!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).simplegis={})}(this,(function(t){"use strict";var e="_maptalks__internal_layer_",i=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],n=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(i),r=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],o=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],s={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},a=["lineColor","polygonFill","markerFill","markerLineColor","textFill"];function h(){return Date.now()}function u(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function l(t){return null==t}function c(t){return"number"==typeof t&&!isNaN(t)}function p(t){return(0|t)===t}function f(t){return"object"==typeof t&&!!t}function d(t){return!l(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function g(t){return!l(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var y=Object.prototype.hasOwnProperty;function _(t,e){return y.call(t,e)}var m=Math.PI/180;function v(t){return t*m}function x(t){return t/m}var w,b,C="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"];function M(t){var e="data:image/svg+xml";return t.length>4&&".svg"===t.slice(-4)?1:t.slice(0,e.length)===e?2:0}function E(t,e){C&&E.node?E.node(t,e):t.src=e[0]}!function(){if(C)return w=function(t){return setTimeout(t,16)},void(b=clearTimeout);var t,e;function i(t){return setTimeout(t,33.333333333333336)}function n(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||n("RequestAnimationFrame")||i,e=window.cancelAnimationFrame||n("CancelAnimationFrame")||n("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=i,e=clearTimeout),w=function(e){return t(e)},b=function(t){t&&e(t)}}();var S=0;function P(){return S++}var I=P;function T(t){return t&&d(t)?JSON.parse(t):t}function L(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n=0,r=i.length;n<r;n++)t.push(i[n])}return t.length}function O(t,e){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function R(t,e,i){if(!Array.isArray(t))return i?e.call(i,t):e(t);for(var n,r,o=[],s=0,a=t.length;s<a;s++)l(n=t[s])?o.push(null):Array.isArray(n)?o.push(R(n,e,i)):(r=i?e.call(i,n):e(n),o.push(r));return o}function N(t,e){return void 0===t?e:t}function A(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function D(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,i=Math.round(e);return Math.abs(i-e)<1e-14?i:e}function k(t,e,i){return t*(1-i)+e*i}function F(t,e,i){if(t===i||t===e)return t;var n=i-e;return((t-e)%n+n)%n+e}function j(t,e,i){return Math.min(i,Math.max(e,t))}function G(t){return Array.isArray(t)&&t.length>0}var z=/^([a-z][a-z\d+\-.]*:)?\/\//i;var B=/^url\((['"])(.+)\1\)$/i,V=/^url\(([^'"].*[^'"])\)$/i;function H(t){return d(t)?V.test(t)?1:B.test(t)?2:3:0}function q(t){var e=H(t);return 3===e?t:1===e?V.exec(t)[1]:2===e?B.exec(t)[2]:t}function Z(t){if("undefined"!=typeof window&&window.btoa)return window.btoa(t);for(var e,i,n=String(t),r="",o=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&e>>8-o%1*8)){if((i=n.charCodeAt(o+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|i}return r}function U(t,e){for(var i=atob(t),n=new ArrayBuffer(i.length),r=new Uint8Array(n),o=0;o<i.length;o++)r[o]=255&i.charCodeAt(o);return new Blob([n],{type:e})}function W(t,e,i,n){var r=i-t,o=n-e;return Math.atan2(o,r)}var Y="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function X(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var i in t)if("center"===i){if(!e[i]||!J(t[i][0],e[i][0])||!J(t[i][1],e[i][1]))return!1}else if(t[i]!==e[i])return!1;return!0}function J(t,e,i){return null==i&&(i=1e-6),t>=e-i&&t<=e+i}function Q(t,e,i,n){t||(t=100),e||(e=4);var r=this;return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function o(){if(0===e)return r.show(),void(i&&(n?i.call(n):i()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(o,t)}),t),this}var K=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function $(t){return new Function("f","var p = (f && f.properties || {}); return "+tt(t))}function tt(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?it(t[1],t[2],"===",!1):"!="===e?it(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?it(t[1],t[2],e,!0):"any"===e?nt(t.slice(1),"||"):"all"===e?nt(t.slice(1),"&&"):"none"===e?st(nt(t.slice(1),"||")):"in"===e?rt(t[1],t.slice(2)):"!in"===e?st(rt(t[1],t.slice(2))):"has"===e?ot(t[1]):"!has"===e?st(ot(t[1])):"true")+")"}function et(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function it(t,e,i,n){var r=et(t),o="$type"===t?K.indexOf(e):JSON.stringify(e);return(n?"typeof "+r+"=== typeof "+o+"&&":"")+r+i+o}function nt(t,e){return t.map(tt).join(e)}function rt(t,e){"$type"===t&&(e=e.map((function(t){return K.indexOf(t)})));var i=JSON.stringify(e.sort(at)),n=et(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function ot(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function st(t){return"!("+t+")"}function at(t,e){return t<e?-1:t>e?1:0}function ht(t){var e=t._toJSON(),i=e.feature;return i.type=K.indexOf(i.geometry.type),i.subType=e.subType,i}function ut(t){if(!Array.isArray(t))return ut([t]);for(var e=[],i=0;i<t.length;i++){var n=void 0;n=!0===t[i].filter?function(){return!0}:$(t[i].filter),e.push(lt({},t[i],{filter:n}))}return e}function lt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function ct(t,e){var i,n,r;if(mt(t)){var o,s=t.stops&&"object"==typeof t.stops[0][0],a=s||void 0!==t.property,h=s||!a,u=t.type||e||"exponential";if("exponential"===u)o=dt;else if("interval"===u)o=ft;else if("categorical"===u)o=pt;else{if("identity"!==u){if("function"===u)return i=function(e,i){return"function"==typeof t.function?t.function(i,e):t.default},n=!1,r=!1,i;throw new Error('Unknown function type "'+u+'"')}o=gt}if(s){for(var l={},c=[],p=0;p<t.stops.length;p++){var f=t.stops[p];void 0===l[f[0].zoom]&&(l[f[0].zoom]={zoom:f[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),l[f[0].zoom].stops.push([f[0].value,f[1]])}for(var d in l)c.push([l[d].zoom,ct(l[d])]);i=function(e,i){var n=dt({stops:c,base:t.base},e)(e,i);return"function"==typeof n?n(e,i):n},n=!1,r=!1}else h?(i=function(e){var i=o(t,e);return"function"==typeof i?i(e):i},n=!0,r=!1):(i=function(e,i){var n=o(t,i?i[t.property]:null);return"function"==typeof n?n(e,i):n},n=!1,r=!0)}else i=function(){return t},n=!0,r=!0;return i.isZoomConstant=r,i.isFeatureConstant=n,i}function pt(t,e){for(var i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.default}function ft(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function dt(t,e){for(var i=void 0!==t.base?t.base:1,n=0;!(n>=t.stops.length||e<=t.stops[n][0]);)n++;return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:yt(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function gt(t,e){return i=e,n=t.default,void 0!==i?i:void 0!==n?n:void 0!==r?r:null;var i,n,r}function yt(t,e,i,n,r,o){return"function"==typeof r?function(){var s=r.apply(void 0,arguments),a=o.apply(void 0,arguments);return yt(t,e,i,n,s,a)}:r.length?function(t,e,i,n,r,o){for(var s=[],a=0;a<r.length;a++)s[a]=_t(t,e,i,n,r[a],o[a]);return s}(t,e,i,n,r,o):_t(t,e,i,n,r,o)}function _t(t,e,i,n,r,o){var s,a=n-i,h=t-i;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function mt(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type||void 0!==t.default&&t.func&&"function"===t.type)}function vt(t){for(var e in t)if(mt(t[e]))return!0;return!1}function xt(t){return Ct(t,"exponential")}function wt(t,e){if(!t)return null;var i=!1;if(Array.isArray(t)){for(var n,r=[],o=0;o<t.length;o++)(n=wt(t[o],e))?(r.push(n),i=!0):r.push(t[o]);return i?r:t}var s,a={__fn_types_loaded:!0},h=[];for(s in t)t.hasOwnProperty(s)&&h.push(s);for(var u=function(t){Object.defineProperty(a,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=xt(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},l=0,c=h.length;l<c;l++)mt(t[s=h[l]])?(i=!0,a["_"+s]=t[s],u(s)):a[s]=t[s];return i?a:t}function bt(t){if(!t||!t.stops)return[];for(var e=[],i=0,n=t.stops.length;i<n;i++)e.push(t.stops[i][1]);return e}function Ct(t,e){if(!mt(t))return function(){return t};var i=!0,n=!0,r=t.stops;if(r)for(var o=0;o<r.length;o++)if(mt(r[o][1])){var s=Ct(r[o][1],e);i=i&&s.isZoomConstant,n=n&&s.isFeatureConstant,r[o]=[r[o][0],s]}var a=ct(t,e);return a.isZoomConstant=i&&a.isZoomConstant,a.isFeatureConstant=n&&a.isFeatureConstant,a}var Mt=Object.freeze({createFilter:$,getFilterFeature:ht,compileStyle:ut,isFunctionDefinition:mt,hasFunctionDefinition:vt,interpolated:xt,piecewiseConstant:function(t){return Ct(t,"interval")},loadFunctionTypes:wt,getFunctionTypeResources:bt});function Et(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function St(t,e,i){if(!t.markerPath)return null;var n=1,r=Et(t);c(t.markerOpacity)&&(n=t.markerOpacity),c(t.opacity)&&(n*=t.opacity);var o={};if(r){for(var s in r.stroke)r.stroke.hasOwnProperty(s)&&(l(r.stroke[s])||(o[s]=r.stroke[s]));for(var a in r.fill)r.fill.hasOwnProperty(a)&&(l(r.fill[a])||(o[a]=r.fill[a]))}for(var h,p=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],f=[],g=0;g<p.length;g++)(h=u({},h=d(p[g])?{path:p[g]}:p[g],o)).d=h.path,delete h.path,f.push(h);var y=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];n<1&&y.push('opacity="'+n+'"'),t.markerPathWidth&&t.markerPathHeight&&y.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),y.push('preserveAspectRatio="none"'),e&&y.push('width="'+e+'"'),i&&y.push('height="'+i+'"'),y.push("><defs></defs>");for(var _=0;_<f.length;_++){var m="<path ";for(var v in f[_])f[_].hasOwnProperty(v)&&(m+=" "+v+'="'+f[_][v]+'"');m+="></path>",y.push(m)}return y.push("</svg>"),"data:image/svg+xml;base64,"+Z(y.join(" "))}function Pt(t,e){if(!t)return[];var i=t;Array.isArray(t)||(i=[t]);for(var n,s,a,h,u=[],l=r,c=i.length-1;c>=0;c--)if(t=i[c]){e&&(t=It(t));for(var p=0;p<l.length;p++)if(mt(n=t[l[p]])&&(n=bt(n)),n){Array.isArray(n)||(n=[n]);for(var f=0;f<n.length;f++)"url("===n[f].slice(0,4)&&(n[f]=q(n[f])),s=o[p],u.push([n[f],t[s[0]],t[s[1]]])}if("path"===t.markerType&&t.markerPath)if(a=mt(t.markerWidth)?200:t.markerWidth,h=mt(t.markerHeight)?200:t.markerHeight,mt(t.markerPath)){n=bt(t.markerPath);for(var d=t.markerPath,g=0;g<n.length;g++)t.markerPath=n[g],u.push([St(t),a,h]);t.markerPath=d}else u.push([St(t),a,h])}return u}function It(t){if(!t)return null;var e=t;if(C)return e;for(var i,n=r,o=0,s=n.length;o<s;o++)(i=e[n[o]])&&(e[n[o]]=Tt(i));return e}function Tt(t){if(mt(t)){for(var e=t.stops,i=0;i<e.length;i++)e[i][1]=Tt(e[i][1]);return t}return"url("===t.slice(0,4)&&(t=q(t)),t}function Lt(t){return t&&t.colorStops}function Ot(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var i=[],n=t.colorStops.length-1;n>=0;n--)i.push(t.colorStops[n].join());e.push(i.join(","))}return e.join("_")}function Rt(t,e){function i(t,e){l(t.opacity)?t.opacity=e:t.opacity*=e}var n;if(Array.isArray(t)){n=[];for(var r=0;r<t.length;r++){var o=u({},t[r]);i(o,e),n.push(o)}}else i(n=u({},t),e);return n}function Nt(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var i,n,r=[],o=0,s=t.length;o<s;o++){i=t[o],n={};for(var a=0,h=e.length;a<h;a++)Array.isArray(e[a])?l(e[a][o])?u(n,i||{}):u(n,i,e[a][o]):u(n,i,e[a]?e[a]:{});r.push(n)}return r}var c=[{},t];return c.push.apply(c,e),u.apply(this,c)}function At(t){if(t.symbol&&(t=[t]),Array.isArray(t))return t;var e=t.$root,i=t.$iconset;if(t=t.style,e||i){e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),i&&"/"===i[i.length-1]&&(i=i.substring(0,i.length-1));t=Dt(t,(function(t){return"{$root}"===t?e:"{$iconset}"===t?i:null}))}return t}function Dt(t,e){for(var i=0;i<t.length;i++){var n=t[i].symbol;n&&Ft(n,e)}}var kt=/(\{\$root\}|\{\$iconset\})/g;function Ft(t,e){for(var i in t)t.hasOwnProperty(i)&&"textName"!==i&&(d(t[i])&&t[i].length>2?t[i]=t[i].replace(kt,e):mt(t[i])?t[i]=jt(t[i],e):f(t[i])&&Ft(t[i],e))}function jt(t,e){var i=t.default;d(i)&&(t.default=i.replace(kt,e));for(var n=t.stops,r=0;r<n.length;r++)Array.isArray(n[r])&&(d(n[r][1])?n[r][1]=n[r][1].replace(kt,e):mt(n[r][1])&&(n[r][1]=jt(n[r][1],e)));return t}var Gt=Object.freeze({now:h,extend:u,isNil:l,isNumber:c,isInteger:p,isObject:f,isString:d,isFunction:g,hasOwn:_,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},isEmpty:function(t){var e;for(e in t)return!1;return!e},toRadian:v,toDegree:x,IS_NODE:C,get requestAnimFrame(){return w},get cancelAnimFrame(){return b},isSVG:M,loadImage:E,UID:P,GUID:I,parseJSON:T,pushIn:L,removeFromArray:O,forEachCoord:R,getValueOrDefault:N,sign:A,log2:D,interpolate:k,wrap:F,clamp:j,isArrayHasData:G,isURL:function(t){return z.test(t)},isCssUrl:H,extractCssUrl:q,btoa:Z,b64toBlob:U,computeDegree:W,emptyImageUrl:Y,equalMapView:X,flash:Q,_defaults:function(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}return t},translateToSVGStyles:Et,getMarkerPathBase64:St,getExternalResources:Pt,convertResourceUrl:It,isGradient:Lt,getGradientStamp:Ot,getSymbolStamp:function t(e){var i=[];if(Array.isArray(e)){for(var n=0;n<e.length;n++)i.push(t(e[n]));return"[ "+i.join(" , ")+" ]"}for(var r in e)_(e,r)&&(g(e[r])||(Lt(e[r])?i.push(r+"="+Ot(e[r])):i.push(r+"="+e[r])));return i.join(";")},lowerSymbolOpacity:Rt,extendSymbol:Nt,parseStyleRootPath:At,convertStylePath:Dt}),zt={};if(!C){var Bt=navigator.userAgent.toLowerCase(),Vt=document.documentElement,Ht="ActiveXObject"in window,qt=-1!==Bt.indexOf("webkit"),Zt=-1!==Bt.indexOf("phantom"),Ut=-1!==Bt.search("android [23]"),Wt=-1!==Bt.indexOf("chrome"),Yt=-1!==Bt.indexOf("gecko")&&!qt&&!window.opera&&!Ht,Xt="undefined"!=typeof orientation||-1!==Bt.indexOf("mobile"),Jt=!window.PointerEvent&&window.MSPointerEvent,Qt=window.PointerEvent&&navigator.pointerEnabled||Jt,Kt=Ht&&"transition"in Vt.style,$t="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ut,te="MozPerspective"in Vt.style,ee="OTransition"in Vt.style,ie=(Kt||$t||te)&&!ee&&!Zt,ne=0;Wt&&(ne=Bt.match(/chrome\/([\d.]+)/)[1]);var re,oe=!Zt&&(Qt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);try{var se=document.createElement("canvas"),ae=se.getContext("webgl")||se.getContext("experimental-webgl");re=ae&&ae instanceof WebGLRenderingContext}catch(t){re=!1}var he=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI;zt={ie:Ht,ielt9:Ht&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:qt,gecko:Yt,android:-1!==Bt.indexOf("android"),android23:Ut,chrome:Wt,chromeVersion:ne,safari:!Wt&&-1!==Bt.indexOf("safari"),phantomjs:Zt,ie3d:Kt,webkit3d:$t,gecko3d:te,opera12:ee,any3d:ie,mobile:Xt,mobileWebkit:Xt&&qt,mobileWebkit3d:Xt&&$t,mobileOpera:Xt&&window.opera,mobileGecko:Xt&&Yt,touch:!!oe,msPointer:!!Jt,pointer:!!Qt,retina:he>1,devicePixelRatio:he,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:Ht&&9===document.documentMode,ie10:Ht&&10===document.documentMode,webgl:re}}var ue=zt;function le(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,ce(t,e)}function ce(t,e){return ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ce(t,e)}function pe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var fe=function(){function t(t,e){if(l(t)||l(e)?l(t.x)||l(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1]):(this.x=+t.x,this.y=+t.y):(this.x=+t,this.y=+e),this._isNaN())throw new Error("Position is NaN")}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},e._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},e._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},e.distanceTo=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},e._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},e.copy=function(){return new this.constructor(this.x,this.y)},e._add=function(t,e){return l(t.x)?l(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.add=function(t,e){var i,n;return l(t.x)?l(t[0])?(i=this.x+t,n=this.y+e):(i=this.x+t[0],n=this.y+t[1]):(i=this.x+t.x,n=this.y+t.y),new this.constructor(i,n)},e._sub=function(t,e){return l(t.x)?l(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(t,e){var i,n;return l(t.x)?l(t[0])?(i=this.x-t,n=this.y-e):(i=this.x-t[0],n=this.y-t[1]):(i=this.x-t.x,n=this.y-t.y),new this.constructor(i,n)},e.substract=function(){return this.sub.apply(this,arguments)},e.multi=function(t){return new this.constructor(this.x*t,this.y*t)},e._multi=function(t){return this.x*=t,this.y*=t,this},e.div=function(t){return this.multi(1/t)},e._div=function(t){return this._multi(1/t)},e.equals=function(t){return t instanceof this.constructor&&(this.x===t.x&&this.y===t.y)},e._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},e.isZero=function(){return 0===this.x&&0===this.y},e.toArray=function(){return[this.x,this.y]},e.toFixed=function(t){return new this.constructor(this.x.toFixed(t),this.y.toFixed(t))},e.toJSON=function(){return{x:this.x,y:this.y}},t}(),de=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},i.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.unit=function(){return this.copy()._unit()},i._unit=function(){return this._div(this.mag()),this},i.perp=function(){return this.copy()._perp()},i._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},i.angleWith=function(t){return this.angleWithSep(t.x,t.y)},i.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},i._rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},i.rotate=function(t){return this.copy()._rotate(t)},e}(fe),ge=function(){function t(t,e){c(t)&&c(e)?(this.width=t,this.height=e):c(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}var e=t.prototype;return e.copy=function(){return new t(this.width,this.height)},e.add=function(e,i){var n,r;return e instanceof t?(n=this.width+e.width,r=this.height+e.height):(n=this.width+e,r=this.height+i),new t(n,r)},e.equals=function(t){return this.width===t.width&&this.height===t.height},e.multi=function(e){return new t(this.width*e,this.height*e)},e._multi=function(t){return this.width*=t,this.height*=t,this},e._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.toPoint=function(){return new de(this.width,this.height)},e.toArray=function(){return[this.width,this.height]},e.toJSON=function(){return{width:this.width,height:this.height}},t}();function ye(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}var _e=/[\b\t\r\v\f]/gim;function me(t){return d(t)?t.replace(_e,""):t}function ve(t){return ye(t).split(/\s+/)}var xe="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function we(t,e){return we.node?we.node(t,e):(xe.font=e,xe.measureText(t).width)}function be(t,e,i){var n=we(t,e);return new ge(n,i||14)}function Ce(t,e,i,n){if(!t||0===t.length)return[{text:"",width:0}];var r=l(n)?we(t,e):n,o=r/t.length,s=Math.floor(i/o/2);if(o>=i||s<=0)return[{text:"",width:i}];if(r<=i)return[{text:t,width:r}];for(var a=[],h=t.substring(0,s),u=o*s,c=s,p=t.length;c<p;c++){var f=t[c],d=we(h+f);d>=i?(a.push({text:h,width:u}),h=t.substring(c,s+c),c+=s-1,u=o*s):(h+=f,u=d),c>=p-1&&(u=we(h),a.push({text:h,width:u}))}return a}var Me=/\{([\w_]+)\}/g;function Ee(t,e){return d(t)?t.replace(Me,(function(t,i){if(!e)return"";var n=e[i];return l(n)?"":Array.isArray(n)?n.join():n})):t}function Se(t,e,i){var n=t.width,r=t.height;return new de("left"===e?-n:"right"===e?0:-n/2,"top"===i?-r:"bottom"===i?0:-r/2)}function Pe(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+(t.textFaceName?'"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"':"monospace")}function Ie(t,e){var i=Pe(e),n=e.textLineSpacing||0,r=be(t,i,e.textSize),o=r.width,s=r.height,a=e.textWrapCharacter,h=[],u=e.textWrapWidth;(!u||u>o)&&(u=o),d(t)||(t+="");var l=0;if(a&&t.indexOf(a)>=0)for(var c=t.split(a),p=0,f=c.length;p<f;p++){var g=c[p],y=we(g,i);if(y>u)for(var _=Ce(g,i,u,y),m=0,v=_.length;m<v;m++){var x=_[m].width;x>l&&(l=x),h.push({text:_[m].text,size:new ge(x,s)})}else y>l&&(l=y),h.push({text:g,size:new ge(y,s)})}else if(o>u)for(var w=Ce(t,i,u,o),b=0;b<w.length;b++){var C=w[b].width;C>l&&(l=C),h.push({text:w[b].text,size:new ge(C,s)})}else o>l&&(l=o),h.push({text:t,size:r});var M=h.length;return{total:M,size:new ge(l,s*M+n*(M-1)),rows:h,rawSize:r}}var Te=Object.freeze({trim:ye,escapeSpecialChars:me,splitWords:ve,stringWidth:we,stringLength:be,getFontHeight:function(t){var e=Qe("span");"_default_"!==t&&(e.style.font=t),e.innerHTML="秦";var i=e.clientHeight;return ke(e),i},splitContent:Ce,replaceVariable:Ee,getAlignPoint:Se,getFont:Pe,splitTextToRow:Ie}),Le=C?function(t){return t[0]}:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},Oe=Le(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Re=Le(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),Ne=Le(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);function Ae(t,e){var i=document.createElement(t);return e&&Ye(i,e),i}function De(t,e,i){var n=Ae(t);return e&&Ze(n,e),i&&i.appendChild(n),n}function ke(t){if(!t)return this;if(ue.ielt9||ue.ie9){var e=Ae("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function Fe(t,e,i,n){if(!(t&&t.addEventListener&&e&&i))return this;for(var r=function(e){e||(e=window.event),i.call(n||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];if(a)t["Z__"+a]||(t["Z__"+a]=[]),Ge(t,a,i)>=0&&je(t,a,i),t["Z__"+a].push({callback:r,src:i}),ue.ie?t.addEventListener(a,r,!1):t.addEventListener(a,r,{capture:!1,passive:!1})}return this}function je(t,e,i){function n(e,i){"mousewheel"===e&&ue.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,i,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!i&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,u=a.length;h<u;h++)n(a[h].callback);return delete t["Z__"+s],this}var l=Ge(t,s,i);if(l<0)return this;n(s,t["Z__"+s][l].callback),t["Z__"+s].splice(l,1)}}return this}function Ge(t,e,i){if(!t||!t["Z__"+e]||!i)return-1;for(var n=t["Z__"+e],r=0,o=n.length;r<o;r++)if(n[r].src===i)return r;return-1}function ze(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Be(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function Ve(t,e){return t?(ue.any3d?function(t,e){var i=e||new de(0,0);t.style[Oe]=ue.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)"}(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function He(t){var e=window.getComputedStyle(t),i=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],n=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight,s=r?n.width/r:1,a=o?n.height/o:1;return t.__position=[n.left+i[0],n.top+i[1],s,a],t.__position}function qe(t,e){t||(t=window.event);var i=e.__position;return i||(i=He(e)),new de((t.clientX-i[0]-e.clientLeft)/i[2],(t.clientY-i[1]-e.clientTop)/i[3])}function Ze(t,e){var i,n,r,o=t.style.cssText;return n=";",(r=(i=o).length-n.length)>=0&&i.indexOf(n,r)===r||(o+=";"),t.style.cssText=o+e,this}function Ue(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=Xe(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function We(t,e){if(void 0===t.classList||Ue(t,e)){var i=Xe(t);Ye(t,(i?i+" ":"")+e)}else for(var n=ve(e),r=0,o=n.length;r<o;r++)t.classList.add(n[r]);return this}function Ye(t,e){return l(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function Xe(t){return l(t.className.baseVal)?t.className:t.className.baseVal}function Je(t,e){var i=Qe(t);d(e)?i.innerHTML=e:i.appendChild(e);var n=new ge(i.clientWidth,i.clientHeight);return ke(i),n}function Qe(t){var e=document.createElement(t);return e.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(e),e}Le(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);var Ke=Fe,$e=je,ti={jsonp:function(t,e){var i="_maptalks_jsonp_"+P();t.match(/\?/)?t+="&callback="+i:t+="?callback="+i;var n=document.createElement("script");return n.type="text/javascript",n.src=t,window[i]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[i]},document.getElementsByTagName("head")[0].appendChild(n),this},get:function(t,e,i){if(g(e)){var n=i;i=e,e=n}if(C&&ti.get.node)return ti.get.node(t,i,e);var r=ti._getClient(i);if(r.open("GET",t,!0),e){for(var o in e.headers)r.setRequestHeader(o,e.headers[o]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,i){var n;if(d(t)){if(g(e)){var r=i;i=e,e=r}n=(e=e||{}).postData}else{var o=i;n=e,t=(e=t).url,i=o}if(C&&ti.post.node)return e.url=t,ti.post.node(e,n,i);var s=ti._getClient(i);if(s.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in s)for(var a in e.headers)e.headers.hasOwnProperty(a)&&s.setRequestHeader(a,e.headers[a]);return d(n)||(n=JSON.stringify(n)),s.send(n),s},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=ti._wrapCallback(e,t),e},getArrayBuffer:function(t,e,i){if(g(e)){var n=i;i=e,e=n}return e||(e={}),e.responseType="arraybuffer",ti.get(t,e,i)},getImage:function(t,e,i){return ti.getArrayBuffer(e,i,(function(e,i){if(e)t.onerror&&t.onerror(e);else if(i){var n=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),n.revokeObjectURL(t.src)};var o=new Blob([new Uint8Array(i.data)],{type:i.contentType});t.cacheControl=i.cacheControl,t.expires=i.expires,t.src=i.data.byteLength?n.createObjectURL(o):Y}}))},getJSON:function(t,e,i){if(g(e)){var n=i;i=e,e=n}var r=function(t,e){var n=e?T(e):null;i(t,n)};return e&&e.jsonp?ti.jsonp(t,r):ti.get(t,e,r)}},ei="#000",ii=!1,ni=null,ri=Math.PI/180,oi={setHitTesting:function(t){ii=t},createCanvas:function(t,e,i){var n;return C?n=new i(t,e):((n=Ae("canvas")).width=t,n.height=e),n},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=Pe(e);var i=e.textFill;i||(i="#000"),t.fillStyle=oi.getRgba(i,e.textOpacity)},prepareCanvas:function(t,e,i,n){if(e){var r=e.lineWidth;l(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile,s=e.lineColor||ei;if(n)t.strokeStyle="#000";else if(o&&i){var a;(e.linePatternDx||e.linePatternDy)&&(a=[e.linePatternDx,e.linePatternDy]),oi._setStrokePattern(t,o,r,a,i),e.lineDasharray=[]}else Lt(s)?e.lineGradientExtent?t.strokeStyle=oi._createGradient(t,s,e.lineGradientExtent):t.strokeStyle=ei:t.strokeStyle=s;e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&G(e.lineDasharray)&&t.setLineDash(e.lineDasharray),e.lineDashOffset&&(t.lineDashOffset=e.lineDashOffset);var h=e.polygonPatternFile,u=e.polygonFill||"rgba(255,255,255,0)";if(n)t.fillStyle="#000";else if(h&&i){var c=hi(h),p=i.getImage([c,null,null]);if(p||(p=i.getImage([c+"-texture",null,r])),M(c)&&p instanceof Image&&(ue.edge||ue.ie)){var f=p.width||20,d=p.height||20,g=oi.createCanvas(f,d);oi.image(g.getContext("2d"),p,0,0,f,d),p=g}p?(t.fillStyle=t.createPattern(p,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",c)}else Lt(u)?e.polygonGradientExtent?t.fillStyle=oi._createGradient(t,u,e.polygonGradientExtent):t.fillStyle="rgba(255,255,255,0)":t.fillStyle=u}},_createGradient:function(t,e,i){var n=null,r=e.places,o=i.getMin(),s=i.getMax(),a=i.getWidth(),h=i.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var u=i.getCenter()._round();r=[u.x,u.y,Math.abs(u.x-o.x),u.x,u.y,0]}n=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];n=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach((function(t){n.addColorStop.apply(n,t)})),n},_setStrokePattern:function(t,e,i,n,r){var o,s=hi(e);if(C)o=r.getImage([s,null,i]);else{var a=s+"-texture-"+i;if(!(o=r.getImage(a))){var h=r.getImage([s,null,null]);if(h){var u;u=h.width&&h.height?Math.round(h.width*i/h.height):i;var l=oi.createCanvas(u,i,t.canvas.constructor);oi.image(l.getContext("2d"),h,0,0,u,i),r.addResource([a,null,i],l),o=l}}}o?(t.strokeStyle=t.createPattern(o,"repeat"),t.strokeStyle.linePatternOffset=n):"undefined"!=typeof console&&console.warn("img not found for",s)},clearRect:function(t,e,i,n,r){t.canvas._drawn=!1,t.clearRect(e,i,n,r)},fillCanvas:function(t,e,i,n){if(ii&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=oi._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=s?s[0]:0,h=s?s[1]:0;l(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),o&&(i=i||0,n=n||0,t.translate(i+a,n+h)),t.fill(),o&&t.translate(-i-a,-n-h),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return l(e)&&(e=1),"#"!==t[0]?t:(7===t.length?(i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(i=17*parseInt(t.substring(1,2),16),n=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+i+","+n+","+r+","+e+")");var i,n,r},image:function(t,e,i,n,r,o){t.canvas._drawn=!0;try{c(r)&&c(o)?t.drawImage(e,i,n,r,o):t.drawImage(e,i,n)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}},text:function(t,e,i,n,r){oi._textOnMultiRow(t,r.rows,n,i,r.size,r.rawSize)},_textOnMultiRow:function(t,e,i,n,r,o){for(var s,a,h=Se(r,i.textHorizontalAlignment,i.textVerticalAlignment),u=o.height+i.textLineSpacing,l=n.add(0,h.y),c=i.textMaxHeight,p=0,f=0,d=e.length;f<d&&(s=e[f].text,a=Se(e[f].size,i.textHorizontalAlignment,i.textVerticalAlignment),oi._textOnLine(t,s,l.add(a.x,f*u),i.textHaloRadius,i.textHaloFill,i.textHaloOpacity),!(c>0&&(p+=u)+o.height>=c));f++);},_textOnLine:function(t,e,i,n,r,o){ii&&(o=1);var s,a,h=0!==o&&0!==n;t.textBaseline="top";var u=t.shadowBlur,l=t.shadowOffsetX,c=t.shadowOffsetY;if(h){var p=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*n,t.strokeStyle=r,t.strokeText(e,i.x,i.y+1),t.miterLimit=10,t.globalAlpha=p,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",a=t.fillStyle,t.fillStyle="#000"}u&&h&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),oi.fillText(t,e,i),s&&(t.globalCompositeOperation=s,oi.fillText(t,e,i,a),u&&(t.shadowBlur=u,t.shadowOffsetX=l,t.shadowOffsetY=c))},fillText:function(t,e,i,n){t.canvas._drawn=!0,n&&(t.fillStyle=n),t.fillText(e,i.x,i.y+1)},_stroke:function(t,e,i,n){if(ii&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=o?o[0]:0,a=o?o[1]:0,h=oi._isPattern(t.strokeStyle)&&(!l(i)&&!l(n)||!l(s)&&!l(a));l(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),h&&(i=i||0,n=n||0,t.translate(i+s,n+a)),t.stroke(),h&&t.translate(-i-s,-n-a),e<1&&(t.globalAlpha=r)}},_path:function(t,e,i,n,r){if(G(e))for(var o,s,a=G(i),h=!0!==r&&oi._isPattern(t.strokeStyle),u=0,l=e.length;u<l;u++)if(o=e[u],!a||t.setLineDash)t.lineTo(o.x,o.y),h&&u>0&&(c(e[u-1],o),t.beginPath(),t.moveTo(o.x,o.y));else if(a){if(u===l-1)break;s=e[u+1],si(t,o,s,i)}function c(e,i){var r=W(e.x,e.y,i.x,i.y);t.save();var o=Math.cos(r);Math.abs(o)<1e-7?t.translate(e.x-t.lineWidth/2,e.y):t.translate(e.x,e.y-t.lineWidth/2/o),t.rotate(r),oi._stroke(t,n),t.restore()}},path:function(t,e,i,n,r){G(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),oi._path(t,e,r,i),oi._stroke(t,i))},_multiClip:function(t,e){if(e&&0!==e.length)for(var i=0,n=(e=e[0]).length;i<n;i++){var r=e[i],o=r.x,s=r.y;0===i?t.moveTo(o,s):t.lineTo(o,s),i===n-1&&(o=e[0].x,s=e[0].y,t.lineTo(o,s))}},polygon:function(t,e,i,n,r,o){if(t.isMultiClip)oi._multiClip(t,e);else if(G(e)){var s=oi._isPattern(t.strokeStyle),a=G(r)&&!t.setLineDash||s&&!o;G(e[0])||(e=[e]);var h,u,l,c=t;if(e.length>1&&!C&&(ni||(ni=oi.createCanvas(1,1)),t.canvas._drawn=!1,ni.width=t.canvas.width,ni.height=t.canvas.height,ui(t=ni.getContext("2d"),c)),a){for(t.save(),u=0,l=e.length;u<l;u++)G(e[u])&&(oi._ring(t,e[u],null,0,!0),h=n,u>0&&(t.globalCompositeOperation="destination-out",h=1),oi.fillCanvas(t,h,e[u][0].x,e[u][0].y),u>0?t.globalCompositeOperation="source-over":l>1&&(t.fillStyle="#fff"),oi._stroke(t,0));t.restore()}for(u=0,l=e.length;u<l;u++)G(e[u])&&(o?(oi.paintSmoothLine(t,e[u],i,o,!0),t.closePath()):oi._ring(t,e[u],r,i),a||(h=n,u>0&&(t.globalCompositeOperation="destination-out",h=1),oi.fillCanvas(t,h,e[u][0].x,e[u][0].y),u>0?t.globalCompositeOperation="source-over":l>1&&(t.fillStyle="#fff")),oi._stroke(t,i));e.length>1&&!C&&(c.drawImage(ni,0,0),c.canvas._drawn=t.canvas._drawn,ui(c,t))}},_ring:function(t,e,i,n,r){var o=oi._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),oi._path(t,e,i,n,r),o||t.closePath()},paintSmoothLine:function(t,e,i,n,r,o,s){if(e)if(e.length<=2||!n)oi.path(t,e,i);else{var a,h=e.length,u=r?h:h-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(u-=Math.max(u-o-1,0));for(var l=0;l<u;l++){var c=e[l].x,p=e[l].y,f=void 0,d=void 0,g=void 0,y=void 0,_=void 0,m=void 0;l-1<0?r?(f=e[u-1].x,d=e[u-1].y):(f=e[l+1].x,d=e[l+1].y):(f=e[l-1].x,d=e[l-1].y),l+1<h?(g=e[l+1].x,y=e[l+1].y):(g=e[l+1-h].x,y=e[l+1-h].y),l+2<h?(_=e[l+2].x,m=e[l+2].y):r?(_=e[l+2-h].x,m=e[l+2-h].y):(_=e[l].x,m=e[l].y);var v=w(f,d,c,p,g,y,_,m,n,l===u-1?s:1);if(l===u-1&&s>=0&&s<1){t.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5]),e.splice(u-1,h-(u-1)-1);var x=new de(v[4],v[5]);x.prevCtrlPoint=new de(v[2],v[3]),e.push(x),h=e.length}else t.bezierCurveTo(v[0],v[1],v[2],v[3],g,y);e[l].nextCtrlPoint=v.slice(0,2),e[l].prevCtrlPoint=a?a.slice(2):null,a=v}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[h-1].prevCtrlPoint||(e[h-1].prevCtrlPoint=e[h-2].nextCtrlPoint),oi._stroke(t,i)}function w(t,e,i,n,r,o,s,a,h,u){var l=(t+i)/2,c=(e+n)/2,p=(i+r)/2,f=(n+o)/2,d=(r+s)/2,g=(o+a)/2,y=Math.sqrt((i-t)*(i-t)+(n-e)*(n-e)),_=Math.sqrt((r-i)*(r-i)+(o-n)*(o-n)),m=y/(y+_),v=_/(_+Math.sqrt((s-r)*(s-r)+(a-o)*(a-o))),x=l+(p-l)*m,w=c+(f-c)*m,b=p+(d-p)*v,C=f+(g-f)*v,M=x+(p-x)*h+i-x,E=w+(f-w)*h+n-w,S=b+(p-b)*h+r-b,P=C+(f-C)*h+o-C,I=[M,E,S,P];return u<1?function(t,e,i,n,r,o,s,a,h,u){var l=1-t,c=1-e,p=i*c*c+2*r*e*c+s*e*e,f=r*c*c+2*s*e*c+h*e*e,d=n*c*c+2*o*e*c+a*e*e,g=o*c*c+2*a*e*c+u*e*e;return[(i*l*l+2*r*t*l+s*t*t)*c+(r*l*l+2*s*t*l+h*t*t)*e,(n*l*l+2*o*t*l+a*t*t)*c+(o*l*l+2*a*t*l+u*t*t)*e,p*l+f*t,d*l+g*t,p*c+f*e,d*c+g*e]}(0,u,i,n,M,E,S,P,r,o):I}},_arcBetween:function(t,e,i,n){var r=n,o=e.distanceTo(i),s=o/2/Math.sin(r/2),a=Math.asin((i.y-e.y)/o);e.x>i.x&&(a=Math.PI-a);var h=a-(90*ri-r/2),u=Math.cos(h)*s,l=Math.sin(h)*s,c=e.x+u,p=e.y+l,f=Math.asin((i.y-p)/s);c>i.x&&(f=Math.PI-f);var d=f+r;return t.beginPath(),t.arc(c,p,s,f,d),[c,p]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,i,n){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),oi._bezierCurveTo.apply(oi,o),oi.fillCanvas(t,n),oi._stroke(t,i)},_bezierCurveTo:function(t,e,i,n){t.bezierCurveTo(e.x,e.y,i.x,i.y,n.x,n.y)},ellipse:function(t,e,i,n,r,o,s){var a,h,u,l,c,p,f,d,g;t.beginPath(),i===n&&i===r?t.arc(e.x,e.y,i,0,2*Math.PI):t.ellipse?n!==r?(t.ellipse(e.x,e.y,i,n,0,180*ri,360*ri,!1),t.ellipse(e.x,e.y,i,r,0,0,180*ri,!1)):t.ellipse(e.x,e.y,i,n,0,0,360*ri,!1):(a=e.x,h=e.y,f=(u=i)*(p=.5522848),d=(l=n)*p,g=(c=r)*p,t.moveTo(a-u,h),t.bezierCurveTo(a-u,h-d,a-f,h-l,a,h-l),t.bezierCurveTo(a+f,h-l,a+u,h-d,a+u,h),t.bezierCurveTo(a+u,h+g,a+f,h+c,a,h+c),t.bezierCurveTo(a-f,h+c,a-u,h+g,a-u,h),t.closePath()),oi.fillCanvas(t,s,e.x-i,e.y-n),oi._stroke(t,o,e.x-i,e.y-n)},rectangle:function(t,e,i,n,r){var o=e.x,s=e.y;t.beginPath(),t.rect(o,s,i.width,i.height),oi.fillCanvas(t,r,o,s),oi._stroke(t,n,o,s)},sector:function(t,e,i,n,r,o){var s=ri,a=n[0],h=n[1];function u(t,e,i,n,a,h){var u=s*-h,l=s*-a;t.beginPath(),t.moveTo(e,i),t.arc(e,i,n,u,l),t.lineTo(e,i),oi.fillCanvas(t,o,e-n,i-n),oi._stroke(t,r,e-n,i-n)}u(t,e.x,e.y,i,a,h)},_isPattern:function(t){return!d(t)&&!("addColorStop"in t)},drawCross:function(t,e,i,n,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=n,t.beginPath(),t.moveTo(e-5,i),t.lineTo(e+5,i),t.moveTo(e,i-5),t.lineTo(e,i+5),t.stroke()},copy:function(t,e){var i=e||Ae("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0),i}};function si(t,e,i,n){var r=e.x,o=e.y,s=i.x,a=i.y,h=n,u=function(t,e){return t<=e},l=function(t,e){return t>=e},c=function(t,e){return Math.min(t,e)},p=function(t,e){return Math.max(t,e)},f={thereYet:l,cap:c},d={thereYet:l,cap:c};o-a>0&&(d.thereYet=u,d.cap=p),r-s>0&&(f.thereYet=u,f.cap=p),t.moveTo(r,o);for(var g,y,_=r,m=o,v=0,x=!0;!f.thereYet(_,s)||!d.thereYet(m,a);)g=Math.atan2(a-o,s-r),y=h[v],_=f.cap(s,_+Math.cos(g)*y),m=d.cap(a,m+Math.sin(g)*y),x?t.lineTo(_,m):t.moveTo(_,m),v=(v+1)%h.length,x=!x}var ai="data:image/";function hi(t){return t.substring(0,ai.length)===ai?t:q(t)}function ui(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle}var li="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ci(t,e){return t(e={exports:{}},e.exports),e.exports}var pi=ci((function(t){!function(e){var i,n,r="fulfilled",o="undefined",s=function(){var t=[],i=0;function r(){for(;t.length-i;){try{t[i]()}catch(t){e.console&&e.console.error(t)}t[i++]=n,1024==i&&(t.splice(0,1024),i=0)}}var s=function(){if(typeof MutationObserver===o)return typeof process!==o&&"function"==typeof process.nextTick?function(){process.nextTick(r)}:typeof setImmediate!==o?function(){setImmediate(r)}:function(){setTimeout(r,0)};var t=document.createElement("div");return new MutationObserver(r).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(e){t.push(e),t.length-i==1&&s()}}();function a(t){if(!(this instanceof a))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){var e=this;try{t((function(t){e.resolve(t)}),(function(t){e.reject(t)}))}catch(t){e.reject(t)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+t+" is not a function")}function h(t,e){if("function"==typeof t.y)try{var i=t.y.call(n,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function u(t,e){if("function"==typeof t.n)try{var i=t.n.call(n,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.reject(e)}a.prototype={resolve:function(t){if(this.state===i){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var e=this;if(t&&("function"==typeof t||"object"==typeof t))try{var n=!0,o=t.then;if("function"==typeof o)return void o.call(t,(function(t){n&&(n=!1,e.resolve(t))}),(function(t){n&&(n=!1,e.reject(t))}))}catch(o){return void(n&&this.reject(o))}this.state=r,this.v=t,e.c&&s((function(){for(var i=0,n=e.c.length;i<n;i++)h(e.c[i],t)}))}},reject:function(t){if(this.state===i){var n=this;this.state="rejected",this.v=t;var r=this.c;s(r?function(){for(var e=0,i=r.length;e<i;e++)u(r[e],t)}:function(){n.handled||!a.suppressUncaughtRejectionError&&e.console&&a.warn("You upset Zousan. Please catch rejections: ",t,t?t.stack:null)})}},then:function(t,e){var n=new a,o={y:t,n:e,p:n};if(this.state===i)this.c?this.c.push(o):this.c=[o];else{var l=this.state,c=this.v;this.handled=!0,s((function(){l===r?h(o,c):u(o,c)}))}return n},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var i=this;return new a((function(n,r){setTimeout((function(){r(Error(e))}),t),i.then((function(t){n(t)}),(function(t){r(t)}))}))}},a.resolve=function(t){var e=new a;return e.resolve(t),e},a.reject=function(t){var e=new a;return e.c=[],e.reject(t),e},a.all=function(t){var e=[],i=0,n=new a;function r(r,o){r&&"function"==typeof r.then||(r=a.resolve(r)),r.then((function(r){e[o]=r,++i==t.length&&n.resolve(e)}),(function(t){n.reject(t)}))}for(var o=0;o<t.length;o++)r(t[o],o);return t.length||n.resolve(e),n},a.warn=console.warn,t.exports&&(t.exports=a),e.define&&e.define.amd&&e.define([],(function(){return a})),(e.Zousan=a).soon=s}(li)})),fi="undefined"!=typeof Promise?Promise:pi,di=function(t){return function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.on=function(t,e,i){if(!t)return this;if(!d(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var n,r,o=t.toLowerCase().split(" ");i||(i=this);for(var s=0,a=o.length;s<a;s++){n=o[s],(r=this._eventMap[n])||(r=[],this._eventMap[n]=r);var h=r.length;if(h>0)for(var u=0;u<h;u++)if(e===r[u].handler&&r[u].context===i)return this;r.push({handler:e,context:i})}return this},i.addEventListener=function(){return this.on.apply(this,arguments)},i.once=function(t,e,i){if(!d(t)){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=this._wrapOnceHandler(r,t[r],i));return this._switch("on",n)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,i));return this},i.off=function(t,e,i){if(!this._eventMap||!t)return this;if(!d(t))return this._switch("off",t,e);if(!e)return this;var n,r,o,s=t.split(" ");i||(i=this);for(var a=0,h=s.length;a<h;a++){if(o="Z__"+(n=s[a].toLowerCase()),!(r=this._eventMap[n]))return this;for(var u=r.length-1;u>=0;u--){var l=r[u];e!==l.handler&&e!==l.handler[o]||l.context!==i||(delete l.handler[o],r.splice(u,1))}r.length||delete this._eventMap[n]}return this},i.removeEventListener=function(){return this.off.apply(this,arguments)},i.listens=function(t,e,i){if(!this._eventMap||!d(t))return 0;var n=this._eventMap[t.toLowerCase()];if(!n||!n.length)return 0;if(!e)return n.length;for(var r=0,o=n.length;r<o;r++)if(e===n[r].handler&&(l(i)||n[r].context===i))return 1;return 0},i.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},i.copyEventListeners=function(t){var e,i=t._eventMap;if(!i)return this;for(var n in i)for(var r=0,o=(e=i[n]).length;r<o;r++)this.on(n,e[r].handler,e[r].context);return this},i.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},i._wrapOnceHandler=function(t,e,i){var n=this,r="Z__"+t,o=!1,s=function a(){o||(delete s[r],o=!0,i?e.apply(i,arguments):e.apply(this,arguments),n.off(t,a,this))};return s[r]=e,s},i._switch=function(t,e,i){for(var n in e)e.hasOwnProperty(n)&&this[t](n,e[n],i);return this},i._clearListeners=function(t){this._eventMap&&d(t)&&(this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null))},i._clearAllListeners=function(){this._eventMap=null},i._setEventParent=function(t){return this._eventParent=t,this},i._setEventTarget=function(t){return this._eventTarget=t,this},i._fire=function(t,e){if(!this._eventMap)return this;var i=this._eventMap[t.toLowerCase()];if(!i)return this;e||(e={}),e.type=t,e.target=this._eventTarget||this;for(var n,r,o=i.slice(0),s=0,a=o.length;s<a;s++)o[s]&&(n=o[s].context,!0,r=u({},e),!1===(n?o[s].handler.call(n,r):o[s].handler(r))&&e.domEvent&&Be(e.domEvent));return this},e}(t)},gi=di(function(){function t(t){this.target=t}var e=t.prototype;return e.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},e.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},e.enabled=function(){return!!this._enabled},e.remove=function(){this.disable(),delete this.target,delete this.dom},t}()),yi=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks()}var e=t.prototype;return e.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.config=function(t){if(!t){var e={};for(var i in this.options)this.options.hasOwnProperty(i)&&(e[i]=this.options[i]);return e}if(2===arguments.length){var n={};n[t]=arguments[1],t=n}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof gi&&(t[r]?this[r].enable():this[r].disable());return this.onConfig(t),this},e.onConfig=function(){},e._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var i=t._initHooks;if(i&&i!==e._initHooks)for(var n=0;n<i.length;n++)i[n].call(this)}},t.addInitHook=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r="function"==typeof t?t:function(){this[t].apply(this,i)},o=this.prototype,s=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==s._initHooks||(o._initHooks=[]),o._initHooks.push(r),this},t.include=function(){for(var t=0;t<arguments.length;t++)u(this.prototype,t<0||arguments.length<=t?void 0:arguments[t]);return this},t.mergeOptions=function(t){var e=this.prototype,i=Object.getPrototypeOf(e);return e.options&&e.options!==i.options||(e.options=e.options?Object.create(e.options):{}),u(e.options,t),this},t}(),_i={},mi=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return le(e,t),e.registerJSONType=function(t){return t?(_i[t]=this,this):this},e.getJSONClass=function(t){return t?_i[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in _i)if(_i[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)};function vi(t){return function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},i.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var i=this._handlers.indexOf(e);i>=0&&this._handlers.splice(i,1),this[t].remove(),delete this[t]}return this},i._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var xi="touchstart mousedown",wi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},bi={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Ci=function(t){function e(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,null)||this).dom=e,n.options=i,n}le(e,t);var i=e.prototype;return i.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},Ke(this.dom,xi,this._onMouseDown,this),this):this},i.disable=function(){return this.dom?(this._offEvents(),$e(this.dom,xi,this._onMouseDown),delete this._onMouseDown,this):this},i.onMouseDown=function(t){if((this.options.rightclick||2!==t.button)&&!(t.touches&&t.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var i=t.touches?t.touches[0]:t;this.startPos=new de(i.clientX,i.clientY),Ke(document,wi[t.type],this.onMouseMove,this),Ke(document,bi[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||Ke(this.dom,"mouseleave",this.onMouseUp,this),this.fire("mousedown",{domEvent:t,mousePos:new de(i.clientX,i.clientY)})}},i.onMouseMove=function(t){if(t.touches&&t.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var e=t.touches?t.touches[0]:t,i=new de(e.clientX,e.clientY).sub(this.startPos);(i.x||i.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new de(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},i.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var i={domEvent:t};c(e.clientX)&&(i.mousePos=new de(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(i.interupted=this.interupted,this.fire("dragend",i),delete this.interupted,delete this.moved),this.fire("mouseup",i)},i._offEvents=function(){var t=this.dom;if($e(t,"mouseleave",this.onMouseUp),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in wi)$e(document,wi[e],this.onMouseMove),$e(document,bi[e],this.onMouseUp);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},e}(gi),Mi=function(t){function e(){return t.apply(this,arguments)||this}return le(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?R(t,(function(t){return[t.x,t.y]})):[t.x,t.y]},e.toCoordinates=function(t){if(c(t[0])&&c(t[1]))return new e(t);for(var i=[],n=0,r=t.length;n<r;n++){var o=t[n];Array.isArray(o)?c(o[0])?i.push(new e(o)):i.push(e.toCoordinates(o)):i.push(new e(o))}return i},e}(fe),Ei=function(){function t(t,e){this.type=t,this.properties=e}return t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t}();Ei.WGS84=Ei.createProj4("+proj=longlat +datum=WGS84 +no_defs"),Ei.EPSG4326=Ei.WGS84,Ei.EPSG3857=Ei.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),Ei.IDENTITY=Ei.createProj4("+proj=identity +no_defs"),Ei.CGCS2000=Ei.createProj4("+proj=longlat +datum=CGCS2000"),Ei.EPSG4490=Ei.CGCS2000,Ei.BD09LL=Ei.createProj4("+proj=longlat +datum=BD09"),Ei.GCJ02=Ei.createProj4("+proj=longlat +datum=GCJ02");var Si,Pi=new de(0,0),Ii=new Mi(0,0),Ti=new Mi(0,0),Li=new Mi(0,0),Oi=new Mi(0,0),Ri=new Mi(0,0),Ni=new Mi(0,0),Ai=new Mi(0,0),Di=new Mi(0,0),ki=[],Fi=[],ji=function(){function t(t,e,i,n){this._clazz=Mi;var r=arguments.length,o=r>0?arguments[r-1]:null;o&&o.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(t,e,i,n)}var e=t.prototype;return e._initialize=function(t,e,i,n){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!l(t)){var r=this.projection;c(t)&&c(e)&&c(i)&&c(n)?r?this.set(t,e,i,n):this.set(Math.min(t,i),Math.min(e,n),Math.max(t,i),Math.max(e,n)):Array.isArray(t)?r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3])):c(t.x)&&c(e.x)&&c(t.y)&&c(e.y)?r?this.set(t.x,t.y,e.x,e.y):(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):c(t.xmin)&&c(t.xmax)&&c(t.ymin)&&c(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},e._add=function(t){return this._dirty=!0,l(t.x)?l(t.xmin)?l(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},e.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._add.apply(t,arguments)},e._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},e._sub=function(t){return this._dirty=!0,l(t.x)?l(t.xmin)?l(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._sub.apply(t,arguments)},e.substract=function(){return this.sub.apply(this,arguments)},e.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},e.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},e.getCenter=function(t){var e=(this.xmin+this.xmax)/2,i=(this.ymin+this.ymax)/2;return t?(t.set(e,i),t):new this._clazz(e,i)},e.isValid=function(){return!(l(this.xmin)||l(this.ymin)||l(this.xmax)||l(this.ymax))},e.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},e.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),i=Math.max(this.pymin,t.pymin),n=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax),o=!(e>n||i>r);return o},e.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},e.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e)if(void 0!==t.x){var i=Ii;Array.isArray(t)?(i.x=t[0],i.y=t[1]):(i.x=t.x,i.y=t.y),t=e.project(i,i)}else void 0!==t.xmin&&this._project(t);return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},e.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.getSize=function(){return new ge(this.getWidth(),this.getHeight())},e.set=function(t,e,i,n){return this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n,this._dirty=!0,this},e.__combine=function(t){var e,i,n,r;void 0!==t.x&&(Si.xmin=Si.xmax=t.x,Si.ymin=Si.ymax=t.y,t=Si),this._project(t),this._project(this),c(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),i=Math.min(this.pymin,t.pymin),n=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,i=t.pymin,n=t.pxmax,r=t.pymax);var o=this.projection;if(o){Ti.set(e,i),Li.set(n,r);var s=o.unproject(Ti,Ti),a=o.unproject(Li,Li);e=s.x,i=s.y,n=a.x,r=a.y}return Fi[0]=e,Fi[1]=i,Fi[2]=n,Fi[3]=r,Fi},e._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},e.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},e.intersection=function(t){if(!this.intersects(t))return null;Oi.x=Math.max(this.pxmin,t.pxmin),Oi.y=Math.max(this.pymin,t.pymin),Ri.x=Math.min(this.pxmax,t.pxmax),Ri.y=Math.min(this.pymax,t.pymax);var e=Oi,i=Ri,n=this.projection;return n&&(e=n.unproject(e,e),i=n.unproject(i,i)),new this.constructor(e,i,n)},e.expand=function(t){var e,i;return c(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-i,this.xmax+e,this.ymax+i,this.projection)},e._expand=function(t){var e,i;return c(t)?e=i=t:(e=t.width||t.x||t[0]||0,i=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=i,this.xmax+=e,this.ymax+=i,this._dirty=!0,this},e.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.toArray=function(){var t=this.xmin,e=this.ymin,i=this.xmax,n=this.ymax;return[new this._clazz([t,n]),new this._clazz([i,n]),new this._clazz([i,e]),new this._clazz([t,e]),new this._clazz([t,n])]},e.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},e.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.convertTo=function(t,e){if(!this.isValid())return null;var i,n=e||new this.constructor;return e&&n.set(null,null,null,null),this._clazz===Mi?i=Ni:this._clazz===de&&(i=Pi),i.x=this.xmin,i.y=this.ymax,n._combine(t(i)),i.x=this.xmax,n._combine(t(i)),i.y=this.ymin,n._combine(t(i)),i.x=this.xmin,n._combine(t(i)),n},e._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){Ai.set(t.xmax,t.ymin),Di.set(t.xmin,t.ymax),ki[0]=Ai,ki[1]=Di;var i=e.projectCoords(ki),n=i[0],r=i[1];t.pxmin=Math.min(n.x,r.x),t.pymin=Math.min(n.y,r.y),t.pxmax=Math.max(n.x,r.x),t.pymax=Math.max(n.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}else t&&(t.pxmin=t.pxmax=t.pymin=t.pymax=null)},t}();Si=new ji(0,0,0,0);var Gi,zi=function(t){function e(e,i,n,r){var o;return(o=t.call(this,e,i,n,r)||this)._clazz=de,o}return le(e,t),e}(ji),Bi=function(){function t(t){this.matrix=t}var e=t.prototype;return e.transform=function(t,e,i){var n=this.matrix[0]*(t.x-this.matrix[2])/e,r=-this.matrix[1]*(t.y-this.matrix[3])/e;return i?(i.x=n,i.y=r,i):new de(n,r)},e.untransform=function(t,e,i){var n=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/-this.matrix[1]+this.matrix[3];return i?(i.x=n,i.y=r,i):new Mi(n,r)},t}(),Vi={project:function(){},unproject:function(){},projectCoords:function(t){var e=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return R(t,this.project,this);if(Array.isArray(t[0]))return t.map((function(t){return e.projectCoords(t)}));for(var i,n,r,o,s,a,h=this.getCircum(),u=this.getSphereExtent(),l=u.sx,c=u.sy,p=t[0],f=[this.project(p)],d=1,g=t.length;d<g;d++)o=(r=t[d]).x-p.x,s=r.y-p.y,a=this.project(r),Math.abs(o)>180&&(void 0===i&&(i=r.x>p.x),i&&(a._add(-h.x*A(o)*l,0),r._add(-360*A(o),0))),Math.abs(s)>90&&(void 0===n&&(n=r.y<p.y),n&&(a._add(0,-h.y*A(s)*c),r._add(0,-180*A(s)))),p=r,f.push(a);return f},unprojectCoords:function(t){return t?Array.isArray(t)?R(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),i=new Mi(t);return e.contains(i)||(i.x=F(t.x,e.xmin,e.xmax),i.y=F(t.y,e.ymin,e.ymax)),i},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new Mi(180,90)),e=this.project(new Mi(-180,-90));this.extent=new ji(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},Hi={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var i=0,n=0,r=t.length;n<r-1;n++)i+=this.measureLenBetween(t[n],t[n+1]);return i}},qi=u({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i],o=null;o=i===n-1?t[0]:t[i+1],e+=r.x*o.y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,i){return t=new Mi(t.x,t.y),this._locate(t,e,i)},_locate:function(t,e,i){return t?(e||(e=0),i||(i=0),e||i?(t.x=t.x+e,t.y=t.y+i,t):t):null},rotate:function(t,e,i){return t=new Mi(t.x,t.y),this._rotate(t,e,i)},_rotate:(Gi=new de(0,0),function(t,e,i){return Gi.x=t.x-e.x,Gi.y=t.y-e.y,Gi._rotate(i*Math.PI/180),t.x=e.x+Gi.x,t.y=e.y+Gi.y,t})},Hi),Zi=function(){function t(t){this.radius=t}var e=t.prototype;return e.measureLenBetween=function(t,e){if(!t||!e)return 0;var i=v(t.y),n=v(e.y),r=i-n,o=v(t.x)-v(e.x);return i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(i)*Math.cos(n)*Math.pow(Math.sin(o/2),2))),i*=this.radius,Math.round(1e5*i)/1e5},e.measureArea=function(t){var e,i=v(this.radius),n=0,r=t,o=r.length;if(o<3)return 0;for(e=0;e<o-1;e++){var s=r[e],a=r[e+1];n+=s.x*i*Math.cos(v(s.y))*a.y*i-a.x*i*Math.cos(v(a.y))*s.y*i}return o=r[e],r=r[0],n+=o.x*i*Math.cos(v(o.y))*r.y*i-r.x*i*Math.cos(v(r.y))*o.y*i,.5*Math.abs(n)},e.locate=function(t,e,i){return t=new Mi(t.x,t.y),this._locate(t,e,i)},e._locate=function(t,e,i){if(!t)return null;if(e||(e=0),i||(i=0),!e&&!i)return t;var n,r,o=v(t.y);if(0!==i){var s=Math.abs(i);r=F(180*(o+=2*Math.sin(s/(2*this.radius))*(i>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var a=Math.abs(e),h=v(t.x);n=F(180*(h+=2*Math.sqrt(Math.pow(Math.sin(a/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1))/Math.PI,-180,180)}else n=t.x;return t.x=n,t.y=r,t},e.rotate=function(t,e,i){return t=new Mi(t),this._rotate(t,e,i)},e._rotate=function(t,e,i){var n=function(t,e,i){void 0===i&&(i={});var n;n=i.final?Ui(e,t):Ui(t,e);return n>180?-(360-n):n}(e,t),r=n-i,o=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,i,n){var r=e/n,o=t.x*Math.PI/180,s=v(t.y),a=v(i),h=r*Math.cos(a),u=s+h;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var l=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(l)>1e-11?h/l:Math.cos(s),p=r*Math.sin(a)/c,f=o+p;return t.x=(180*f/Math.PI+540)%360-180,t.y=180*u/Math.PI,t}(t,o,r,this.radius)},t}();function Ui(t,e){var i=v(t.y),n=v(e.y),r=v(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(x(Math.atan2(r,o))+360)%360}var Wi=u({measure:"EPSG:4326",sphere:new Zi(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},Hi),Yi=u({measure:"BAIDU",sphere:new Zi(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},Hi),Xi=Wi,Ji={};function Qi(t){Ji[t.measure]=t}Qi(qi),Qi(Wi),Qi(Yi);var Ki,$i={getInstance:function(t){if(!t)return Xi;for(var e in Ji)if(_(Ji,e)){var i=Ji[e].measure;if(!i)continue;if(t.toLowerCase()===i.toLowerCase())return Ji[e]}return null}},tn=u({},Vi,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var i=this.rad,n=this.metersPerDegree,r=this.maxLatitude,o=t.x,s=Math.max(Math.min(r,t.y),-r),a=o*n,h=(0===s?0:Math.log(Math.tan((90+s)*i/2))/i)*n;return e?(e.x=a,e.y=h,e):new Mi(a,h)},unproject:function(t,e){var i,n=this.rad,r=this.metersPerDegree,o=t.x/r,s=t.y;0===s?i=0:(i=s/r,i=(2*Math.atan(Math.exp(i*n))-Math.PI/2)/n),Math.abs(Math.abs(o)-180)<1e-7&&(o=180*A(o)),Math.abs(Math.abs(i)-this.maxLatitude)<1e-7&&(i=A(i)*this.maxLatitude);var a=F(o,-180,180),h=F(i,-this.maxLatitude,this.maxLatitude);return e?(e.x=a,e.y=h,e):new Mi(a,h)}},Wi),en=u({},Vi,{code:"EPSG:4326",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new Mi(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new Mi(t)}},Wi),nn=u({},en,{code:"EPSG:4490"}),rn=u({},Vi,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},Yi,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var i,n=0,r=this.MCBAND.length;n<r;n++)if(Math.abs(t.y)>=this.MCBAND[n]){i=this.MC2LL[n];break}return this.convertor(t,i,e)},convertLL2MC:function(t,e){var i,n,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var o=new Mi(t.x,t.y);for(n=0,r=this.LLBAND.length;n<r;n++)if(o.y>=this.LLBAND[n]){i=this.LL2MC[n];break}if(!i)for(n=this.LLBAND.length-1;n>=0;n--)if(o.y<=-this.LLBAND[n]){i=this.LL2MC[n];break}return this.convertor(t,i,e)},convertor:function(t,e,i){if(!t||!e)return null;var n=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],o=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return n*=t.x<0?-1:1,o*=t.y<0?-1:1,i?(i.x=n,i.y=o,i):new Mi(n,o)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){if(t===1/0)return i;if(t===-1/0)return e;for(;t>i;)t-=i-e;for(;t<e;)t+=i-e;return t}}),on=u({},Vi,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},qi),sn=tn,an=Object.freeze({EPSG3857:tn,DEFAULT:sn,EPSG4326:en,EPSG4490:nn,BAIDU:rn,IDENTITY:on,Common:Vi}),hn=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return le(e,t),e.registerRenderer=function(t,e){var i=this.prototype,n=Object.getPrototypeOf(i);return i._rendererClasses&&i._rendererClasses!==n._rendererClasses||(i._rendererClasses=i._rendererClasses?Object.create(i._rendererClasses):{}),i._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},un=function(t){function e(e){var i;return(i=t.call(this)||this).layer=e,i._painted=!1,i._drawTime=0,i.setToRedraw(),i}le(e,t);var i=e.prototype;return i.render=function(t){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new ln),this.checkAndDraw(this._tryToDraw,t))},i.checkAndDraw=function(t){for(var e=this,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];if(this.checkResources){var o=this.checkResources();o.length>0?(this._loadingResource=!0,this.loadResources(o).then((function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())}))):t.call.apply(t,[this].concat(n))}else t.call.apply(t,[this].concat(n))},i.testIfNeedRedraw=function(){var t=this.getMap();return!this._loadingResource&&(!!this._toRedraw||!(t.isInteracting()&&!this.drawOnInteracting)&&!!this.needToRedraw())},i.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()&&!t.getRenderer().isViewChanged())&&!(!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,delete this.resources,delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(){this.setToRedraw()},i.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown)return!1;var e=this.getMap(),i=e.getDevicePixelRatio(),n=e.getSize();if(t.x<0||t.x>n.width*i||t.y<0||t.y>n.height*i)return!1;try{if(this.context.getImageData(i*t.x,i*t.y,1,1).data[3]>0)return!0}catch(t){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t),this._errorThrown=!0),!1}return!1},i.loadResources=function(t){this.resources||(this.resources=new ln);var e=this.resources,i=[];if(G(t))for(var n={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!n[o.join("-")]&&(n[o.join("-")]=1,e.isResourceLoaded(o,!0)||i.push(new fi(this._promiseResource(o))))}return fi.all(i)},i.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.southWest=t._containerPointToPoint(new de(0,t.height))},i.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),i=t.getDevicePixelRatio(),n=i*e.width,r=i*e.height;if(this.layer._canvas){var o=this.layer._canvas;o.width=n,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=oi.createCanvas(n,r,t.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=this.canvas.getContext("2d"),this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this.context.scale(t,t)}},i.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},i.resizeCanvas=function(t){var e=this.canvas;if(e){var i=t||this.getMap().getSize(),n=this.getMap().getDevicePixelRatio();e.width===n*i.width&&e.height===n*i.height||(e.height=n*i.height,e.width=n*i.width,1!==n&&this.context&&this.context.scale(n,n),this.layer._canvas&&e.style&&(e.style.width=i.width+"px",e.style.height=i.height+"px"))}},i.clearCanvas=function(){this.context&&oi.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},i.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var i=this.southWest,n=this.getMap();this.southWest=n._containerPointToPoint(new de(0,n.height)),t.save();var r=n.getDevicePixelRatio();if(1!==r&&(t.save(),t.scale(r,r)),e.getGeometries){t.isMultiClip=!0;var o=e.getGeometries()||[];t.beginPath(),o.forEach((function(e){e._getMaskPainter().paint(null,t)})),t.stroke(),delete t.isMultiClip}else{e._getMaskPainter().paint(null,t)}return 1!==r&&t.restore(),t.clip(),this.southWest=i,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(){},i.onZoomEnd=function(){this.setToRedraw()},i.onZooming=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){this.setToRedraw()},i.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(){},i.onDragRotating=function(){},i.onDragRotateEnd=function(){this.setToRedraw()},i.onSpatialReferenceChange=function(){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},i._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var i=h();this.draw(t),i=h()-i,this._drawTime=e?i:i/2,e&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",t,"drawTime:",this._drawTime)}},i._promiseResource=function(t){var e=this,i=this.resources,n=this.layer.options.crossOrigin;return function(r){if(i.isResourceLoaded(t,!0))r(t);else{var o=new Image;l(n)||(o.crossOrigin=n),M(t[0])&&!C&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),o.onload=function(){e._cacheResource(t,o),r(t)},o.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),r(t)},o.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),i.markErrorResource(t),r(t)},E(o,t)}}},i._cacheResource=function(t,e){if(this.layer&&this.resources){var i=t[1],n=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===M(t[0])&&(ue.edge||ue.ie)){l(i)&&(i=e.width||this.layer.options.defaultIconSize[0]),l(n)&&(n=e.height||this.layer.options.defaultIconSize[1]);var r=oi.createCanvas(i,n);oi.image(r.getContext("2d"),e,0,0,i,n),e=r}this.resources.addResource(t,e)}},e}(yi),ln=function(){function t(){this.resources={},this._errors={}}var e=t.prototype;return e.addResource=function(t,e){this.resources[t[0]]={image:e,width:+t[1],height:+t[2]}},e.isResourceLoaded=function(t,e){if(!t)return!1;var i=this._getImgUrl(t);if(this._errors[i])return!0;var n=this.resources[i];return!!n&&!(e&&M(t[0])&&(+t[1]>n.width||+t[2]>n.height))},e.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},e.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},e.merge=function(t){if(!t)return this;for(var e in t.resources){var i=t.resources[e];this.addResource([e,i.width,i.height],i.image)}return this},e.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)_(this.resources,e)&&t(e,this.resources[e]);return this},e._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},t}();function cn(t,e,i,n){for(var r,o=[],s=0,a=0,h=t.length;a<h-1;a++)(r=pn(t[a],t[a+1],e,a,i,n))&&(o[s]=o[s]||[],o[s].push({point:r[0],index:a}),r[1]===t[a+1]&&a!==h-2||(o[s].push({point:r[1],index:a+1}),s++));return o}function pn(t,e,i,n,r,o){var s,a,h,u=n?Ki:gn(t,i),l=gn(e,i);for(Ki=l;;){if(!(u|l))return[t,e];if(u&l)return!1;if(o)return[t,e];h=gn(a=dn(t,e,s=u||l,i,r),i),s===u?(t=a,u=h):(e=a,l=h)}}function fn(t,e,i){var n,r,o,s,a,h,u,l,c,p=[1,4,2,8];for(r=0,u=t.length;r<u;r++)t[r]._code=gn(t[r],e);for(s=0;s<4;s++){for(l=p[s],n=[],r=0,o=(u=t.length)-1;r<u;o=r++)a=t[r],h=t[o],a._code&l?h._code&l||((c=dn(h,a,l,e,i))._code=gn(c,e),n.push(c)):(h._code&l&&((c=dn(h,a,l,e,i))._code=gn(c,e),n.push(c)),n.push(a));t=n}return t}function dn(t,e,i,n,r){var o,s,a=e.x-t.x,h=e.y-t.y,u=n.getMin(),l=n.getMax();8&i?(o=t.x+a*(l.y-t.y)/h,s=l.y):4&i?(o=t.x+a*(u.y-t.y)/h,s=u.y):2&i?(o=l.x,s=t.y+h*(l.x-t.x)/a):1&i&&(o=u.x,s=t.y+h*(u.x-t.x)/a);var c=new de(o,s);return r&&c._round(),c}function gn(t,e){var i=0;return t.x<e.getMin().x?i|=1:t.x>e.getMax().x&&(i|=2),t.y<e.getMin().y?i|=4:t.y>e.getMax().y&&(i|=8),i}function yn(t,e,i,n){t=new de(t);var r,o,s,a=Math.abs(i.x-e.x),h=Math.abs(i.y-e.y),u=Math.sqrt(Math.abs(a*a-h*h));return a>=h?(r=new de(e.x-u,e.y),o=new de(e.x+u,e.y),s=2*a):(r=new de(e.x,e.y-u),o=new de(e.x,e.y+u),s=2*h),t.distanceTo(r)+t.distanceTo(o)<=s+2*n}var _n=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i._prepareContext=function(t){c(this.symbol.opacity)?t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity):1!==t.globalAlpha&&(t.globalAlpha=1)},i.prepareCanvas=function(t,e,i){oi.prepareCanvas(t,e,i,this.getPainter().isHitTesting())},i.remove=function(){},i.setZIndex=function(){},i.show=function(){},i.hide=function(){},i._defineStyle=function(t){return function(){var e=this,i=[],n={};return wt(t,(function(){var t=e.getMap();return function(t,e,i){return t[0]=e,t[1]=i,t}(i,t.getZoom(),u({},e.geometry.getProperties(),function(t,e,i,n){return t["{bearing}"]=e,t["{pitch}"]=i,t["{zoom}"]=n,t}(n,t.getBearing(),t.getPitch(),t.getZoom())))}))}.bind(this)()},e}(function(){function t(){}var e=t.prototype;return e.getMap=function(){return this.geometry.getMap()},e.getPainter=function(){return this.painter},e.isDynamicSize=function(){return!1},t.testColor=function(t){return!(!t||!d(t))&&a.indexOf(t)>=0},t}());var mn=new de(0,0),vn=new de(0,0),xn=function(t){function e(e,i,n){var r;return(r=t.call(this)||this).symbol=e,r.geometry=i,r.painter=n,r}le(e,t);var i=e.prototype;return i.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLZoom(),i=new zi,n=this._getRenderPoints()[0],r=n.length-1;r>=0;r--)n[r]&&i._combine(t._pointToPoint(n[r],e));return i},i.isDynamicSize=function(){var t=this.symbol;return mt(t.markerWidth)||mt(t.markerHeight)||mt(t.textSize)},i._rotateExtent=function(t,e){return t.convertTo((function(t){return t._rotate(e)}))},i._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},i._getRenderContainerPoints=function(t){var e=this.getPainter(),i=this._getRenderPoints()[0];if(e.isSpriting())return i;var n=this.getDxDy(),r=this.painter._pointContainerPoints(i,n.x,n.y,t,!0,this.getPlacement());if(!r||!Array.isArray(r[0]))return r;for(var o=[],s=0,a=r.length;s<a;s++)for(var h=0,u=r[s].length;h<u;h++)o.push(r[s][h]);return o},i._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var i=this._getRenderPoints()[1];if(!i||!i[t])return e;var n=this.getMap(),r=i[t][0],o=i[t][1];if(n.isTransforming()){var s=n.getGLZoom();return r=n._pointToContainerPoint(i[t][0],s,0,mn),o=n._pointToContainerPoint(i[t][1],s,0,vn),e+W(r.x,r.y,o.x,o.y)}return e+-W(r.x,r.y,o.x,o.y)},i._rotate=function(t,e,i){if(i){var n=this.getDxDy(),r=e.sub(n);return t.save(),t.translate(r.x,r.y),t.rotate(i),this.getDxDy()}return null},e}(_n),wn=function(t){function e(i,n,r){var o;(o=t.call(this,i,n,r)||this)._dynamic=vt(i),o.style=o._defineStyle(o.translate()),o.strokeAndFill=o._defineStyle(e.translateLineAndFill(o.style));var s=o.strokeAndFill.lineWidth;return o.padding=s%2==0?2:1.5,o}le(e,t),e.test=function(t){return!!t&&!(!l(t.markerFile)||l(t.markerType)||"path"===t.markerType)};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&(0!==i.polygonOpacity||0!==i.lineOpacity)){var n=this._getRenderContainerPoints();G(n)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,n,e):this._drawMarkersWithCache(t,n,e))}},i.getDxDy=function(){var t=this.style,e=t.markerDx,i=t.markerDy;return new de(e,i)},i._drawMarkers=function(t,e,i){var n=this.strokeAndFill;Lt(n.lineColor)||Lt(n.polygonFill)||this.prepareCanvas(t,n,i);for(var r=e.length-1;r>=0;r--){var o=e[r],s=this._rotate(t,o,this._getRotationAt(r));s&&(o=s),this._drawVectorMarker(t,o,i),s&&t.restore()}},i._drawMarkersWithCache=function(t,e,i){var n=this._stampSymbol(),r=i.getImage(n);r||(r=this._createMarkerImage(t,i),i.addResource([n,r.width,r.height],r));for(var o=this._getAnchor(r.width,r.height),s=e.length-1;s>=0;s--){var a=e[s],h=this._rotate(t,a,this._getRotationAt(s));h&&(a=h),oi.image(t,r,a.x+o.x,a.y+o.y),h&&t.restore()}},i._calMarkerSize=function(){if(!this._size){var t=this.strokeAndFill.lineWidth,e=2*(this.symbol.shadowBlur||0),i=Math.round(this.style.markerWidth+t+2*e+2*this.padding),n=Math.round(this.style.markerHeight+t+2*e+2*this.padding);if(mt(this.symbol.markerWidth)||mt(this.symbol.markerHeight))return[i,n];this._size=[i,n]}return this._size},i._createMarkerImage=function(t,e){var i=t.canvas.constructor,n=this._calMarkerSize(),r=oi.createCanvas(n[0],n[1],i),o=this._getCacheImageAnchor(n[0],n[1]),s=r.getContext("2d");return Lt(this.strokeAndFill.lineColor)||Lt(this.strokeAndFill.polygonFill)||this.prepareCanvas(s,this.strokeAndFill,e),this._drawVectorMarker(s,o,e),r},i._stampSymbol=function(){return this._stamp||(this._stamp=[this.style.markerType,Lt(this.style.markerFill)?Ot(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,Lt(this.style.markerLineColor)?Ot(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_")),this._stamp},i._getAnchor=function(t,e){var i=2*(this.symbol.shadowBlur||0)+this.padding,n=Se(new ge(t,e),this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment);return n.x!==-t/2&&(n.x-=A(n.x+t/2)*i),n.y!==-e/2&&(n.y-=A(n.y+e/2)*i),n},i._getCacheImageAnchor=function(t,e){var i=2*(this.symbol.shadowBlur||0)+this.padding,n=this.style.markerType;return"bar"===n||"pie"===n||"pin"===n?new de(t/2,e-i):"rectangle"===n?new de(i,i):new de(t/2,e/2)},i._getGraidentExtent=function(t){var e=new zi,i=this.getDxDy(),n=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=n.xmin-i.x,e.ymin+=n.ymin-i.y,e.xmax+=n.xmax-i.x,e.ymax+=n.ymax-i.y,e},i._drawVectorMarker=function(t,i,n){var r,o=this.style,s=this.strokeAndFill,a=o.markerType.toLowerCase(),h=e._getVectorPoints(a,o.markerWidth,o.markerHeight),u=s.lineOpacity,l=s.polygonOpacity;(Lt(s.lineColor)||Lt(s.polygonFill))&&(Lt(s.lineColor)&&(r=this._getGraidentExtent(i),s.lineGradientExtent=r.expand(s.lineWidth)),Lt(s.polygonFill)&&(r||(r=this._getGraidentExtent(i)),s.polygonGradientExtent=r),this.prepareCanvas(t,s,n));var c=o.markerWidth,p=o.markerHeight,f=o.markerLineWidth/2;if("ellipse"===a)oi.ellipse(t,i,c/2,p/2,p/2,u,l);else if("cross"===a||"x"===a){for(var d=h.length-1;d>=0;d--)h[d]._add(i);oi.path(t,h.slice(0,2),u),oi.path(t,h.slice(2,4),u)}else if("diamond"===a||"bar"===a||"square"===a||"rectangle"===a||"triangle"===a){"bar"===a?i=i.add(0,-f):"rectangle"===a&&(i=i.add(f,f));for(var g=h.length-1;g>=0;g--)h[g]._add(i);oi.polygon(t,h,u,l)}else if("pin"===a){i=i.add(0,-f);for(var y=h.length-1;y>=0;y--)h[y]._add(i);var _=t.lineCap;t.lineCap="round",oi.bezierCurveAndFill(t,h,u,l),t.lineCap=_}else{if("pie"!==a)throw new Error("unsupported markerType: "+a);i=i.add(0,f);var m=180*Math.atan(c/2/p)/Math.PI,v=t.lineCap;t.lineCap="round",oi.sector(t,i,p,[90-m,90+m],u,l),t.lineCap=v}},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){var t=this.style.markerRotation;return c(t)?-t*Math.PI/180:null},i.getFixedExtent=function(){var t=this.getDxDy(),e=2*this.padding,i=this._calMarkerSize().map((function(t){return t-e})),n=this._getAnchor(i[0],i[1]),r=new zi(t.add(0,0),t.add(i[0],i[1]));r._add(n);var o=this.getRotation();return o&&(r=this._rotateExtent(r,o)),r},i.translate=function(){var t,e,i=this.symbol,n={markerType:N(i.markerType,"ellipse"),markerFill:N(i.markerFill,"#00f"),markerFillOpacity:N(i.markerFillOpacity,1),markerFillPatternFile:N(i.markerFillPatternFile,null),markerLineColor:N(i.markerLineColor,"#000"),markerLineWidth:N(i.markerLineWidth,1),markerLineOpacity:N(i.markerLineOpacity,1),markerLineDasharray:N(i.markerLineDasharray,[]),markerLinePatternFile:N(i.markerLinePatternFile,null),markerDx:N(i.markerDx,0),markerDy:N(i.markerDy,0),markerWidth:N(i.markerWidth,10),markerHeight:N(i.markerHeight,10),markerRotation:N(i.markerRotation,0)},r=n.markerType;return"bar"===r||"pie"===r||"pin"===r?(t="middle",e="top"):"rectangle"===r?(t="right",e="bottom"):(t="middle",e="middle"),n.markerHorizontalAlignment=N(i.markerHorizontalAlignment,t),n.markerVerticalAlignment=N(i.markerVerticalAlignment,e),c(i.markerOpacity)&&(c(i.markerFillOpacity)&&(n.markerFillOpacity*=i.markerOpacity),c(i.markerLineOpacity)&&(n.markerLineOpacity*=i.markerOpacity)),n},e.translateLineAndFill=function(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e},e._getVectorPoints=function(t,e,i){var n,r,o,s,a=i/2,h=e/2;if("triangle"===t)return[n=new de(0,0-a),r=new de(0-h,0+a),o=new de(0+h,0+a)];if("cross"===t)return[n=new de(0-h,0),r=new de(0+h,0),o=new de(0,0-a),s=new de(0,0+a)];if("diamond"===t)return[n=new de(0-h,0),r=new de(0,0-a),o=new de(0+h,0),s=new de(0,0+a)];if("square"===t)return[n=new de(0-h,0+a),r=new de(0+h,0+a),o=new de(0+h,0-a),s=new de(0-h,0-a)];if("rectangle"===t)return r=(n=new de(0,0)).add(e,0),o=n.add(e,i),s=n.add(0,i),[n,r,o,s];if("x"===t)return[n=new de(0-h,0+a),r=new de(0+h,0-a),o=new de(0+h,0+a),s=new de(0-h,0-a)];if("bar"===t)return[n=new de(0-h,0-i),r=new de(0+h,0-i),o=new de(0+h,0),s=new de(0-h,0)];if("pin"===t){var u=i*Math.atan(h/a);return[n=new de(0,0),r=new de(0-u,0-i),o=new de(0+u,0-i),s=new de(0,0)]}return[]},e}(xn),bn=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.getPlacement=function(){return"point"},i.getDxDy=function(){return new de(0,0)},i.symbolize=function(t){var e=this.geometry,i=e.getLayer();if(e.options.debug||!i||i.options.debug){var n=this.getMap();if(n&&!n.isZooming()){var r=i.options.debugOutline;t.strokeStyle=r,t.fillStyle=r;var o=this.getPainter().getContainerExtent().toArray();oi.polygon(t,[o],1,0);for(var s=this._getRenderContainerPoints(),a=this.geometry.getId(),h=wn._getVectorPoints("cross",10,10),u=0;u<s.length;u++){var c=s[u];l(a)||oi.fillText(t,a,c.add(8,-4),r);for(var p=[],f=0;f<h.length;f++)p.push(h[f].add(c));oi.path(t,p.slice(0,2),1),oi.path(t,p.slice(2,4),1)}}}},e}(xn),Cn=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this).style=r._defineStyle(r.translate()),r}le(e,t),e.test=function(t){return!!t&&!l(t.markerFile)};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(this.painter.isHitTesting()||0!==i.markerWidth&&0!==i.markerHeight&&0!==i.markerOpacity){var n=this._getRenderContainerPoints();if(G(n)){var r=this._getImage(e);if(r){this._prepareContext(t);var o,s=i.markerWidth,a=i.markerHeight;if(!c(s)||!c(a)){s=r.width,a=r.height,i.markerWidth=s,i.markerHeight=a;var h=[i.markerFile,i.markerWidth,i.markerHeight];e.isResourceLoaded(h)||e.addResource(h,r);var u=this.getPainter();u.isSpriting()||u.removeCache()}"path"!==this.symbol.markerType&&c(i.markerOpacity)&&i.markerOpacity<1&&(o=t.globalAlpha,t.globalAlpha*=i.markerOpacity);for(var l=Se(new ge(s,a),i.markerHorizontalAlignment,i.markerVerticalAlignment),p=0,f=n.length;p<f;p++){var d=n[p],g=this._rotate(t,d,this._getRotationAt(p));g&&(d=g),oi.image(t,r,d.x+l.x,d.y+l.y,s,a),g&&t.restore()}void 0!==o&&(t.globalAlpha=o)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},i._getImage=function(t){return t?t.getImage([this.style.markerFile,this.style.markerWidth,this.style.markerHeight]):null},i.getPlacement=function(){return this.symbol.markerPlacement},i.getRotation=function(){var t=this.style.markerRotation;return c(t)?-t*Math.PI/180:null},i.getDxDy=function(){var t=this.style,e=t.markerDx,i=t.markerDy;return new de(e,i)},i.getFixedExtent=function(t){var e=this.style,i=e.markerFile,n=t?t.getImage(i):null,r=e.markerWidth||(n?n.width:0),o=e.markerHeight||(n?n.height:0),s=this.getDxDy(),a=Se(new ge(r,o),e.markerHorizontalAlignment,e.markerVerticalAlignment),h=new zi(s.add(0,0),s.add(r,o));h._add(a);var u=this.getRotation();return u&&(h=this._rotateExtent(h,u)),h},i.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:N(t.markerOpacity,1),markerWidth:N(t.markerWidth,null),markerHeight:N(t.markerHeight,null),markerRotation:N(t.markerRotation,0),markerDx:N(t.markerDx,0),markerDy:N(t.markerDy,0),markerHorizontalAlignment:N(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:N(t.markerVerticalAlignment,"top")}},e}(xn),Mn=new Mi(0,0),En=new Mi(0,0),Sn=function(t){function e(e,i,n){var r;return(r=t.call(this)||this).symbol=e,r.geometry=i,r.painter=n,"Point"===i.type?pe(r):(r.style=r._defineStyle(r.translate()),r)}le(e,t),e.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var i in t){var n=i.slice(0,4);if("line"===n||"poly"===n)return!0}return!1};var i=e.prototype;return i.symbolize=function(t,e){var i=this.style;if(0!==i.polygonOpacity||0!==i.lineOpacity||this.painter.isHitTesting()){var n=this._getPaintParams();if(n){this._prepareContext(t);var r=Lt(i.lineColor),o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!i.lineColor.places&&o||(i.lineGradientExtent=this.getPainter().getContainerExtent()._expand(i.lineWidth)),Lt(i.polygonFill)&&(i.polygonGradientExtent=this.getPainter().getContainerExtent());var s=n[0];if("Polygon"===this.geometry.getJSONType()&&s.length>0&&Array.isArray(s[0][0])||"LineString"===this.geometry.type&&s.length>0&&Array.isArray(s[0]))for(var a=0;a<s.length;a++){this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s[a],i.lineColor);var h=[t,s[a]];n.length>1&&h.push.apply(h,n.slice(1)),h.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}else{this.prepareCanvas(t,i,e),r&&o&&!i.lineColor.places&&this._createGradient(t,s,i.lineColor);var u=[t];u.push.apply(u,n),u.push(i.lineOpacity,i.polygonOpacity,i.lineDasharray),this.geometry._paintOn.apply(this.geometry,u)}t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])}}},i.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new Mi(0,0),this._extMax=new Mi(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var i=t._prjToPoint(this._extMin,void 0,Mn),n=t._prjToPoint(this._extMax,void 0,En);return this._pxExtent?this._pxExtent.set(Math.min(i.x,n.x),Math.min(i.y,n.y),Math.max(i.x,n.x),Math.max(i.y,n.y)):this._pxExtent=new zi(i,n),this._pxExtent},i.getFixedExtent=function(){var t=this.style.lineWidth/2;return new zi(-t,-t,t,t)},i._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},i.translate=function(){var t=this.symbol,e={lineColor:N(t.lineColor,"#000"),lineWidth:N(t.lineWidth,2),lineOpacity:N(t.lineOpacity,1),lineDasharray:N(t.lineDasharray,[]),lineCap:N(t.lineCap,"butt"),lineJoin:N(t.lineJoin,"miter"),linePatternFile:N(t.linePatternFile,null),lineDx:N(t.lineDx,0),lineDy:N(t.lineDy,0),polygonFill:N(t.polygonFill,null),polygonOpacity:N(t.polygonOpacity,1),polygonPatternFile:N(t.polygonPatternFile,null),polygonPatternDx:N(t.polygonPatternDx,0),polygonPatternDy:N(t.polygonPatternDy,0),linePatternDx:N(t.linePatternDx,0),linePatternDy:N(t.linePatternDy,0),lineDashOffset:N(t.lineDashOffset,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},i._createGradient=function(t,e,i){if(Array.isArray(e)&&e.length){var n=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[n-1].x,e[n-1].y);i.colorStops.forEach((function(t){r.addColorStop.apply(r,t)})),t.strokeStyle=r}},e}(_n),Pn="___text_symbol_cache",In=function(t){function e(e,i,n){var r;if((r=t.call(this,e,i,n)||this)._dynamic=vt(e),r.style=r._defineStyle(r.translate()),0===r.style.textWrapWidth)return pe(r);r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style));var o=Ee(r.style.textName,r.geometry.getProperties());return r._dynamic||(r._cacheKey=function(t,e){var i=[t];for(var n in e)e.hasOwnProperty(n)&&n.length>4&&"text"===n.substring(0,4)&&i.push(n+"="+e[n]);return i.join("-")}(o,r.style)),r._descText(o),r}le(e,t),e.test=function(t){return!!t&&!l(t.textName)};var i=e.prototype;return i.symbolize=function(t,e){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var i=this._getRenderContainerPoints();if(G(i)){var n=this.style,r=this.strokeAndFill,o=Ee(this.style.textName,this.geometry.getProperties());this._descText(o),this._prepareContext(t),this.prepareCanvas(t,r,e),oi.prepareCanvasFont(t,n);for(var s=0,a=i.length;s<a;s++){var h=i[s],u=this._rotate(t,h,this._getRotationAt(s));u&&(h=u),oi.text(t,o,h,n,this.textDesc),u&&t.restore()}}}},i.getPlacement=function(){return this.symbol.textPlacement},i.getRotation=function(){var t=this.style.textRotation;return c(t)?-t*Math.PI/180:null},i.getDxDy=function(){var t=this.style;return new de(t.textDx,t.textDy)},i.getFixedExtent=function(){var t=this.getDxDy(),e=this.style,i=this.textDesc.size,n=Se(i,e.textHorizontalAlignment,e.textVerticalAlignment),r=n.x,o=n.y;if(e.textHaloRadius){var s=e.textHaloRadius;i=i.add(2*s,2*s)}var a=new zi(t.add(r,o),t.add(r+i.width,o+i.height)),h=this.getRotation();return h&&(a=this._rotateExtent(a,h)),a},i.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:N(t.textFaceName,"monospace"),textWeight:N(t.textWeight,"normal"),textStyle:N(t.textStyle,"normal"),textSize:N(t.textSize,14),textFont:N(t.textFont,null),textFill:N(t.textFill,"#000"),textOpacity:N(t.textOpacity,1),textHaloFill:N(t.textHaloFill,"#ffffff"),textHaloRadius:N(t.textHaloRadius,0),textHaloOpacity:N(t.textHaloOpacity,1),textWrapWidth:N(t.textWrapWidth,null),textWrapCharacter:N(t.textWrapCharacter,"\n"),textLineSpacing:N(t.textLineSpacing,0),textDx:N(t.textDx,0),textDy:N(t.textDy,0),textHorizontalAlignment:N(t.textHorizontalAlignment,"middle"),textVerticalAlignment:N(t.textVerticalAlignment,"middle"),textAlign:N(t.textAlign,"center"),textRotation:N(t.textRotation,0),textMaxWidth:N(t.textMaxWidth,0),textMaxHeight:N(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},i.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},i._descText=function(t){this._dynamic?this.textDesc=this._measureText(t):(this.textDesc=this._loadFromCache(),this.textDesc||(this.textDesc=this._measureText(t),this._storeToCache(this.textDesc)))},i._measureText=function(t){var e=this.style.textMaxHeight,i=Ie(t,this.style);return e&&e<i.size.height&&(i.size.height=e),i},i._storeToCache=function(t){C||(this.geometry[Pn]||(this.geometry[Pn]={}),this.geometry[Pn][this._cacheKey]={desc:t,active:!0})},i._loadFromCache=function(){if(!this.geometry[Pn])return null;var t=this.geometry[Pn][this._cacheKey];return t?(t.active=!0,t.desc):null},e}(xn);In.CACHE_KEY=Pn;var Tn,Ln=function(t){function e(e,i,n){var r;l(e.markerWidth)&&(e.markerWidth=80),l(e.markerHeight)&&(e.markerHeight=80),e=u(e,(r=t.call(this,e,i,n)||this).translate());var o=r.style=r._defineStyle(e);return ue.gecko?r._url=[St(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:r._url=[St(o),o.markerWidth,o.markerHeight],r}le(e,t),e.test=function(t){return!!t&&!(!l(t.markerFile)||"path"!==t.markerType)};var i=e.prototype;return i._prepareContext=function(){},i._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var i=this.painter,n=new Image;return n.onload=function(){var t=i.getLayer()&&i.getLayer().getRenderer();t&&t.setToRedraw()},n.onerror=function(i){i&&"undefined"!=typeof console&&console.warn(i),t.markErrorResource(e._url)},n.src=this._url[0],t&&t.addResource(this._url,n),n},e}(Cn),On={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},Rn=function(t){function e(e,i,n){var r;return(r=t.call(this,e,i,n)||this).style=i.getLayer().options.drawAltitude,r.style&&f(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}le(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var i=e.getJSONType();return"Marker"===i||"LineString"===i};var i=e.prototype;return i.symbolize=function(t,e){var i=this.geometry.getLayer();if(i.options.enableAltitude){var n=this.geometry.getProperties();if(n&&n[i.options.altitudeProperty]){var r=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var o=this._getPaintParams(r.lineDx,r.lineDy);if(!o)return;var s=this.getPainter().getPaintParams(r.lineDx,r.lineDy,!0)[0];this._drawLineAltitude(t,o[0],s,e)}else{var a=this._getRenderContainerPoints(),h=this._getRenderContainerPoints(!0);if(!a||0===a.length)return;this._drawMarkerAltitude(t,a[0],h[0],e)}}}},i.getDxDy=function(){var t=this.dxdy;return new de(t.dx||0,t.dy||0)},i.get2DExtent=function(){return"LineString"===this.geometry.type?Sn.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},i.getPlacement=function(){return"point"},i._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0)},i._drawMarkerAltitude=function(t,e,i){var n=this._getStyle();this.prepareCanvas(t,n),oi.path(t,[e,i],n.lineOpacity,null,n.lineDasharray)},i._drawLineAltitude=function(t,e,i,n){var r=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var o=0;o<e.length;o++)this._drawLine(t,e[o],i[o],n);else this._drawLine(t,e,i,n);t.setLineDash&&Array.isArray(r.lineDasharray)&&t.setLineDash([])},i._drawLine=function(t,e,i,n){var r=this._getStyle();r.polygonFill&&(r.polygonGradientExtent=this.getPainter().getContainerExtent()),this.prepareCanvas(t,r,n);for(var o=0,s=e.length-1;o<s;o++)oi.polygon(t,[e[o],e[o+1],i[o+1],i[o]],r.lineOpacity,r.polygonOpacity,r.lineDasharray)},i._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return f(t)||(t=On),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},e}(xn),Nn=[Rn,Sn,Cn,Ln,wn,In],An=new de(0,0),Dn=new zi,kn=new zi,Fn=new zi,jn=new zi,Gn=new zi,zn=function(t){function e(e){var i;return(i=t.call(this)||this).geometry=e,i.symbolizers=i._createSymbolizers(),i._altAtGLZoom=i._getGeometryAltitude(),i}le(e,t);var i=e.prototype;return i.getMap=function(){return this.geometry.getMap()},i.getLayer=function(){return this.geometry.getLayer()},i._createSymbolizers=function(){var t=this.getSymbol(),e=[],i=Nn,n=t;Array.isArray(t)||(n=[t]);for(var r=n.length-1;r>=0;r--)for(var o=n[r],s=i.length-1;s>=0;s--)if(i[s].test(o,this.geometry)){var a=new i[s](o,this.geometry,this);e.push(a),a instanceof xn&&(this._hasPoint=!0)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new bn(t,this.geometry,this),e},i.hasPoint=function(){return!!this._hasPoint},i.getRenderPoints=function(t){return this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},i.getPaintParams=function(t,e,i){var n=this.getMap(),r=this.geometry,o=n.getResolution(),s=0!==n.getPitch(),a=0!==n.getBearing(),h=this._cachedParams,u=r._paintAsPath&&r._paintAsPath();if(u&&this._unsimpledParams&&o<=this._unsimpledParams._res)h=this._unsimpledParams;else if(!h||h._res!==n.getResolution()||this._pitched!==s&&r._redrawWhenPitch()||this._rotated!==a&&r._redrawWhenRotate()){if(!(h=r._getPaintParams()))return null;h._res=o,!r._simplified&&u&&(this._unsimpledParams||(this._unsimpledParams=h),o>this._unsimpledParams._res&&(this._unsimpledParams._res=o)),this._cachedParams=h}if(!h)return null;this._pitched=s,this._rotated=a;var l=n.getGLScale(),p=[],f=h[0],d=n.getContainerExtent(),g=this._pointContainerPoints(f,t,e,i,this._hitPoint&&!d.contains(this._hitPoint));if(!g)return null;p.push(g);for(var y=1,_=h.length;y<_;y++)c(h[y])||h[y]instanceof ge?c(h[y])?p.push(h[y]/l):p.push(h[y].multi(1/l)):p.push(h[y]);return p},i._pointContainerPoints=function(t,e,i,n,r,o){if(this._aboveCamera())return null;var s,a=this.getMap(),h=a.getGLZoom(),u=this.containerOffset;function l(t,n){var r=a._pointToContainerPoint(t,h,n)._sub(u);return(e||i)&&r._add(e||0,i||0),r}var c=this.getAltitude();if(Array.isArray(t)){var p,f=this.geometry,d=(p=!r&&f.options.enableClip?this._clip(t,c):{points:t,altitude:c}).points;c=p.altitude,n&&(c=0);var g=c;s=[];for(var y=0,_=d.length;y<_;y++){var m=d[y];if(Array.isArray(m)){for(var v=[],x=0,w=m.length;x<w;x++){var b=m[x];Array.isArray(c)&&(g=c[y]?c[y][x]:0),v.push(l(b,g))}s.push(v)}else Array.isArray(c)&&(g="vertex-last"===o?c[c.length-1-y]:"line"===o?(c[y]+c[y+1])/2:c[y]),s.push(l(m,g))}}else t instanceof de&&(n&&(c=0),s=a._pointToContainerPoint(t,h,c)._sub(u),(e||i)&&s._add(e,i));return s},i._clip=function(t,e){var i=this.getMap(),n=this.geometry,r=this.getSymbol().lineWidth;c(r)||(r=4);var o=i._get2DExtent(void 0,jn)._expand(r);if(i.getPitch()>0&&e){var s=i.cameraLookAt,a=i.cameraPosition;An.set(a.x,a.y),o=o._combine(An._add(A(s[0]-a[0]),A(s[1]-a[1])))}var h=t;if(this.get2DExtent(null,Gn).within(o))return{points:h,altitude:e};var u=i._get2DExtent(i.getGLZoom(),jn)._expand(r*i._glScale),l=n.options.smoothness;if(n.getShell&&this.geometry.getHoles&&!l)if(Array.isArray(t[0])){h=[];for(var p=0;p<t.length;p++){var f=fn(t[p],u);f.length&&h.push(f)}}else h=fn(t,u);else if("LineString"===n.getJSONType()&&!l){if(Array.isArray(t[0])){h=[];for(var d=0;d<t.length;d++)L(h,cn(t[d],u,!1,!!l))}else h=cn(t,u,!1,!!l);return this._interpolateSegAlt(h,t,e)}return{points:h,altitude:e}},i._interpolateSegAlt=function(t,e,i){if(!Array.isArray(i)){var n=function(t){return t.point};return{points:t.map((function(t){return Array.isArray(t)?t.map(n):t.point})),altitude:i}}var r=Bn(t,e,i);i=[];var o=r.map((function(t){if(Array.isArray(t)){var e=[],n=t.map((function(t){return e.push(t.altitude),t.point}));return i.push(e),n}return i.push(t.altitude),t.point}));return{points:o,altitude:i}},i.getSymbol=function(){return this.geometry._getInternalSymbol()},i.paint=function(t,e,i){if(this.symbolizers){var n=this.getLayer()._getRenderer();if(n&&(n.context||e)&&(!t||t.intersects(this.get2DExtent(n.resources,Dn)))){var r=this.getMap(),o=this.getMinAltitude(),s=r.getFrustumAltitude();if(!(o&&s&&s<o)){this.containerOffset=i||r._pointToContainerPoint(n.southWest)._add(0,-r.height),this._beforePaint();for(var a=e||n.context,h=[a,n.resources],u=this.symbolizers.length-1;u>=0;u--)this._prepareShadow(a,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],h);this._afterPaint(),this._painted=!0,this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,h)}}}},i.getSprite=function(t,e){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var i=new zi;this.symbolizers.forEach((function(e){var n=e.getFixedExtent(t);i._combine(n)}));var n,r=i.getMin().multi(-1),o=e||(this.getMap()?this.getMap().CanvasClass:null),s=oi.createCanvas(i.getWidth(),i.getHeight(),o);this._renderPoints&&(n=this._renderPoints);for(var a=s.getContext("2d"),h=[a,t],u=this.symbolizers.length-1;u>=0;u--){var l=this.symbolizers[u].getDxDy();this._renderPoints={center:[[r.add(l)]]},this._prepareShadow(a,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],h)}n&&(this._renderPoints=n),this._sprite={canvas:s,offset:i.getCenter()}}return this._spriting=!1,this._sprite},i.isSpriting=function(){return!!this._spriting},i.hitTest=function(t,e){(!e||e<.5)&&(e=.5),Tn||(Tn=oi.createCanvas(1,1)),oi.setHitTesting(!0),Tn.width=Tn.height=2*e;var i=Tn.getContext("2d");this._hitPoint=t.sub(e,e);try{this.paint(null,i,this._hitPoint)}catch(t){throw t}finally{oi.setHitTesting(!1)}delete this._hitPoint;for(var n=i.getImageData(0,0,Tn.width,Tn.height).data,r=3,o=n.length;r<o;r+=4)if(n[r]>0)return!0;return!1},i.isHitTesting=function(){return!!this._hitPoint},i._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},i._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var i=this.symbolizers.length-1;i>=0;i--)t.apply(e,[this.symbolizers[i]])}},i.get2DExtent=function(t,e){this._verifyProjection();var i=this.getMap();t=t||this.getLayer()._getRenderer().resources;var n=i.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===n&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==n&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new zi),this._extent2D._zoom=n),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new zi)))),!this._extent2D)return r&&delete this._fixedExtent,null;var o=this._fixedExtent,s=o.xmin,a=o.ymin,h=o.xmax,u=o.ymax;return r&&delete this._fixedExtent,Fn.set(s,-u,h,-a),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(Fn),e):this._extent2D.add(Fn)},i._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--){var i=this.symbolizers[e];t._combine(i.get2DExtent())}return t},i._computeFixedExtent=function(t,e){for(var i=this.symbolizers.length-1;i>=0;i--){var n=this.symbolizers[i];n.getFixedExtent&&e._combine(n.getFixedExtent(t))}return e},i._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--){if(this.symbolizers[t].isDynamicSize())return!0}return!1},i.getContainerExtent=function(t){if(this._aboveCamera())return null;this._verifyProjection();var e=this.getMap(),i=e.getZoom(),n=e._glScale;this._extent2D&&this._extent2D._zoom===i||this.get2DExtent(null,kn);var r=this.getMinAltitude(),o=this._extent2D.convertTo((function(t){return e._pointToContainerPoint(t,i,r/n,An)}),t),s=this.getMaxAltitude();if(s!==r){var a=this._extent2D.convertTo((function(t){return e._pointToContainerPoint(t,i,s/n,An)}),kn);o._combine(a)}var h=this.geometry.getLayer();if("LineString"===this.geometry.type&&s&&h.options.drawAltitude){var u=this._extent2D.convertTo((function(t){return e._pointToContainerPoint(t,i,0,An)}),kn);o._combine(u)}return o&&o._add(this._fixedExtent||this._computeFixedExtent(null,new zi)),this.geometry.options.smoothness&&o._expand(.15*o.getWidth()),o},i._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap().getFrustumAltitude();return t&&e&&e<t},i.getFixedExtent=function(){var t=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new zi):(this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,Fn),this._fixedExtent)},i.setZIndex=function(t){this._eachSymbolizer((function(e){e.setZIndex(t)}))},i.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(t){t.show()}))):this.getLayer().isCanvasRender()||this.paint()},i.hide=function(){this._eachSymbolizer((function(t){t.hide()}))},i.repaint=function(){this._altAtGLZoom=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},i.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},i.remove=function(){this.removeCache(),this._removeSymbolizers()},i._removeSymbolizers=function(){this._eachSymbolizer((function(t){delete t.painter,t.remove()})),delete this.symbolizers},i.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams,this.geometry&&delete this.geometry[In.CACHE_KEY]},i.getAltitude=function(){return this.geometry.getAltitude()!==this._propAlt&&(this._altAtGLZoom=this._getGeometryAltitude()),this._altAtGLZoom?this._altAtGLZoom:0},i.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},i.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},i._getGeometryAltitude=function(){var t=this;if(!this.getMap())return 0;var e=this.geometry.getAltitude();if(this._propAlt=e,!e)return this.minAltitude=this.maxAltitude=0,0;var i=this.geometry.getCenter();return i?Array.isArray(e)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,e.map((function(e){var n=t._meterToPoint(i,e);return n<t.minAltitude&&(t.minAltitude=n),n>t.maxAltitude&&(t.maxAltitude=n),n}))):(this.minAltitude=this.maxAltitude=this._meterToPoint(i,e),this.minAltitude):0},i._meterToPoint=function(t,e){var i=this.getMap(),n=i.getGLZoom();return i.distanceToPoint(e,0,n,t).x*A(e)},i._verifyProjection=function(){var t=this.geometry._getProjection();this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},i._beforePaint=function(){var t=this.geometry[In.CACHE_KEY];if(t)for(var e in t)_(t,e)&&(t[e].active=!1)},i._afterPaint=function(){var t=this.geometry[In.CACHE_KEY];if(t)for(var e in t)_(t,e)&&(t[e].active||delete t[e])},e}(yi);function Bn(t,e,i){if(!Array.isArray(i))return t;for(var n=[],r=0,o=t.length;r<o;r++)if(Array.isArray(t[r]))n.push(Bn(t[r],e,i));else{var s=t[r];if(s.point.equals(e[s.index]))s.altitude=i[s.index],n.push(s);else{var a=void 0,h=void 0;0===s.index?(a=s.index,h=s.index+1):(a=s.index-1,h=s.index);var u=s.point.distanceTo(e[h]),l=u/(u+e[a].distanceTo(s.point)),c=k(i[a],i[h],1-l);s.altitude=c,n.push(s)}}return n}var Vn=new zi,Hn=function(t){function e(e,i){var n;return(n=t.call(this)||this).geometry=e,n.isMask=i,n}le(e,t);var i=e.prototype;return i._eachPainter=function(t){for(var e,i=this.geometry.getGeometries(),n=0,r=i.length;n<r&&(!(e=this.isMask?i[n]._getMaskPainter():i[n]._getPainter())||!e||!1!==t.call(this,e));n++);},i.paint=function(t){this.geometry&&this._eachPainter((function(e){e.paint(t)}))},i.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var i=e||new zi;return this._eachPainter((function(e){i=i._combine(e.get2DExtent(t,Vn))})),i},i.getContainerExtent=function(){var t=new zi;return this._eachPainter((function(e){t=t.combine(e.getContainerExtent())})),t},i.remove=function(){var t=arguments;this._eachPainter((function(e){e.remove.apply(e,t)}))},i.setZIndex=function(){var t=arguments;this._eachPainter((function(e){e.setZIndex.apply(e,t)}))},i.show=function(){var t=arguments;this._eachPainter((function(e){e.show.apply(e,t)}))},i.hide=function(){var t=arguments;this._eachPainter((function(e){e.hide.apply(e,t)}))},i.repaint=function(){var t=arguments;this._eachPainter((function(e){e.repaint.apply(e,t)}))},i.refreshSymbol=function(){var t=arguments;this._eachPainter((function(e){e.refreshSymbol.apply(e,t)}))},i.hasPoint=function(){var t=!1;return this._eachPainter((function(e){return!e.hasPoint()||(t=!0,!1)})),t},i.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter((function(i){var n=i.getMinAltitude();(t||n<e)&&(t=!1,e=n)})),e},i.getMaxAltitude=function(){var t=0;return this._eachPainter((function(e){var i=e.getMaxAltitude();i>t&&(t=i)})),t},e}(yi),qn={"EPSG:3857":{resolutions:function(){for(var t=[],e=12756274*Math.PI,i=0;i<21;i++)t[i]=e/(256*Math.pow(2,i));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<20;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{resolutions:function(){for(var t=Math.pow(2,18),e=[],i=0;i<20;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{resolutions:function(){for(var t=Math.pow(2,8),e=[],i=0;i<18;i++)e[i]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}}};qn["EPSG:4490"]=qn["EPSG:4326"];var Zn=function(){function t(t){void 0===t&&(t={}),this.options=t,this._initSpatialRef()}t.getProjectionInstance=function(t){if(!t)return null;if(f(t))return t;for(var e in t=(t+"").toLowerCase(),an)if(_(an,e)){var i=an[e].code;if(i&&i.toLowerCase()===t)return an[e]}return null},t.equals=function(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var i=t.fullExtent,n=e.fullExtent;if(i&&!n||!i&&n)return!1;if(i&&n&&(i.top!==n.top||i.bottom!==n.bottom||i.left!==n.left||i.right!==n.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++)if(r[s]!==o[s])return!1}return!0};var e=t.prototype;return e._initSpatialRef=function(){var e=this.options.projection;if(!(e=e?t.getProjectionInstance(e):sn))throw new Error("must provide a valid projection in map's spatial reference.");(e=u({},Vi,e)).measureLength||u(e,$i.DEFAULT),this._projection=e;var i,n=this.options.resolutions;if(!n&&(e.code&&(i=qn[e.code])&&(n=i.resolutions,this.isEPSG="IDENTITY"!==e.code),!n))throw new Error("must provide valid resolutions in map's spatial reference.");this._resolutions=n;var r=this.options.fullExtent;if(!r&&(e.code&&(i=qn[e.code])&&(r=i.fullExtent),!r))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(l(r.left)?(this._fullExtent=new ji(r),r.left=r.xmin,r.right=r.xmax,r.top=r.ymax,r.bottom=r.ymin):this._fullExtent=new ji(new Mi(r.left,r.top),new Mi(r.right,r.bottom)),l(r.top)||l(r.bottom)||l(r.left)||l(r.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");u(this._fullExtent,r),this._projection.fullExtent=r;var o=r.right>=r.left?1:-1,s=r.top>=r.bottom?-1:1;this._transformation=new Bi([o,s,0,0])},e.getResolutions=function(){return this._resolutions||[]},e.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var i=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?i+(this._resolutions[e+1]-i)*(t-e):i},e.getProjection=function(){return this._projection},e.getFullExtent=function(){return this._fullExtent},e.getTransformation=function(){return this._transformation},e.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!l(this._resolutions[t]))return t;return 0},e.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!l(this._resolutions[t]))return t;return this._resolutions.length-1},e.getZoomDirection=function(){return A(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},t}(),Un=function(t){function e(e){var i,n=u({},e),r=n.symbol,o=n.properties,s=n.id;return delete n.symbol,delete n.id,delete n.properties,i=t.call(this,n)||this,r&&i.setSymbol(r),o&&i.setProperties(o),l(s)||i.setId(s),i}le(e,t);var n=e.prototype;return n.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},n.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},n.addTo=function(t,e){return t.addGeometry(this,e),this},n.getLayer=function(){return this._layer?this._layer:null},n.getMap=function(){return this._layer?this._layer.getMap():null},n.getId=function(){return this._id},n.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},n.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},n.setProperties=function(t){var e=this.properties;return this.properties=f(t)?u({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},n.getType=function(){return this.type},n.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?Nt(t):u({},t):null},n.setSymbol=function(t){return this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),this},n.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();return e=Nt(e||this._getInternalSymbol(),t),this._eventSymbolProperties=t,this.setSymbol(e)},n.getCenter=function(){return this._computeCenter(this._getMeasurer())},n.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var i=e.unproject(new Mi(t.xmin,t.ymin)),n=e.unproject(new Mi(t.xmax,t.ymax));return new ji(i,n,e)}return this._computeExtent(this._getMeasurer())},n.getContainerExtent=function(t){var e=this._getPainter();return e?e.getContainerExtent(t):null},n.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},n.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof Mi&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},n._containsPoint=function(t,e){var i=this._getPainter();return!!i&&(l(e)&&this._hitTestTolerance&&(e=this._hitTestTolerance()),i.hitTest(t,e))},n.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},n.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},n.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,i=t.length;e<i;e++)if(l(t[e].opacity)||t[e].opacity>0)return!0;return!1}return l(t.opacity)||c(t.opacity)&&t.opacity>0},n.getZIndex=function(){return this.options.zIndex||0},n.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},n.setZIndexSilently=function(t){return this.options.zIndex=t,this},n.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},n.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},n.translate=function(t,e){if(l(t))return this;var i=new Mi(t,e);if(0===i.x&&0===i.y)return this;var n=this.getCoordinates();if(n)if(Array.isArray(n)){var r=R(n,(function(t){return t.add(i)}));this.setCoordinates(r)}else this.setCoordinates(n.add(i));return this},n.flash=function(t,e,i,n){return Q.call(this,t,e,i,n)},n.copy=function(){var t=this.toJSON(),i=e.fromJSON(t);return i.options.visible=!0,i},n.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},n.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},n.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(l(t.geometry)||t.geometry){var i=this._exportGeoJSONGeometry();e.geometry=i}var n,r=this.getId();return l(r)||(e.id=r),(l(t.properties)||t.properties)&&(n=this._exportProperties()),e.properties=n,e},n.toJSON=function(t){t||(t={});var e=this._toJSON(t);return u(e,this._exportGraphicOptions(t)),e},n.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},n.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},n.rotate=function(t,e){if("GeometryCollection"===this.type)return this.getGeometries().forEach((function(i){return i.rotate(t,e)})),this;e=e?new Mi(e):this.getCenter();var i=this._getMeasurer(),n=this.getCoordinates();if(!Array.isArray(n)){if(e.x!==n.x||e.y!==n.y){var r=i._rotate(n,e,t);this.setCoordinates(r)}return this}return R(n,(function(n){return i._rotate(n,e,t)})),this.setCoordinates(n),this},n._getConnectPoints=function(){return[this.getCenter()]},n._initOptions=function(t){var e=u({},t),i=e.symbol,n=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),i&&this.setSymbol(i),n&&this.setProperties(n),l(r)||this.setId(r)},n._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache()},n._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],i=0;i<t.length;i++)e.push(It(this._checkAndCopySymbol(t[i])));return e}return t?It(t=this._checkAndCopySymbol(t)):null},n._checkAndCopySymbol=function(t){var e={};for(var i in t)s[i]&&d(t[i])?e[i]=+t[i]:e[i]=t[i];return e},n._getSymbol=function(){return this._symbol},n._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},n._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},n._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},n._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._clearHandlers(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},n._getInternalId=function(){return this._internalId},n._setInternalId=function(t){this._internalId=t},n._getMeasurer=function(){return this._getProjection()?this._getProjection():Zn.getProjectionInstance(this.options.defaultProjection)},n._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},n._getExternalResources=function(){return Pt(this._getInternalSymbol())},n._getPainter=function(){var t=this.getLayer();if(!this._painter&&t)if(-1!==i.indexOf(this.type)){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();this._painter=new e(this)}}else if(t.constructor.getPainterClass){var n=t.constructor.getPainterClass();this._painter=new n(this)}return this._painter},n._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new Hn(this,!0):new zn(this)),this._maskPainter},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},n._paint=function(t){this._painter&&this._painter.paint(t)},n._clearCache=function(){delete this._extent},n._clearProjection=function(){delete this._extent},n._repaint=function(){this._painter&&this._painter.repaint()},n.onHide=function(){this.closeMenu(),this.closeInfoWindow()},n.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},n.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},n.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties&&(t.properties=u({},this._eventSymbolProperties),delete this._eventSymbolProperties),this._fireEvent("symbolchange",t)},n.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var i=!1;for(var n in t)if(t.hasOwnProperty(n)){var r=n.slice(0,5);if("arrow"===r||"smoot"===r){i=!0;break}}e?(this.setProperties(e),this._repaint()):i&&this._repaint()},n._setParent=function(t){t&&(this._parent=t)},n._getParent=function(){return this._parent},n._fireEvent=function(t,e){this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e)},n._toJSON=function(t){return{feature:this.toGeoJSON(t)}},n._exportGraphicOptions=function(t){var e={};return(l(t.options)||t.options)&&(e.options=this.config()),(l(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(l(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Mi.toNumberArrays(t);return{type:this.getType(),coordinates:e}},n._exportProperties=function(){var t=null,e=this.getProperties();return l(e)||(t=f(e)?u({},e):e),t},n.getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,i=this.getProperties(),n=e.enableAltitude&&i?i[e.altitudeProperty]:0,r=t.getAltitude?t.getAltitude():0;return Array.isArray(n)?n.map((function(t){return t+r})):n+r},e}(mi(di(vi(yi))));Un.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,defaultProjection:"EPSG:4326"});var Wn={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,hitDetect:!ue.mobile},Yn=function(t){function e(e,i){var n,r;return i&&(r=i.canvas,delete i.canvas),(n=t.call(this,i)||this)._canvas=r,n.setId(e),i&&(n.setZIndex(i.zIndex),i.mask&&n.setMask(Un.fromJSON(i.mask))),n}le(e,t);var i=e.prototype;return i.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();l(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},i.getId=function(){return this._id},i.setId=function(t){var e=this._id;return l(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},i.addTo=function(t){return t.addLayer(this),this},i.setZIndex=function(t){return this._zIndex=t,l(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},i.getZIndex=function(){return this._zIndex||0},i.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},i.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),l(e)?1/0:e):e},i.getOpacity=function(){return this.options.opacity},i.setOpacity=function(t){return this.config("opacity",t),this},i.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof un},i.getMap=function(){return this.map?this.map:null},i.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},i.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i+1),this},i.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var i=e.getZIndex();return this.setZIndex(i-1),this},i.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var i=this.getMap();e&&i?i.once("renderend",(function(){t.fire("show")})):this.fire("show")}return this},i.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var i=this.getMap();e&&i?i.once("renderend",(function(){t.fire("hide")})):this.fire("hide")}return this},i.isVisible=function(){if(c(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!l(this.options.maxZoom)&&this.options.maxZoom<e||!l(this.options.minZoom)&&this.options.minZoom>e)return!1}return l(this.options.visible)&&(this.options.visible=!0),this.options.visible},i.remove=function(){return this.map&&this.map.removeLayer(this),this},i.getMask=function(){return this._mask},i.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),"Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},i.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},i.onLoad=function(){return!0},i.onLoadEnd=function(){},i.isLoaded=function(){return!!this._loaded},i.getRenderer=function(){return this._getRenderer()},i.onConfig=function(t){if(c(t.opacity)||t.cssFilter){var e=this.getRenderer();e&&e.setToRedraw()}},i.onAdd=function(){},i.onRendererCreate=function(){},i.onCanvasCreate=function(){},i.onRemove=function(){},i._bindMap=function(t,e){t&&(this.map=t,l(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},i._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},i._doRemove=function(){this._loaded=!1,this.onRemove(),this._switchEvents("off",this),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map},i._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()[t](e.getEvents(),e)},i._getRenderer=function(){return this._renderer},i._getLayerList=function(){return this.map?this.map._layers:[]},i._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},e}(mi(di(hn(yi))));Yn.mergeOptions(Wn);var Xn=Yn.prototype.fire;Yn.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,e.target=this,this.map._onLayerEvent(e)),Xn.apply(this,arguments)};var Jn,Qn,Kn,$n,tr,er,ir={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!C,zoomAnimationDuration:330,panAnimation:!C,panAnimationDuration:600,zoomable:!0,enableInfoWindow:!0,hitDetect:!ue.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60]},nr=function(t){function i(e,n){var r;if(!n)throw new Error("Invalid options when creating map.");if(!n.center)throw new Error("Invalid center when creating map.");var o=u({},n),s=o.zoom;delete o.zoom;var a=new Mi(o.center);delete o.center;var h=o.baseLayer;delete o.baseLayer;var l=o.layers;return delete o.layers,(r=t.call(this,o)||this).VERSION=i.VERSION,Object.defineProperty(pe(r),"id",{value:P(),writable:!1}),r._loaded=!1,r._initContainer(e),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=s,r._center=a,r.setSpatialReference(o.spatialReference||o.view),r.setMaxExtent(o.maxExtent),r._mapViewPoint=new de(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),h&&r.setBaseLayer(h),l&&r.addLayer(l),r._Load(),r.initView=r.getView(),r}le(i,t),i.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this};var n=i.prototype;return n.isLoaded=function(){return!!this._loaded},n.getContainer=function(){return this._containerDOM},n.getSpatialReference=function(){return this._spatialReference},n.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&Zn.equals(e,t)||this._updateSpatialReference(t,e),this},n._updateSpatialReference=function(t,e){if(t=u({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new Zn(t),this.options.spatialReference&&g(this.options.spatialReference.projection)){var i=this._spatialReference.getProjection();this.options.spatialReference.projection=i.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:u({},this.options.spatialReference)}),this},n.onConfig=function(t){var e=t.spatialReference||t.view;return l(e)||this._updateSpatialReference(e,null),this},n.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},n.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},n.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},n.resetCursor=function(){return this.setCursor(null)},n.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},n.setCenter=function(t){if(!t)return this;t=new Mi(t);var e=this.getProjection().project(t);return this._verifyExtent(e)?this._loaded?(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},n.getSize=function(){return l(this.width)||l(this.height)?this._getContainerDomSize():new ge(this.width,this.height)},n.getContainerExtent=function(){var t=this.height,e=this.getPitch(),i=this.options.maxVisualPitch;return i&&e>i&&(t=this._getVisualHeight(i)),new zi(0,this.height-t,this.width,this.height)},n._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,i=this.getFov()*Math.PI/180;t*=Math.PI/180;var n=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(i/2),o=n*r/(1/Math.tan(t)-r)/Math.sin(t),s=n*(Math.sin(e)*o/(n+Math.cos(e)*o));return this.height/2+s},n.getExtent=function(){return this._pointToExtent(this._get2DExtent())},n.getProjExtent=function(){var t=this._get2DExtent();return new ji(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},n.getPrjExtent=function(){return this.getProjExtent()},n.getMaxExtent=function(){return this.options.maxExtent?new ji(this.options.maxExtent,this.getProjection()):null},n.setMaxExtent=function(t){if(t){var e=new ji(t,this.getProjection());this.options.maxExtent=e,this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent().getCenter());var i=this.getProjection();this._prjMaxExtent=e.convertTo((function(t){return i.project(t)}))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},n.getZoom=function(){return this._zoomLevel},n.getZoomForScale=function(t,e,i){var n=this.getZoom();if(l(e)&&(e=n),1===t&&e===n)return n;var r=this._getResolution(e)/t,o=this.getZoomFromRes(r);if(i)return o;var s=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-s):Math.floor(o+s)},n.getZoomFromRes=function(t){var e=this._getResolutions(),i=this._getResolution(this.getMinZoom()),n=this._getResolution(this.getMaxZoom());if(i<=n){if(t<=i)return this.getMinZoom();if(t>=n)return this.getMaxZoom()}else{if(t>=i)return this.getMinZoom();if(t<=n)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=e[o+1]-e[o],a=t-e[o];if(A(s)===A(a)&&Math.abs(s)>=Math.abs(a))return o+a/s}return r-1},n.setZoom=function(t,e){return void 0===e&&(e={animation:!0}),isNaN(t)||l(t)||(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t)),this},n.getMaxZoom=function(){return l(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},n.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},n.getMinZoom=function(){return l(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},n.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},n.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},n.getGLZoom=function(){return this.getMaxNativeZoom()/2},n.getGLScale=function(t){return l(t)&&(t=this.getZoom()),this._getResolution(t)/this._getResolution(this.getGLZoom())},n.zoomIn=function(){return this.setZoom(this.getZoom()+1)},n.zoomOut=function(){return this.setZoom(this.getZoom()-1)},n.isZooming=function(){return!!this._zooming},n.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},n.setCenterAndZoom=function(t,e){return l(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},n.getFitZoom=function(t,e){var i=this;if(!(t&&t instanceof ji))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var n=this.getSize(),r=t.convertTo((function(t){return i.coordToContainerPoint(t)})),o=r.getWidth(),s=r.getHeight(),a=n.width/o,h=n.height/s,u=this.getSpatialReference().getZoomDirection()<0?Math.max(a,h):Math.min(a,h);return this.getZoomForScale(u,null,e)},n.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},n.setView=function(t){return t?(t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.pitch||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},n.getResolution=function(t){return this._getResolution(t)},n.getScale=function(t){var e=l(t)?this.getZoom():t,i=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/i},n.fitExtent=function(t,e,i,n){if(void 0===i&&(i={}),!t)return this;t=new ji(t,this.getProjection());var r=this.getFitZoom(t)+(e||0),o=t.getCenter();return void 0===i.animation||i.animation?this._animateTo({center:o,zoom:r},{duration:i.duration||this.options.zoomAnimationDuration,easing:i.easing||"out"},n):this.setCenterAndZoom(o,r)},n.getBaseLayer=function(){return this._baseLayer},n.setBaseLayer=function(t){var e=!1;if(this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),!t)return delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this;return this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this},n.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},n.getLayers=function(t){return this._getLayers((function(i){return!(i===this._baseLayer||i.getId().indexOf(e)>=0)&&(!t||t(i))}))},n.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var i=this.getBaseLayer();return i&&i.getId()===t?i:null},n.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,i=0,n=t.length;i<n;i++){var r=t[i],o=r.getId();if(l(o))throw new Error("Invalid id for the layer: "+o);if(r.getMap()!==this){if(this._layerCache[o])throw new Error("Duplicate layer id in the map: "+o);this._layerCache[o]=r,r._bindMap(this),e.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},n.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(r instanceof Yn||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}if(e.length>0){var a=this.getRenderer();a&&a.setLayerCanvasUpdated(),this.once("frameend",(function(){e.forEach((function(t){t.fire("remove")}))}))}return this._fireEvent("removelayer",{layers:t}),this},n.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],i=Number.MAX_VALUE,n=0,r=t.length;n<r;n++){var o=t[n];if(d(t[n])&&(o=this.getLayer(o)),!(o instanceof Yn&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<i&&(i=o.getZIndex()),e.push(o)}for(var s=0,a=e.length;s<a;s++)e[s].setZIndex(i+s);return this},n.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var i=t.save,n=this._getRenderer();if(n&&n.toDataURL){var r=t.fileName;r||(r="export");var o=n.toDataURL(e);if(i&&o){var s;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var a=U(o.replace(/^data:image\/(png|jpeg|jpg);base64,/,""),e);s=URL.createObjectURL(a)}else s=o;var h=document.createElement("a");h.download=r,h.href=s,document.body.appendChild(h),h.click(),document.body.removeChild(h)}return o}return null},n.coordToPoint=function(t,e,i){return this.coordinateToPoint(t,e,i)},n.pointToCoord=function(t,e,i){return this.pointToCoordinate(t,e,i)},n.coordToViewPoint=function(t,e,i){return this.coordinateToViewPoint(t,e,i)},n.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},n.coordToContainerPoint=function(t,e,i){return this.coordinateToContainerPoint(t,e,i)},n.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},n.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},n.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},n.checkSize=function(){var t=h()-this._initTime<1500&&0===this.width||0===this.height,e=this._getContainerDomSize(),i=this.height,n=this.width;if(e.width===n&&e.height===i)return this;var r=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(e);else{var o=this._getVisualHeight(this.getPitch()),s=new de(0,this.height-o),a=this._containerPointToPrj(s);this._updateMapSize(e);var u=this._getVisualHeight(this.getPitch()),l=new de(0,this.height-u);this._setPrjCoordAtContainerPoint(a,l),this._mapViewCoord=this._getPrjCenter()}var c=0===e.width||0===e.height||0===n||0===i;return(t||c)&&(this._eventSilence=!0,this.setCenter(r),delete this._eventSilence),this._fireEvent("resize"),this},n.locate=function(t,e,i){return this.getProjection()._locate(new Mi(t),e,i)},n.getMainPanel=function(){return this._getRenderer().getMainPanel()},n.getPanels=function(){return this._panels},n.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),i=0;i<e.length;i++)e[i].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(t){return"maptalks-wrapper"===t.className})).forEach((function(e){return t._containerDOM.removeChild(e)})),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},n.isRemoved=function(){return!this._containerDOM},n.isMoving=function(){return!!this._moving},n.onMoveStart=function(t){var e=this._getPrjCenter();this._originCenter&&!this._verifyExtent(e)||(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},n.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},n.onMoveEnd=function(t){if(this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())&&this._originCenter){var e=this._originCenter;this._panTo(e)}},n.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},n.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},n.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},n.isDragRotating=function(){return!!this._dragRotating},n.getRenderer=function(){return this._getRenderer()},n.getDevicePixelRatio=function(){return this.options.devicePixelRatio||ue.devicePixelRatio||1},n._initContainer=function(t){if(d(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,C&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},n._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},n._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},n._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},n._removeLayer=function(t,e){if(t&&e){var i=e.indexOf(t);i>-1&&e.splice(i,1)}},n._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t;this._layers.sort((function(t,e){var i=t.getZIndex()-e.getZIndex();return 0===i?t._order-e._order:i}))}},n._fireEvent=function(t,e){this._eventSilence||(this.fire("_"+t,e),this.fire(t,e))},n._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=h()},n._initRenderer=function(){var t=this.options.renderer,e=i.getRendererClass(t);this._renderer=new e(this),this._renderer.load()},n._getRenderer=function(){return this._renderer},n._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(t){t&&t.load()}),this.getLayers())},n._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,i=[],n=0;n<e.length;n++)t&&!t.call(this,e[n])||i.push(e[n]);return i},n._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var i=[],n=0,r=e.length;n<r;n++)i=i.concat(e[n]);for(var o=0,s=i.length;o<s;o++)t.call(t,i[o])}},n._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},n._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),i=this._spatialReference.getMaxZoom(),n=this._spatialReference.getMinZoom();(l(t)||-1===t||t>i)&&this.setMaxZoom(i),(l(e)||-1===e||e<n)&&this.setMinZoom(n),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(l(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},n._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,i=this._containerDOM;if(l(i.width)||l(i.height)){if(l(i.clientWidth)||l(i.clientHeight))throw new Error("can not get size of container");t=parseInt(i.clientWidth,0),e=parseInt(i.clientHeight,0)}else{t=i.width,e=i.height;var n=this.getDevicePixelRatio();1!==n&&i.layer&&(t/=n,e/=n)}return new ge(t,e)},n._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},n._getPrjCenter=function(){return this._prjCenter},n._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},n._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var i=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),n=this._pointToPrj(this._prjToPoint(t).sub(i));return this._setPrjCenter(n),this},n._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},n._offsetCenterByPixel=function(t){var e=new de(this.width/2-t.x,this.height/2-t.y),i=this._containerPointToPrj(e);return this._setPrjCenter(i),i},n.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},n.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},n._resetMapViewPoint=function(){this._mapViewPoint=new de(0,0),this._mapViewCoord=this._getPrjCenter()},n._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?t===this.getGLZoom()&&void 0!==this._mapGlRes?this._mapGlRes:(l(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},n._getResolutions=function(){return this._spatialReference.getResolutions()},n._prjToPoint=function(t,e,i){return e=l(e)?this.getZoom():e,this._spatialReference.getTransformation().transform(t,this._getResolution(e),i)},n._pointToPrj=function(t,e,i){return e=l(e)?this.getZoom():e,this._spatialReference.getTransformation().untransform(t,this._getResolution(e),i)},n._pointToPoint=function(t,e,i){return i?(i.x=t.x,i.y=t.y):i=t.copy(),l(e)?i:i._multi(this._getResolution(e)/this._getResolution())},n._pointToPointAtZoom=function(t,e,i){return i?(i.x=t.x,i.y=t.y):i=t.copy(),l(e)?i:i._multi(this._getResolution()/this._getResolution(e))},n._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},n._callOnLoadHooks=function(){var t=i.prototype;if(t._onLoadHooks)for(var e=0,n=t._onLoadHooks.length;e<n;e++)t._onLoadHooks[e].call(this)},i}(vi(di(hn(yi))));nr.include({coordinateToPoint:(er=new Mi(0,0),function(t,e,i){var n=this.getProjection().project(t,er);return this._prjToPoint(n,e,i)}),pointToCoordinate:function(){var t=new Mi(0,0);return function(e,i,n){var r=this._pointToPrj(e,i,t);return this.getProjection().unproject(r,n)}}(),coordinateToViewPoint:function(){var t=new Mi(0,0);return function(e,i,n){return this._prjToViewPoint(this.getProjection().project(e,t),i,n)}}(),viewPointToCoordinate:function(){var t=new Mi(0,0);return function(e,i){return this.getProjection().unproject(this._viewPointToPrj(e,t),i)}}(),coordinateToContainerPoint:function(){var t=new Mi(0,0);return function(e,i,n){var r=this.getProjection().project(e,t);return this._prjToContainerPoint(r,i,n)}}(),containerPointToCoordinate:function(){var t=new Mi(0,0);return function(e,i){var n=this._containerPointToPrj(e,t);return this.getProjection().unproject(n,i)}}(),containerToExtent:($n=new de(0,0),tr=new de(0,0),function(t){var e=new zi(this._containerPointToPoint(t.getMin($n),void 0,$n),this._containerPointToPoint(t.getMax(tr),void 0,tr));return this._pointToExtent(e)}),distanceToPixel:function(){var t=new de(0,0),e=new de(0,0);return function(i,n,r){var o=this.getProjection();if(!o)return null;var s=this.getScale()/this.getScale(r),a=this.getCenter(),h=o.locate(a,i,n),u=this.coordToContainerPoint(a,void 0,t),l=this.coordToContainerPoint(h,void 0,e);return l._sub(u)._multi(s)._abs(),new ge(l.x,l.y)}}(),distanceToPoint:(Kn=new de(0,0),function(t,e,i,n){var r=this.getProjection();if(!r)return null;var o=n||this.getCenter(),s=r.locate(o,t,e),a=this.coordToPoint(o,i,Kn),h=this.coordToPoint(s,i);return h._sub(a)._abs(),h}),pixelToDistance:(Jn=new Mi(0,0),Qn=new Mi(0,0),function(t,e){var i=this.getProjection();if(!i)return null;var n=this.getFullExtent(),r=n.top>n.bottom?-1:1,o=Jn.set(this.width/2+t,this.height/2+r*e),s=this.containerPointToCoord(o,Qn);return i.measureLength(this.getCenter(),s)}),pointToDistance:function(){var t=new de(0,0),e=new Mi(0,0);return function(i,n,r){var o=this.getProjection();if(!o)return null;var s=this._prjToPoint(this._getPrjCenter(),r,t);s._add(i,n);var a=this.pointToCoord(s,r,e);return o.measureLength(this.getCenter(),a)}}(),locateByPoint:function(){var t=new de(0,0);return function(e,i,n){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(i,n))}}(),_get2DExtent:function(){var t=new de(0,0);return function(e,i){var n,r=this;return void 0!==e&&e!==this._zoomLevel||!this._mapExtent2D?e===this.getGLZoom()&&this._mapGlExtent2D&&(n=this._mapGlExtent2D):n=this._mapExtent2D,n?i?(i.set(n.xmin,n.ymin,n.xmax,n.ymax),i):n.copy():this.getContainerExtent().convertTo((function(i){return r._containerPointToPoint(i,e,t)}),i)}}(),_pointToExtent:function(){var t=new Mi(0,0),e=new Mi(0,0);return function(i){var n=i.getMin(),r=i.getMax(),o=this.getFullExtent(),s=!o||o.left<=o.right?[n.x,r.x]:[r.x,n.x],a=s[0],h=s[1],u=!o||o.top>o.bottom?[r.y,n.y]:[n.y,r.y],l=u[0],c=u[1],p=n.set(a,c),f=r.set(h,l);return new ji(this.pointToCoord(p,void 0,t),this.pointToCoord(f,void 0,e),this.getProjection())}}(),_getViewPointFrameOffset:function(){var t=new de(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new de(0,0);return function(e,i){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),i)}}(),_prjToContainerPoint:function(){var t=new de(0,0);return function(e,i,n,r){return this._pointToContainerPoint(this._prjToPoint(e,i,t),i,r||0,n)}}(),_prjToViewPoint:function(){var t=new de(0,0);return function(e,i,n){var r=this._prjToContainerPoint(e,void 0,t,n);return this.containerPointToViewPoint(r,i)}}(),_viewPointToPoint:function(){var t=new de(0,0);return function(e,i,n){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),i,n)}}(),_pointToViewPoint:function(){var t=new Mi(0,0);return function(e,i,n){return this._prjToViewPoint(this._pointToPrj(e,i,t),n)}}()}),nr.mergeOptions(ir);var rr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},i.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},i._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var i=e.getZoom(),n=t.domEvent.shiftKey?Math.ceil(i)-1:Math.floor(i)+1;e._zoomAnimation(n,t.containerPoint)}},e}(gi);nr.mergeOptions({doubleClickZoom:!0}),nr.addOnLoadHook("addHandler","doubleClickZoom",rr);var or=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){var t=this.target;if(t){var e=t._panels.mapWrapper||t._containerDOM;this._dragHandler=new Ci(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},i.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},i._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},i._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},i._onMouseDown=function(t){delete this.startDragTime,delete this._mode,2===t.domEvent.button||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),ze(t.domEvent)},i._onDragStart=function(t){this.startDragTime=h(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},i._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},i._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},i._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY},i._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var i=qe(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(i)},i._moving=function(t){if(this.startDragTime){var e=this.target,i=qe(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,i),e.onMoving(t)}},i._moveEnd=function(t){if(this.startDragTime){var e=this.target,i=h()-this.startDragTime,n=t.mousePos.x,r=t.mousePos.y,o=n-this.startX,s=r-this.startY;this._clear(),e.options.panAnimation&&!t.interupted&&e._verifyExtent(e._getPrjCenter())&&i<280&&Math.abs(s)+Math.abs(o)>5?(i=5*i*(Math.abs(o)+Math.abs(s))/500,e.panBy(new de(o,s),{duration:i})):e.onMoveEnd(t)}},i._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},i._rotating=function(t){var e=this.target,i=t.mousePos.x,n=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),s=Math.abs(i-this.preX),a=Math.abs(n-this.preY);if(this._rotateMode||(e.options.dragRotatePitch?this._rotateMode="rotate_pitch":this._rotateMode=s>a?"rotate":s<a?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&a<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var h=0;h=e.options.dragPitch||s>a?-.6*(this.preX-i):i>e.width/2?.6*(this.preY-n):-.6*(this.preY-n);var u=e.getBearing()+h;this._db=this._db||0,this._db+=h,e.setBearing(u)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e.setPitch(e.getPitch()+.4*(this.preY-n)),this.preX=i,this.preY=n,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},i._rotateEnd=function(t){var e=this.target,i=e.getBearing();this._clear();var n=h()-this.startDragTime;if(e.onDragRotateEnd(t),Math.abs(i-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&n<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/2},{easing:"out",duration:800})}},i._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(gi);nr.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),nr.addOnLoadHook("addHandler","draggable",or);var sr="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",ar=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;Ke(e,sr,this._identifyGeometryEvents,this)},i.removeHooks=function(){var t=this.target,e=t._panels.allLayers||t._containerDOM;$e(e,sr,this._identifyGeometryEvents)},i._identifyGeometryEvents=function(t,e){var i=this.target;if(!i.isInteracting()&&!i._ignoreEvent(t)){var n=i._getLayers((function(t){return!(!t.identify||!t.options.geometryEvents)}));if(n.length){var r=null,o=e||t.type;if("mousedown"===o||"touchstart"===o&&1===t.touches.length)this._mouseDownTime=h();else if(("click"===o||"touchend"===o)&&this._mouseDownTime){var s=this._mouseDownTime;if(delete this._mouseDownTime,h()-s>300){if("click"===o)return}else"touchend"===o&&(r="click")}var a=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(a){var u=qe(a,i._containerDOM),l=i.containerPointToCoordinate(u);"touchstart"===o&&ze(t);var c=null,p={includeInternals:!0,filter:function(e){if(!(e instanceof Un))return!1;var i=e._getEventTypeToFire(t);if("mousemove"===o){if(!c&&e.options.cursor&&(c=e.options.cursor),!e.listens("mousemove")&&!e.listens("mouseover")&&!e.listens("mouseenter"))return!1}else if(!e.listens(i)&&!e.listens(r))return!1;return!0},count:1,coordinate:l,onlyVisible:i.options.onlyVisibleGeometryEvents,layers:n},f=function(e){var n=!0;if("mousemove"===o){var s={};if(e.length>0)for(var a=e.length-1;a>=0;a--){var h=e[a];if(h instanceof Un){var u=h._getInternalId();s[u]=h,h._onEvent(t),this._prevOverGeos&&this._prevOverGeos.geomap[u]||h._onEvent(t,"mouseenter"),n=h._onEvent(t,"mouseover")}}i._setPriorityCursor(c);var l=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:e,geomap:s},l&&l.length>0)for(var p=l.length-1;p>=0;p--){var f=l[p];if(f instanceof Un){var d=l[p]._getInternalId();s[d]||(n=f._onEvent(t,"mouseout"))}}}else{if(!e||!e.length)return;for(var g=e.length-1;g>=0;g--)if(e[g]instanceof Un){n=e[g]._onEvent(t),r&&e[g]._onEvent(t,r);break}}!1===n&&Be(t)}.bind(this);"mousemove"===o||"touchmove"===o?this._queryIdentifyTimeout=i.getRenderer().callInNextFrame((function(){i.isInteracting()||i.identify(p,f)})):i.identify(p,f)}}}},e}(gi);nr.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),nr.addOnLoadHook("addHandler","geometryEvents",ar);var hr=4.000244140625,ur=function(t){function e(e){var i;return(i=t.call(this,e)||this)._thisScrollZoom=i._scrollZoom.bind(pe(i)),i._wheelZoomRate=.0022222222222222222,i._defaultZoomRate=.01,i._delta=0,i}le(e,t);var i=e.prototype;return i.addHooks=function(){Fe(this.target._containerDOM,"wheel",this._onWheelScroll,this)},i.removeHooks=function(){je(this.target._containerDOM,"wheel",this._onWheelScroll)},i._onWheelScroll=function(t){ze(t),Be(t);var e=this.target;if(e._ignoreEvent(t)||!e.options.zoomable)return!1;var i=e._containerDOM,n=e._checkZoomOrigin(qe(t,i));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,n)):this._interval(t,n)},i._seamless=function(t,e){var i=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(i%hr!=0&&(this._ensureTrackpad||(Math.abs(i)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(i*=14)),t.shiftKey&&i&&(i/=4),this._lastWheelEvent=t,this._delta-=i,!this._zooming&&this._delta){var n=this.target;this._zoomOrigin=e,n.onZoomStart(null,e)}this._start()},i._start=function(){if(this._delta){this._zooming=!0;var t=this.target;this._active||(t.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0)}},i._scrollZoom=function(){var t=this;if(this._active=!1,this._delta){var e=Math.abs(this._delta)>hr?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);var n=this.target,r=n.getZoom(),o=n.getZoomForScale(i,r,!0);this._delta=0,n.onZooming(o,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((function(){t._zooming=!1,delete t._timeout,n.onZoomEnd(n.getZoom(),t._zoomOrigin)}),210)}},i._interval=function(t,e){var i=this,n=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.deltaY?-1*t.deltaY:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var o=n.getZoom(),s=o+r;if((s=n._checkZoom(r>0?Math.ceil(s):Math.floor(s)))===o)return!1;this._zooming=!0,this._delta||(n.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=n.getZoom());return n._animateTo({zoom:s-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(e){"finished"===e.state.playState?i._requesting<1||Math.abs(s-i._startZoom)>2||s===n.getMaxZoom()||s===n.getMinZoom()?(n._animateTo({zoom:s,around:i._origin},{continueOnViewChanged:!0,duration:100},(function(t){"running"!==t.state.playState&&(delete i._zooming,delete i._requesting)})),delete i._startZoom,delete i._origin,delete i._delta,i._requesting=0):l(i._requesting)||(delete i._zooming,i._onWheelScroll(t)):"running"!==e.state.playState&&(delete i._zooming,delete i._requesting)})),!1},e}(gi);nr.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!1}),nr.addOnLoadHook("addHandler","scrollWheelZoom",ur);var lr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){Fe(this.target.getContainer(),"touchstart",this._onTouchStart,this)},i.removeHooks=function(){je(this.target.getContainer(),"touchstart",this._onTouchStart)},i._onTouchStart=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var i=e.getContainer(),n=qe(t.touches[0],i),r=qe(t.touches[1],i);this.preY=n.y,this._startP1=n,this._startP2=r,this._startDist=n.distanceTo(r),this._startVector=n.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),$e(document,"touchmove",this._onTouchMove),$e(document,"touchend",this._onTouchEnd),Fe(document,"touchmove",this._onTouchMove,this),Fe(document,"touchend",this._onTouchEnd,this),ze(t),e._fireEvent("touchactstart")}},i._onTouchMove=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var i=e.getContainer(),n=qe(t.touches[0],i),r=qe(t.touches[1],i),o=n.sub(this._startP1),s=r.sub(this._startP2),a=n.sub(r),h=n.distanceTo(r)/this._startDist,u=180*a.angleWith(this._startVector)/Math.PI,l=.4*((this.preY||n.y)-n.y);this.preY=n.y;var c={domEvent:t,mousePos:[n,r]};if(this.mode||(e.options.touchRotate&&Math.abs(u)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&o.y*s.y>0&&Math.abs(o.y)>10&&Math.abs(s.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-h)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(c)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=h;var p=e._getResolution(this._startZoom)/h,f=e.getZoomFromRes(p);e.onZooming(f,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e.setBearing(this._startBearing+u),e.onDragRotating(c)):"pitch"===this.mode&&(e.setPitch(e.getPitch()+l),e.onDragRotating(c)),e._fireEvent("touchactinging")}},i._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var i=e.getSize();this._Origin=new de(i.width/2,i.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},i._onTouchEnd=function(t){delete this.preY;var e=this.target;if($e(document,"touchmove",this._onTouchMove),$e(document,"touchend",this._onTouchEnd),"zoom"===this.mode||"rotate_zoom"===this.mode){var i=this._scale,n=e._getResolution(this._startZoom)/i,r=e.getZoomFromRes(n);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(gi);nr.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),nr.addOnLoadHook("addHandler","touchGesture",lr);var cr="__anim_player",pr={in:function(t){return Math.pow(t,2)},out:function(t){return 1-pr.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?pr.inAndOut(2*t):1-pr.inAndOut(2*(t-.5))}},fr=function(t,e){this.state=t,this.styles=e},dr=function(t,e,i,n){this._animation=t,this.options=e,this._onFrame=i,this.playState="idle",this.ready=!0,this.finished=!1,this.target=n},gr={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return gr._resolveStyles(t);for(var e=[],i=[],n=[],r=0;r<t.length;r++){var o=gr._resolveStyles(t[r]);o&&(e.push(o[0]),i.push(o[1]),n.push(o[2]))}return e.length?[e,i,n]:null}function i(t){var e,i=t;Array.isArray(t)||(i=c(t)?[0,t]:t instanceof de||t instanceof Mi?[new(e=t.constructor)(0,0),t]:[t,t]);var n=i[0],r=i[1];return c(n)&&c(r)?n===r?null:[n,r-n,r]:Array.isArray(n)&&c(n[0])||n instanceof Mi||n instanceof de?(Array.isArray(n)?(n=new Mi(n),r=new Mi(r)):(n=new(e=n.constructor)(n),r=new e(r)),n.equals(r)?null:[n,r.sub(n),r]):[n,r,r]}var n,r={},o={},s={};for(var a in t)if(t.hasOwnProperty(a)){var h=t[a];if(!h)continue;if(Array.isArray(h)&&(l(h[0])||l(h[1])))continue;var u=void 0;n=h,(u=!Array.isArray(n)&&n.constructor===Object||Array.isArray(n)&&n[0].constructor===Object?e(h):i(h))&&(o[a]=u[0],r[a]=u[1],s[a]=u[2])}return[o,r,s]},framing:function(t,e){e||(e={});var i,n,r,o=e.easing?pr[e.easing]:pr.linear;o||(o=pr.linear),(t=gr._resolveStyles(t))&&(n=t[0],i=t[1],r=t[2]);var s=function t(e,i,n){if(!i||!n)return null;var o={};for(var s in n)if(n.hasOwnProperty(s)){if(i[s]===r[s]){o[s]=i[s];continue}var a=i[s],h=n[s];if(c(h))o[s]=a+e*h;else if(Array.isArray(h)){for(var u=[],l=0;l<h.length;l++)u.push(t(e,a[l],h[l]));o[s]=u}else{var p=h.constructor;o[s]=p===Object?t(e,a,h):a instanceof de||a instanceof Mi?a.add(h.multi(e)):h}}return o};return function(t,e){var a,h;if(t<0)a={playState:"idle",delta:0},h=n;else if(t<e){var u=o(t/e);a={playState:"running",delta:u},h=s(u,n,i)}else a={playState:"finished",delta:1},h=r;return a.startStyles=n,a.destStyles=r,a.progress=t,a.remainingMs=e-t,new fr(a,h)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=w(gr._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]();this._frameQueue.length?this._animationFrameId=w(gr._frameFn):delete this._animationFrameId}},animate:function(t,e,i,n){e||(e={});var r=gr.framing(t,e);return new dr(r,e,i,n)}};gr._frameFn=gr._run.bind(gr),u(dr.prototype,{_prepare:function(){var t=this.options,e=t.speed||t.duration;d(e)&&((e=gr.speed[e])||(e=+e)),e||(e=gr.speed.normal),this.duration=e,this._framer=t.framer||gr._requestAnimFrame.bind(gr)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[cr])return this;this.target&&(this.target[cr]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=h();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},cancel:function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},finish:function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},reverse:function(){},_run:function(){var t=this,e=this._onFrame,i=h(),n=i-this._playStartTime;if(this.options.repeat&&n>=this.duration&&(this._playStartTime=i,n=0),"running"===this.playState){var r=this._animation(n,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[cr],"idle"===this.playState?this.startTime>i&&setTimeout(this._run.bind(this),this.startTime-i):"running"===this.playState?this._framer((function(){"running"===t.playState&&(t.currentTime=n,e&&e(r),t._run())})):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(this.target&&delete this.target[cr],e){"finished"===this.playState?n=this.duration:"idle"===this.playState&&(n=0);var o=this._animation(n,this.duration);o.state.playState=this.playState,e(o)}}});var yr=Object.freeze({Animation:gr,Easing:pr,Player:dr,Frame:fr}),_r=ci((function(t){!function(){function e(t,e,i){var n=e.x,r=e.y,o=i.x-n,s=i.y-r;if(0!==o||0!==s){var a=((t.x-n)*o+(t.y-r)*s)/(o*o+s*s);a>1?(n=i.x,r=i.y):a>0&&(n+=o*a,r+=s*a)}return(o=t.x-n)*o+(s=t.y-r)*s}function i(t,n,r,o,s){for(var a,h=o,u=n+1;u<r;u++){var l=e(t[u],t[n],t[r]);l>h&&(a=u,h=l)}h>o&&(a-n>1&&i(t,n,a,o,s),s.push(t[a]),r-a>1&&i(t,a,r,o,s))}function n(t,e){var n=t.length-1,r=[t[0]];return i(t,0,n,e,r),r.push(t[n]),r}function r(t,e,i){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return t=i?t:function(t,e){for(var i,n,r,o,s,a=t[0],h=[a],u=1,l=t.length;u<l;u++)i=t[u],r=a,o=void 0,s=void 0,o=(n=i).x-r.x,s=n.y-r.y,o*o+s*s>e&&(h.push(i),a=i);return a!==i&&h.push(i),h}(t,r),t=n(t,r)}t.exports=r,t.exports.default=r}()})),mr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.getOutline=function(){if(!this._getPainter())return null;var t=this.getExtent();return new xr(t.toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}})},i.animateShow=function(t,e){var i=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.finish(),g(t)&&(e=t={});var n=this.getCoordinates();if(0===n.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var r=!!this.getShell?this.getShell().concat(this.getShell()[0]):this.getCoordinates(),o=this._getProjection(),s=o.projectCoords(r);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=o.unproject(this._prjAniShowCenter);var a=t.duration||1e3,h=t.easing||"out";this.setCoordinates([]);for(var u=0,l=1;l<s.length;l++)u+=s[l].distanceTo(s[l-1]);var c=this._showPlayer=gr.animate({t:a},{duration:a,easing:h},(function(t){if(i.getMap()){var o=i._drawAnimShowFrame(t.styles.t,a,u,r,s);"finished"===t.state.playState&&(delete i._showPlayer,delete i._aniShowCenter,delete i._prjAniShowCenter,delete i._animIdx,delete i._animLenSoFar,delete i._animTailRatio,i.setCoordinates(n)),e&&e(t,o)}else if("finished"!==c.playState&&(c.finish(),e)){var h=i.getCoordinates();e(t,h[h.length-1])}}),this);return c.play(),c},i._drawAnimShowFrame=function(t,e,i,n,r){if(0===t)return n[0];var o,s,a=this._getProjection(),h=t/e*i,u=0;for(o=this._animIdx,s=r.length;o<s-1&&(u=r[o].distanceTo(r[o+1]),!(this._animLenSoFar+u>h));o++)this._animLenSoFar+=u;if(this._animIdx=o,this._animIdx>=s-1)return this.setCoordinates(n),n[n.length-1];var l=this._animIdx,c=r[l],p=r[l+1],f=(h-this._animLenSoFar)/u;this._animTailRatio=f;var d=c.x+(p.x-c.x)*f,g=c.y+(p.y-c.y)*f,y=new Mi(d,g),_=a.unproject(y),m=!!this.getShell;if(!m&&this.options.smoothness>0){var v=n.slice(0,this._animIdx+3);this.setCoordinates(v);var x=r.slice(0,this._animIdx+3);this._setPrjCoordinates(x)}else{var w=n.slice(0,this._animIdx+1);w.push(_);var b=r.slice(0,this._animIdx+1);b.push(y),m?(this.setCoordinates([this._aniShowCenter].concat(w)),this._setPrjCoordinates([this._prjAniShowCenter].concat(b))):(this.setCoordinates(w),this._setPrjCoordinates(b))}return _},i._getCenterInExtent=function(t,e,i){var n=this.getExtent();if(!t.intersects(n))return null;var r=i(e,t);if(0===r.length)return null;var o=0,s=0,a=0;r.forEach((function(t){Array.isArray(t)?t.forEach((function(t){t.point&&(t=t.point),o+=t.x,s+=t.y,a++})):(t.point&&(t=t.point),o+=t.x,s+=t.y,a++)}));var h=new Mi(o,s)._multi(1/a);return h.count=a,h},i._getPath2DPoints=function(t,e,i){if(!G(t))return[];var n=this.getMap(),r=!e&&this._shouldSimplify(),o=this.options.simplifyTolerance*n._getResolution(),s=Array.isArray(t[0]);if(delete this._simplified,r&&!s){var a=t.length;t=_r(t,o,!1),this._simplified=t.length<a}return l(i)&&(i=n.getZoom()),R(t,(function(t){return n._prjToPoint(t,i)}))},i._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),i=e&&t.options.enableAltitude&&!l(e[t.options.altitudeProperty]);return t&&t.options.enableSimplify&&!i&&this.options.enableSimplify&&!this._showPlayer},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},i._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},i._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},i._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t):[]},i._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},i._computeCenter=function(){var t=this._coordinates;if(!G(t))return null;for(var e=0,i=0,n=0,r=t.length,o=0;o<r;o++)t[o]&&c(t[o].x)&&c(t[o].y)&&(e+=t[o].x,i+=t[o].y,n++);return new Mi(e/n,i/n)},i._computeExtent=function(){var t=this._coordinates;if(!G(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},i._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},i._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,i=1,n=t.length;i<n;i++)e+=t[i].distanceTo(t[i-1]);return e},i._hitTestTolerance=function(){var t,e=this._getInternalSymbol();if(Array.isArray(e)){t=0;for(var i=0;i<e.length;i++)c(e[i].lineWidth)&&e[i].lineWidth>t&&(t=e[i].lineWidth)}else t=e.lineWidth;return c(t)?t/2:1.5},i._coords2Extent=function(t,e){for(var i=new ji(e),n=0,r=t.length;n<r;n++)for(var o=0,s=t[n].length;o<s;o++)i._combine(t[n][o]);return i},e}(Un);mr.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var vr="Polygon",xr=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="Polygon",e&&n.setCoordinates(e),n}le(e,t);var i=e.prototype;return i.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=Mi.toCoordinates(t),i=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),i>1){for(var n=[],r=1;r<i;r++)e[r]&&n.push(this._trimRing(e[r]));this._holes=n}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},i.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],i=0,n=t.length;i<n;i++)e.push(this._copyAndCloseRing(t[i]));return e},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),fn)},i.getShell=function(){return this._coordinates||[]},i.getHoles=function(){return this._holes||[]},i.hasHoles=function(){return this.getHoles().length>0},i._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},i._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},i._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},i._checkRing=function(t){if(this._cleanRing(t),!t||!G(t))return!1;var e=t[t.length-1],i=!0;return t[0].x===e.x&&t[0].y===e.y||(i=!1),i},i._trimRing=function(t){var e=this._checkRing(t);return G(t)&&e&&t.splice(t.length-1,1),t},i._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return G(t)&&!e?(t.push(t[0].copy()),t):t},i._getPrjShell=function(){return this.getJSONType()===vr?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},i._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},i._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!G(e))return 0;for(var i=0,n=0,r=e.length;n<r;n++)i+=t.measureLength(e[n]);return i},i._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!G(e))return 0;for(var i=t.measureArea(e[0]),n=1,r=e.length;n<r;n++)i-=t.measureArea(e[n]);return i},i._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},i._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},i._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(mr);function wr(t){return function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){var e=t instanceof Mi?t:new Mi(t);if(e.equals(this._coordinates))return this;if(this._coordinates=e,!this.getMap())return this.onPositionChanged(),this;var i=this._getProjection();return this._setPrjCoordinates(i.project(this._coordinates)),this},i._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var i=l(t)?e.getZoom():e.getGLZoom(),n=this._getPrjCoordinates();return n?e._prjToPoint(n,i):null},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pcenter&&t&&this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter},i._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},i._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},i._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}xr.registerJSONType(vr);var br=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="Point",e&&n.setCoordinates(e),n}le(e,t);var i=e.prototype;return i.getOutline=function(){var t=this._getPainter();if(!t)return null;var i=this.getCoordinates(),n=t.getContainerExtent(),r=this.getMap().coordToContainerPoint(i);return new e(i,{symbol:{markerType:"square",markerWidth:n.getWidth(),markerHeight:n.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:n.xmin-(r.x-n.getWidth()/2),markerDy:n.ymin-(r.y-n.getHeight()/2)}})},i._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&wn.test(t)},i._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(wn.test(t)||Ln.test(t)||Cn.test(t))},i._containsPoint=function(e,i){var n=this.getContainerExtent();return i&&(n=n.expand(i)),!!n.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,i))},i._computeExtent=function(){return Cr.call(this,"getCenter")},i._computePrjExtent=function(){return Cr.call(this,"_getPrjCoordinates")},i._computeGeodesicLength=function(){return 0},i._computeGeodesicArea=function(){return 0},i._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new zn(this).getSprite(t,e)},e}(wr(Un));function Cr(t){var e=this[t]();return e?new ji(e,e,this._getProjection()):null}br.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1}),br.registerJSONType("Marker");var Mr=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="LineString",e&&n.setCoordinates(e),n}le(e,t);var i=e.prototype;return i.setCoordinates=function(t){return t?(this._coordinates=Mi.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},i.getCoordinates=function(){return this._coordinates||[]},i.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),cn)},i._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},i._computeGeodesicArea=function(){return 0},e}(mr);Mr.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),Mr.registerJSONType("LineString");var Er=function(t){function e(e,i){var n;return(n=t.call(this,i)||this).type="GeometryCollection",n.setGeometries(e),n}le(e,t);var i=e.prototype;return i.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),i=this._getSymbol(),n=this.config(),r=e.length-1;r>=0;r--)e[r]._initOptions(n),e[r]._setParent(this),e[r]._setEventParent(this),i&&e[r].setSymbol(i);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},i.getGeometries=function(){return this._geometries||[]},i.forEach=function(t,e){for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n]&&(e?t.call(e,i[n],n):t(i[n],n));return this},i.filter=function(t,i){if(!t)return new e;var n=[],r=g(t),o=r?t:$(t);return this.forEach((function(t){var e=r?t:ht(t);(i?o.call(i,e):o(e))&&n.push(t)}),this),new e(n)},i.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach((function(t){t&&t.translate&&t.translate.apply(t,e)})),this},i.isEmpty=function(){return!G(this.getGeometries())},i.remove=function(){return this.forEach((function(t){t._unbind()})),Un.prototype.remove.apply(this,arguments)},i.show=function(){return this.options.visible=!0,this.forEach((function(t){t.show()})),this},i.hide=function(){return this.options.visible=!1,this.forEach((function(t){t.hide()})),this},i.onConfig=function(t){this.forEach((function(e){e.config(t)}))},i.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var i=[],n=!1;this.forEach((function(t){t.getSymbol()&&!n&&(n=!0),i.push(t.getSymbol())})),n&&(e={children:i})}return e},i.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach((function(e,i){e.setSymbol(t.children[i])}));else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach((function(t){t.setSymbol(e)}))}return this.onSymbolChanged(),this},i._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach((function(e){e._setExternSymbol(t)})),this.onSymbolChanged(),this},i._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},i._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach((function(e){e._bindLayer(t)}))},i._checkGeometries=function(t){var e="The geometry added to collection is invalid.";if(t&&!Array.isArray(t)){if(t instanceof Un)return[t];throw new Error(e)}for(var i=0,n=t.length;i<n;i++)if(!this._checkGeo(t[i]))throw new Error(e+" Index: "+i);return t},i._checkGeo=function(t){return t instanceof Un},i._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(t){t&&t._updateCache&&t._updateCache()}))},i._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(t){t._removePainter()}))},i._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,i=0,n=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,i+=a.y,n++)}return 0===n?null:new Mi(e/n,i/n)},i._containsPoint=function(t,e){if(this.isEmpty())return!1;for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)if(i[n]._containsPoint(t,e))return!0;return!1},i._computeExtent=function(t){return Sr.call(this,t,"_computeExtent")},i._computePrjExtent=function(t){return Sr.call(this,t,"_computePrjExtent")},i._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicLength(t));return i},i._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),i=0,n=0,r=e.length;n<r;n++)e[n]&&(i+=e[n]._computeGeodesicArea(t));return i},i._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),i=0,n=e.length;i<n;i++)e[i]&&t.push(e[i]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},i._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e]&&t[e]._clearProjection()},i._getConnectPoints=function(){var t=this.getExtent();return[new Mi(t.xmin,t.ymax),new Mi(t.xmax,t.ymin),new Mi(t.xmin,t.ymin),new Mi(t.xmax,t.ymax)]},i._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,i=this.getGeometries(),n=[],r={},o=0,s=i.length;o<s;o++)if(i[o])for(var a=0,h=(t=Pt(i[o]._getInternalSymbol())).length;a<h;a++)r[e=t[a].join()]||(n.push(t[a]),r[e]=1);return n},i.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var i=this.getGeometries(),n=0,r=i.length;n<r;n++)i[n].startEdit(t);return this._editing=!0,this.hide(),setTimeout((function(){e.fire("editstart")}),1),this},i.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,i=t.length;e<i;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},i.isEditing=function(){return!!this._editing},e}(Un);function Sr(t,e){if(this.isEmpty())return null;for(var i=this.getGeometries(),n=null,r=0,o=i.length;r<o;r++){var s=i[r];if(s){var a=s[e](t);a&&(n=a.combine(n))}}return n}Er.registerJSONType("GeometryCollection");var Pr=function(t){function e(e,i,n,r){var o;return(o=t.call(this,null,r)||this).GeometryType=e,o.type=i,o._initData(n),o}le(e,t);var i=e.prototype;return i.getCoordinates=function(){for(var t=[],e=this.getGeometries(),i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},i.setCoordinates=function(t){for(var e=[],i=0,n=(t=t||[]).length;i<n;i++){var r=new this.GeometryType(t[i],this.config());e.push(r)}return this.setGeometries(e),this},i._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},i._checkGeo=function(t){return t instanceof this.GeometryType},i._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=Mi.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e}(Er),Ir=function(t){function e(e,i){return t.call(this,br,"MultiPoint",e,i)||this}return le(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=this.getCoordinates(),i=null,n=1/0;return e.forEach((function(e){var r,o,s,a,h=(r=e,s=(o=t).x-r.x,a=o.y-r.y,Math.sqrt(s*s+a*a));h<n&&(i=e,n=h)})),i},e}(Pr);Ir.registerJSONType("MultiPoint");var Tr=function(t){function e(){return t.apply(this,arguments)||this}return le(e,t),e.prototype.getCenterInExtent=function(t){var e=this.getGeometries(),i=0,n=0,r=0;return e.forEach((function(e){var o=e.getCenterInExtent(t);o&&(i+=o.x*o.count,n+=o.y*o.count,r+=o.count)})),0===r?null:new Mi(i,n)._multi(1/r)},e}(Pr),Lr=function(t){function e(e,i){return t.call(this,Mr,"MultiLineString",e,i)||this}return le(e,t),e}(Tr);Lr.registerJSONType("MultiLineString");var Or=function(t){function e(e,i){return t.call(this,xr,"MultiPolygon",e,i)||this}return le(e,t),e}(Tr);Or.registerJSONType("MultiPolygon");var Rr={Marker:br,LineString:Mr,Polygon:xr,MultiPoint:Ir,MultiLineString:Lr,MultiPolygon:Or},Nr={toGeometry:function(t,e){if(d(t)&&(t=T(t)),Array.isArray(t)){for(var i=[],n=0,r=t.length;n<r;n++){var o=Nr._convert(t[n],e);Array.isArray(o)?L(i,o):i.push(o)}return i}return Nr._convert(t,e)},_convert:function(t,e){if(!t||l(t.type))return null;var i=t.type;if("Feature"===i){var n=t.geometry,r=Nr._convert(n);return r?(r.setId(t.id),r.setProperties(t.properties),e&&e(r),r):null}if("FeatureCollection"===i){var o=t.features;return o?Nr.toGeometry(o,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(i)>=0){var s=new Rr["Point"===i?"Marker":i](t.coordinates);return e&&e(s),s}if("GeometryCollection"===i){var a=t.geometries;if(!G(a)){var h=new Er;return e&&e(h),h}for(var u=[],c=a.length,p=0;p<c;p++)u.push(Nr._convert(a[p]));var f=new Er(u);return e&&e(f),f}return null}},Ar=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,e&&r.setCoordinates(e),r._radius=i,r}le(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.radius,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getRadius=function(){return this._radius},i.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getRadius(),a=[],h=0,u=o-1;h<u;h++){t=360*h/u*Math.PI/180,e=s*Math.cos(t),i=s*Math.sin(t);var l=n.locate(r,e,i);a.push(l)}return a.push(a[0]),a},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,i){var n=this.getMap();if(n.getPitch())return t.prototype._containsPoint.call(this,e,i);var r=n._pointToContainerPoint(this._getCenter2DPoint()),o=this.getSize(),s=l(i)?this._hitTestTolerance():i,a=r.add(o.width/2,o.height/2);return yn(e,r,a,s)},i._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var i=this._getPrjCoordinates(),n=e.map((function(e){return t.project(e)})),r=n[0].x-i.x,o=n[1].x-i.x,s=n[2].y-i.y,a=n[3].y-i.y;return new ji(i.add(r,s),i.add(o,a))},i._computeExtent=function(t){var e=this._getMinMax(t);return e?new ji(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},i._getMinMax=function(t){if(!t||!this._coordinates||l(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},i._computeGeodesicLength=function(){return l(this._radius)?0:2*Math.PI*this._radius},i._computeGeodesicArea=function(){return l(this._radius)?0:Math.PI*Math.pow(this._radius,2)},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Mi.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=this.getCenter(),i=u({},t);i.geometry=!1;var n=this.toGeoJSON(i);return n.geometry={type:"Polygon"},{feature:n,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},e}(wr(xr));Ar.mergeOptions({numberOfShellPoints:60}),Ar.registerJSONType("Circle");var Dr=function(t){function e(e,i,n,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o.width=i,o.height=n,o}le(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getWidth=function(){return this.width},i.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},i.getHeight=function(){return this.height},i.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n,r=this._getMeasurer(),o=this.getCoordinates(),s=this.options.numberOfShellPoints,a=this.getWidth(),h=this.getHeight(),u=[],l=Math.pow(a/2,2)*Math.pow(h/2,2),c=Math.pow(a/2,2),p=Math.pow(h/2,2),f=0;f<s;f++){e=(t=360*f/s)*Math.PI/180,i=Math.sqrt(l/(c*Math.pow(Math.tan(e),2)+p)),n=Math.sqrt(l/(p*Math.pow(1/Math.tan(e),2)+c)),t>90&&t<270&&(i*=-1),t>180&&t<360&&(n*=-1);var d=r.locate(o,i,n);u.push(d)}return u},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=n.getProjection(),o=l(i)?this._hitTestTolerance():i,s=r.projectCoords([this._coordinates,n.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)]);return yn(e,n._prjToContainerPoint(s[0]),n._prjToContainerPoint(s[1]),o)},i._computePrjExtent=function(){return Ar.prototype._computePrjExtent.apply(this,arguments)},i._computeExtent=function(){return Ar.prototype._computeExtent.apply(this,arguments)},i._getMinMax=function(t){if(!t||!this._coordinates||l(this.width)||l(this.height))return null;var e=this.getWidth(),i=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-i/2),t.locate(this._coordinates,0,i/2)]},i._computeGeodesicLength=function(){if(l(this.width)||l(this.height))return 0;var t=this.width>this.height?this.width:this.height;return 2*Math.PI*t/2-4*Math.abs(this.width-this.height)},i._computeGeodesicArea=function(){return l(this.width)||l(this.height)?0:Math.PI*this.width*this.height/4},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Mi.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=u({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Ellipse",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},e}(wr(xr));Dr.mergeOptions({numberOfShellPoints:80}),Dr.registerJSONType("Ellipse");var kr=function(t){function e(e,i,n,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o._width=i,o._height=n,o}le(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getCoordinates=function(){return this._coordinates},i.setCoordinates=function(t){if(this._coordinates=t instanceof Mi?t:new Mi(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},i.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,i=this.getMap(),n=1,r=-1;if(i){var o=i.getFullExtent();o.left>o.right&&(n=-1),o.bottom>o.top&&(r=1)}var s=[];return s.push(e),s.push(t.locate(e,n*this._width,0)),s.push(t.locate(e,n*this._width,r*this._height)),s.push(t.locate(e,0,r*this._height)),s.push(e),s},i.getHoles=function(){return[]},i.animateShow=function(){return this.show()},i._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},i._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},i._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),i=this._getProjection();if(!i.isSphere())return e;for(var n=i.getSphereExtent(),r=n.sx,o=n.sy,s=this._getProjection().getCircum(),a=e[0],h=1,u=e.length;h<u;h++){var l=e[h],c=0,p=0;r*(a.x-l.x)>0&&(c=s.x*r),o*(a.y-l.y)<0&&(p=s.y*o),e[h]._add(c,p)}return e},i._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},i._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},i._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=l(i)?this._hitTestTolerance():i,o=n._getResolution()*r,s=this._getPrjExtent().expand(o),a=n._containerPointToPrj(e);return s.contains(a)},i._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var i=t.projectCoords([new Mi(this._coordinates.x,e.y),new Mi(e.x,this._coordinates.y)]);return new ji(i[0],i[1])},i._computeExtent=function(t){var e=this._getSouthEast(t);return e?new ji(this._coordinates,e,this._getProjection()):null},i._getSouthEast=function(t){if(!t||!this._coordinates||l(this._width)||l(this._height))return null;var e=this.getWidth(),i=-this.getHeight();if(t.fullExtent){var n=t.fullExtent;e*=n.right>n.left?1:-1,i*=n.top>n.bottom?1:-1}return t.locate(this._coordinates,e,i)},i._computeGeodesicLength=function(){return l(this._width)||l(this._height)?0:2*(this._width+this._height)},i._computeGeodesicArea=function(){return l(this._width)||l(this._height)?0:this._width*this._height},i._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:Mi.toNumberArrays([this.getShell()])}},i._toJSON=function(t){var e=u({},t),i=this.getCoordinates();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Rectangle",coordinates:[i.x,i.y],width:this.getWidth(),height:this.getHeight()}},e}(xr);kr.registerJSONType("Rectangle");var Fr=function(t){function e(e,i,n,r,o){var s;return(s=t.call(this,e,i,o)||this).startAngle=n,s.endAngle=r,s}le(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i.getStartAngle=function(){return this.startAngle},i.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},i.getEndAngle=function(){return this.endAngle},i.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},i.getShell=function(){for(var t,e,i,n=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints-2,s=this.getRadius(),a=[r.copy()],h=this.getStartAngle(),u=this.getEndAngle()-h,l=0;l<o;l++){t=(u*l/(o-1)+h)*Math.PI/180,e=s*Math.cos(t),i=s*Math.sin(t);var c=n.locate(r,e,i);a.push(c)}return a.push(r.copy()),a},i._containsPoint=function(e,i){var n=this.getMap();if(n.isTransforming())return t.prototype._containsPoint.call(this,e,i);var r=n._pointToContainerPoint(this._getCenter2DPoint()),o=l(i)?this._hitTestTolerance():i,s=this.getSize(),a=r,h=e,u=h.x-a.x,c=a.y-h.y,p=Math.atan2(c,u),f=p<0?360*(p+2*Math.PI)/(2*Math.PI):360*p/(2*Math.PI),d=this.startAngle%360,g=this.endAngle%360,y=!1;return y=d>g?!(f>g&&f<d):f>=d&&f<=g,h.distanceTo(a)<=s.width/2+o&&y},i._computeGeodesicLength=function(){return l(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},i._computeGeodesicArea=function(){return l(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},i._toJSON=function(t){var e=u({},t),i=this.getCenter();e.geometry=!1;var n=this.toGeoJSON(e);return n.geometry={type:"Polygon"},{feature:n,subType:"Sector",coordinates:[i.x,i.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(Ar);Fr.mergeOptions({numberOfShellPoints:60}),Fr.registerJSONType("Sector");var jr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i._arc=function(t,e,i){for(var n=this.options.arcDegree*Math.PI/180,r=1,o=e.length;r<o;r++){var s=oi._arcBetween(t,e[r-1],e[r],n),a=[e[r-1].x+e[r].x-s[0],e[r-1].y+e[r].y-s[1]];e[r-1].nextCtrlPoint=a,e[r].prevCtrlPoint=a,oi._stroke(t,i)}},i._quadraticCurve=function(t,e){if(e.length<=2)oi._path(t,e);else{var i,n;for(i=2,n=e.length;i<n;i+=2)t.quadraticCurveTo(e[i-1].x,e[i-1].y,e[i].x,e[i].y);if((i-=1)<n)for(;i<n;i++)t.lineTo(e[i].x,e[i].y)}},i._bezierCurve=function(t,e){if(e.length<=3)oi._path(t,e);else{var i,n;for(i=1,n=e.length;i+2<n;i+=3)t.bezierCurveTo(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(i<n)for(;i<n;i++)t.lineTo(e[i].x,e[i].y)}},i._getCurveArrowPoints=function(t,e,i,n,r,o){var s,a=e.length;for(s=o;s<a;s+=o){var h=this._getArrowShape(e[s-1],e[s],i,n,r);h&&t.push(h)}if((s-=o)<a-1)for(s+=1;s<a;s++){var u=this._getArrowShape(e[s-1],e[s],i,n,r);u&&t.push(u)}},e}(Mr);jr.mergeOptions({enableSimplify:!1,enableClip:!1});var Gr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},i._paintOn=function(t,e,i){t.beginPath(),this._arc(t,e,i),oi._stroke(t,i),this._paintArrow(t,e,i)},e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n},e}(jr);Gr.registerJSONType("ArcCurve"),Gr.mergeOptions({arcDegree:90});var zr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},i._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),oi._stroke(t,i),this._paintArrow(t,e,i)},i._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,3)},e}(jr);zr.registerJSONType("CubicBezierCurve");var Br=function(t){function e(){return t.apply(this,arguments)||this}le(e,t),e.fromJSON=function(t){var i=t.feature,n=new e(i.geometry.coordinates,t.options);return n.setProperties(i.properties),n};var i=e.prototype;return i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},i._paintOn=function(t,e,i){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,i),oi._stroke(t,i),this._paintArrow(t,e,i)},i._getArrowPoints=function(t,e,i,n,r){return this._getCurveArrowPoints(t,e,i,n,r,2)},e}(jr);Br.registerJSONType("QuadBezierCurve");var Vr={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},Hr={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},qr=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.getContent=function(){return this._content},i.setContent=function(t){var e=this._content;return this._content=me(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},i.onAdd=function(){this._refresh()},i.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},i.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var i=this._parseSymbol(e);if(this.setTextStyle){var n=this.getTextStyle()||{};n.symbol=i[0],this.setTextStyle(n)}else this.setTextSymbol&&this.setTextSymbol(i[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=i[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(i[1]);return this},i._parseSymbol=function(t){var e={},i={};for(var n in t)_(t,n)&&(0===n.indexOf("text")?e[n]=t[n]:i[n]=t[n]);return[e,i]},i._getTextSize=function(t){return Ie(this._content,t).size},i._getInternalSymbol=function(){return this._symbol},i._getDefaultTextSymbol=function(){return u({},Vr)},i._getDefaultBoxSymbol=function(){return u({},Hr)},i._getDefaultPadding=function(){return[12,8]},e}(br),Zr=function(t){function e(e,i,n,r,o){var s;return void 0===o&&(o={}),(s=t.call(this,i,o)||this)._content=me(e),s._width=l(n)?100:n,s._height=l(r)?40:r,o.boxSymbol&&s.setBoxSymbol(o.boxSymbol),o.textStyle&&s.setTextStyle(o.textStyle),s._refresh(),s}le(e,t);var i=e.prototype;return i.getWidth=function(){return this._width},i.setWidth=function(t){return this._width=t,this._refresh(),this},i.getHeight=function(){return this._height},i.setHeight=function(t){return this._height=t,this._refresh(),this},i.getBoxSymbol=function(){return u({},this.options.boxSymbol)},i.setBoxSymbol=function(t){return this.options.boxSymbol=t?u({},t):t,this.getSymbol()&&this._refresh(),this},i.getTextStyle=function(){return this.options.textStyle?u({},this.options.textStyle):null},i.setTextStyle=function(t){return this.options.textStyle=t?u({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var i=t.feature,n=new e(t.content,i.geometry.coordinates,t.width,t.height,t.options);return n.setProperties(i.properties),n.setId(i.id),t.symbol&&n.setSymbol(t.symbol),n},i._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},i._refresh=function(){var t=this.getTextStyle()||{},e=t.padding||[12,8],i=this._width-2*e[0],n=this._height-2*e[1],r=u({},t.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:i,textMaxHeight:n});t.wrap&&!r.textWrapWidth&&(r.textWrapWidth=i);var o=t.horizontalAlignment;r.textDx=r.markerDx||0;var s=r.markerWidth/2-e[0];"left"===o?(r.textHorizontalAlignment="right",r.textDx=r.textDx-s):"right"===o&&(r.textHorizontalAlignment="left",r.textDx=r.textDx+s);var a=t.verticalAlignment;r.textDy=r.markerDy||0;var h=r.markerHeight/2-e[1];"top"===a?(r.textVerticalAlignment="bottom",r.textDy-=h):"bottom"===a&&(r.textVerticalAlignment="top",r.textDy+=h),this._refreshing=!0,this.updateSymbol(r),delete this._refreshing},e}(qr);Zr.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),Zr.registerJSONType("TextBox");var Ur=function(t){function e(e,i,n){var r;return void 0===n&&(n={}),r=t.call(this,i,n)||this,n.textSymbol&&r.setTextSymbol(n.textSymbol),n.boxStyle&&r.setBoxStyle(n.boxStyle),r._content=me(e),r._refresh(),r}le(e,t);var i=e.prototype;return i.getBoxStyle=function(){return this.options.boxStyle?u({},this.options.boxStyle):null},i.setBoxStyle=function(t){return this.options.boxStyle=t?u({},t):t,this._refresh(),this},i.getTextSymbol=function(){return u({},this._getDefaultTextSymbol(),this.options.textSymbol)},i.setTextSymbol=function(t){return this.options.textSymbol=t?u({},t):t,this._refresh(),this},e.fromJSON=function(t){var i=t.feature,n=new e(t.content,i.geometry.coordinates,t.options);return n.setProperties(i.properties),n.setId(i.id),t.symbol&&n.setSymbol(t.symbol),n},i._canEdit=function(){return!1},i._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},i._refresh=function(){var t=u({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){u(t,e.symbol);var i=this._getBoxSize(t),n=i[1],r=e.padding||this._getDefaultPadding(),o=i[0];t.markerWidth=o.width,t.markerHeight=o.height;var s=t.textDx||0,a=t.textDy||0,h=Se(n,t.textHorizontalAlignment,t.textVerticalAlignment)._add(s,a),l=e.horizontalAlignment||"middle";t.markerDx=h.x,"left"===l?t.markerDx+=t.markerWidth/2-r[0]:"right"===l?t.markerDx-=t.markerWidth/2-n.width-r[0]:t.markerDx+=n.width/2;var c=e.verticalAlignment||"middle";t.markerDy=h.y,"top"===c?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===c?t.markerDy-=t.markerHeight/2-n.height-r[1]:t.markerDy+=n.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},i._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,i,n=this.getBoxStyle(),r=this._getTextSize(t),o=n.padding||this._getDefaultPadding();return e=r.width+2*o[0],i=r.height+2*o[1],n.minWidth&&(!e||e<n.minWidth)&&(e=n.minWidth),n.minHeight&&(!i||i<n.minHeight)&&(i=n.minHeight),[new ge(e,i),r]},e}(qr);Ur.mergeOptions({boxStyle:null,textSymbol:null}),Ur.registerJSONType("Label");var Wr=function(t){return function(t){function e(){return t.apply(this,arguments)||this}le(e,t),e._hasConnectors=function(t){return!l(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors};var i=e.prototype;return i.getConnectSource=function(){return this._connSource},i.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},i.getConnectTarget=function(){return this._connTarget},i.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},i._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,i,n=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),o=0,s=this.getCoordinates(),a=0,h=n.length;a<h;a++)for(var u=n[a],l=0,c=r.length;l<c;l++){var p=r[l],f=t.computeLength(u,p);0===a&&0===l?(e=u,i=p,o=f):f<o&&(e=u,i=p)}G(s)&&s[0].equals(e)&&s[1].equals(i)||this.setCoordinates([e,i])}},i.onAdd=function(){this._registerEvents(),this._updateCoordinates()},i.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&O(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(O(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof Un&&this._connTarget instanceof Un)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},i._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},i._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof Un&&this._connTarget instanceof Un)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},Yr={showOn:"always"},Xr=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,1===arguments.length&&(n=e,e=null,i=null),r._connSource=e,r._connTarget=i,r}return le(e,t),e}(Wr(Mr));Xr.mergeOptions(Yr),Xr.registerJSONType("ConnectorLine");var Jr=function(t){function e(e,i,n){var r;return r=t.call(this,null,n)||this,1===arguments.length&&(n=e,e=null,i=null),r._connSource=e,r._connTarget=i,r}return le(e,t),e}(Wr(Gr));Jr.mergeOptions(Yr),Jr.registerJSONType("ArcConnectorLine");var Qr=function(t){function e(e,i,r){var o;i&&!(i instanceof Un)&&!Array.isArray(i)&&n.indexOf(i.type)<0&&(r=i,i=null),(o=t.call(this,e,r)||this)._maxZIndex=0,o._minZIndex=0,o._initCache(),i&&o.addGeometry(i);var s=o.options.style;return s&&o.setStyle(s),o}le(e,t);var i=e.prototype;return i.getGeometryById=function(t){return l(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},i.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var i,n=[],r=0,o=this._geoList.length;r<o;r++)i=this._geoList[r],(e?t.call(e,i):t(i))&&n.push(i);return n},i.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},i.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},i.getCount=function(){return this._geoList.length},i.getExtent=function(){if(0===this.getCount())return null;var t=new ji(this.getProjection());return this.forEach((function(e){t._combine(e.getExtent())})),t},i.forEach=function(t,e){for(var i=this._geoList.slice(0),n=0,r=i.length;n<r;n++)e?t.call(e,i[n],n):t(i[n],n);return this},i.filter=function(t,e){var i=[],n=g(t),r=n?t:$(t);return this.forEach((function(t){var o=n?t:ht(t);(e?r.call(e,o):r(o))&&i.push(t)}),this),i},i.isEmpty=function(){return!this._geoList.length},i.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(Nr.toGeometry(t),e);if(!Array.isArray(t)){var i=arguments.length,n=arguments[i-1];return t=Array.prototype.slice.call(arguments,0,i-1),e=n,n&&f(n)&&("type"in n||n instanceof Un)&&(t.push(n),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),e&&(r=new ji),this._toSort=this._maxZIndex>0;for(var o=[],s=0,a=t.length;s<a;s++){var h=t[s];if(!h)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+s);if(!(h instanceof Un)&&(h=Un.fromJSON(h),Array.isArray(h)))for(var c=0,p=h.length;c<p;c++)this._add(h[c],r,s),o.push(h[c]);Array.isArray(h)||(this._add(h,r,s),o.push(h))}var d=this.getMap();if(d&&(this._getRenderer().onGeometryAdd(o),r&&!l(r.xmin))){var y=r.getCenter(),_=d.getFitZoom(r);if(f(e)){var m=g(e.step)?e.step:function(){};d.animateTo({center:y,zoom:_},u({duration:d.options.zoomAnimationDuration,easing:"out"},e),m)}else!0===e&&d.setCenterAndZoom(y,_)}return this.fire("addgeo",{geometries:t}),this},i.getGeoMinZIndex=function(){return this._minZIndex},i.getGeoMaxZIndex=function(){return this._maxZIndex},i._add=function(t,e,i){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var n=t.getId();if(!l(n)){if(!l(this._geoMap[n]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+n+", at index:"+i);this._geoMap[n]=t}var r=P();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},i.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof Un||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},i.clear=function(){this._clearing=!0,this.forEach((function(t){t.remove()})),this._geoMap={};var t=this._geoList;return this._geoList=[],this._getRenderer()&&this._getRenderer().onGeometryRemove(t),this._clearing=!1,this.fire("clear"),this},i.onRemoveGeometry=function(t){if(t&&!this._clearing&&(this===t.getLayer()&&!l(t._getInternalId()))){var e=t.getId();l(e)||delete this._geoMap[e];var i=this._findInList(t);i>=0&&this._geoList.splice(i,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},i.getStyle=function(){return this.options.style?this.options.style:null},i.setStyle=function(t){return this.options.style=t,t=At(t),this._cookedStyles=ut(t),this.forEach((function(t){this._styleGeometry(t)}),this),this.fire("setstyle",{style:t}),this},i._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=ht(t),i=0,n=this._cookedStyles.length;i<n;i++)if(!0===this._cookedStyles[i].filter(e))return t._setExternSymbol(this._cookedStyles[i].symbol),!0;return!1},i.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(t){t._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},i.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},i.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return Yn.prototype.hide.call(this)},i._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},i._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},i._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(e,i){return t._updateZIndex(e.getZIndex(),i.getZIndex()),t._compare(e,i)})),this._toSort=!1)},i._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},i._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;for(var i,n=0,r=e-1;n<=r;){if(i=Math.floor((n+r)/2),this._geoList[i]===t)return i;this._compare(this._geoList[i],t)>0?r=i-1:n=i+1}return-1},i._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},i._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!l(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}l(t.old)||t.new===t.old||delete this._geoMap[t.old]}},i._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},i._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},i._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},i._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},i._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},i._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},i._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},e}(Yn);Qr.mergeOptions({drawImmediate:!1});var Kr=new zi,$r={debug:!1,enableSimplify:!0,geometryEvents:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:ue.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,altitude:0},to=function(t){function e(e,i,n){return t.call(this,e,i,n)||this}le(e,t);var i=e.prototype;return i.onConfig=function(e){if(t.prototype.onConfig.call(this,e),e.enableAltitude||e.drawAltitude||e.altitudeProperty){var i=this.getRenderer();i&&i.setToRedraw&&i.setToRedraw()}},i.identify=function(t,e){void 0===e&&(e={});var i=this.getRenderer();return e.onlyVisible&&i&&i.identify?i.identify(t,e):(t instanceof Mi||(t=new Mi(t)),this._hitGeos(this._geoList,t,e))},i._hitGeos=function(t,e,i){void 0===i&&(i={});for(var n=i.filter,r=i.tolerance,o=[],s=this.getMap(),a=s.coordToPoint(e),h=s._pointToContainerPoint(a,void 0,0,a),u=t.length-1;u>=0;u--){var l=t[u];if(l&&l.isVisible()&&l._getPainter()&&l.options.interactive){if(!(l instanceof Mr&&(l._getArrowStyle()||l instanceof jr))){var c=l.getContainerExtent(Kr);if(r&&(c=c._expand(r)),!c||!c.contains(h))continue}if(l._containsPoint(h,r)&&(!n||n(l))&&(o.push(l),i.count&&o.length>=i.count))break}}return o},i.getAltitude=function(){return this.options.altitude||0},i.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(l(t.geometries)||t.geometries){var i;if(t.clipExtent){var n=this.getMap(),r=n?n.getProjection():null;i=new ji(t.clipExtent,r)}for(var o=[],s=this.getGeometries(),a=0,h=s.length;a<h;a++){var u=s[a],c=u.getExtent();if(c&&(!i||i.intersects(c))){var p=u.toJSON(t.geometries);o.push(p)}}e.geometries=o}return e},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var i=new e(t.id,t.options),n=t.geometries,r=[],o=0;o<n.length;o++){var s=Un.fromJSON(n[o]);s&&r.push(s)}return i.addGeometry(r),i},e.getPainterClass=function(){return zn},e.getCollectionPainterClass=function(){return Hn},e}(Qr);to.mergeOptions($r),to.registerJSONType("VectorLayer");var eo="_map_tool",io=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addTo=function(t){return t?(this._map=t,t[eo]&&t[eo].disable(),this.onAdd&&this.onAdd(),this.enable(),t[eo]=this,this._fireEvent("add"),this):this},i.getMap=function(){return this._map},i.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},i.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},i.isEnabled=function(){return!!this._enabled},i.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[eo],delete this._map),this._fireEvent("remove"),this):this},i._registerEvents=function(){this._switchEvents("on")},i._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},i._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(di(yi)),no={},ro=function(t){function i(e){var i;return(i=t.call(this,e)||this)._checkMode(),i._events={click:i._clickHandler,mousemove:i._mouseMoveHandler,dblclick:i._doubleClickHandler,mousedown:i._mouseDownHandler,mouseup:i._mouseUpHandler},i}le(i,t),i.registerMode=function(t,e){no[t.toLowerCase()]=e},i.getRegisterMode=function(t){return no[t.toLowerCase()]};var n=i.prototype;return n.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.getSymbol=function(){var t=this.options.symbol;return Nt(t||this.options.symbol)},n.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},n.getCurrentGeometry=function(){return this._geometry},n.onAdd=function(){this._checkMode()},n.onEnable=function(){if(this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources(),this.options.autoPanAtEdge){var t=this.getMap();this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})}return this},n.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw(),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this},n.undo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||!this._historyPointer)return this;var i=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),i,this._geometry),this},n.redo=function(){var t=this._getRegisterMode(),e=t.action;if(!this._shouldRecordHistory(e)||l(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var i=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),i,this._geometry),this},n._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},n._checkMode=function(){this._getRegisterMode()},n._saveMapCfg=function(){var t=this.getMap();if(this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom}),this._getRegisterMode().action.indexOf("mousedown")>-1){var e=this.getMap();this._mapDraggable=e.options.draggable,e.config({draggable:!1})}},n._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),l(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n._loadResources=function(){var t=Pt(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},n._getProjection=function(){return this._map.getProjection()},n._getRegisterMode=function(){var t=this.getMode(),e=i.getRegisterMode(t);if(!e)throw new Error(t+" is not a valid mode of DrawTool.");return e},n.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var i=0;i<t.length;i++)e[t[i]]=this._events[t[i]];return e}return null},n._mouseDownHandler=function(t){this._createGeometry(t)},n._mouseUpHandler=function(t){this.endDraw(t)},n._clickHandler=function(t){var e=this._getRegisterMode();if(this._geometry){var i=this.getMap()._pointToPrj(t.point2d);l(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer)),this._clickCoords.push(i),this._historyPointer=this._clickCoords.length,t.drawTool=this,e.update(this.getMap().getProjection(),this._clickCoords,this._geometry,t),this._fireEvent("drawvertex",t),e.clickLimit&&e.clickLimit===this._historyPointer&&this.endDraw(t)}else this._createGeometry(t)},n._createGeometry=function(t){var e=this.getMode(),i=this._getRegisterMode(),n=this.getMap()._pointToPrj(t.point2d),r=this.getSymbol();this._geometry||(this._clickCoords=[n],t.drawTool=this,this._geometry=i.create(this.getMap().getProjection(),this._clickCoords,t),r&&"point"!==e?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t)),"point"===e&&this.endDraw(t)},n._mouseMoveHandler=function(t){var e=this.getMap();if(this._geometry&&e&&!e.isInteracting()){var i=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(i)){var n=this.getMap()._pointToPrj(t.point2d),r=e.getProjection();t.drawTool=this;var o=this._getRegisterMode();if(this._shouldRecordHistory(o.action)){var s=this._clickCoords.slice(0,this._historyPointer);if(s&&s.length>0&&n.equals(s[s.length-1]))return;o.update(r,s.concat([n]),this._geometry,t)}else o.update(r,n,this._geometry,t);this._fireEvent("mousemove",t)}}},n._doubleClickHandler=function(t){if(this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var i=this._getRegisterMode(),n=this._clickCoords;if(!(n.length<2)){for(var r=this.getMap().getProjection(),o=[n[0]],s=1,a=n.length;s<a;s++)n[s].x===n[s-1].x&&n[s].y===n[s-1].y||o.push(n[s]);o.length<2||this._geometry&&this._geometry instanceof xr&&o.length<3||(t.drawTool=this,i.update(r,o,this._geometry,t),this.endDraw(t))}}}},n._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},n.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this},n._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n._getMouseContainerPoint=function(t){return"mousedown"===this._getRegisterMode().action&&Be(t.domEvent),t.containerPoint},n._isValidContainerPoint=function(t){var e=this._map.getSize(),i=e.width,n=e.height;return!(t.x<0||t.y<0)&&!(t.x>i||t.y>n)},n._getDrawLayer=function(){var t=e+"drawtool",i=this._map.getLayer(t);return i||(i=new to(t,{enableSimplify:!1}),this._map.addLayer(i)),i},n._fireEvent=function(t,e){e||(e={}),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this})),io.prototype._fireEvent.call(this,t,e)},i}(io);ro.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0});var oo=function(t){function e(e){var i;return(i=t.call(this,e)||this).drawTool=new ro({mode:"boxZoom",ignoreMouseleave:!1}),i}le(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},i.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},i._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},i._boxZoom=function(t){var e=this.target;this.drawTool.remove();var i=t.geometry,n=i.getCenter(),r=i.getSymbol(),o=r.markerWidth,s=r.markerHeight,a=new ji(n,e.locateByPoint(n,o,s),e.getProjection()),h=e.getFitZoom(a);e._animateTo({center:a.getCenter(),zoom:h})},e}(gi);nr.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),nr.addOnLoadHook("addHandler","boxZoom",oo);var so=30,ao=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},i.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},i._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var i=t.containerPoint,n=e.getContainerExtent();if(n){var r,o=i.x,s=i.y,a=n.xmax,h=n.ymax;o<so&&(r=[Math.abs(o-so),0]),s<so&&(r=[0,Math.abs(s-so)]),o+so>a&&(r=[-Math.abs(o+so-a),0]),s+so>h&&(r=[0,-Math.abs(s+so-h)]),r&&e.panBy(r,{duration:1})}}},e}(gi);nr.mergeOptions({autoPanAtEdge:!1}),nr.addOnLoadHook("addHandler","autoPanAtEdge",ao),nr.include({animateTo:function(t,e,i){var n=this;void 0===e&&(e={}),g(e)&&(i=e,e={});var r=this.getProjection(),o=this.getView(),s={},a=!0;for(var h in t)if(_(t,h)&&!l(t[h])&&("prjCenter"===h||!l(o[h])))if(a=!1,"center"===h){var u=new Mi(o[h]).toFixed(7),c=new Mi(t[h]).toFixed(7);u.equals(c)||(s.center=[u,c])}else if("prjCenter"===h){var p=new Mi(this._getPrjCenter()),f=new Mi(t[h]);p.equals(f)||(s.prjCenter=[p,f])}else o[h]!==t[h]&&"around"!==h&&(s[h]=[o[h],t[h]]);if(a)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var d=t.around||new de(this.width/2,this.height/2),y=this._getRenderer(),m=this._animPlayer=gr.animate(s,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){y.callInNextFrame(t)}},(function(t){if(n.isRemoved())m.finish();else{if("running"===m.playState){if(t.styles.center){var o=t.styles.center;n._setPrjCenter(r.project(o)),n.onMoving(n._parseEventFromCoord(n.getCenter()))}else if(t.styles.prjCenter){var a=t.styles.prjCenter;n._setPrjCenter(a),n.onMoving(n._parseEventFromCoord(n.getCenter()))}l(t.styles.zoom)||n.onZooming(t.styles.zoom,d),l(t.styles.pitch)||n.setPitch(t.styles.pitch),l(t.styles.bearing)||n.setBearing(t.styles.bearing),n._fireEvent("animating")}else"paused"===m.playState&&m!==n._mapAnimPlayer||(m._interupted||(s.center?n._setPrjCenter(r.project(s.center[1])):s.prjCenter&&n._setPrjCenter(s.prjCenter[1]),l(s.pitch)||n.setPitch(s.pitch[1]),l(s.bearing)||n.setBearing(s.bearing[1])),n._endAnim(m,s,d,e));i&&i(t)}}),this);return this._startAnim(s,d),m},_animateTo:function(t,e,i){return void 0===e&&(e={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,i),delete this._isInternalAnimation,this._mapAnimPlayer},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,i,n){delete this._animRotating;var r,o=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center)r=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(e.prjCenter){var s;s=t._interupted?this._getPrjCenter():e.prjCenter[1];var a=this._parseEventFromCoord(this.getProjection().unproject(s));a.point2d=this._prjToPoint(s),this.onMoveEnd(a)}l(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),i):n.wheelZoom?this.onZooming(e.zoom[1],i):this.onZoomEnd(e.zoom[1],i)),o&&this._fireEvent(o),l(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),this._resumePrev(t)},_startAnim:function(t,e){this._animPlayer&&(t.center&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&(delete this._animRotating,"finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(this._prevAnimPlayer){var e=this._prevAnimPlayer;"paused"!==e.playState&&delete this._prevAnimPlayer,t!==e&&(this._animPlayer=e,e.play())}}});var ho="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function uo(t,e,i,n,r){var o=1/Math.tan(e/2),s=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t}function lo(t,e,i){var n,r,o,s,a,h,u,l,c,p,f,d,g=i[0],y=i[1],_=i[2];return e===t?(t[12]=e[0]*g+e[4]*y+e[8]*_+e[12],t[13]=e[1]*g+e[5]*y+e[9]*_+e[13],t[14]=e[2]*g+e[6]*y+e[10]*_+e[14],t[15]=e[3]*g+e[7]*y+e[11]*_+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=e[9],f=e[10],d=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=p,t[10]=f,t[11]=d,t[12]=n*g+a*y+c*_+e[12],t[13]=r*g+h*y+p*_+e[13],t[14]=o*g+u*y+f*_+e[14],t[15]=s*g+l*y+d*_+e[15]),t}function co(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function po(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=e[9],f=e[10],d=e[11],g=e[12],y=e[13],_=e[14],m=e[15],v=i[0],x=i[1],w=i[2],b=i[3];return t[0]=v*n+x*a+w*c+b*g,t[1]=v*r+x*h+w*p+b*y,t[2]=v*o+x*u+w*f+b*_,t[3]=v*s+x*l+w*d+b*m,v=i[4],x=i[5],w=i[6],b=i[7],t[4]=v*n+x*a+w*c+b*g,t[5]=v*r+x*h+w*p+b*y,t[6]=v*o+x*u+w*f+b*_,t[7]=v*s+x*l+w*d+b*m,v=i[8],x=i[9],w=i[10],b=i[11],t[8]=v*n+x*a+w*c+b*g,t[9]=v*r+x*h+w*p+b*y,t[10]=v*o+x*u+w*f+b*_,t[11]=v*s+x*l+w*d+b*m,v=i[12],x=i[13],w=i[14],b=i[15],t[12]=v*n+x*a+w*c+b*g,t[13]=v*r+x*h+w*p+b*y,t[14]=v*o+x*u+w*f+b*_,t[15]=v*s+x*l+w*d+b*m,t}function fo(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],p=e[10],f=e[11],d=e[12],g=e[13],y=e[14],_=e[15],m=i*a-n*s,v=i*h-r*s,x=i*u-o*s,w=n*h-r*a,b=n*u-o*a,C=r*u-o*h,M=l*g-c*d,E=l*y-p*d,S=l*_-f*d,P=c*y-p*g,I=c*_-f*g,T=p*_-f*y,L=m*T-v*I+x*P+w*S-b*E+C*M;return L?(L=1/L,t[0]=(a*T-h*I+u*P)*L,t[1]=(r*I-n*T-o*P)*L,t[2]=(g*C-y*b+_*w)*L,t[3]=(p*b-c*C-f*w)*L,t[4]=(h*S-s*T-u*E)*L,t[5]=(i*T-r*S+o*E)*L,t[6]=(y*x-d*C-_*v)*L,t[7]=(l*C-p*x+f*v)*L,t[8]=(s*I-a*S+u*M)*L,t[9]=(n*S-i*I-o*M)*L,t[10]=(d*b-g*x+_*m)*L,t[11]=(c*x-l*b-f*m)*L,t[12]=(a*E-s*P-h*M)*L,t[13]=(i*P-n*E+r*M)*L,t[14]=(g*v-d*w-y*m)*L,t[15]=(l*w-c*v+p*m)*L,t):null}function go(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yo(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _o(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function mo(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function vo(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function xo(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function wo(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],h=i[2];return t[0]=r*h-o*a,t[1]=o*s-n*h,t[2]=n*a-r*s,t}function bo(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.hypot?Math.hypot(i,n,r):function(){var t=0,e=arguments.length;for(;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}(i,n,r)}function Co(t,e,i){var n=e[0],r=e[1],o=e[2],s=1/(i[3]*n+i[7]*r+i[11]*o+i[15]);return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])*s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])*s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])*s,t}nr.include({_registerDomEvents:function(){Fe(this._panels.mapWrapper||this._containerDOM,ho,this._handleDOMEvent,this)},_removeDomEvents:function(){je(this._panels.mapWrapper||this._containerDOM,ho,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=t.type;if("contextmenu"===e&&ze(t),!this._ignoreEvent(t)){var i=!1;if("mousedown"===e||"touchstart"===e&&1===t.touches.length)this._mouseDownTime=h();else if("click"===e||"touchend"===e||"contextmenu"===e){if(!this._mouseDownTime)return;var n=this._mouseDownTime;if(delete this._mouseDownTime,h()-n>300){if("click"===e||"contextmenu"===e)return}else"touchend"===e&&(i=!0)}this._fireDOMEvent(this,t,e),i&&(this._clickTime&&h()-this._clickTime<=300?(delete this._clickTime,this._fireDOMEvent(this,t,"dblclick")):(this._clickTime=h(),this._fireDOMEvent(this,t,"click")))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var e,i=t.srcElement||t.target;if(i)for(;i&&i!==this._containerDOM;){if(i.className&&i.className.indexOf&&(i.className.indexOf("maptalks-control")>=0||i.className.indexOf("maptalks-ui")>=0&&!e.eventsPropagation))return!0;e=i,i=i.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=qe(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_parseEvent:function(t,e){if(!t)return null;var i={domEvent:t};if("keypress"!==e){var n=this._getActualEvent(t);if(n){var r=qe(n,this._containerDOM);i=u(i,{coordinate:this.containerPointToCoord(r),containerPoint:r,viewPoint:this.containerPointToViewPoint(r),point2d:this._containerPointToPoint(r)})}}return i},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,i){if(!this.isRemoved()){var n=this._parseEvent(e,i);this._fireEvent(i,n)}}}),nr.addOnLoadHook("_registerDomEvents"),nr.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen();else{null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}}),nr.include({panTo:function(t,e,i){if(void 0===e&&(e={}),!t)return this;if(g(e)&&(i=e,e={}),t=new Mi(t),void 0===e.animation||e.animation){var n=this.getProjection().project(t);return this._panAnimation(n,e.duration,i)}return this.setCenter(t),this},_panTo:function(t,e){return void 0===e&&(e={}),void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e,i){if(void 0===e&&(e={}),!t)return this;if(g(e)&&(i=e,e={}),t=new de(t),this.getContainerExtent().ymin>0&&t.y>30){var n=t.y;t.y=30,t.x=30*t.x/n,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(this.onMoveStart(),void 0===e.animation||e.animation){t=t.multi(-1);var r=this._containerPointToPrj(new de(this.width/2+t.x,this.height/2+t.y));this._panAnimation(r,e.duration,i)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,e,i){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},i)}}),Un.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],i=0,n=t.length;i<n;i++){var r=Un.fromJSON(t[i]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?Nr.toGeometry(t):(t.subType?(o=Un.getJSONClass(t.subType).fromJSON(t),l(t.feature.id)||o.setId(t.feature.id)):(o=Nr.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o);var o},Yn.fromJSON=function(t){if(!t)return null;var e=t.type,i=Yn.getJSONClass(e);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+e);return i.fromJSON(t)},nr.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom(),e.options.bearing=this.getBearing(),e.options.pitch=this.getPitch();var i=this.getBaseLayer();(l(t.baseLayer)||t.baseLayer)&&i&&(e.baseLayer=i.toJSON(t.baseLayer));var n={};t.clipExtent&&(!0===t.clipExtent?n.clipExtent=this.getExtent():n.clipExtent=t.clipExtent);var r=[];if(l(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=this.getLayers(),s=0,a=o.length;s<a;s++)if(o[s].toJSON){var h=u({},f(t.layers)?t.layers:{},n);r.push(o[s].toJSON(h))}e.layers=r}else if(G(t.layers)){for(var c=t.layers,p=0;p<c.length;p++){var d=c[p],g=this.getLayer(d.id);if(g.toJSON){var y=u({},d.options,n);r.push(g.toJSON(y))}}e.layers=r}else e.layers=[];return e}}),nr.fromJSON=function(t,e,i){if(!t||!e)return null;i||(i={});var n=new nr(t,e.options);if(l(i.baseLayer)||i.baseLayer){var r=Yn.fromJSON(e.baseLayer);r&&n.setBaseLayer(r)}if(l(i.layers)||i.layers){for(var o=[],s=e.layers,a=0;a<s.length;a++){var h=Yn.fromJSON(s[a]);o.push(h)}n.addLayer(o)}return n},nr.include({computeLength:function(t,e){if(!this.getProjection())return null;var i=new Mi(t),n=new Mi(e);return i.equals(n)?0:this.getProjection().measureLength(i,n)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,i){if(!t)return this;var n=t.layers;if(!G(n))return this;for(var r=[],o=0,s=n.length;o<s;o++)d(n[o])?r.push(this.getLayer(n[o])):r.push(n[o]);for(var a=new Mi(t.coordinate),h=u({},t),l=[],c=r.length-1;c>=0&&!(t.count&&l.length>=t.count);c--){var p=r[c];if(p&&p.getMap()&&(t.includeInvisible||p.isVisible())&&(t.includeInternals||!(p.getId().indexOf(e)>=0))){var f=p.identify(a,h);f&&(Array.isArray(f)?L(l,f):l.push(f))}}return i.call(this,l),this}}),nr.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,i){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,i)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new de(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new de(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,i){l(i)&&(i=1);var n=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(n-i)/Math.abs(n-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,i){if(this.options.zoomable&&this._frameZoom!==t){l(i)&&(i=1),this._zoomTo(t,e);var n=this.getResolution(t),r=this.getResolution(this._startZoomVal)/n/i,o=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),s=this.getViewPoint();if(!this.isRotating()&&!o.equals(e)&&1!==r){var a=this.getPitch(),h=o._sub(e)._multi(1/(1-r));a&&(h.y/=Math.cos(a*Math.PI/180)),e=e.add(h)}var u={view:[r,0,0,r,(e.x-s.x)*(1-r),(e.y-s.y)*(1-r)]},c=this.getDevicePixelRatio();1!==c&&(e=e.multi(c)),u.container=[r,0,0,r,e.x*(1-r),e.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:e,matrix:u}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var i=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:i,to:t}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){this._zoomLevel=t,this._calcMatrices(),e&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,e)},_checkZoom:function(t){var e=this.getMaxZoom(),i=this.getMinZoom();return t<i&&(t=i),t>e&&(t=e),t}});var Mo,Eo,So,Po,Io,To,Lo,Oo,Ro,No,Ao=Math.PI/180,Do=new Mi(0,0);function ko(){return go(new Array(16))}nr.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/Ao},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*Ao,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Ao:0},setBearing:function(t){if(ue.ie9)throw new Error("map can't rotate in IE9.");var e=-F(t,-180,180)*Ao;if(this._angle===e)return this;var i=this.getBearing();return this._fireEvent("rotatestart",{from:i,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:i,to:e}),this._fireEvent("rotateend",{from:i,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){if(ue.ie9)throw new Error("map can't tilt in IE9.");var e=j(t,0,this.options.maxPitch)*Ao;if(this._pitch===e)return this;var i=this.getPitch();return this._fireEvent("pitchstart",{from:i,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:i,to:e}),this._fireEvent("pitchend",{from:i,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,i=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return i;e=Math.PI*e/180;var n=new de(this.cameraPosition).distanceTo(new de(this.cameraLookAt)),r=i*Math.tan(2*e);return i+Math.tan(e)*(n+r)},_pointToContainerPoint:(No=[0,0,0],function(t,e,i,n){if(void 0===i&&(i=0),t=this._pointToPoint(t,e,n),this.isTransforming()||i){i*=this._getResolution(e)/this._getResolution();var r=this._glScale;_o(No,t.x*r,t.y*r,i*r);var o=this._projIfBehindCamera(No,this.cameraPosition,this.cameraForward);Co(o,o,this.projViewMatrix);var s=this.width/2,a=this.height/2;return o[0]=o[0]*s+s,o[1]=-o[1]*a+a,n?(n.x=o[0],n.y=o[1],n):new de(o[0],o[1])}var h=this._prjToPoint(this._getPrjCenter(),void 0,Do);return n?(n.x=t.x,n.y=t.y):n=t,n._sub(h.x,h.y),n.set(n.x,-n.y),n._add(this.width/2,this.height/2)}),_projIfBehindCamera:(Lo=new Array(3),Oo=new Array(3),Ro=new Array(3),function(t,e,i){mo(Lo,t,e);var n=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(i,Lo);return n<=0&&(function(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}(Oo,i,1.01*n),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(t,e,mo(Ro,Lo,Oo))),t}),_containerPointToPoint:(Po=[0,0,0],Io=[0,0,0,1],To=[0,0,0,1],function(t,e,i){if(this.isTransforming()){var n=this.width/2||1,r=this.height/2||1;_o(Po,(t.x-n)/n,(r-t.y)/r,0),_o(Io,Po[0],Po[1],0),_o(To,Po[0],Po[1],1),Io[3]=To[3]=1,Co(Io,Io,this.projViewMatrixInverse),Co(To,To,this.projViewMatrixInverse);var o=Io[0],s=To[0],a=Io[1],h=To[1],u=Io[2],l=To[2],c=u===l?0:(0-u)/(l-u),p=k(o,s,c),f=k(a,h,c);return i?(i.x=p,i.y=f):i=new de(p,f),i._multi(1/this._glScale),void 0===e||this.getZoom()===e?i:this._pointToPointAtZoom(i,e,i)}var d=this._prjToPoint(this._getPrjCenter(),e,i),g=void 0!==e?this._getResolution()/this._getResolution(e):1,y=g*(t.x-this.width/2),_=g*(t.y-this.height/2);return d._add(y,-_)}),_calcMatrices:(Eo=ko(),So=ko(),function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),e=t.width||1,i=t.height||1;this._glScale=this.getGLScale();var n=this.getPitch()*Math.PI/180,r=this._getCameraWorldMatrix(),o=this.getFov()*Math.PI/180,s=this._getCameraFar(o,this.getPitch());this.cameraFar=s,this.cameraNear=Math.max(this._glScale*this.getResolution(this.getGLZoom())*Math.cos(n),.1);var a=this.projMatrix||ko();uo(a,o,e/i,this.cameraNear,s),this.projMatrix=a,this.viewMatrix=fo(Eo,r),this.projViewMatrix=po(this.projViewMatrix||ko(),a,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=po(this.projViewMatrixInverse||ko(),r,fo(So,a)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this._getResolution(this.getGLZoom()),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtent(this.getGLZoom())}),_getCameraFar:function(t,e){var i=this.cameraCenterDistance=bo(this.cameraPosition,this.cameraLookAt),n=i;if(e>0){var r;if(e=e*Math.PI/180,2/Math.PI-e<=t/2)r=4*i;else{var o=Math.tan(t/2);r=i*o/(1/Math.tan(e)-o)}n+=r}return n+1},_calcCascadeMatrixes:function(){var t=ko();function e(e,i,n){var r=this.width,o=this.height,s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,i),h=this.cameraCenterDistance;a=h+(a-h)/Math.cos((90-i)*Math.PI/180)*Math.cos((90-e)*Math.PI/180),uo(t,s,r/o,.1,a);var u=this.viewMatrix;return po(n,t,u)}return function(){var t=this.getPitch(),i=this.options.cascadePitches[0],n=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||ko(),o=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||ko();t>i?e.call(this,t,i,r):yo(this.cascadeFrustumMatrix0,this.projViewMatrix),t>n?e.call(this,t,n,o):yo(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var t=ko(),e=ko(),i=[1,-1,1],n=[0,0,0];return function(){var r=this.width||1,o=this.height||1,s=.5/Math.tan(this._fov/2)*o;return co(t,this.projMatrix,i),lo(t,t,_o(n,0,0,-s)),this._pitch&&function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],l=e[9],c=e[10],p=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=s*r+l*n,t[6]=a*r+c*n,t[7]=h*r+p*n,t[8]=u*r-o*n,t[9]=l*r-s*n,t[10]=c*r-a*n,t[11]=p*r-h*n}(t,t,this._pitch),this._angle&&function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],u=e[4],l=e[5],c=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=s*r+l*n,t[2]=a*r+c*n,t[3]=h*r+p*n,t[4]=u*r-o*n,t[5]=l*r-s*n,t[6]=c*r-a*n,t[7]=p*r-h*n}(t,t,this._angle),go(e),co(e,e,_o(n,r/2,-o/2,1)),po(this.domCssMatrix||ko(),e,t)}}(),_getCameraWorldMatrix:(Mo={},function(){var t=this.getGLZoom(),e=this.getSize(),i=this.getGLScale(),n=this._prjToPoint(this._prjCenter,t);this.cameraLookAt=_o(this.cameraLookAt||[0,0,0],n.x,n.y,0);var r=this.getPitch()*Ao,o=this.getBearing()*Ao,s=this._getFovRatio(),a=i*(e.height||1)/2/s,h=a*Math.cos(r),u=Math.sin(r)*a,l=n.x-u*Math.sin(o),c=n.y-u*Math.cos(o);this.cameraPosition=_o(this.cameraPosition||[0,0,0],l,c,h);var p=u||1,f=this.cameraUp=_o(this.cameraUp||[0,0,0],Math.sin(o)*p,Math.cos(o)*p,0),d=this.cameraWorldMatrix=this.cameraWorldMatrix||ko();!function(t,e,i,n){var r=[0,0,0],o=[0,0,0],s=[0,0,0];mo(s,e,i),0===vo(s)&&(s[2]=1),xo(s,s),wo(r,n,s),0===vo(s)&&(1===Math.abs(n[2])?s[0]+=1e-4:s[2]+=1e-4,xo(s,s),wo(r,n,s)),xo(r,r),wo(o,s,r),t[0]=r[0],t[4]=o[0],t[8]=s[0],t[1]=r[1],t[5]=o[1],t[9]=s[1],t[2]=r[2],t[6]=o[2],t[10]=s[2]}(d,this.cameraPosition,this.cameraLookAt,f);var g,y,_,m=this.cameraForward||[0,0,0];return mo(m,this.cameraLookAt,this.cameraPosition),this.cameraForward=xo(m,m),function(t,e){var i,n=e[0],r=e[4],o=e[8],s=e[1],a=e[5],h=e[9],u=e[2],l=e[6],c=e[10],p=n+a+c;p>0?(i=.5/Math.sqrt(p+1),t.w=.25/i,t.x=(l-h)*i,t.y=(o-u)*i,t.z=(s-r)*i):n>a&&n>c?(i=2*Math.sqrt(1+n-a-c),t.w=(l-h)/i,t.x=.25*i,t.y=(r+s)/i,t.z=(o+u)/i):a>c?(i=2*Math.sqrt(1+a-n-c),t.w=(o-u)/i,t.x=(r+s)/i,t.y=.25*i,t.z=(h+l)/i):(i=2*Math.sqrt(1+c-n-a),t.w=(s-r)/i,t.x=(o+u)/i,t.y=(h+l)/i,t.z=.25*i)}(Mo,d),function(t,e){var i=t,n=e.x,r=e.y,o=e.z,s=e.w,a=n+n,h=r+r,u=o+o,l=n*a,c=n*h,p=n*u,f=r*h,d=r*u,g=o*u,y=s*a,_=s*h,m=s*u;i[0]=1-(f+g),i[4]=c-m,i[8]=p+_,i[1]=c+m,i[5]=1-(l+g),i[9]=d-y,i[2]=p-_,i[6]=d+y,i[10]=1-(l+f),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1}(d,Mo),g=d,y=this.cameraPosition,(_=g)[12]=y[0],_[13]=y[1],_[14]=y[2],d}),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*Ao)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}}))}}),nr.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),i=this._viewHistory.length-1;i>=0;i--)if(X(t,this._viewHistory[i]))return this._viewHistoryPointer=i,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var n=this.options.viewHistoryCount;n>0&&this._viewHistory.length>n&&this._viewHistory.splice(0,this._viewHistory.length-n),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t){if(void 0===t&&(t={}),!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t){if(void 0===t&&(t={}),!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var i=this,n=this.getView();e.animation?this._animateTo(t,{duration:e.duration},(function(e){"finished"===e.state.playState&&i._fireViewChange(n,t)})):(this.setView(t),this._fireViewChange(n,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e})},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),nr.mergeOptions({viewHistory:!0,viewHistoryCount:10});var Fo=function(t){function e(e){var i;return(i=t.call(this,e)||this).on("enable",i._afterEnable,pe(i)).on("disable",i._afterDisable,pe(i)),i._measureLayers=[],i}le(e,t);var i=e.prototype;return i.clear=function(){if(G(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},i.getMeasureLayers=function(){return this._measureLayers},i.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},i.undo=function(){t.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var i=e;i<this._vertexes.length;i++)this._vertexes[i].label&&this._vertexes[i].label.remove(),this._vertexes[i].marker.remove();return this},i.redo=function(){t.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},i._measure=function(t){var e,i,n=this.getMap();t instanceof Un?e=n.computeGeometryLength(t):Array.isArray(t)&&(e=n.getProjection().measureLength(t)),this._lastMeasure=e,i="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];var r="";return this.options.metric&&(r+=e<1e3?e.toFixed(0)+i[0]:(e/1e3).toFixed(2)+i[1]),this.options.imperial&&(e*=3.2808399,r.length>0&&(r+="\n"),r+=e<5280?e.toFixed(0)+i[2]:(e/5280).toFixed(2)+i[3]),r},i._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},i._afterEnable=function(){this._registerMeasureEvents()},i._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},i._msOnDrawStart=function(t){var e=this.getMap(),i=e._pointToPrj(t.point2d),n=P(),r="distancetool_"+n,o="distancetool_markers_"+n;e.getLayer(r)?(this._measureLineLayer=e.getLayer(r),this._measureMarkerLayer=e.getLayer(o)):(this._measureLineLayer=new to(r).addTo(e),this._measureMarkerLayer=new to(o).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var s=new br(t.coordinate,{symbol:this.options.vertexSymbol});s._setPrjCoordinates(i);var a="zh-CN"===this.options.language?"起点":"start",h=new Ur(a,t.coordinate,this.options.labelOptions);h._setPrjCoordinates(i),this._lastVertex=h,this._addVertexMarker(s,h)},i._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var i=Nt(this.options.vertexSymbol);i.markerWidth/=2,i.markerHeight/=2,this._tailMarker=new br(t.coordinate,{symbol:i}).addTo(this._measureMarkerLayer),this._tailLabel=new Ur(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var n=this._geometry._getPrjCoordinates(),r=n[n.length-1];this._tailMarker.setCoordinates(t.coordinate),this._tailMarker._setPrjCoordinates(r),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate),this._tailLabel._setPrjCoordinates(r)},i._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this._geometry._getPrjCoordinates(),i=e[e.length-1],n=t.geometry,r=new br(t.coordinate,{symbol:this.options.vertexSymbol}),o=this._measure(n),s=new Ur(o,t.coordinate,this.options.labelOptions);this._addVertexMarker(r,s),s._setPrjCoordinates(i),r._setPrjCoordinates(i),this._lastVertex=s},i._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),this._vertexes.push({label:e,marker:t}),void 0!==this._historyPointer&&(this._vertexes.length=this._historyPointer),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},i._msOnDrawEnd=function(t){this._clearTailMarker();var e=this._lastVertex.getSize();e||(e=new ge(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var i=t.geometry.copy();i._setPrjCoordinates(t.geometry._getPrjCoordinates()),i.addTo(this._measureLineLayer),this._lastMeasure=i.getLength()},i._addClearMarker=function(t,e,i){var n=this.options.clearButtonSymbol,r={markerDx:(n.markerDx||0)+i,textDx:(n.textDx||0)+i};Array.isArray(n)&&(r=n.map((function(t){return t?{markerDx:(t.markerDx||0)+i,textDx:(t.textDx||0)+i}:null}))),n=Nt(n,r);var o=new br(t,{symbol:n}),s=this._measureLineLayer,a=this._measureMarkerLayer;o.on("click",(function(){return s.remove(),a.remove(),!1}),this),o.addTo(this._measureMarkerLayer),o._setPrjCoordinates(e)},i._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},e}(ro);Fo.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var jo=function(t){function e(e){var i;return(i=t.call(this,e)||this).on("enable",i._afterEnable,pe(i)).on("disable",i._afterDisable,pe(i)),i._measureLayers=[],i}le(e,t);var i=e.prototype;return i._measure=function(t){var e,i,n=this.getMap();t instanceof Un?e=n.computeGeometryArea(t):Array.isArray(t)&&(e=n.getProjection().measureArea(t)),this._lastMeasure=e,i="zh-CN"===this.options.language?[" 平方米"," 平方公里"," 平方英尺"," 平方英里"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="";if(this.options.metric&&(r+=e<1e6?e.toFixed(0)+i[0]:(e/1e6).toFixed(2)+i[1]),this.options.imperial){e*=3.2808399,r.length>0&&(r+="\n");var o=27878400;r+=e<o?e.toFixed(0)+i[2]:(e/o).toFixed(2)+i[3]}return r},i._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},i._msOnDrawVertex=function(t){var e=this.getMap()._pointToPrj(t.point2d),i=new br(t.coordinate,{symbol:this.options.vertexSymbol});i._setPrjCoordinates(e),this._measure(t.geometry),this._lastVertex=i,this._addVertexMarker(i)},i._msOnDrawEnd=function(t){this._clearTailMarker();var e=this.getMap()._pointToPrj(t.point2d),i=this._measure(t.geometry),n=new Ur(i,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer);n._setPrjCoordinates(e);var r=n.getSize();r||(r=new ge(10,10)),this._addClearMarker(t.coordinate,e,r.width);var o=t.geometry.copy();o._setPrjCoordinates(t.geometry._getPrjCoordinates()),o.addTo(this._measureLineLayer),this._lastMeasure=o.getArea()},e}(Fo);jo.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}});var Go={create:function(t,e){var i=t.unproject(e[0]),n=new Ar(i,0);return n._setPrjCoordinates(e[0]),n},update:function(t,e,i){var n=i.getMap(),r=Array.isArray(e)?e[e.length-1]:e,o=t.unproject(r),s=n.computeLength(i.getCenter(),o);i.setRadius(s)},generate:function(t){return t}};ro.registerMode("circle",u({clickLimit:2,action:["click","mousemove","click"]},Go)),ro.registerMode("freeHandCircle",u({action:["mousedown","mousemove","mouseup"]},Go));var zo={create:function(t,e){var i=t.unproject(e[0]),n=new Dr(i,0,0);return n._setPrjCoordinates(e[0]),n},update:function(t,e,i){var n=i.getMap(),r=i.getCenter(),o=Array.isArray(e)?e[e.length-1]:e,s=t.unproject(o),a=n.computeLength(r,new Mi({x:s.x,y:r.y})),h=n.computeLength(r,new Mi({x:r.x,y:s.y}));i.setWidth(2*a),i.setHeight(2*h)},generate:function(t){return t}};ro.registerMode("ellipse",u({clickLimit:2,action:["click","mousemove","click"]},zo)),ro.registerMode("freeHandEllipse",u({action:["mousedown","mousemove","mouseup"]},zo));var Bo={create:function(t,e){var i=new xr([]);return i._firstClick=e[0],i},update:function(t,e,i,n){var r=i.getMap(),o=n.containerPoint,s=r._prjToContainerPoint(i._firstClick),a=[[s.x,s.y],[o.x,s.y],[o.x,o.y],[s.x,o.y]];i.setCoordinates(a.map((function(t){return r.containerPointToCoord(new de(t))}))),i._setPrjCoordinates(a.map((function(t){return r._containerPointToPrj(new de(t))})))},generate:function(t){return t}};ro.registerMode("rectangle",u({clickLimit:2,action:["click","mousemove","click"]},Bo)),ro.registerMode("freeHandRectangle",u({action:["mousedown","mousemove","mouseup"]},Bo)),ro.registerMode("point",{clickLimit:1,action:["click"],create:function(t,e){var i=t.unproject(e[0]),n=new br(i);return n._setPrjCoordinates(e[0]),n},generate:function(t){return t}});var Vo={create:function(t,e){var i=e.map((function(e){return t.unproject(e)})),n=new Mr(i);return n._setPrjCoordinates(e),n},update:function(t,e,i){var n,r=i.getSymbol();Array.isArray(e)?n=e:(n=i._getPrjCoordinates()).push(e);var o=n.map((function(e){return t.unproject(e)}));i.setCoordinates(o),i._setPrjCoordinates(n);var s=i.getLayer();if(s){var a=s.getGeometryById("polygon");if(!a&&n.length>=3){if(a=new xr([o],{id:"polygon"}),r){var h=Nt(r,{lineOpacity:0});a.setSymbol(h)}a.addTo(s)}a&&a._setPrjCoordinates(n)}},generate:function(t){var e=new xr(t.getCoordinates(),{symbol:t.getSymbol()});return e._setPrjCoordinates(t._getPrjCoordinates()),e._projCode=t._projCode,e}};ro.registerMode("polygon",u({action:["click","mousemove","dblclick"]},Vo)),ro.registerMode("freeHandPolygon",u({action:["mousedown","mousemove","mouseup"]},Vo));var Ho={create:function(t,e){var i=e.map((function(e){return t.unproject(e)})),n=new Mr(i);return n._setPrjCoordinates(e),n},update:function(t,e,i){var n;Array.isArray(e)?n=e:(n=i._getPrjCoordinates()).push(e);var r=n.map((function(e){return t.unproject(e)}));i.setCoordinates(r),i._setPrjCoordinates(n)},generate:function(t){return t}};function qo(t){for(var e=t.tileInfo,i=[e.cols,e.rows],n=[],r=e.lods,o=0,s=r.length;o<s;o++)n.push(r[o].resolution);var a=t.fullExtent,h=e.origin,u=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:n,fullExtent:a},tileSystem:u,tileSize:i}}function Zo(t,e){return void 0===e&&(e=[]),e.forEach((function(e){var i=e[0],n=e[1];t=t.replace(i,n)})),t}function Uo(t,e,i){void 0===i&&(i={});var n,r,o=t[e],s=o.getElementsByTagName("TileMatrix"),a=[],h=[],u=[];if(!n){var l=o.getElementsByTagName("ows:SupportedCRS")[0];if(l){for(n=(n=l.textContent).split("EPSG")[1];n.indexOf(":")>-1;)n=n.replace(":","");n=function(t){var e=t.indexOf("EPSG")>-1?t:"EPSG:"+t;return Zo(e,[["4490","4326"],["102100","3857"],["900913","3857"]])}(n)}}r||(r=o.getElementsByTagName("ows:Identifier")[0])&&(r=r.textContent);var c=.0002645833333333333;i.isArcgis&&(c=28e-5),n&&n.indexOf("4326")>-1&&(c=2.3767925226029154e-9,i.isArcgis&&(c=2.518101729011901e-9));for(var p=1/0,f=0;f<s.length;f++){var d=s[f],g=d.getElementsByTagName("ows:Identifier")[0].textContent;g=parseInt(g),p=Math.min(p,g);var y=d.getElementsByTagName("ScaleDenominator")[0].textContent,_=d.getElementsByTagName("TopLeftCorner")[0].textContent,m=d.getElementsByTagName("TileWidth")[0].textContent,v=d.getElementsByTagName("TileHeight")[0].textContent;if(0===u.length&&u.push(parseInt(m),parseInt(v)),0===h.length){var x=_.split(" ").filter((function(t){return""!==t})).map((function(t){return parseFloat(t)})),w=x[0],b=x[1];w>0?h.push(1,-1,b,w):h.push(1,-1,w,b)}var C=parseFloat(y)*c;a.push(C)}if(p>0)for(var M=a[0],E=p-1;E>=0;E--)M*=2,a.splice(0,0,M);return{resolutions:a,tileSize:u,tileSystem:h,projection:n,TileMatrixSet:r}}ro.registerMode("linestring",u({action:["click","mousemove","dblclick"]},Ho)),ro.registerMode("freeHandLinestring",u({action:["mousedown","mousemove","mouseup"]},Ho)),ro.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map((function(e){return t.unproject(e)})),n=new Gr(i);return n._setPrjCoordinates(e),n},update:Ho.update,generate:function(t){return t}}),ro.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map((function(e){return t.unproject(e)})),n=new Br(i);return n._setPrjCoordinates(e),n},update:Ho.update,generate:function(t){return t}}),ro.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var i=e.map((function(e){return t.unproject(e)})),n=new zr(i);return n._setPrjCoordinates(e),n},update:Ho.update,generate:function(t){return t}}),ro.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,e){e=e[0];var i=t.unproject(e),n=new br(i);return n._firstClick=e,n},update:function(t,e,i,n){var r=i.getMap(),o=r._prjToContainerPoint(i._firstClick),s=n.containerPoint;e=r._containerPointToPrj(new Mi(Math.min(o.x,s.x),Math.min(o.y,s.y)));var a=t.unproject(e);i.setCoordinates(a)._setPrjCoordinates(e),i.updateSymbol({markerWidth:Math.abs(o.x-s.x),markerHeight:Math.abs(o.y-s.y)})},generate:function(t){return t}}),Zn.loadArcgis=function(t,e,i){if(void 0===i&&(i={jsonp:!0}),d(t)&&"{"!==t.substring(0,1))ti.getJSON(t,(function(t,i){if(t)e(t);else{var n=qo(i);e(null,n)}}),i);else{d(t)&&(t=T(t));var n=qo(t);e(null,n)}return this},Zn.loadWMTS=function(t,e,i){return void 0===i&&(i={jsonp:!0}),d(t)&&ti.get(t,(function(n,r){if(n)e(n);else{var o=function(t,e,i){var n=(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("Contents")[0];if(!n)return[];var r=n.getElementsByTagName("Layer");if(!r.length)return[];for(var o=[],s=0,a=n.childNodes.length;s<a;s++)"TileMatrixSet"===n.childNodes[s].nodeName&&o.push(n.childNodes[s]);if(!o.length)return[];for(var h=[],u=0,l=r.length;u<l;u++){var c=r[u],p=c.querySelectorAll("Style")[0];p&&(p=p.getElementsByTagName("ows:Identifier")[0])&&(p=p.textContent);var f=c.getElementsByTagName("ows:Identifier")[0];f&&(f=f.textContent);var d=c.querySelectorAll("ResourceURL")[0],g="";d&&(g=d.attributes.template.value);var y=Uo(o,u,i),_=y.resolutions,m=y.tileSize,v=y.tileSystem,x=y.projection,w=y.TileMatrixSet;g.length||(g=e.substr(0,e.lastIndexOf("?")),g+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT=tiles&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var b=Zo(g,[["{LAYER}",f],["{Layer}",f],["{layer}",f],["{STYLE}",p],["{Style}",p],["{style}",p],["{TileMatrixSet}",w],["{TileMatrix}","{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"]]);h.push({tileSize:m,tileSystem:v,spatialReference:{resolutions:_,projection:x},urlTemplate:b,info:{layerName:f,TileMatrixSet:w,style:p,tileSize:m,tileSystem:v,resolutions:_,projection:x,urlTemplate:b}})}return h}(r,t,i);e(null,o)}}),i),this};var Wo=function(t){function e(e){return t.call(this,e)||this}le(e,t);var i=e.prototype;return i.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},i.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},i.show=function(t){var e=this.getMap();if(!e)return this;this._mapEventsOn||this._switchMapEvents("on"),t=t||this._coordinate||this._owner.getCenter();var i=this.isVisible();this.fire("showstart");var n=this._getUIContainer();this._coordinate=t,this._removePrevDOM();var r=this.__uiDOM=this.buildOn(e);if(r.eventsPropagation=this.options.eventsPropagation,!r)return this.fire("showend"),this;this._measureSize(r),this._singleton()&&(e[this._uiDomKey()]=r),this._setPosition(),r.style[Ne]=null,n.appendChild(r);var o=this._getAnimation();if(i&&(o.ok=!1),o.ok&&(o.fade&&(r.style.opacity=0),o.scale)){if(this.getTransformOrigin){var s=this.getTransformOrigin();r.style[Re]=s}r.style[Oe]=this._toCSSTranslate(this._pos)+" scale(0)"}r.style.display="",this.options.eventsToStop&&Ke(r,this.options.eventsToStop,Be),this.options.autoPan&&this._autoPan();var a=o.transition;return o.ok&&a&&(r.offsetHeight,a&&(r.style[Ne]=a),o.fade&&(r.style.opacity=1),o.scale&&(r.style[Oe]=this._toCSSTranslate(this._pos)+" scale(1)")),this.fire("showend"),this},i.hide=function(){var t=this;if(!this.getDOM()||!this.getMap())return this;var e=this._getAnimation(),i=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(i.offsetHeight,i.style[Ne]=e.transition,setTimeout((function(){i.style.display="none",t.fire("hide")}),this.options.animationDuration)):(i.style.display="none",this.fire("hide")),e.fade&&(i.style.opacity=0),e.scale&&(i.style[Oe]=this._toCSSTranslate(this._pos)+" scale(0)"),this},i.isVisible=function(){var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},i.remove=function(){return delete this._mapEventsOn,this._owner?(this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this):this},i.getSize=function(){return this._size?this._size.copy():null},i.getOwner=function(){return this._owner},i.getDOM=function(){return this.__uiDOM},i.getPosition=function(){if(!this.getMap())return null;var t=this._getViewPoint()._round();if(this.getOffset){var e=this.getOffset()._round();e&&t._add(e)}return t},i._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],i=0;i<e.length;i++){var n=ye(e[i]);"fade"===n?t.fade=!0:"scale"===n&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=Oe+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},i._getViewPoint=function(){var t=0;if(this._owner&&this._owner.getAltitude){var e=this._owner.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},i._meterToPoint=function(t,e){return this.getMap().distanceToPoint(e,0,void 0,t).x*A(e)},i._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var i=this._pos,n=t.getSize(),r=n.width,o=n.height,s=t.viewPointToContainerPoint(i),a=parseInt(e.clientWidth),h=parseInt(e.clientHeight),u=0,l=0;s.x<0?u=-(s.x-a/2):s.x+a-35>r&&(u=r-(s.x+3*a/2)),s.y-h<0?l=50-(s.y-h):s.y>o&&(l=o-s.y-h-30),0===l&&0===u||t.panBy(new de(u,l),{duration:this.options.autoPanDuration})}},i._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute",t.style.left="-99999px";var i=t.style.bottom?"bottom":"top";return t.style[i]="-99999px",t.style.display="",e.appendChild(t),this._size=new ge(t.clientWidth,t.clientHeight),t.style.display="none",t.style.left="0px",t.style[i]="0px",this._size},i._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),i=this._uiDomKey();e[i]&&(t&&$e(e[i],t,Be),ke(e[i]),delete e[i]),delete this.__uiDOM}else this.__uiDOM&&(t&&$e(this.__uiDOM,t,Be),ke(this.__uiDOM),delete this.__uiDOM)},i._uiDomKey=function(){return"__ui_"+this._getClassName()},i._singleton=function(){return this.options.single},i._getUIContainer=function(){return this.getMap()._panels.ui},i._getClassName=function(){return"UIComponent"},i._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var i=this._getDefaultEvents();if(this.getEvents&&u(i,this.getEvents()),i)for(var n in i)i.hasOwnProperty(n)&&e[t](n,i[n],this)}},i._switchEvents=function(t){this._switchMapEvents(t);var e=this._getOwnerEvents();if(this._owner)for(var i in e)e.hasOwnProperty(i)&&this._owner[t](i,e[i],this)},i._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,resize:this.onResize}},i._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof Un&&(t.positionchange=this.onGeometryPositionChange),this.getOwnerEvents&&u(t,this.getOwnerEvents()),t},i.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&this.show(t.target.getCenter())},i.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},i.onEvent=function(){this.isVisible()&&this._updatePosition()},i.onZoomEnd=function(){this.isVisible()&&this._setPosition()},i.onResize=function(){this.isVisible()&&this._setPosition()},i._updatePosition=function(){this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this))},i._setPosition=function(){var t=this.getDOM();if(t){t.style[Ne]=null;var e=this.getPosition();this._pos=e,t.style[Oe]=this._toCSSTranslate(e)+" scale(1)"}},i._toCSSTranslate=function(t){if(!t)return"";if(ue.any3d){var e=this.getMap(),i=e?e.getBearing():0,n=e?e.getPitch():0,r="";return this.options.pitchWithMap&&n&&(r+=" rotateX("+Math.round(n)+"deg)"),this.options.rotateWithMap&&i&&(r+=" rotateZ("+Math.round(-i)+"deg)"),"translate3d("+t.x+"px,"+t.y+"px, 0px)"+r}return"translate("+t.x+"px,"+t.y+"px)"},e.isSupport=function(t){return!!(t&&g(t.on)&&g(t.off)&&g(t.getCenter))},e}(di(yi));Wo.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!0,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1});var Yo="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Xo=function(t){function e(e,i){var n;return(n=t.call(this,i)||this)._markerCoord=new Mi(e),n}le(e,t);var i=e.prototype;return i._getClassName=function(){return"UIMarker"},i.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition()),this},i.getCoordinates=function(){return this._markerCoord},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},i.getContent=function(){return this.options.content},i.onAdd=function(){this.show()},i.show=function(){return t.prototype.show.call(this,this._markerCoord)},i.flash=function(t,e,i,n){return Q.call(this,t,e,i,n)},i.buildOn=function(){var t;return d(this.options.content)?(t=Ae("div")).innerHTML=this.options.content:t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),t},i.getOffset=function(){var t=this.getSize();return new de(-t.width/2,-t.height/2)},i.getTransformOrigin=function(){return"center center"},i.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},i.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},i._registerDOMEvents=function(t){Ke(t,Yo,this._onDomEvents,this)},i._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type);this.fire(t.type,e)},i._removeDOMEvents=function(t){$e(t,Yo,this._onDomEvents)},i._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),i=this.getSize(),n=i.width,r=i.height;return[t.containerPointToCoordinate(e.add(-n/2,0)),t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},e}(vi(Wo));Xo.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null});var Jo=ue.touch?"touchstart mousedown":"mousedown",Qo=function(t){function e(e){return t.call(this,e)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on(Jo,this._startDrag,this)},i.removeHooks=function(){this.target.off(Jo,this._startDrag,this)},i._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},i._prepareDragHandler=function(){this._dragHandler=new Ci(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},i._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i._onMouseDown=function(t){Be(t.domEvent)},i._dragging=function(t){var e=this.target,i=e.getMap()._parseEvent(t.domEvent),n=i.domEvent;if(!(n.touches&&n.touches.length>1))if(this._isDragging){var r=i.coordinate,o=i.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var s=r.sub(this._lastCoord),a=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(s)),i.coordOffset=s,i.pointOffset=a,e.fire("dragging",i)}else this._isDragging=!0},i._endDrag=function(t){var e=this.target,i=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,i){var n=i._parseEvent(t.domEvent);e.fire("dragend",n)}},i.isDragging=function(){return!!this._isDragging},e}(gi);Xo.addInitHook("addHandler","draggable",Qo);var Ko=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i._getClassName=function(){return"InfoWindow"},i.addTo=function(e){return e instanceof Un&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getContent=function(){return this.options.content},i.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},i.getTitle=function(){return this.options.title},i.buildOn=function(){if(this.options.custom){if(d(this.options.content)){var t=Ae("div");return t.innerHTML=this.options.content,t}return this.options.content}var e=Ae("div");this.options.containerClass&&(e.className=this.options.containerClass),e.style.width=this._getWindowWidth()+"px",e.style.bottom="0px";var i='<em class="maptalks-ico"></em>';this.options.title&&(i+="<h2>"+this.options.title+"</h2>"),i+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',e.innerHTML=i;var n=e.querySelector(".maptalks-msgContent");return d(this.options.content)?n.innerHTML=this.options.content:n.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this),Fe(e.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),e},i.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},i.getOffset=function(){var t=this.getSize(),e=new de(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var i=this.getOwner();if(i instanceof br||i instanceof Ir){var n,r;if(i instanceof br)n=i._getPainter(),r=i.getSize();else{var o=i.getGeometries();if(!o||!o.length)return e;n=o[0]._getPainter(),r=o[0].getSize()}if(n){var s=n.getFixedExtent();e._add(s.xmax-r.width/2,s.ymin)}else e._add(0,-r.height)}return e},i.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},i.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},i.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},i.onRemove=function(){this.onDomRemove()},i.onDomRemove=function(){this._onCloseBtnClick&&(je(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},i._onAutoOpen=function(t){var e=this,i=this.getOwner();setTimeout((function(){i instanceof br||i instanceof Wo?e.show(i.getCoordinates()):i instanceof Ir?e.show(i.findClosest(t.coordinate)):i instanceof Mr||i instanceof Lr?(e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(i,t.coordinate)),e.show(t.coordinate)):e.show(t.coordinate)}),1)},i._rectifyMouseCoordinte=function(t,e){var i=this;return t instanceof Mr?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof Lr?t.getGeometries().map((function(t){return i._rectifyLineStringMouseCoordinate(t,e)})).sort((function(t,e){return t.dis-e.dis}))[0].coordinate:e},i._rectifyLineStringMouseCoordinate=function(t,e){for(var i=this,n=t.getCoordinates().map((function(t){return i.getMap().coordToContainerPoint(t)})),r=this.getMap().coordToContainerPoint(e),o=1/0,s=-1,a=0,h=n.length;a<h;a++){var u=n[a],l=r.distanceTo(u);l<o&&(o=l,s=a)}var c=[];0===s?c.push(n[0],n[1]):s===n.length-1?c.push(n[s-1],n[s]):c.push(n[s-1],n[s],n[s+1]);for(var p=[],f=this.getMap().getSize(),d=f.width,g=f.height,y=0,_=c.length-1;y<_;y++){var m=c[y],v=c[y+1];if(m.x===v.x)for(var x=Math.max(0,Math.min(m.y,v.y)),w=Math.min(g,Math.max(m.y,v.y)),b=x;b<=w;b++)p.push(new de(m.x,b));else for(var C=(v.y-m.y)/(v.x-m.x),M=Math.max(0,Math.min(m.x,v.x)),E=Math.min(d,Math.max(m.x,v.x)),S=M;S<=E;S++){var P=C*(S-m.x)+m.y;p.push(new de(S,P))}}for(var I=1/0,T=-1,L=0,O=p.length;L<O;L++){var R=p[L],N=r.distanceTo(R);N<I&&(I=N,T=L)}return{dis:I,coordinate:T<0?e:this.getMap().containerPointToCoord(p[T])}},i._getWindowWidth=function(){var t=this.options.width;return t||(t=300),t},e}(Wo);Ko.mergeOptions({containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:300,minHeight:120,custom:!1,title:null,content:null});var $o=function(t){le(i,t);var e=i.prototype;function i(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,i)||this)._content=e,n}return e._getClassName=function(){return"ToolTip"},e.addTo=function(e){if(i.isSupport(e))return e.on("mousemove",this.onMouseMove,this),e.on("mouseout",this.onMouseOut,this),t.prototype.addTo.call(this,e);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},e.setStyle=function(t){return this.options.containerClass=t,this},e.getStyle=function(){return this.options.containerClass},e.getContent=function(){return this._content},e.buildOn=function(){var t=Ae("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var i=e.containerClass||e.cssName;return!i&&e.height&&(t.style.lineHeight=e.height+"px"),t.innerHTML='<div class="'+i+'">'+this._content+"</div>",t},e.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM()},e.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var i=this.getMap();if(i){var n=i.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(n):this._timeout=setTimeout((function(){i&&e.show(n)}),this.options.showTimeout)}},e.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this))},e._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},i}(Wo);$o.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var ts=function(t){function e(e){return t.call(this,e)||this}le(e,t);var i=e.prototype;return i._getClassName=function(){return"Menu"},i.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,Wo.prototype.addTo.apply(this,arguments)},i.setItems=function(t){return this.options.items=t,this},i.getItems=function(){return this.options.items||[]},i.buildOn=function(){if(this.options.custom){if(d(this.options.items)){var t=Ae("div");return t.innerHTML=this.options.items,t}return this.options.items}var e=Ae("div");this.options.containerClass&&We(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var i=this._createMenuItemDom();return e.appendChild(i),Ke(e,"contextmenu",ze),e},i.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),i=this.getSize(),n=0,r=0;return e.x+i.width>t.width&&(n=-i.width),e.y+i.height>t.height&&(r=-i.height),new de(n,r)},i.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},i.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},i._createMenuItemDom=function(){var t=this,e=this.getMap(),i=Ae("ul");We(i,"maptalks-menu-items");var n,r,o=this.getItems();function s(i){return function(n){var r=e._parseEvent(n,"click");r.target=t,r.owner=t._owner,r.index=i,!1!==this._callback(r)&&t.hide()}}for(var a=0,h=o.length;a<h;a++){if("-"===(n=o[a])||"_"===n)We(r=Ae("li"),"maptalks-menu-splitter");else{r=Ae("li");var u=n.item;g(u)&&(u=u({owner:this._owner,index:a})),r.innerHTML=u,r._callback=n.click,Ke(r,"click",s(a))}i.appendChild(r)}var l=this.options.maxHeight||0;return l>0&&Ze(i,"max-height: "+l+"px; overflow-y: auto;"),i},i._getMenuWidth=function(){return this.options.width||160},e}(Wo);ts.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var es={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},openMenu:function(t){var e=this instanceof nr?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(this._menuOptions),this._menu.show(t)),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this},_bindMenu:function(t){return this._menu=new ts(t),this._menu.addTo(this),this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.listens("contextmenu")>1||(this.openMenu(t.coordinate),!1)}};nr.include(es),Un.include(es);var is=Object.freeze({UIComponent:Wo,UIMarker:Xo,InfoWindow:Ko,ToolTip:$o,Menuable:es,Menu:ts}),ns=function(t){function e(e){return e&&e.position&&!d(e.position)&&(e.position=u({},e.position)),t.call(this,e)||this}le(e,t);var i=e.prototype;return i.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=Ae("div"),Ze(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},i.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},i.getMap=function(){return this._map},i.getPosition=function(){return u({},this._parse(this.options.position))},i.setPosition=function(t){return d(t)?this.options.position=t:this.options.position=u({},t),this._updatePosition(),this},i.getContainerPoint=function(){var t,e,i=this.getPosition(),n=this.getMap().getSize();return l(i.left)?l(i.right)||(t=n.width-parseInt(i.right)):t=parseInt(i.left),l(i.top)?l(i.bottom)||(e=n.height-parseInt(i.bottom)):e=parseInt(i.top),new de(t,e)},i.getContainer=function(){return this.__ctrlContainer},i.getDOM=function(){return this._controlDom},i.show=function(){return this.__ctrlContainer.style.display="",this},i.hide=function(){return this.__ctrlContainer.style.display="none",this},i.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},i.remove=function(){return this._map?(ke(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},i._parse=function(t){var i=t;return d(t)&&(i=e.positions[i]),i},i._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:u({},t)})},e}(di(yi));ns.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},nr.mergeOptions({control:!0}),nr.include({addControl:function(t){return this._containerDOM.getContext||t.addTo(this),this},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var rs="addlayer removelayer setbaselayer baselayerremove",os=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(){return this._attributionContainer=Ae("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},i.onAdd=function(){this.getMap().on(rs,this._update,this)},i.onRemove=function(){this.getMap().off(rs,this._update,this)},i._update=function(){var t=this.getMap();if(t){var e=t._getLayers((function(t){return t.options.attribution})).reverse().map((function(t){return t.options.attribution})),i=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+i+"</span>"}},e}(ns);os.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),nr.mergeOptions({attribution:!0}),nr.addOnLoadHook((function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new os(t),this.addControl(this.attributionControl))}));var ss=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(){var t=this.container=Ae("div",this.options.containerClass),e=this.panel=Ae("div","panel"),i=this.button=Ae("button");return t.appendChild(i),t.appendChild(e),t},i.onAdd=function(){Ke(this.button,"mouseover",this._show,this),Ke(this.panel,"mouseleave",this._hide,this),Ke(this.getMap(),"click",this._hide,this)},i.onRemove=function(){this.panel&&($e(this.button,"mouseover",this._show),$e(this.panel,"mouseleave",this._hide),$e(this.getMap(),"click",this._hide),ke(this.panel),ke(this.button),delete this.panel,delete this.button,delete this.container)},i._show=function(){Ue(this.container,"shown")||(We(this.container,"shown"),this._createPanel())},i._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||Ye(this.container,this.options.containerClass)},i._createPanel=function(){this.panel.innerHTML="";var t=Ae("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},i._renderLayers=function(t,e){var i=t.getBaseLayer(),n=t.getLayers(),r=n.length;if(i){var o=i.layers||[i],s=Ae("li","group"),a=Ae("ul"),h=Ae("label");h.innerHTML=this.options.baseTitle,s.appendChild(h);for(var u=0,l=o.length;u<l;u++){var c=o[u];this._isExcluded(c)&&(a.appendChild(this._renderLayer(o[u],!0)),s.appendChild(a),e.appendChild(s))}}if(r){var p=Ae("li","group"),f=Ae("ul"),d=Ae("label");d.innerHTML=this.options.overlayTitle,p.appendChild(d);for(var g=0;g<r;g++){var y=n[g];this._isExcluded(y)&&f.appendChild(this._renderLayer(y))}p.appendChild(f),e.appendChild(p)}},i._isExcluded=function(t){var e=t.getId(),i=this.options.excludeLayers;return!(i.length&&i.indexOf(e)>=0)},i._renderLayer=function(t,e){var i=this,n=Ae("li","layer"),r=Ae("label"),o=Ae("input"),s=this.getMap(),a=t.options.visible;t.options.visible=!0;var h=t.isVisible();return t.options.visible=a,n.className="layer",e?(o.type="radio",o.name="base"):o.type="checkbox",o.checked=a&&h,h||o.setAttribute("disabled","disabled"),o.onchange=function(e){if("radio"===e.target.type){var n=s.getBaseLayer(),r=n.layers;if(r)for(var o=0,a=r.length;o<a;o++){var h=r[o];h[h===t?"show":"hide"]()}else n.isVisible()||n.show();s._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();i.fire("layerchange",{target:t})},n.appendChild(o),r.innerHTML=t.getId(),n.appendChild(r),n},e}(ns);ss.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),nr.mergeOptions({layerSwitcherControl:!1}),nr.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new ss(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var as=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=Ae("div"),i=this.mapContainer=Ae("div");i.style.width=t[0]+"px",i.style.height=t[1]+"px",i.className=this.options.containerClass;var n=this.button=Ae("div");return n.className=this.options.buttonClass,e.appendChild(i),e.appendChild(n),e},i.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),Ke(this.button,"click",this._onButtonClick,this),this._updateButtonText()},i.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),$e(this.button,"click",this._onButtonClick)},i.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},i.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},i.getOverviewMap=function(){return this._overview},i._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},i._updateButtonText=function(){this._overview?this.button.innerHTML="-":this.button.innerHTML="+"},i._createOverview=function(){var t=this.getMap(),e=this.mapContainer,i=t.config();u(i,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new nr(e,i),this._updateBaseLayer(),this._perspective=new xr(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new to("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},i._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),i=t.getMinZoom(),n=this.options.level;if(n>0){for(var r=n;r>0;r--)if(e-r>=i)return e-r}else for(var o=n;o<0;o++)if(e-o>=i)return e-o;return e},i._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},i._getPerspectiveCoords=function(){var t=this.getMap();return t.getContainerExtent().toArray().map((function(e){return t.containerPointToCoordinate(e)}))},i._update=function(){if(this._overview){He(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},i._updateSpatialReference=function(){if(this._overview){var t=this.getMap().options.spatialReference;this._overview.setSpatialReference(t)}},i._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,i=0;if(e)for(var n=0,r=e.length;n<r;n++){if(e[n].isVisible()){i=n;break}}var o=t.toJSON(),s=null;e?(s=o.layers[i].options).visible=!0:s=o.options,this._overview.setMinZoom(s.minZoom||null).setMaxZoom(s.maxZoom||null),delete s.minZoom,delete s.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var a=Yn.fromJSON(o);for(var h in t)g(t[h])&&t.hasOwnProperty(h)&&t[h]!==t.constructor.prototype[h]&&(a[h]=t[h]);this._overview.setBaseLayer(a)}else this._overview.setBaseLayer(null)}},e}(ns);as.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),nr.mergeOptions({overviewControl:!1}),nr.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new as(this.options.overviewControl),this.addControl(this.overviewControl))}));var hs=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(){var t;if(this.options.custom)d(this.options.content)?(t=Ae("div")).innerHTML=this.options.content:t=this.options.content;else{if(t=Ae("div","maptalks-panel"),this.options.closeButton){var e=Ae("a","maptalks-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var i=Ae("div","maptalks-panel-content");i.innerHTML=this.options.content,t.appendChild(i)}return this.draggable=new Ci(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},i.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),ns.prototype.update.call(this)},i.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},i.getContent=function(){return this.options.content},i._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},i._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=u({},this.getPosition()),this.fire("dragstart",t)},i._onDragging=function(t){var e=t.mousePos.sub(this._startPos),i=this._startPosition,n=this.getPosition();l(n.top)||(n.top=parseInt(i.top)+e.y),l(n.bottom)||(n.bottom=parseInt(i.bottom)-e.y),l(n.left)||(n.left=parseInt(i.left)+e.x),l(n.right)||(n.right=parseInt(i.right)-e.x),this.setPosition(n),this.fire("dragging",t)},i._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},i._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),i=this.getDOM(),n=parseInt(i.clientWidth),r=parseInt(i.clientHeight);return[t.containerPointToCoordinate(e.add(n/2,0)),t.containerPointToCoordinate(e.add(n,r/2)),t.containerPointToCoordinate(e.add(n/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(ns);hs.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var us=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(t){return this._map=t,this._scaleContainer=Ae("div",this.options.containerClass),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},i.onRemove=function(){this.getMap().off("zoomend",this._update,this)},i._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=De("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=De("div",this.options.containerClass?null:t,this._scaleContainer))},i._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},i._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},i._updateMetric=function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},i._updateImperial=function(t){var e,i,n,r=3.2808399*t;r>5280?(e=r/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mile",i/e)):(n=this._getRoundNum(r),this._updateScale(this._iScale,n+" feet",n/r))},i._updateScale=function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},i._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)},e}(ns);us.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),nr.mergeOptions({scaleControl:!1}),nr.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new us(this.options.scaleControl),this.addControl(this.scaleControl))}));var ls=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(t){this._map=t;var e=Ae("div"),i=Ae("ul","maptalks-toolbar-hx");e.appendChild(i),this.options.vertical?We(e,"maptalks-toolbar-vertical"):We(e,"maptalks-toolbar-horizonal");var n=this;function r(t,e,i,r){var o=n._getItems()[e];return function(n){return Be(n),t({target:o,index:e,childIndex:i,dom:r})}}var o,s=this.options.items;if(G(s))for(var a=0,h=s.length;a<h;a++){var u=s[a],l=Ae("li");if(28!==this.options.height&&(l.style.lineHeight=this.options.height+"px"),l.style.height=this.options.height+"px",l.style.cursor="pointer",o=u.item,/<[a-z\][\s\S]*>/i.test(o)){l.style.textAlign="center";var c=Je("div",u.item);l.innerHTML='<div style="margin-top:'+(this.options.height-c.height)/2+'px;">'+u.item+"</div>"}else l.innerHTML=u.item;if(u.click&&Ke(l,"click",r(u.click,a,null,l)),G(u.children)){var p=this._createDropMenu(a);l.appendChild(p),l._menu=p,Ke(l,"mouseover",(function(){this._menu.style.display=""})),Ke(l,"mouseout",(function(){this._menu.style.display="none"}))}i.appendChild(l)}return e},i._createDropMenu=function(t){var e=this;function i(t,i,n){var r=e._getItems()[i].children[n];return function(e){return Be(e),t({target:r,index:i,childIndex:n})}}var n=Ae("div","maptalks-dropMenu"),r=this._getItems(),o=r.length,s=Ae("ul"),a=r[t].children;t===o-1&&a&&(n.style.cssText="right: 0px;",s.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(s.style.bottom=0)),n.appendChild(Ae("em","maptalks-ico"));for(var h=0,u=0,l=a.length;u<l;u++){var c=be(a[u].item,"12px");c.width>h&&(h=c.width)}for(var p=0,f=a.length;p<f;p++){var d=a[p],g=Ae("li");g.innerHTML='<a href="javascript:;">'+d.item+"</a>",g.style.cursor="pointer",g.style.width=h+24+"px",Ke(g.childNodes[0],"click",i(d.click,t,p)),s.appendChild(g)}if(this.options.vertical){var y=h<95?95:h;this.options.reverseMenu?n.style.right=-(y+20)+"px":n.style.left=-(y+20)+"px"}else this.options.reverseMenu?n.style.bottom="28px":n.style.top="28px";return n.appendChild(s),n.style.display="none",n},i._getItems=function(){return this.options.items||[]},e}(ns);ls.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var cs=10,ps=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.buildOn=function(t){var e=this.options,i=Ae("div","maptalks-zoom");if(e.zoomLevel){var n=Ae("span","maptalks-zoom-zoomlevel");i.appendChild(n),this._levelDOM=n}var r=Ae("div","maptalks-zoom-slider"),o=Ae("a","maptalks-zoom-zoomin");if(o.href="javascript:;",o.innerHTML="+",r.appendChild(o),this._zoomInButton=o,e.slider){var s=Ae("div","maptalks-zoom-slider-box"),a=Ae("div","maptalks-zoom-slider-ruler"),h=Ae("span","maptalks-zoom-slider-reading"),u=Ae("span","maptalks-zoom-slider-dot");a.appendChild(h),s.appendChild(a),s.appendChild(u),r.appendChild(s),this._sliderBox=s,this._sliderRuler=a,this._sliderReading=h,this._sliderDot=u}var l=Ae("a","maptalks-zoom-zoomout");return l.href="javascript:;",l.innerHTML="-",r.appendChild(l),this._zoomOutButton=l,i.appendChild(r),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),i},i.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&$e(this._zoomInButton,"click",this._onZoomInClick),this._zoomOutButton&&$e(this._zoomOutButton,"click",this._onZoomOutClick),this._sliderRuler&&($e(this._sliderRuler,"click",this._onClickRuler),this.dotDragger.disable(),delete this.dotDragger)},i._update=function(){var t=this.getMap();if(this._sliderBox){var e=(t.getMaxZoom()-t.getMinZoom())*cs;this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var i=(t.getMaxZoom()-t.getZoom())*cs;this._sliderReading.style.height=(t.getZoom()-t.getMinZoom()+1)*cs+"px",this._sliderDot.style.top=i+"px"}this._updateText()},i._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();p(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t}},i._registerDomEvents=function(){this._zoomInButton&&Ke(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Ke(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(Ke(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new Ci(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},i._onZoomInClick=function(t){ze(t),this.getMap().zoomIn()},i._onZoomOutClick=function(t){ze(t),this.getMap().zoomOut()},i._onClickRuler=function(t){ze(t);var e=this.getMap(),i=qe(t,this._sliderRuler).y,n=e.getMaxZoom(),r=Math.floor(n-i/cs);e.setZoom(r)},i._onDotDragstart=function(t){ze(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5);e.onZoomStart(e.getZoom(),i)},i._onDotDrag=function(t){ze(t.domEvent);var e=this.getMap(),i=e.getSize().toPoint()._multi(.5),n=qe(t.domEvent,this._sliderRuler),r=e.getMaxZoom(),o=e.getMinZoom(),s=n.y,a=r-s/cs;r<a?(a=r,s=0):o>a&&(a=o,s=(r-o)*cs),"dragging"===t.type?e.onZooming(a,i,1):"dragend"===t.type&&(this.options.seamless?e.onZoomEnd(a,i):e.onZoomEnd(Math.round(a),i)),this._sliderDot.style.top=s+"px",this._sliderReading.style.height=(e.getZoom()-o+1)*cs+"px",this._updateText()},e}(ns);ps.mergeOptions({position:"top-left",slider:!0,zoomLevel:!0,seamless:!1}),nr.mergeOptions({zoomControl:!1}),nr.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new ps(this.options.zoomControl),this.addControl(this.zoomControl))}));var fs=Object.freeze({Control:ns,Attribution:os,LayerSwitcher:ss,Overview:as,Panel:hs,Scale:us,Toolbar:ls,Zoom:ps}),ds=function(){function t(t,e,i,n){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:i,y:n})}return t.getDefault=function(t){return"baidu"===t.code.toLowerCase()?"baidu":t.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":"identity"===t.code.toLowerCase()?[1,-1,0,0]:"web-mercator"},t}(),gs=6378137*Math.PI;u(ds,{"web-mercator":new ds([1,-1,-gs,gs]),"tms-global-mercator":new ds([1,1,-gs,-gs]),"tms-global-geodetic":new ds([1,1,-180,-90]),baidu:new ds([1,1,0,0])});for(var ys=function(){function t(t,e,i,n){this.map=t,this.tileSize=n,this.fullExtent=i,this.prepareTileInfo(e,i),this._xScale=i.right>=i.left?1:-1,this._yScale=i.top>=i.bottom?1:-1,this._pointOrigin=t._prjToPoint(new de(this.tileSystem.origin),t.getGLZoom()),this._glRes=t.getResolution(t.getGLZoom())}var e=t.prototype;return e.prepareTileInfo=function(t,e){if(d(t)?t=ds[t.toLowerCase()]:Array.isArray(t)&&(t=new ds(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t;var i=e.right>e.left?1:-1,n=e.top>e.bottom?-1:1,r=t.origin.x,o=t.origin.y;this.transformation=new Bi([i,n,r,o])},e._getTileNum=function(t,e){var i=this.tileSystem,n=this.tileSize,r=Math.floor(1e-7*i.scale.x+t.x/(n.width*e)),o=Math.ceil(1e-7*i.scale.y+t.y/(n.height*e));return{x:i.scale.x*r,y:i.scale.y*o}},e.getTileIndex=function(t,e,i){var n=this.tileSystem,r=this.transformation.transform(t,1),o=this._getTileNum(r,e);return n.scale.x<0&&(o.x-=1),n.scale.y>0&&(o.y-=1),this.getNeighorTileIndex(o.x,o.y,0,0,e,i)},e.getNeighorTileIndex=function(t,e,i,n,r,o){var s=this.tileSystem,a=t+s.scale.x*i,h=e-s.scale.y*n,u=!1,l=a,c=h,p=this._getTileFullIndex(r);return o&&(!0!==o&&"x"!==o||(p.xmax===p.xmin?a=p.xmin:a<p.xmin?(a=p.xmax-(p.xmin-a)%(p.xmax-p.xmin))===p.xmax&&(a=p.xmin):a>=p.xmax&&(a=p.xmin+(a-p.xmin)%(p.xmax-p.xmin))),!0!==o&&"y"!==o||(p.ymax===p.ymin?h=p.ymin:h>=p.ymax?h=p.ymin+(h-p.ymin)%(p.ymax-p.ymin):h<p.ymin&&(h=p.ymax-(p.ymin-h)%(p.ymax-p.ymin))===p.ymax&&(h=p.ymin))),(a<p.xmin||a>p.xmax||h>p.ymax||h<p.ymin)&&(u=!0),{x:a,y:h,idx:l,idy:c,out:u}},e._getTileFullIndex=function(t){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[t])return this._tileFullIndex[t];var e=this.fullExtent,i=this.transformation,n=this._getTileNum(i.transform(new Mi(e.left,e.top),1),t),r=this._getTileNum(i.transform(new Mi(e.right,e.bottom),1),t),o=this.tileSystem;return o.scale.x<0&&(n.x-=1,r.x-=1),o.scale.y>0&&(n.y-=1,r.y-=1),this._tileFullIndex[t]=new ji(n,r),this._tileFullIndex[t]},e.getTilePrjNW=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+this._yScale*n.scale.y*(e+(1===n.scale.y?1:0))*i*r.height,s=n.origin.x+this._xScale*n.scale.x*(t+(1===n.scale.x?0:1))*i*r.width;return new Mi(s,o)},e.getTilePointNW=function(t,e,i){var n=this._glRes/i,r=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*n+this._yScale*r.scale.y*(e+(1===r.scale.y?1:0))*o.height,a=this._pointOrigin.x*n+this._xScale*r.scale.x*(t+(1===r.scale.x?0:1))*o.width;return new de(a,s)},e.getTilePrjSE=function(t,e,i){var n=this.tileSystem,r=this.tileSize,o=n.origin.y+this._yScale*n.scale.y*(e+(1===n.scale.y?0:1))*i*r.height,s=n.origin.x+this._xScale*n.scale.x*(t+(1===n.scale.x?1:0))*i*r.width;return new Mi(s,o)},e.getTilePointSE=function(t,e,i){var n=this._glRes/i,r=this.tileSystem,o=this.tileSize,s=this._pointOrigin.y*n+this._yScale*r.scale.y*(e+(1===r.scale.y?0:1))*o.height,a=this._pointOrigin.x*n+this._xScale*r.scale.x*(t+(1===r.scale.x?1:0))*o.width;return new de(a,s)},e.getTilePrjExtent=function(t,e,i){var n=this.getTilePrjNW(t,e,i),r=this.getTilePrjSE(t,e,i);return new ji(n,r)},t}(),_s=[],ms=0;ms<6;ms++)_s[ms]=[];var vs=[];function xs(t,e,i){var n,r,o,s,a,h,u,l,c,p,f,d,g,y,_,m,v;r=(n=t)[0],o=n[1],s=n[2],a=n[3],h=n[4],u=n[5],l=n[6],c=n[7],p=n[8],f=n[9],d=n[10],g=n[11],y=n[12],_=n[13],m=n[14],v=n[15],bs(_s[0],a-r,c-h,g-p,v-y),bs(_s[1],a+r,c+h,g+p,v+y),bs(_s[2],a+o,c+u,g+f,v+_),bs(_s[3],a-o,c-u,g-f,v-_),bs(_s[4],a-s,c-l,g-d,v-m),bs(_s[5],a+s,c+l,g+d,v+m);for(var x=0;x<6;x++)if(!i||"0"!==i.charAt(x)){var w=_s[x];if(vs[0]=w[0]>0?e[1][0]:e[0][0],vs[1]=w[1]>0?e[1][1]:e[0][1],vs[2]=w[2]>0?e[1][2]:e[0][2],Cs(w,vs)<0)return!1}return!0}var ws=1/6;function bs(t,e,i,n,r){return t[0]=e*ws,t[1]=i*ws,t[2]=n*ws,t[3]=r*ws,t}function Cs(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}var Ms="undefined"!=typeof Set,Es=function(){function t(){this._table=Ms?new Set:{}}var e=t.prototype;return e.add=function(t){Ms?this._table.add(t):this._table[t]=!0},e.has=function(t){return Ms?this._table.has(t):this._table[t]},e.reset=function(){Ms?this._table.clear():this._table={}},t}(),Ss={urlTemplate:null,subdomains:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!C,debug:!1,spatialReference:null,maxCacheSize:256,renderer:ue.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0},Ps=/\{ *([\w_]+) *\}/g,Is=new de(0,0),Ts=new de(0,0),Ls=new de(0,0),Os=new de(0,0),Rs=new de(0,0),Ns=new de(0,0),As=new de(0,0),Ds=new de(0,0),ks=[[0,0,0],[0,0,0]],Fs=[],js=function(t){function e(){return t.apply(this,arguments)||this}le(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null};var i=e.prototype;return i.getTileSize=function(){var t=this.options.tileSize;return c(t)&&(t=[t,t]),new ge(t)},i.getTiles=function(t,e){var i=this.getMap(),n=i.getPitch(),r=e&&e.getRenderer(),o=i.getContainerExtent(),s=[],a=0,h=this.getMinZoom(),u=i.options.cascadePitches[0],c=i.options.cascadePitches[1],p=Math.floor(i._getVisualHeight(c)),f=l(t)?this._getTileZoom(i.getZoom()):t;if(this._visitedTiles=new Es,this._coordCache={},!l(t)||!this.options.cascadeTiles||n<=u||!l(h)&&f<=h){var d=n<=c?o:new zi(0,i.height-p,i.width,i.height),g=this._getTiles(f,d,2,r);return g&&(a+=g.tiles.length,s.push(g)),{tileGrids:s,count:a}}var y=Math.floor(i._getVisualHeight(u)),_=new zi(0,i.height-y,i.width,i.height),m=this._getTiles(f,_,0,r);a+=m?m.tiles.length:0,s.push(m);var v,x,w=_.ymin,b=i.getSpatialReference().getZoomDirection(),C=b;if(n>c){f-C<=h&&(C=0);var M=new zi(0,i.height-p,i.width,w);a+=(v=this._getTiles(f-C,M,1,r))?v.tiles.length:0,w=M.ymin,C+=4*b}if(f-C>=h){var E=new zi(0,o.ymin,i.width,w);a+=(x=this._getTiles(f-C,E,2,r))?x.tiles.length:0,s.push(x)}return v&&x&&(s[1]=x,s[2]=v),{tileGrids:s,count:a}},i.getTileUrl=function(t,e,i){var n=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(G(o)){var s=(t+e)%o.length;s<0&&(s=0),r=o[s]}}if(g(n))return n(t,e,i,r);var a={x:t,y:e,z:i,s:r};return n.replace(Ps,(function(t,e){var i=a[e];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(a)),i}))},i.clear=function(){return this._renderer&&this._renderer.clear(),this.fire("clear"),this},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},i.getSpatialReference=function(){var t=this.getMap();return!t||this.options.spatialReference&&!Zn.equals(this.options.spatialReference,t.options.spatialReference)?(this._sr=this._sr||new Zn(this.options.spatialReference),void 0===this._srMinZoom&&(this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom()),this._sr):t.getSpatialReference()},i.getMinZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t.prototype.getMinZoom.call(this),this._srMinZoom):t.prototype.getMinZoom.call(this)},i.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},i._getTileZoom=function(t){p(t)||(t=Math.round(t));var e=this.options.maxAvailableZoom;return!l(e)&&t>e&&(t=e),t},i._getTiles=function(t,e,i,n){var r=this,o=this.getMap(),s=t,a=o.projViewMatrix;i<2&&(0===i&&(s-=1),a=0===i?o.cascadeFrustumMatrix0:1===i?o.cascadeFrustumMatrix1:o.projViewMatrix);var h=s+this.options.zoomOffset,u=this._getTileOffset(h),c=u[0]||u[1],p={zoom:s,extent:null,offset:u,tiles:[]};if(h<0)return p;var f=this.getMinZoom(),d=this.getMaxZoom();if(!(o&&this.isVisible()&&o.width&&o.height))return p;if(!l(f)&&s<f||!l(d)&&s>d)return p;var g=this._getTileConfig();if(!g)return p;var y=this.getSpatialReference(),_=o.getSpatialReference(),m=y.getResolution(h),v=o.getGLScale(s),x=y===_&&this.options.repeatWorld,w=e.convertTo((function(t){if(t.y>0&&t.y<o.height){var e=(0===t.x?0:1)+t.y;r._coordCache[e]||(r._coordCache[e]=o._containerPointToPoint(t)),r._coordCache[e]}return o._containerPointToPoint(t,void 0,Is)}));w._add(u);var b=this._getMask2DExtent();if(b){var C=b.intersection(w);if(!C)return p;e=C.convertTo((function(t){return o._pointToContainerPoint(t,void 0,0,Is)}))}var M,E=o._containerPointToPrj(e.getCenter(),Ts),S=o._prjToPoint(E,void 0,Ls);M=c?this._project(o._pointToPrj(S._add(u),void 0,Ls),Ls):this._project(E,Ls),Os.x=w.xmin,Os.y=w.ymax,Rs.x=w.xmax,Rs.y=w.ymin;for(var P=this._project(o._pointToPrj(Os,void 0,Os),Os),I=this._project(o._pointToPrj(Rs,void 0,Rs),Rs),T=g.getTileIndex(M,m,x),L=g.getTileIndex(P,m,x),O=g.getTileIndex(I,m,x),R=Math.ceil(Math.abs(T.idy-L.idy)),N=Math.ceil(Math.abs(T.idx-L.idx)),A=Math.ceil(Math.abs(T.idy-O.idy)),D=Math.ceil(Math.abs(T.idx-O.idx)),k=(R+A+1)*(N+D+1),F=this.getTileSize(),j=this.getRenderer()||n,G=this._getTileConfig().tileSystem.scale,z=[],B=new zi,V=-R;V<=A;V++)for(var H=-N,q=-1/0,Z=!1;H>=q&&H<=D;){var U=g.getNeighorTileIndex(T.idx,T.idy,H,V,m,x);q===-1/0?H++:H--;var W=this._getTileId(U.idx,U.idy,s);if(!(U.out||this._visitedTiles&&this._visitedTiles.has(W))){var Y=j&&j.isTileCachedOrLoading(W);Y&&(Y=Y.info);var X=void 0;if(Y){var J=Y.point0;X=Y.point.set(J.x,J.y)}else if(this._hasOwnSR){var Q=g.getTilePrjNW(U.x,U.y,m);X=o._prjToPoint(this._unproject(Q,Rs),s)}else X=g.getTilePointNW(U.x,U.y,m);var K=void 0,$=void 0;if(y===_)K=F.width,$=F.height;else{var tt=void 0;if(this._hasOwnSR){var et=g.getTilePrjSE(U.x,U.y,m);tt=o._prjToPoint(this._unproject(et,Rs),s,Rs)}else tt=g.getTilePointSE(U.x,U.y,m);K=Math.ceil(Math.abs(tt.x-X.x)),$=Math.ceil(Math.abs(tt.y-X.y))}var it=G.x*(U.idx-U.x)*K,nt=G.y*(U.idy-U.y)*$;(it||nt)&&X._add(it,nt),c&&X._sub(u);var rt=Y&&Y.extent2d||new zi(X.x,X.y,X.x+K,X.y-$);(k<=4||Z||this._isTileInExtent(a,rt,v))&&(this._visitedTiles&&0===i&&this._visitedTiles.add(W),0===i?(this._splitTiles(a,z,j,U,s+1,rt,u,it,nt),B._combine(rt)):(Y||(Y={point0:X.add(u)._sub(it,nt),point:X,z:s,x:U.x,y:U.y,extent2d:rt,mask:i,size:[K,$],id:W,dupKey:W,layer:this.getId(),url:this.getTileUrl(U.x,U.y,h)}),c&&(rt.set(X.x,X.y,X.x+K,X.y-$),Y.point=X._add(u),rt._add(u)),z.push(Y),B._combine(rt)),q===-1/0?(q=H,H=D):Z||(Z=!0))}}if(z.length){var ot=o._containerPointToPoint(e.getCenter(),s,Is)._add(u);z.sort((function(t,e){return t.point.distanceTo(ot)-e.point.distanceTo(ot)}))}return{offset:u,zoom:t,extent:B,tiles:z}},i._splitTiles=function(t,e,i,n,r,o,s,a,h){var u=this._getTileConfig().tileSystem.scale.y,l=this.getMap().getGLScale(r),c=Ns.set(2*o.xmin,u<0?2*o.ymax:2*o.ymin),p=As.set(o.xmin,u<0?o.ymax:o.ymin)._add(s)._sub(a,h)._multi(2),f=o.getWidth(),d=o.getHeight(),g=2*n.idx,y=2*n.idy,_=2*n.x,m=2*n.y,v=this._checkAndAddTile(t,i,g,y,_,m,r,0,0,f,d,c,p,s,l);v&&e.push(v),(v=this._checkAndAddTile(t,i,g,y,_,m,r,0,1,f,d,c,p,s,l))&&e.push(v),(v=this._checkAndAddTile(t,i,g,y,_,m,r,1,0,f,d,c,p,s,l))&&e.push(v),(v=this._checkAndAddTile(t,i,g,y,_,m,r,1,1,f,d,c,p,s,l))&&e.push(v)},i._checkAndAddTile=function(t,e,i,n,r,o,s,a,h,u,l,c,p,f,d){var g=this._getTileId(i+a,n+h,s);if(this._visitedTiles&&this._visitedTiles.has(g))return null;var y=this._getTileConfig().tileSystem.scale.y,_=new zi(c.x+a*u,c.y+y*h*l,c.x+(a+1)*u,c.y+y*(h+1)*l);if(!this._isSplittedTileInExtent(t,_,d))return null;var m=f[0]||f[1],v=e&&e.isTileCachedOrLoading(g);return v=v?v.info:{point0:p.add(a*u,Math.max(y*h*l,y*(h+1)*l)),point:new de(_.xmin,_.ymax),z:s,x:r+a,y:o+h,extent2d:_,size:[u,l],id:g,dupKey:g,layer:this.getId(),url:this.getTileUrl(r+a,o+h,s+this.options.zoomOffset)},m&&(v.extent2d=_,v.extent2d._add(f),v.point.set(_.xmin,_.ymax)._add(f)),v},i._getTileOffset=function(t){var e=this.getMap(),i=e._getResolution()/e._getResolution(t),n=this.options.offset;return g(n)&&(n=n(this)),n[0]*=i,n[1]*=i,n},i._getTileId=function(t,e,i,n){return(n||this.getId())+"_"+e+"_"+t+"_"+i},i._project=function(t,e){if(this._hasOwnSR){var i=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(i.unproject(t,e),e)}return t},i._unproject=function(t,e){if(this._hasOwnSR){var i=this.getMap(),n=this.getSpatialReference(),r=i.getProjection(),o=n.getProjection();return r.project(o.unproject(t,e),e)}return t},i._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),i=this.getSpatialReference(),n=i.getProjection(),r=i.getFullExtent();if(this._defaultTileConfig=new ys(t,ds.getDefault(n),r,e),this.options.tileSystem&&(this._tileConfig=new ys(t,this.options.tileSystem,r,e)),t&&!this._tileConfig&&t.getSpatialReference()===i&&t.getBaseLayer()&&t.getBaseLayer()!==this&&t.getBaseLayer()._getTileConfig){var o=t.getBaseLayer()._getTileConfig();this._tileConfig=new ys(t,o.tileSystem,o.fullExtent,e)}this._hasOwnSR=i!==t.getSpatialReference()},i._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},i._bindMap=function(e){var i=e.getBaseLayer();return i===this&&(i.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),t.prototype._bindMap.apply(this,arguments)},i._isTileInExtent=function(t,e,i){var n,r=this.getMap();if(t!==r.projViewMatrix){var o=e.getCenter(Ds)._multi(i);_o(Fs,o.x,o.y,0);var s=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return s=s||1,t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/s,t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,t}(Fs,Fs,r.projViewMatrix);n=s[1]<0?r.projViewMatrix:t}else n=r.projViewMatrix;return ks[0][0]=e.xmin*i,ks[0][1]=e.ymin*i,ks[1][0]=e.xmax*i,ks[1][1]=e.ymax*i,xs(n,ks)},i._isSplittedTileInExtent=function(t,e,i){var n=this.getMap();return ks[0][0]=e.xmin*i,ks[0][1]=e.ymin*i,ks[1][0]=e.xmax*i,ks[1][1]=e.ymax*i,xs(n.projViewMatrix,ks)},i.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},i._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr;var t=this.getRenderer();t&&t.clear()},e}(Yn);js.registerJSONType("TileLayer"),js.mergeOptions(Ss);var Gs=function(t){function e(e,i,n){var r;return(r=t.call(this,e,n)||this).layers=i||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}le(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var i=t.layers.map((function(t){return Yn.fromJSON(t)}));return new e(t.id,i,t.options)};var i=e.prototype;return i.getLayers=function(){return this.layers},i.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(t){return t.toJSON()})),options:this.config()}},i.getTiles=function(t){for(var e=this.layers,i=[],n=0,r=0,o=e.length;r<o;r++){var s=e[r];if(s.options.visible){var a=s.getTiles(t,this);a&&0!==a.count&&(n+=a.count,L(i,a.tileGrids))}}return{count:n,tileGrids:i}},i.onAdd=function(){var e=this,i=this.getMap();this.layers.forEach((function(t){e.layerMap[t.getId()]=t,t.getChildLayer&&e._groupChildren.push(t),t._bindMap(i),t.on("show hide",e._onLayerShowHide,e)})),t.prototype.onAdd.call(this)},i.onRemove=function(){var e=this;this.layers.forEach((function(t){t._doRemove(),t.off("show hide",e._onLayerShowHide,e)})),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},i.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var i=0;i<this._groupChildren.length;i++){var n=this._groupChildren[i].getChildLayer(t);if(n)return n}return null},i._onLayerShowHide=function(){var t=this.getRenderer();t&&t.setToRedraw()},i.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,i=0,n=e.length;i<n;i++)if(e[i].isVisible())return!0;return!1},i._checkChildren=function(){var t=this,e={};this.layers.forEach((function(i){var n=i.getId();if(e[n])throw new Error("Duplicate child layer id ("+n+") in the GroupTileLayer ("+t.getId()+")");e[n]=1}))},e}(js);Gs.registerJSONType("GroupTileLayer");var zs={crs:null,uppercase:!1,detectRetina:!1},Bs={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},Vs=function(t){function e(e,i){var n;n=t.call(this,e)||this;var r=u({},Bs);for(var o in i)o in n.options||(r[o]=i[o]);n.setOptions(i),n.setZIndex(i.zIndex);var s=n.getTileSize();return r.width=s.width,r.height=s.height,n.wmsParams=r,n._wmsVersion=parseFloat(r.version),n}le(e,t);var i=e.prototype;return i.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),i=zs.detectRetina?e:1;this.wmsParams.width*=i,this.wmsParams.height*=i;var n=this.options.crs||this.getMap().getProjection().code,r=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[r]=n,t.prototype.onAdd.call(this)},i.getTileUrl=function(e,i,n){var r=this.getSpatialReference().getResolution(n),o=this._getTileConfig().getTilePrjExtent(e,i,r),s=o.getMax(),a=o.getMin(),h=(this._wmsVersion>=1.3&&"EPSG:4326"===this.wmsParams.crs?[a.y,a.x,s.y,s.x]:[a.x,a.y,s.x,s.y]).join(","),u=t.prototype.getTileUrl.call(this,e,i,n);return u+function(t,e,i){var n=[];for(var r in t)n.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")}(this.wmsParams,u,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},i.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(js);Vs.registerJSONType("WMSTileLayer"),Vs.mergeOptions(zs);var Hs=function(t){function e(e,i){var n;return(n=t.call(this,e,i)||this).options.hasOwnProperty("forceRenderOnMoving")||(n.options.forceRenderOnMoving=!1),n}le(e,t);var i=e.prototype;return i.drawTile=function(){},i.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(js);function qs(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error("Failed to compile shader: "+r)}return n}Hs.registerJSONType("CanvasTileLayer");var Zs="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",Us="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n        }\n    ",Ws=[0,0],Ys=[0,0,0],Xs=new Array(16),Js=new de(20,20),Qs=function(t){var e,i=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.drawGLImage=function(t,e,i,n,r,o,s,a){this.gl.program!==this.program&&this.useProgram(this.program);var h=this.gl;this.loadTexture(t),Ys[0]=e||0,Ys[1]=i||0;var u=go(Xs);lo(u,u,Ys),co(u,u,[o,o,1]),po(u,this.getMap().projViewMatrix,u),h.uniformMatrix4fv(this.program.u_matrix,!1,u),h.uniform1f(this.program.u_opacity,s),h.uniform1f(this.program.u_debug_line,0);var l=t.glBuffer;!l||l.width===n&&l.height===r||(this.saveImageBuffer(l),delete t.glBuffer),t.glBuffer?h.bindBuffer(h.ARRAY_BUFFER,l):t.glBuffer=this.bufferTileData(0,0,n,r),Ws[0]="a_position",Ws[1]=2,Ws[2]=t.glBuffer.type,this.enableVertexAttrib(Ws),h.drawArrays(h.TRIANGLE_STRIP,0,4),a&&this.drawDebug(u,Ws,0,0,n,r,a)},i.drawDebug=function(t,e,i,n,r,o,s){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),a.bufferData(a.ARRAY_BUFFER,new Float32Array([i,n,i+r,n,i+r,n-o,i,n-o,i,n]),a.DYNAMIC_DRAW),a.uniformMatrix4fv(this.program.u_matrix,!1,t),a.uniform1f(this.program.u_debug_line,1),a.drawArrays(a.LINE_STRIP,0,5);var h=this._debugInfoCanvas;if(!h){var u=this.getMap().getDevicePixelRatio()>1?2:1;(h=this._debugInfoCanvas=document.createElement("canvas")).width=256*u,h.height=32*u;var l=h.getContext("2d");l.font="20px monospace",l.scale(u,u)}var c=h.getContext("2d");c.clearRect(0,0,h.width,h.height);var p=this.layer.options.debugOutline;oi.fillText(c,s,Js,p),this.loadTexture(h),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,h);var f=i,d=i+(r=256),g=n,y=n-(o=32);a.bufferData(a.ARRAY_BUFFER,this.set8(f,g,f,y,d,g,d,y),a.DYNAMIC_DRAW),a.uniform1f(this.program.u_debug_line,0),a.drawArrays(a.TRIANGLE_STRIP,0,4)},i.bufferTileData=function(t,e,i,n,r){var o,s=t,a=t+i,h=e,u=e-n;o=p(s)&&p(a)&&p(h)&&p(u)?this.set8Int(s,h,s,u,a,h,a,u):this.set8(s,h,s,u,a,h,a,u);var l=this.loadImageBuffer(o,r);return l.width=i,l.height=n,l.type=o instanceof Int16Array?"SHORT":"FLOAT",l},i.drawTinImage=function(t,e,i,n,r){var o=this.gl;this.loadTexture(t),o.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),o.uniform1f(this.program.u_opacity,r),o.bindBuffer(o.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.DYNAMIC_DRAW),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),o.DYNAMIC_DRAW),o.drawElements(o.TRIANGLES,n.length,o.UNSIGNED_SHORT,0)},i.createCanvas2=function(){this.canvas2=oi.createCanvas(this.canvas.width,this.canvas.height)},i.createGLContext=function(){this.canvas.gl&&this.canvas.gl.wrap?this.gl=this.canvas.gl.wrap():this.gl=function(t,e){for(var i={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},n=["webgl","experimental-webgl"],r=null,o=0;o<n.length;++o){try{r=t.getContext(n[o],e||i)}catch(t){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.disable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(Zs,this.layer.options.fragmentShader||Us,["u_matrix","u_image","u_opacity","u_debug_line"]),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),t.bufferData(t.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},i.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},i.clearGLCanvas=function(){this.gl&&this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)},i.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},i._createTexture=function(t){var e=this.gl,i=this.getTexture()||e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),p(D(t.width))&&p(D(t.width))&&e.generateMipmap(e.TEXTURE_2D),i},i.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},i.saveTexture=function(t){this._textures.push(t)},i.loadTexture=function(t){var e=this.gl,i=t.texture;return i||(i=this._createTexture(t),t.texture=i),e.bindTexture(e.TEXTURE_2D,i),i},i.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},i.saveImageBuffer=function(t){this._imageBuffers.push(t)},i.loadImageBuffer=function(t,e){var i=this.gl,n=e||this.createImageBuffer();return i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW),n},i.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},i.removeGLCanvas=function(){var t=this.gl;if(t){if(this._debugBuffer&&(t.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(e){t.deleteBuffer(e)})),delete this._buffers),this._textures&&(this._textures.forEach((function(e){return t.deleteTexture(e)})),delete this._textures),this._debugInfoCanvas){var e=this._debugInfoCanvas.texture;e&&t.deleteTexture(e),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var i=t.program;t.deleteShader(i.fragmentShader),t.deleteShader(i.vertexShader),t.deleteProgram(i),delete this.gl,delete this.canvas2}},i.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},i.enableVertexAttrib=function(t){!function(t,e,i){if(Array.isArray(i[0])){for(var n=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<i.length;o++)r+=i[o][1]||0;for(var s=0,a=0;a<i.length;a++){var h=t.getAttribLocation(e,i[a][0]);if(h<0)throw new Error("Failed to get the storage location of "+i[a][0]);t.vertexAttribPointer(h,i[a][1],t[i[a][2]||"FLOAT"],!1,n*r,n*s),s+=i[a][1]||0,t.enableVertexAttribArray(h)}}else{var u=t.getAttribLocation(e,i[0]);t.vertexAttribPointer(u,i[1],t[i[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(u)}}(this.gl,this.gl.program,t)},i.createProgram=function(t,e,i){var n=function(t,e,i){var n=qs(t,t.VERTEX_SHADER,e),r=qs(t,t.FRAGMENT_SHADER,i);if(!n||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:n,fragmentShader:r}):null}(this.gl,t,e),r=n.program,o=n.vertexShader,s=n.fragmentShader;return r.vertexShader=o,r.fragmentShader=s,this._initUniforms(r,i),r},i.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},i.enableSampler=function(t,e){var i=this.gl,n=this._getUniform(i.program,t);return e||(e=0),i.uniform1i(n,e),n},i._initUniforms=function(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=e[i],o=n.indexOf("[");o>=0&&(n=n.substring(0,o),C||(r=r.substring(0,o))),t[n]=this._getUniform(t,r)}},i._getUniform=function(t,e){var i=this.gl.getUniformLocation(t,e);if(!i)throw new Error("Failed to get the storage location of "+e);return i},e}(t);return u(i.prototype,{set8:(e=ue.ie9?null:new Float32Array(8),function(t,i,n,r,o,s,a,h){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=h,e}),set8Int:function(){var t=ue.ie9?null:new Int16Array(8);return function(e,i,n,r,o,s,a,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t}}()}),i},Ks={renderer:ue.webgl?"gl":"canvas",crossOrigin:null},$s=new de(0,0),ta=function(t){function e(e,i,n){var r;return!i||Array.isArray(i)||i.url||(n=i,i=null),(r=t.call(this,e,n)||this)._images=i,r}le(e,t);var i=e.prototype;return i.onAdd=function(){this._prepareImages(this._images)},i.setImages=function(t){return this._images=t,this._prepareImages(t),this},i.getImages=function(){return this._images},i._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap();this._imageData=t.map((function(t){var i=new ji(t.extent);return u({},t,{extent:i,extent2d:i.convertTo((function(t){return e.coordToPoint(t,e.getGLZoom())}))})})),this._images=t;var i=this.getRenderer();i&&i.refreshImages()},e}(Yn);ta.mergeOptions(Ks);var ea=[],ia=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},i.checkResources=function(){var t=this;if(this._imageLoaded)return ea;var e=this.layer._imageData.map((function(t){return[t.url,null,null]}));if(this.resources){var i=[],n=new ln;e.forEach((function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);n.addResource(e,r)}else i.push(e)})),this.resources.forEach((function(e,i){n.isResourceLoaded(e)||t.retireImage(i.image)})),this.resources=n,e=i}return this._imageLoaded=!0,e},i.retireImage=function(){},i.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},i.needToRedraw=function(){var e=this.getMap();return!(e.isZooming()&&!e.getPitch())&&t.prototype.needToRedraw.call(this)},i.draw=function(){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},i._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),i=e._get2DExtent(e.getGLZoom());if(t&&t.length)for(var n=0;n<t.length;n++){var r=t[n].extent2d,o=this.resources&&this.resources.getImage(t[n].url);o&&i.intersects(r)&&(this._painted=!0,this._drawImage(o,r,t[n].opacity||1))}},i._drawImage=function(t,e,i){var n=0,r=this.context;i<1&&(n=r.globalAlpha,r.globalAlpha=i);var o=this.getMap(),s=$s.set(e.xmin,e.ymax),a=o._pointToContainerPoint(s,o.getGLZoom()),h=a.x,u=a.y,l=o.getBearing();l&&(r.save(),r.translate(h,u),l&&r.rotate(-l*Math.PI/180),h=u=0);var c=o.getGLScale();r.drawImage(t,h,u,e.getWidth()/c,e.getHeight()/c),l&&r.restore(),n&&(r.globalAlpha=n)},i.drawOnInteracting=function(){this.draw()},e}(un),na=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.isDrawable=function(){return!0},i._drawImage=function(t,e,i){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,i)},i.createContext=function(){this.createGLContext()},i.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.retireImage=function(t){this.disposeImage(t)},i.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(Qs(ia));ta.registerRenderer("canvas",ia),ta.registerRenderer("gl",na);var ra=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.getPrepareParams=function(){return[]},i.getDrawParams=function(){return[]},i.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=oi.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},i.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},i.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this._drawLayerOnInteracting()},i.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var i=e.image;this.buffer.width===i.width&&this.buffer.height===i.height||(this.buffer.width=i.width,this.buffer.height=i.height);var n=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(n,this.context);(void 0===r||r)&&(oi.image(n,i,0,0),e.image=this.buffer)}return e},i.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},i.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},i.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},i.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},i.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},i.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},i.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},i.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},i.prepareDrawContext=function(){if(!this._predrawed){var t=oa(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},i._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],i=oa(this.getDrawParams());return e.push.apply(e,i),e.push.apply(e,this._drawContext),e},i._drawLayer=function(){var t=this._prepareDrawParams();t&&(this.layer.draw.apply(this.layer,t),this.completeRender())},i._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();t&&(this.layer.drawOnInteracting.apply(this.layer,t),this.completeRender())}},e}(un);function oa(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var sa=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.isCanvasRender=function(){return!0},i.prepareToDraw=function(){},i.draw=function(){},i.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},i.play=function(){return this.config("animation",!0),this},i.pause=function(){return this.config("animation",!1),this},i.isPlaying=function(){return this.options.animation},i.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},i.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},i.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},i.onCanvasCreate=function(){return this},i.onZoomStart=function(){},i.onZooming=function(){},i.onZoomEnd=function(){},i.onMoveStart=function(){},i.onMoving=function(){},i.onMoveEnd=function(){},i.onResize=function(){},i.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e}(Yn);sa.mergeOptions({doubleBuffer:!1,animation:!1}),sa.registerRenderer("canvas",ra);var aa=new de(0,0),ha=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.getParticles=function(){},i.draw=function(t,e){var i=this.getParticles(h());if(i&&0!==i.length){var n=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo((function(t){return n._pointToContainerPoint(t,void 0,0,aa)}));for(var o=2*Math.PI,s=0,a=i.length;s<a;s++){var u=i[s].point;if(r.contains(u)){var l=i[s].color||this.options.lineColor||"#fff",c=i[s].r;t.fillStyle!==l&&(t.fillStyle=l),c<=2?t.fillRect(u.x-c/2,u.y-c/2,c,c):(t.beginPath(),t.arc(u.x,u.y,c/2,0,o),t.fill())}}this._fillCanvas(t)}else{this._getRenderer()&&(this._getRenderer()._shouldClear=!0)}},i._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var i=this.options.trail||30;t.fillStyle="rgba(0, 0, 0, "+1/i+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(sa);ha.mergeOptions({animation:!0}),ha.registerRenderer("canvas",function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},i.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},i.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(ra));var ua=e+"_edit_stage_";function la(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var ca={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:la("ellipse",1),vertexHandleSymbol:la("square",1),newVertexHandleSymbol:la("square",.4)},pa=function(t){function e(e,i){var n;return(n=t.call(this,i)||this)._geometry=e,n._geometry?n:pe(n)}le(e,t);var i=e.prototype;return i.getMap=function(){return this._geometry.getMap()},i.prepare=function(){this.getMap()&&(this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},i._prepareEditStageLayer=function(){var t=this.getMap(),e=P(),i=ua+e,n=ua+e+"_shadow";this._editStageLayer=t.getLayer(i),this._shadowLayer=t.getLayer(n),this._editStageLayer||(this._editStageLayer=new to(i),t.addLayer(this._editStageLayer)),this._shadowLayer||(this._shadowLayer=new to(n),t.addLayer(this._shadowLayer))},i.start=function(){var t=this;if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){var e=this.getMap();this.editing=!0;var i=this._geometry;this._geometryDraggble=i.options.draggable,i.config("draggable",!1),this.prepare();var n=i.copy();n.setSymbol(i._getInternalSymbol()),n.copyEventListeners(i),i._getParent()&&n.copyEventListeners(i._getParent()),n._setEventTarget(i),n.setId(null).config({draggable:!1}),this._shadow=n,this._switchGeometryEvents("on"),i.hide(),(i instanceof br||i instanceof Ar||i instanceof kr||i instanceof Dr)&&this._createOrRefreshOutline(),this._shadowLayer.bringToFront().addGeometry(n),this._editStageLayer.bringToFront(),this._addListener([e,"zoomstart",function(){t._editStageLayer.hide()}]),this._addListener([e,"zoomend",function(){t._editStageLayer.show()}]),i instanceof br?(n.config("draggable",!0),n.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),i instanceof br?this.createMarkerEditor():i instanceof Ar?this.createCircleEditor():i instanceof kr||i instanceof Dr?this.createEllipseOrRectEditor():i instanceof Fr||(i instanceof xr||i instanceof Mr)&&this.createPolygonEditor()}},i.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()&&(delete this._shadow,this._geometry.config("draggable",this._geometryDraggble),delete this._geometryDraggble,this._geometry.show(),this._editStageLayer.remove(),this._shadowLayer.remove(),this._clearAllListeners(),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1)},i.isEditing=function(){return!l(this.editing)&&this.editing},i._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,"positionchange shapechange":this._exeAndReset}},i._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var i in e)this._geometry[t](i,e[i],this)}},i._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},i._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray()),this._refresh()},i._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;return e?(e.remove(),this._editOutline=e=t.getOutline(),this._editStageLayer.addGeometry(e)):(e=t.getOutline(),this._editStageLayer.addGeometry(e),this._editOutline=e,this._addRefreshHook(this._createOrRefreshOutline)),e},i._createCenterHandle=function(){var t,e=this,i=this._shadow.getCenter(),n=this.options.centerHandleSymbol,r=this.createHandle(i,{symbol:n,cursor:"move",onDown:function(){var i=Rt((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(i).addTo(e._editStageLayer)},onMove:function(e,i){var n=i.coordOffset;t.translate(n)},onUp:function(){e._update("setCoordinates",Mi.toNumberArrays(t.getCoordinates())),t.remove(),e._refresh()}});this._addRefreshHook((function(){var t=e._shadow.getCenter();r.setCoordinates(t)}))},i._createHandleInstance=function(t,e){var i=e.symbol;return new br(t,{draggable:!0,dragShadow:!1,dragOnAxis:e.axis,cursor:e.cursor,symbol:i})},i.createHandle=function(t,e){e||(e={});var i=this.getMap(),n=this._createHandleInstance(t,e),r=this;function o(t){return e.onDown&&(this._geometry.fire("handledragstart"),e.onDown.call(r,t.viewPoint,t)),!1}function s(t){r._hideContext();var o=i._prjToViewPoint(n._getPrjCoordinates());return e.onMove&&(this._geometry.fire("handledragging"),e.onMove.call(r,o,t)),!1}function a(t){return e.onUp&&(this._geometry.fire("handledragend"),e.onUp.call(r,t)),!1}return n.on("dragstart",o,this),n.on("dragging",s,this),n.on("dragend",a,this),n.on("removestart",(function t(){n.config("draggable",!1),n.off("dragstart",o,r),n.off("dragging",s,r),n.off("dragend",a,r),n.off("removestart",t,r),delete n["maptalks--editor-refresh-fn"]}),this),e.onRefresh&&(n["maptalks--editor-refresh-fn"]=e.onRefresh),this._editStageLayer.addGeometry(n),n},i._createResizeHandles=function(t,e,i){var n=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],o=[null,"y",null,"x","x",null,"y",null],s=this._geometry;t||(t=[]);var a=this,h=[],u={},l=this.getMap(),c=this.options.vertexHandleSymbol,p=function(){for(var p,f=s._getPainter().get2DExtent(),d=[new de((p=f).xmin,p.ymax),new de((p.xmax+p.xmin)/2,p.ymax),new de(p.xmax,p.ymax),new de(p.xmin,(p.ymax+p.ymin)/2),new de(p.xmax,(p.ymax+p.ymin)/2),new de(p.xmin,p.ymin),new de((p.xmax+p.xmin)/2,p.ymin),new de(p.xmax,p.ymin)],g=function(p){if(Array.isArray(t)&&t.some((function(t){return t===p})))return"continue";var f,g=d[p],y=l.pointToCoordinate(g);if(h.length<d.length-t.length){var _=n.createHandle(y,{symbol:c,cursor:r[p],axis:o[p],onMove:(f=p,function(t){a._updating=!0,e(t,f),s.fire("resizing")}),onUp:function(){a._updating=!1,i(),n._refresh()}});_.setId(p),u[p]=h.length,h.push(_)}else h[u[p]].setCoordinates(y)},y=0;y<d.length;y++)g(y)};return p(),this._addRefreshHook(p),h},i.createMarkerEditor=function(){var t=this,e=this._geometry,i=this._shadow,n=this.getMap();if(i._canEdit()){this._history||this._recordHistory(p());var r=i._getInternalSymbol(),o=new de(0,0);c(r.markerDx)&&(o.x=r.markerDx),c(r.markerDy)&&(o.y=r.markerDy);var s=null;wn.test(r)?"pin"!==r.markerType&&"pie"!==r.markerType&&"bar"!==r.markerType||(s=[5,6,7]):(Cn.test(r)||Ln.test(r))&&(s=[5,6,7]);var a,h=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var u=i.getSize();a=u.width/u.height}var l=this._createResizeHandles(null,(function(r,u){if(s&&s.indexOf(u)>=0){var c=n.viewPointToCoordinate(r.sub(o)),p=i.getCoordinates();c.x=p.x,i.setCoordinates(c),t._updateCoordFromShadow(!0);var f=l[l.length-1-u];r=n.coordToViewPoint(f.getCoordinates())}var d=n._pointToViewPoint(i._getCenter2DPoint()).add(o),g=i._getInternalSymbol(),y=r.sub(d);s&&r.y>d.y&&(y.y=0);var _=s?1:2,m=2*Math.abs(y.x),v=Math.abs(y.y)*_;a&&(v=(m=Math.max(m,v*a))/a);var x=h[u];i instanceof Zr?((a||0===x||2===x)&&(i.setWidth(m),e.setWidth(m)),(a||1===x||2===x)&&(i.setHeight(v),e.setHeight(v))):((a||0===x||2===x)&&(g.markerWidth=m),(a||1===x||2===x)&&(g.markerHeight=v),i.setSymbol(g),e.setSymbol(g))}),(function(){t._update(p())}));this._addListener([n,"zoomend",function(){this._refresh()}])}else console&&console.warn("A marker can't be resized with symbol:",i.getSymbol());function p(){var t=[["setCoordinates",i.getCoordinates().toArray()]];return i instanceof Zr?(t.push(["setWidth",i.getWidth()]),t.push(["setHeight",i.getHeight()])):t.push(["setSymbol",i.getSymbol()]),t}},i.createCircleEditor=function(){var t=this,e=this._geometry,i=this._shadow,n=this.getMap();this._history||this._recordHistory([["setCoordinates",i.getCoordinates().toArray()],["setRadius",i.getRadius()]]),this._createResizeHandles(null,(function(t){var r=e.getCenter(),o=n.viewPointToCoordinate(t),s=new Mr([[r.x,r.y],[o.x,r.y]]),a=new Mr([[r.x,r.y],[r.x,o.y]]),h=Math.max(n.computeGeometryLength(s),n.computeGeometryLength(a));i.setRadius(h),e.setRadius(h)}),(function(){t._update("setRadius",i.getRadius())}))},i.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],i=this._geometry,n=this._shadow;this._history||this._recordHistory(h());var r,o=this.getMap(),s=this._geometry instanceof kr;this.options.fixAspectRatio&&(r=i.getWidth()/i.getHeight());var a=this._createResizeHandles(null,(function(h,u){var l,c,p,f=s?1:2,d=h,g=e[u];if(s){var y=a[7-u],_=o.coordToViewPoint(y.getCoordinates()),m=(l=d.sub(_)).abs();c=o.pixelToDistance(m.x,0),p=o.pixelToDistance(0,m.y);var v=i.getSize(),x=a[0].getCoordinates(),w=o.viewPointToCoordinate(h),b=y.getCoordinates(),C=new Mr([[b.x,b.y],[w.x,b.y]]),M=new Mr([[b.x,b.y],[b.x,w.y]]);c=o.computeGeometryLength(C),p=o.computeGeometryLength(M),0===g?(r&&(m.y=m.x/r,v.height=Math.abs(m.y),p=c/r),d.y=_.y-v.height/2,w.y=x.y,w.x=4===u?Math.min(w.x,x.x):Math.min(w.x,b.x)):1===g?(r&&(m.x=m.y*r,v.width=Math.abs(m.x),c=p*r),d.x=_.x-v.width/2,w.x=x.x,w.y=Math.max(w.y,b.y)):(r&&(c>p*r?(p=c/r,d.y=_.y+m.x*A(l.y)/r):(c=p*r,d.x=_.x+m.y*A(l.x)*r)),w.x=Math.min(w.x,b.x),w.y=Math.max(w.y,b.y)),n.setCoordinates(w),t._updateCoordFromShadow(!0)}else{var E=i.getCenter(),S=o.viewPointToCoordinate(d),P=new Mr([[E.x,E.y],[S.x,E.y]]),I=new Mr([[E.x,E.y],[E.x,S.y]]);c=o.computeGeometryLength(P),p=o.computeGeometryLength(I),r&&(p=(c=Math.max(c,p*r))/r)}(r||0===g||2===g)&&(n.setWidth(c*f),i.setWidth(c*f)),(r||1===g||2===g)&&(n.setHeight(p*f),i.setHeight(p*f))}),(function(){t._update(h())}));function h(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},i.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow,i=this,n=t.getProjection();this._history||this._recordHistory("setCoordinates",Mi.toNumberArrays(e.getCoordinates()));var r=e instanceof xr?3:2,o="maptalks--editor-refresh-fn",s="maptalks--editor-vertex-index",a={0:[]},h={0:[]};function u(t){if(void 0===t&&(t=0),e instanceof xr){var i=e.getCoordinates()[t]||[];return i.slice(0,i.length-1)}return e.getCoordinates()}function l(t){return void 0===t&&(t=0),0===t?e._getPrjCoordinates():e._getPrjHoles()[t-1]}function p(){for(var t in a){for(var e=a[t].length-1;e>=0;e--)a[t][e][s]=e;for(var n=h[t].length-1;n>=0;n--)h[t][n][s]=n}i._updateCoordFromShadow()}function f(t){var n,o=t.target,u=o[s],f=c(o._ringIndex)?o._ringIndex:0,d=l(f);d.length<=r||(d.splice(u,1),f>0?e._prjHoles[f-1]=d:e._setPrjCoordinates(d),e._updateCache(),a[f].splice(u,1)[0].remove(),u<h[f].length&&h[f].splice(u,1)[0].remove(),n=0===u?h[f].length-1:u-1,h[f].splice(n,1)[0].remove(),h[f].splice(n,0,y.call(i,n,f)),p(),i._refresh())}function d(n,r,s){void 0===s&&(s=0);var a,u=l(s),c=t._viewPointToPrj(n),p=u[r];p.x=c.x,p.y=c.y,e._updateCache(),e.onShapeChanged(),i._updateCoordFromShadow(!0),a=0===r?h[s].length-1:r-1,h[s][r]&&h[s][r][o](),h[s][a]&&h[s][a][o]()}function g(t,e){void 0===e&&(e=0);var n=u(e)[t],r=i.createHandle(n,{symbol:i.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(t){d(t,r[s],e)},onRefresh:function(){n=u(e)[r[s]],r.setCoordinates(n)},onUp:function(){i._refresh(),i._updateCoordFromShadow()},onDown:function(t,e){!e||!e.domEvent||e.domEvent.button}});return r[s]=t,r._ringIndex=e,r.on(i.options.removeVertexOn,f),r}function y(t,r){void 0===r&&(r=0);var o,c=u(r);o=t+1>=c.length?c[0]:c[t+1];var f=c[t].add(o).multi(.5),_=i.createHandle(f,{symbol:i.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(t,o){if(!o||!o.domEvent||2!==o.domEvent.button){var a=l(r),u=_[s],c=n.project(_.getCoordinates());a.splice(u+1,0,c),r>0?e._prjHoles[r-1]=a:e._setPrjCoordinates(a),e._updateCache();var p=_.getSymbol();delete p.opacity,_.setSymbol(p),h[r].splice(u,0,y.call(i,u,r),y.call(i,u+1,r))}},onMove:function(t){d(t,_[s]+1,r)},onUp:function(t){if(!t||!t.domEvent||2!==t.domEvent.button){var e=_[s];O(_,h[r]),_.remove(),a[r].splice(e+1,0,g.call(i,e+1,r)),p(),i._updateCoordFromShadow(),i._refresh()}},onRefresh:function(){c=u(r);var t,e=_[s];t=e===c.length-1?0:e+1;var i=c[e].add(c[t]).multi(.5);_.setCoordinates(i)}});return _[s]=t,_}if(e instanceof xr)for(var _=e.getHoles().length+1,m=0;m<_;m++){a[m]=[],h[m]=[];for(var v=u(m),x=0,w=v.length;x<w;x++)a[m].push(g.call(this,x,m)),x<w-1&&h[m].push(y.call(this,x,m));h[m].push(y.call(this,v.length-1,m))}else for(var b=0,C=u(0).length;b<C;b++)a[0].push(g.call(this,b,0)),b<C-1&&h[0].push(y.call(this,b,0));this._addRefreshHook((function(){for(var t in h)for(var e=h[t].length-1;e>=0;e--)h[t][e][o](t);for(var i in a)for(var n=a[i].length-1;n>=0;n--)a[i][n][o](i)}))},i._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},i._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},i._addListener=function(t){this._eventListeners||(this._eventListeners=[]),this._eventListeners.push(t),t[0].on(t[1],t[2],this)},i._clearAllListeners=function(){if(this._eventListeners&&this._eventListeners.length>0){for(var t=this._eventListeners.length-1;t>=0;t--){var e=this._eventListeners[t];e[0].off(e[1],e[2],this)}this._eventListeners=[]}},i._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},i._update=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];this._exeHistory([t,i]),this._recordHistory.apply(this,[t].concat(i))},i._updateCoordFromShadow=function(t){if(this._shadow){var e=this._shadow.getCoordinates(),i=this._geometry,n=this._updating;this._updating=!0,i.setCoordinates(e),t||this._recordHistory("setCoordinates",Mi.toNumberArrays(i.getCoordinates())),this._updating=n}},i._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0);for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(this._history.length){var r=this._history[this._history.length-1];if(r[0]===t&&JSON.stringify(r[1])===JSON.stringify(i))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,i]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},i.cancel=function(){if(!this._history||0===this._historyPointer)return this;this._historyPointer=0;var t=this._history[0];return this._exeAndReset(t),this},i.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},i.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},i._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,i=this._historyPointer;this.stop(),this._history=e,this._historyPointer=i,this.start()}},i._exeHistory=function(t){var e=this;if(Array.isArray(t)){var i=this._updating;this._updating=!0;var n=this._geometry;Array.isArray(t[0])?t[0].forEach((function(t){var i=t[0],r=t.slice(1);e._shadow[i].apply(e._shadow,r),n[i].apply(n,r)})):(this._shadow[t[0]].apply(this._shadow,t[1]),n[t[0]].apply(n,t[1])),this._updating=i}},e}(di(yi));pa.mergeOptions(ca);var fa={startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),$e(this._textEditor,"mousedown dblclick",Be),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var i=this._getEditorOffset();this._editUIMarker=new Xo(this.getCoordinates(),{animation:null,content:e,dx:i.dx,dy:i.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,i=0,n=t.textHorizontalAlignment;return"middle"===n||l(n)?(e=(t.textDx||0)-2,i=(t.textDy||0)-2):(e=(t.markerDx||0)-2,i=(t.markerDy||0)-2),{dx:e,dy:i}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),i=this._getInternalSymbol()||{},n=e.width,r=i.textFill||"#000000",o=i.textSize||12,s=e.height,a=i.markerLineColor||"#000",h=i.markerFill||"#3398CC",u=i.textLineSpacing||0,l=Ae("div");return l.contentEditable=!0,l.style.cssText="background:"+h+"; border:1px solid "+a+";\n            color:"+r+";font-size:"+o+"px;width:"+(n-2)+"px;height:"+(s-2)+"px;margin: auto;\n            line-height:"+(o+u)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",l.innerText=t,Ke(l,"mousedown dblclick",Be),l.onkeyup=function(t){var e=l.style.height||0;13===t.keyCode&&(l.style.height=parseInt(e)+o/2+"px")},l},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}};qr.include(fa),Un.include({animate:function(t,e,i){var n=this;this._animPlayer&&this._animPlayer.finish(),g(e)&&(i=e),e||(e={});var r,o=this.getMap(),s=this._getProjection(),a=this.getSymbol()||{},h=this._prepareAnimationStyles(t),u=e.focus;if(delete this._animationStarted,o){var l=o._getRenderer();e.framer=function(t){l.callInNextFrame(t)}}var c=gr.animate(h,e,(function(t){if(o&&o.isRemoved())c.finish();else{o&&!n._animationStarted&&u&&o.onMoveStart();var e=t.styles;for(var h in e)if("symbol"!==h&&"translate"!==h&&e.hasOwnProperty(h)){var l="set"+h[0].toUpperCase()+h.slice(1);n[l](e[h])}var p=e.translate;if(p){var f=p;r&&(f=p.sub(r)),r=p,n.translate(f)}var d=e.symbol;if(d&&n.setSymbol(Nt(a,d)),o&&u){var g=s.project(n.getCenter());o._setPrjCenter(g);var y=o._parseEventFromCoord(s.unproject(g));"running"!==c.playState?o.onMoveEnd(y):o.onMoving(y)}n._fireAnimateEvent(c.playState),i&&i(t)}}),this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),i={};for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if("translate"!==n&&"symbol"!==n){var o=this["get"+n[0].toUpperCase()+n.substring(1)]();i[n]=[o,r]}else if("symbol"===n){var s=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");s=[];for(var a=t.symbol,h=0;h<a.length;h++)if(a[h]){var u={};for(var l in a[h])a[h].hasOwnProperty(l)&&(u[l]=[e[h][l],a[h][l]]);s.push(u)}else s.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var c in s={},r)r.hasOwnProperty(c)&&(s[c]=[e[c],r[c]])}i.symbol=s}else"translate"===n&&(i.translate=new Mi(r))}return i},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var da=e+"_drag_stage",ga=ue.touch?"touchstart mousedown":"mousedown",ya=function(t){function e(e){return t.call(this,e)||this}le(e,t);var i=e.prototype;return i.addHooks=function(){this.target.on(ga,this._startDrag,this)},i.removeHooks=function(){this._endDrag(),this.target.off(ga,this._startDrag,this),delete this.container},i._prepareDragHandler=function(){this._dragHandler=new Ci(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},i._prepareShadow=function(){var t=this,e=this.target;this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var i=this._shadow=e.copy();if(i.getGeometries){var n=i.getGeometries(),r=e.getGeometries();n.forEach((function(e,i){t._updateShadowSymbol(e,r[i])}))}else this._updateShadowSymbol(i,e);i.setId(null),this._prepareShadowConnectors()},i._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var i=Rt(t._getInternalSymbol(),.5);t.setSymbol(i)}},i._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,i=this._dragStageLayer._getRenderer().resources,n=[];if(Xr._hasConnectors(t))for(var r=Xr._getConnectors(t),o=0,s=r.length;o<s;o++){var a=r[o],h=a.config(),u=a._getInternalSymbol();h.symbol=Rt(u,.5);var l=void 0;l=a.getConnectSource()===t?new a.constructor(e,a.getConnectTarget(),h):new a.constructor(a.getConnectSource(),e,h),n.push(l),a.getLayer()&&a.getLayer()._getRenderer()&&i.merge(a.getLayer()._getRenderer().resources)}this._shadowConnectors=n,n.push(e),this._dragStageLayer.bringToFront().addGeometry(n)},i._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},i._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(da),this._dragStageLayer||(this._dragStageLayer=new to(da,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var i=new ln;i.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=i},i._startDrag=function(t){var e=this.target.getMap();if(e&&(!this.target._getParent()&&!this.isDragging())){var i=t.domEvent;i.touches&&i.touches.length>1||2===i.button||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),Ke(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},i._dragging=function(t){var e=this.target,i=e.getMap()._parseEvent(t.domEvent),n=i.domEvent;if(!(n.touches&&n.touches.length>1)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",i),this.target._fireEvent("dragstart",this._startParam||i),void delete this._startParam;if(this._shadow){var r=this._shadow.options.dragOnAxis,o=this._correctCoord(i.coordinate),s=i.containerPoint;this._lastPoint=this._lastPoint||s,this._lastCoord=this._lastCoord||o;var a=s.sub(this._lastPoint),h=o.sub(this._lastCoord);"x"===r?a.y=h.y=0:"y"===r&&(a.x=h.x=0),this._lastPoint=s,this._lastCoord=o,this._shadow.translate(h),e.options.dragShadow||e.translate(h),i.coordOffset=h,i.pointOffset=a,this._shadow._fireEvent("dragging",i),e._fireEvent("dragging",i)}}},i._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&$e(this.container,"mouseleave",this._endDrag),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var i=e.getMap();if(this.enabled()&&i){var n=i._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(n),this._moved&&e._fireEvent("dragend",n)}}},i.isDragging=function(){return!!this._isDragging},i._updateTargetAndRemoveShadow=function(t){var e=this.target,i=e.getMap();e.options.dragShadow||e.show();var n=this._shadow;if(n){if(e.options.dragShadow)if(e.getGeometries){var r=n.getGeometries(),o=e.getGeometries();r.forEach((function(t,e){o[e].setCoordinates(r[e].getCoordinates())}))}else e.setCoordinates(n.getCoordinates());n._fireEvent("dragend",t),n.remove(),delete this._shadow}this._shadowConnectors&&(i.getLayer(da).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&this._dragStageLayer.remove()},i._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var i=this.target._getPainter();if(!i.getMinAltitude())return t;var n=(i.getMinAltitude()+i.getMaxAltitude())/2;return e.locateByPoint(t,0,-n)},e}(gi);Un.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null}),Un.addInitHook("addHandler","draggable",ya),Un.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),Un.include({startEdit:function(t){return this.getMap()&&this.options.editable?(this.endEdit(),this._editor=new pa(this,t),this._editor.start(),this.fire("editstart"),this):this},endEdit:function(){return this._editor&&(this._editor.stop(),delete this._editor,this.fire("editend")),this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),Un.include({_onEvent:function(t,e){if(this.getMap()){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(Be(t),ze(t));var n=this._getEventParams(t);this._fireEvent(i,n)}},_getEventTypeToFire:function(t){return t.type},_getEventParams:function(t){var e=this.getMap(),i={domEvent:t},n=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(n){var r=qe(n,e._containerDOM);i.coordinate=e.containerPointToCoordinate(r),i.containerPoint=r,i.viewPoint=e.containerPointToViewPoint(r),i.pont2d=e._containerPointToPoint(r)}return i}}),Un.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof Ko?(this._infoWindow=t,this._infoWinOptions=u({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=u({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(this._infoWinOptions),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(this._infoWinOptions),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(t){return this._infoWindow=new Ko(t),this._infoWindow.addTo(this),this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var _a=function(){function t(t,e){this.max=t,this.onRemove=e,this.reset()}var e=t.prototype;return e.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.getAndRemove(this.order[0]);i&&this.onRemove(i)}return this},e.has=function(t){return t in this.data},e.keys=function(){return this.order},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},e.get=function(t){return this.has(t)?this.data[t]:null},e.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},e.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}(),ma=new de(0,0),va=new de(0,0),xa=new de(0,0),wa=function(t){function e(e){var i;return(i=t.call(this,e)||this).tilesInView={},i.tilesLoading={},i._parentTiles=[],i._childTiles=[],i.tileCache=new _a(e.options.maxCacheSize,i.deleteTile.bind(pe(i))),i}le(e,t);var i=e.prototype;return i.getCurrentTileZoom=function(){return this._tileZoom},i.draw=function(){var t=this.getMap();if(this.isDrawable()){var e=this.prepareCanvas();if(!e||e.intersects(this.canvasExtent2D)){var i=this.layer.getTiles().tileGrids;if(i&&i.length){var n=0,r=!1,o={},s=[],a=[],h={},u=[],l={},c=[],p={},f={},d=this._markTiles(),g=this._getLoadLimit(),y=i.length;this._tileZoom=i[0].zoom,this._tileOffset=i[0].offset;for(var _=0;_<y;_++)for(var m=i[_],v=m.tiles,x=this._generatePlaceHolder(m.zoom),w=0,b=v.length;w<b;w++){var C=v[w],M=C.id,E=!1;if(this._isLoadingTile(M))E=r=!0,this.tilesLoading[M].current=!0;else{var S=this._getCachedTile(M);if(S)S.image&&this.getTileOpacity(S.image)<1&&(E=r=!0),s.push(S);else E=r=!0,g&&n+d[0]>g||t.isInteracting()&&!t.isMoving()&&!t.isRotating()||(n++,f[M+"@"+C.point.toArray().join()]=C)}if(E&&!o[M]){o[M]=1,x&&!p[M]&&(C.cache=!1,c.push({image:x,info:C}),p[M]=1);var P=this._findParentTile(C);if(P){var I=P.info.id;void 0===h[I]&&(h[I]=a.length,a.push(P))}else if(!a.length){var T=this._findChildTiles(C);T.length&&T.forEach((function(t){l[t.info.id]||(u.push(t),l[t.info.id]=1)}))}}}a.length&&(u.length=0,this._childTiles.length=0),this._drawTiles(s,a,u,c),n?this.loadTileQueue(f):r||(t.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),this._retireTiles()}else this.completeRender()}else this.completeRender()}},i.isTileCachedOrLoading=function(t){return this.tilesLoading[t]||this.tilesInView[t]||this.tileCache.get(t)},i._drawTiles=function(t,e,i,n){var r=this;e.length&&(e.sort((function(t,e){return Math.abs(e.info.z-r._tileZoom)-Math.abs(t.info.z-r._tileZoom)})),this._parentTiles=e),i.length&&(this._childTiles=i);var o={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles};this.onDrawTileStart(o),this._parentTiles.forEach((function(t){return r._drawTileAndCache(t)})),this._childTiles.forEach((function(t){return r._drawTileOffset(t.info,t.image)})),n.forEach((function(t){return r._drawTileOffset(t.info,t.image)}));var s=this.layer,a=this.getMap();if(!s.options.cascadeTiles||a.getPitch()<=a.options.cascadePitches[0])t.forEach((function(t){return r._drawTileAndCache(t)}));else{this.writeZoomStencil();for(var h=!1,u=0,l=t.length;u<l;u++)t[u].info.z!==this._tileZoom?h?this.resumeZoomStencilTest():(this.startZoomStencilTest(),h=!0):h&&this.pauseZoomStencilTest(),this._drawTileAndCache(t[u]);this.endZoomStencilTest()}this.onDrawTileEnd(o)},i.writeZoomStencil=function(){},i.startZoomStencilTest=function(){},i.endZoomStencilTest=function(){},i.pauseZoomStencilTest=function(){},i.resumeZoomStencilTest=function(){},i.onDrawTileStart=function(){},i.onDrawTileEnd=function(){},i._drawTileOffset=function(t,e){if(e){var i=this._tileOffset;if(i[0]||i[1]){var n=this.getMap(),r=n._getResolution(this._tileZoom)/n._getResolution(t.z);i[0]*=r,i[1]*=r,t.point._sub(i),t.extent2d._sub(i),this.drawTile(t,e),t.point._add(i),t.extent2d._add(i),i[0]/=r,i[1]/=r}else this.drawTile(t,e)}},i._drawTileAndCache=function(t){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTileOffset(t.info,t.image),this.tileCache.add(t.info.id,t)},i.drawOnInteracting=function(){this.draw()},i.needToRedraw=function(){var e=this.getMap();return e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this))},i.hitDetect=function(){return!1},i._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},i.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},i.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},i._isLoadingTile=function(t){return!!this.tilesLoading[t]},i.clipCanvas=function(e){return t.prototype.clipCanvas.call(this,e)},i._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var i=e.getContainerExtent(),n=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(i.ymin)*n,Math.ceil(i.getWidth())*n,Math.ceil(i.getHeight())*n),t.stroke(),t.clip(),!0},i.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e],n=this.loadTile(i);void 0===n.loadTime&&(this.tilesLoading[i.id]={image:n,current:!0,info:i})}},i.loadTile=function(t){var e=this.layer.getTileSize(),i=new Image;return i.width=e.width,i.height=e.height,i.onload=this.onTileLoad.bind(this,i,t),i.onerror=this.onTileError.bind(this,i,t),this.loadTileImage(i,t.url),i},i.loadTileImage=function(t,e){var i=this.layer.options.crossOrigin;return l(i)||(t.crossOrigin=i),E(t,[e])},i.abortTileLoading=function(t){t&&(t.onload=ba,t.onerror=ba,t.src=Y)},i.onTileLoad=function(t,e){if(this.layer){var i=e.id;if(this.tilesInView){var n={tile:e,tileImage:t};this.layer.fire("tileload",n),(t=n.tileImage).loadTime=h(),delete this.tilesLoading[i],this._addTileToCache(e,t),this.setToRedraw()}}},i.onTileError=function(t,e){if(this.layer){if(t.onerrorTick=t.onerrorTick||0,this.layer.options.tileRetryCount>t.onerrorTick)return t.onerrorTick++,void(t.src=e.url);if(t.onTileReplaceTick=t.onTileReplaceTick||0,this.layer.options.tileReplaceMaxZoomDiff>t.onTileReplaceTick){t.onTileReplaceTick++;var i=t.onTileReplaceTick,n=Math.floor(e.x/(2*i)),r=256*i*(e.x%2==0?1:-1),o=Math.floor(e.y/(2*i)),s=256*i*(e.y%2==0?1:-1),a=e.z-i,h=this.layer.options.urlTemplate.replace("{x}",n).replace("{y}",o).replace("{z}",a);return t.style.width=100*t.onTileReplaceTick+"%",t.style.height=100*t.onTileReplaceTick+"%",t.style.position="absolute",t.style.left=r+"px",t.style.bottom=s+"px",t.style.src=h,void(t.style.zIndex=-1)}t instanceof Image&&this.abortTileLoading(t,e),t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},i.drawTile=function(t,e){if(e&&this.getMap()){var i=t.point,n=t.z,r=t.id,o=this.getMap(),s=t.size,a=o.getZoom(),h=this.context,u=o._pointToContainerPoint(i,n,0,ma),l=o.getBearing(),c=l||a!==n,p=this.getTileOpacity(e),f=h.globalAlpha;p<1&&(h.globalAlpha=p,this.setToRedraw()),c||u._round();var d=u.x,g=u.y,y=s[0],_=s[1];if(c){if(h.save(),h.translate(d,g),l&&(h.rotate(-l*Math.PI/180),y+=.1,_+=.1),a!==n){var m=o._getResolution(n)/o._getResolution();h.scale(m,m)}d=g=0}if(oi.image(h,e,d,g,y,_),this.layer.options.debug){var v=this.layer.options.debugOutline;h.save(),h.strokeStyle=v,h.fillStyle=v,h.strokeWidth=10,h.font="20px monospace";var x=new de(d,g);oi.rectangle(h,x,{width:y,height:_},1,0),oi.fillText(h,this.getDebugInfo(r),x._add(10,20),v),oi.drawCross(h,d+y/2,g+_/2,2,v),h.restore()}c&&h.restore(),h.globalAlpha!==f&&(h.globalAlpha=f),this.setCanvasUpdated()}},i.getDebugInfo=function(t){var e=t.split("_"),i=e.length;return"x:"+e[i-2]+", y:"+e[i-3]+", z:"+e[i-1]},i._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e.options.background)return[];for(var i=this.getMap(),n=[],r=t.extent2d.getMin(),o=t.extent2d.getMax(),s=e._project(i._pointToPrj(r,t.z,va),va),a=e._project(i._pointToPrj(o,t.z,xa),xa),h=1;h<2;h++)this._findChildTilesAt(n,s,a,e,t.z+h);return n},i._findChildTilesAt=function(t,e,i,n,r){var o=n.options.zoomOffset,s=n.getId(),a=n.getSpatialReference().getResolution(r+o);if(a)for(var h,u,l=n._getTileConfig().getTileIndex(e,a),c=n._getTileConfig().getTileIndex(i,a),p=Math.min(l.idx,c.idx),f=Math.max(l.idx,c.idx),d=Math.min(l.idy,c.idy),g=Math.max(l.idy,c.idy),y=p;y<f;y++)for(var _=d;_<g;_++)h=n._getTileId(y,_,r+o,s),this.tileCache.has(h)&&(u=this.tileCache.getAndRemove(h),t.push(u),this.tileCache.add(h,u))},i._findParentTile=function(t){var e=this.getMap(),i=this._getLayerOfTile(t.layer);if(!i.options.background)return null;for(var n=i.getSpatialReference(),r=n.getZoomDirection(),o=i.options.zoomOffset,s=i.options.backgroundZoomDiff,a=t.extent2d.getCenter(),h=i._project(e._pointToPrj(a,t.z)),u=1;u<=s;u++){var l=t.z-r*u,c=n.getResolution(l+o);if(c){var p=i._getTileConfig().getTileIndex(h,c),f=i._getTileId(p.x,p.y,l+o,t.layer);if(this.tileCache.has(f)){var d=this.tileCache.getAndRemove(f);return this.tileCache.add(f,d),d}}}return null},i._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},i._getCachedTile=function(t){var e=this.tilesInView,i=this.tileCache.getAndRemove(t);if(i){e[t]=i;var n=this.tilesLoading;if(n&&n[t]){n[t].current=!1;var r=n[t],o=r.image,s=r.info;this.abortTileLoading(o,s),console.log("_getCachedTile"),delete n[t]}}else i=e[t];return i},i._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},i.getTileOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(h()-t.loadTime)/(1e3/60*10)):1},i.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,t.prototype.onRemove.call(this)},i._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var i in this.tilesLoading)this.tilesLoading[i].current=!1,t++;if(this.tilesInView)for(var n in this.tilesInView)this.tilesInView[n].current=!1,e++;return[t,e]},i._retireTiles=function(t){for(var e in this.tilesLoading){var i=this.tilesLoading[e];!t&&i.current||(i.image&&this.abortTileLoading(i.image,i.info),this.deleteTile(i),delete this.tilesLoading[e])}for(var n in this.tilesInView){var r=this.tilesInView[n];r.current||(delete this.tilesInView[n],this.tileCache.has(n)||this.deleteTile(r))}},i.deleteTile=function(t){t&&t.image&&(t.image.onload=null,t.image.onerror=null)},i._generatePlaceHolder=function(t){var e=this.getMap(),i=this.layer.options.placeholder;if(!i||e.getPitch())return null;var n=this.layer.getTileSize(),r=e._getResolution(t)/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||oi.createCanvas(1,1);return o.width=n.width*r,o.height=n.height*r,g(i)?i(o):function(t){var e=t.getContext("2d"),i=t.width,n=t.height,r=i/16,o=n/16;e.beginPath();for(var s=0;s<16;s++)e.moveTo(0,s*o),e.lineTo(i,s*o),e.moveTo(s*r,0),e.lineTo(s*r,n);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var a=[[0,0],[i,0],[0,n],[i,n],[0,0],[0,n],[i,0],[i,n],[0,n/2],[i,n/2],[i/2,0],[i/2,n]],h=1;h<a.length;h+=2)e.moveTo(a[h-1][0],a[h-1][1]),e.lineTo(a[h][0],a[h][1]);e.lineWidth=4,e.stroke()}(o),o},e}(un);function ba(){return!1}js.registerRenderer("canvas",wa);var Ca=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.isDrawable=function(){return!0},i.needToRedraw=function(){var e=this.getMap();return!(!this._gl()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},i.drawTile=function(e,i){var n=this.getMap();if(e&&n&&i){var r=e._glScale=e._glScale||n.getGLScale(e.z),o=e.size[0],s=e.size[1];if(!1!==e.cache&&this._bindGLBuffer(i,o,s),this._gl()){var a=e.point,h=a.x*r,u=a.y*r,l=this.getTileOpacity(i),c=null;this.layer.options.debug&&(c=this.getDebugInfo(e.id)),this.drawGLImage(i,h,u,o,s,r,l,c),l<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,i)}},i.writeZoomStencil=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255),t.stencilOp(t.KEEP,t.KEEP,t.REPLACE)},i.startZoomStencilTest=function(){var t=this.gl;t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilFunc(t.EQUAL,0,255)},i.endZoomStencilTest=function(){this.pauseZoomStencilTest()},i.pauseZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.ALWAYS,1,255)},i.resumeZoomStencilTest=function(){var t=this.gl;t.stencilFunc(t.EQUAL,0,255)},i._bindGLBuffer=function(t,e,i){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,i))},i.loadTileImage=function(t,e){var i=this.layer.options.crossOrigin;t.crossOrigin=null!==i?i:"",t.src=e},i.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},i.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},i.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},i.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},i.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},i._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},i.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},i.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(Qs(wa));function Ma(t){var e=this.layer.getTileSize(),i=this.canvas.constructor,n=this.getMap(),r=n.getDevicePixelRatio(),o=oi.createCanvas(e.width*r,e.height*r,i);o.layer=this.layer;var s=this,a=new ji(n.pointToCoordinate(t.point),n.pointToCoordinate(t.point.add(e.toPoint())),n.getProjection());return this.layer.drawTile(o,{url:t.url,point:t.point,center:n.pointToCoordinate(t.point.add(e.width/2,e.height/2)),extent:a,z:t.z,x:t.x,y:t.y},(function(e){e?s.onTileError(o,t):s.onTileLoad(o,t)})),o}js.registerRenderer("gl",Ca);var Ea=function(t){function e(){return t.apply(this,arguments)||this}return le(e,t),e.prototype.loadTile=function(){return Ma.apply(this,arguments)},e}(wa),Sa=function(t){function e(){return t.apply(this,arguments)||this}return le(e,t),e.prototype.loadTile=function(){return Ma.apply(this,arguments)},e}(Ca);Hs.registerRenderer("canvas",Ea),Hs.registerRenderer("gl",Sa);var Pa=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!G(t))return[];for(var e=[],i={},n=t.length-1;n>=0;n--){var r=t[n]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var s=r[o][0];this.resources.isResourceLoaded(r[o])||i[s]||(e.push(r[o]),i[s]=1)}else e.push.apply(e,r)}return this._resourceChecked=!0,delete this._geosToCheck,e},i.render=function(){return this.layer._sortGeometries(),t.prototype.render.apply(this,arguments)},i._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),L(this._geosToCheck,t))},i.onGeometryAdd=function(t){this._addGeoToCheckRes(t),Ia(this)},i.onGeometryRemove=function(){Ia(this)},i.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),Ia(this)},i.onGeometryShapeChange=function(){Ia(this)},i.onGeometryPositionChange=function(){Ia(this)},i.onGeometryZIndexChange=function(){Ia(this)},i.onGeometryShow=function(){Ia(this)},i.onGeometryHide=function(){Ia(this)},i.onGeometryPropertiesChange=function(){Ia(this)},e}(un);function Ia(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var Ta=new zi,La=function(t){function e(){return t.apply(this,arguments)||this}le(e,t);var i=e.prototype;return i.checkResources=function(){var e=this,i=t.prototype.checkResources.apply(this,arguments),n=this.layer.getStyle();n&&(Array.isArray(n)||(n=[n]),n.forEach((function(t){for(var n=Pt(t.symbol,!0),r=0,o=n.length;r<o;r++)e.resources.isResourceLoaded(n[r])||i.push(n[r])})));var r=this.layer.options.drawAltitude;if(r)for(var o=Pt(r,!0),s=0,a=o.length;s<a;s++)this.resources.isResourceLoaded(o[s])||i.push(o[s]);return i},i.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===to)&&t.prototype.needToRedraw.call(this)},i.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},i.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},i.drawOnInteracting=function(){if(this._geosToDraw){this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),i=this.getMap().getResolution();(t.isZooming()&&t.options.seamlessZoom&&void 0!==this._drawnRes&&i>1.5*this._drawnRes&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this.forEachGeo(this.checkGeo,this),this._drawnRes=i);for(var n=0,r=this._geosToDraw.length;n<r;n++){var o=this._geosToDraw[n];o.isVisible()&&o._paint(this._displayExtent)}}},i.show=function(){this.layer.forEach((function(t){t._repaint()})),t.prototype.show.apply(this,arguments)},i.forEachGeo=function(t,e){this.layer.forEach(t,e)},i.drawGeos=function(){this._drawnRes=this.getMap().getResolution(),this._updateDisplayExtent(),this.prepareToDraw(),this.forEachGeo(this.checkGeo,this);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint()},i.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},i.checkGeo=function(t){if(t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),i=e.get2DExtent(this.resources,Ta);i&&i.intersects(this._displayExtent)&&(e.hasPoint()&&(this._hasPoint=!0),this._geosToDraw.push(t))}},i.onZoomEnd=function(){delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,arguments)},i.onRemove=function(){this.forEachGeo((function(t){t.onHide()})),delete this._geosToDraw},i.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},i._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},i.identify=function(t,e){void 0===e&&(e={});var i=this._geosToDraw;return i?this.layer._hitGeos(i,t,e):[]},e}(Pa);to.registerRenderer("canvas",La);var Oa=function(t){function e(e){var i;return(i=t.call(this)||this).map=e,i._handlerQueue={},i}le(e,t);var i=e.prototype;return i.callInNextFrame=function(t){this._handlerQueue.push(t)},i.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,i=t.length;e<i;e++)t[e]()},i.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&0===t.x&&0===t.y)return this;var i=this.map._panels,n=this._frontCount=i.back.layerDOM.childElementCount,r=this._backCount=i.front.layerDOM.childElementCount,o=this._uiCount=i.front.uiDOM.childElementCount;if(n||r||o){var s=this.map.offsetPlatform();s=t?s.add(t)._round():s.round(),r&&Ve(i.back,s),(n||o)&&Ve(i.front,s)}return this},i.domChanged=function(){var t=this.map._panels;if(!t.front)return!1;var e=t.back.layerDOM.childElementCount;if(void 0===this._frontCount||this._frontCount!==e)return!0;var i=t.front.layerDOM.childElementCount;if(void 0===this._backCount||this._backCount!==i)return!0;var n=t.front.uiDOM.childElementCount;return void 0===this._uiCount||this._uiCount!==n},i.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new de(0,0);Ve(this.map._panels.back,t),Ve(this.map._panels.front,t)}},i.onZoomEnd=function(){this.resetContainer()},i.onLoad=function(){this._frameLoop()},e}(yi),Ra=function(t){function e(e){var i;return(i=t.call(this,e)||this)._containerIsCanvas=!!e._containerDOM.getContext,i._thisVisibilitychange=i._onVisibilitychange.bind(pe(i)),i._registerEvents(),i._loopTime=0,i}le(e,t);var i=e.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(t){if(!this.map)return!1;delete this._isViewChanged;var e=this.map;e._fireEvent("framestart"),this.updateMapDOM();var i=this._getAllLayerToRender();return this.drawLayers(i,t),this.drawLayerCanvas(i)&&this._drawCenterCross(),e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,!0},i.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},i.drawLayers=function(t,e){for(var i=this.map,n=i.isInteracting(),r=[],o=[],s=i.options.fpsOnInteracting||0,a=0===s?0:1e3/s,h=this.map.options.layerCanvasLimitOnInteracting,u=t.length,l=i.getBaseLayer(),c=0,p=0;p<u;p++){var f=t[p];if(f.isVisible()){var d=f.isCanvasRender();d&&r.push(f.getId());var g=f._getRenderer();if(g){var y=this._checkLayerRedraw(f);d&&g.isCanvasUpdated()&&(y||o.push(f.getId()),this.setLayerCanvasUpdated());var _=g.__zoomTransformMatrix;if(delete g.__zoomTransformMatrix,y){if(n&&d){if(h>0&&u-1-p>h&&f!==l){f._getRenderer().clearCanvas();continue}c+=this._drawCanvasLayerOnInteracting(f,c,a,e)}else n&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.checkAndDraw?g.checkAndDraw(g.drawOnInteracting,this._eventParam,e):g.drawOnInteracting(this._eventParam,e)):(g.render(e),d&&_&&g.isLoadingResource()&&(g.__zoomTransformMatrix=_));d&&(o.push(f.getId()),this.setLayerCanvasUpdated())}else d&&n&&(i.isZooming()&&!i.getPitch()?(g.prepareRender(),g.__zoomTransformMatrix=this._zoomMatrix):(i.getPitch()||i.isRotating())&&g.clearCanvas())}}}var m=this._canvasIds||[],v=this._updatedIds||[];if(this._canvasIds=r,this._updatedIds=o,!this.isLayerCanvasUpdated()){var x="---";m.join(x)===r.join(x)&&v.join(x)===o.join(x)||this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,i=t._getRenderer();return t.isCanvasRender()?i.testIfNeedRedraw():!(!i.needToRedraw||!i.needToRedraw())||(e.isInteracting()||this.isViewChanged())},i._drawCanvasLayerOnInteracting=function(t,e,i,n){var r=this.map,o=t._getRenderer(),s=o.getDrawTime(),a=0===i||i>0&&e+s<=i;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(n);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||a||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.checkAndDraw?o.checkAndDraw(o.drawOnInteracting,this._eventParam,n):o.drawOnInteracting(this._eventParam,n),s;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__zoomTransformMatrix=this._zoomMatrix)}return o.drawOnInteracting&&!a&&o.onSkipDrawOnInteracting(this._eventParam,n),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach((function(e){var i=t.getLayer(e);if(i){var n=i._getRenderer();n&&n.isRenderComplete()&&i.fire("layerload")}}))}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(t){var e=this.map;if(!e)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged())return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var i,n=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,o=t.length,s=[],a=0;a<o;a++){if(t[a].isVisible()&&t[a].isCanvasRender())if(t[a]._getRenderer()){var h=this._getLayerImage(t[a]);h&&h.image&&(t[a]===e.getBaseLayer()?i=[t[a],h]:s.push([t[a],h]))}}i&&(this._drawLayerCanvasImage(i[0],i[1]),this._drawFog()),o=s.length;for(var u=n&&r>=0&&o>r?o-r:0;u<o;u++)this._drawLayerCanvasImage(s[u][0],s[u][1]);return e._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){for(var t=this._getAllLayerToRender(),e=0,i=t.length;e<i;e++){var n=t[e].getRenderer();n&&n.canvas&&n.setToRedraw&&n.setToRedraw()}},i.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",i=t.height+"px",n=this.map._panels;n.mapWrapper.style.width=e,n.mapWrapper.style.height=i,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},i.toDataURL=function(t){return this.canvas?this.canvas.toDataURL(t):null},i.remove=function(){ue.webgl&&"undefined"!=typeof document&&je(document,"visibilitychange",this._thisVisibilitychange),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){for(var i=e._getLayers(),n="default",r=e.options.hitDetectLimit||0,o=0,s=i.length-1;s>=0;s--){var a=i[s];if(!(!a.options.hitDetect||a.isEmpty&&a.isEmpty())){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){n=a.options.cursor||"pointer";break}if(o++,r>0&&o>r)break}}}e._trySetCursor(n)}},i._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},i.initContainer=function(){var t=this.map._panels;function e(e,i,n,r){var o,s=Ae("div",i);return n&&(s.style.cssText=n),t[e]=s,r||((o=s).onselectstart=function(){return!1},o.ondragstart=function(){return!1},o.setAttribute("unselectable","on")),s}var i=this.map._containerDOM;if(!this._containerIsCanvas){i.innerHTML="";var n="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=e("allLayers","maptalks-all-layers",n+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),s=e("backStatic","maptalks-back-static",n+"z-index:0;",!0),a=e("back","maptalks-back",n+"z-index:1;"),h=e("backLayer","maptalks-back-layer",n),u=e("canvasContainer","maptalks-canvas-layer",n+"border:none;z-index:2;"),l=e("frontStatic","maptalks-front-static",n+"z-index:3;",!0),c=e("front","maptalks-front",n+"z-index:4;",!0),p=e("frontLayer","maptalks-front-layer",n+"z-index:0;"),f=e("ui","maptalks-ui",n+"border:none;z-index:1;",!0),d=e("control","maptalks-control","z-index:1",!0);i.appendChild(r),o.appendChild(s),a.appendChild(h),a.layerDOM=h,o.appendChild(a),o.appendChild(u),c.appendChild(p),c.layerDOM=p,c.uiDOM=f,o.appendChild(l),o.appendChild(c),c.appendChild(f),r.appendChild(o),r.appendChild(d),this.createCanvas(),this.resetContainer();var g=this.map._getContainerDomSize();this.updateMapSize(g)}},i.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!X(t,e),this._isViewChanged},i._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||X(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},i._frameLoop=function(t){var e=this;this.map?(this.renderFrame(t),this._animationFrame=w((function(t){e._frameLoop(t)}))):this._cancelFrameLoop()},i._cancelFrameLoop=function(){this._animationFrame&&b(this._animationFrame)},i._drawLayerCanvasImage=function(t,e){var i=this.context,n=e.point.round(),r=this.map.getDevicePixelRatio();1!==r&&n._multi(r);var o=e.image,s=o.width,a=o.height;if(!(n.x+s<=0||n.y+a<=0)){var h=t.options.opacity;if(c(h)||(h=1),!(h<=0)){var u=e.opacity;if(c(u)||(u=1),!(u<=0)){var l=i.globalAlpha;h<1&&(i.globalAlpha*=h),u<1&&(i.globalAlpha*=u),t.options.cssFilter&&(i.filter=t.options.cssFilter);var p=t.getRenderer(),f=p.__zoomTransformMatrix,d=p.clipCanvas(this.context);f&&(i.save(),i.setTransform.apply(i,f)),i.drawImage(o,0,0,s,a,n.x,n.y,s,a),f&&i.restore(),d&&i.restore(),"none"!==i.filter&&(i.filter="none"),i.globalAlpha=l}}}},i._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,i=new de(this.canvas.width/2,this.canvas.height/2);g(t)?t(e,i):oi.drawCross(this.context,i.x,i.y,2,"#f00")}},i._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),i=this.map.height-this.map._getVisualHeight(t[1]),n=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,n.ymin),r.lineTo(n.xmax,n.ymin),r.stroke(),r.beginPath(),r.moveTo(0,e),r.lineTo(n.xmax,e),r.stroke(),r.beginPath(),r.moveTo(0,i),r.lineTo(n.xmax,i),r.stroke()},i._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),i=this.context,n=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=n.ymin*e,s=Math.ceil(o-r),a=t.options.fogColor.join(),h=i.createLinearGradient(0,r,0,o+30),u=1-30/(s+30);h.addColorStop(0,"rgba("+a+", 0)"),h.addColorStop(.3,"rgba("+a+", 0.3)"),h.addColorStop(u,"rgba("+a+", 1)"),h.addColorStop(1,"rgba("+a+", 0)"),i.beginPath(),i.fillStyle=h,i.fillRect(0,r,Math.ceil(n.getWidth())*e,Math.ceil(s+30))}},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){this.canvas&&oi.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),i=this.canvas,n=t.getDevicePixelRatio();return(e.width*n!==i.width||e.height*n!==i.height)&&(i.height=n*e.height,i.width=n*e.width,i.style&&(i.style.width=e.width+"px",i.style.height=e.height+"px"),!0)},i.createCanvas=function(){this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=Ae("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._checkSize=function(){this.map&&!this.map.isInteracting()&&(He(this.map._containerDOM),this.map.checkSize())},i._setCheckSizeInterval=function(t){var e=this;clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval((function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()}),this._checkSizeInterval)},i._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!C&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),ue.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(e){t._eventParam=e})),e.on("_zooming",(function(i){e.getPitch()||(t._zoomMatrix=i.matrix.container),t._eventParam=i})),e.on("_zoomend",(function(e){t._eventParam=e,delete t._zoomMatrix})),e.on("_spatialreferencechange",(function(){t._spatialRefChanged=!0})),ue.webgl&&"undefined"!=typeof document&&Fe(document,"visibilitychange",this._thisVisibilitychange,this)},i._onMapMouseMove=function(t){var e=this,i=this.map;!i.isInteracting()&&i.options.hitDetect&&(this._hitDetectFrame&&b(this._hitDetectFrame),this._hitDetectFrame=w((function(){e.hitDetect(t.containerPoint)})))},i._getCanvasLayers=function(){return this.map._getLayers((function(t){return t.isCanvasRender()}))},i._onVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},e}(Oa);nr.registerRenderer("canvas",Ra),nr.mergeOptions({fog:!1,fogColor:[233,233,233]});var Na=Object.freeze({ResourceCache:ln,CanvasRenderer:un,ImageGLRenderable:Qs,MapRenderer:Oa,MapCanvasRenderer:Ra,Renderable:hn,ImageLayerCanvasRenderer:ia,ImageLayerGLRenderer:na,TileLayerCanvasRenderer:wa,TileLayerGLRenderer:Ca,CanvasTileLayerCanvasRenderer:Ea,CanvasTileLayerGLRenderer:Sa,OverlayLayerCanvasRenderer:Pa,VectorLayerCanvasRenderer:La,CanvasLayerRenderer:ra}),Aa={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLZoom())],null]}};br.include(Aa),Dr.include(Aa),Ar.include(Aa),Fr.include(Aa),kr.include({_getRenderPoints:function(t){var e=this.getMap();if("vertex"===t){for(var i=this._trimRing(this.getShell()),n=[],r=0,o=i.length;r<o;r++)n.push(e.coordToPoint(i[r],e.getGLZoom()));return[n,null]}return[[e.coordToPoint(this.getCenter(),e.getGLZoom())],null]}});var Da={_getRenderPoints:function(t){var e,i=this.getMap(),n=i.getGLZoom(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,n))&&e.length>0&&Array.isArray(e[0])){for(var o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)0===a?r.push([e[o][a],e[o][a+1]]):r.push([e[o][a-1],e[o][a]]);e=e[0].concat(e[1])}else for(var u=0,l=e.length;u<l;u++)0===u?r.push([e[u],e[u+1]]):r.push([e[u-1],e[u]]);else if("line"===t){e=[],r=[];var c=this._getPath2DPoints(this._getPrjCoordinates(),!1,n);if(c.length>0&&Array.isArray(c[0]))for(var p,f=1,d=c.length;f<d;f++){p=c[f],this instanceof xr&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(p[0]);for(var g=1,y=p.length;g<y;g++)e.push(p[g].add(p[g-1])._multi(.5)),r.push([p[g-1],p[g]])}else{this instanceof xr&&c.length>0&&!c[0].equals(c[c.length-1])&&c.push(c[0]);for(var _=1,m=c.length;_<m;_++)e.push(c[_].add(c[_-1])._multi(.5)),r.push([c[_-1],c[_]])}}else if("vertex-first"===t){var v=this._getPrjCoordinates();e=v.length?[i._prjToPoint(v[0],n)]:[],r=v.length?[[i._prjToPoint(v[0],n),i._prjToPoint(v[1],n)]]:[]}else if("vertex-last"===t){var x=this._getPrjCoordinates(),w=x.length;e=w?[i._prjToPoint(x[w-1],n)]:[];var b=w-1,C=w>1?w-2:w-1;r=w?[[i._prjToPoint(x[C],n),i._prjToPoint(x[b],n)]]:[]}else{var M=this._getProjection().project(this.getCenter());e=[i._prjToPoint(M,n)]}return[e,r]}};Mr.include(Da),xr.include(Da),Un.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var ka={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof Dr||this instanceof Fr},_paintAsPath:function(){var t=this.getMap();return this.getAltitude()>0||t.getPitch()||this instanceof Dr&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return xr.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),i=t._prjToPoint(e,t.getGLZoom()),n=this._getRenderSize(i);return[i].concat(n)},_paintOn:function(){return this._paintAsPath()?oi.polygon.apply(oi,arguments):oi.ellipse.apply(oi,arguments)},_getRenderSize:function(t){var e=this.getMap(),i=e.getGLZoom(),n=this._getPrjExtent(),r=e._prjToPoint(n.getMin(),i),o=e._prjToPoint(n.getMax(),i);return[Math.abs(o.x-r.x)/2,Math.abs(o.y-t.y),Math.abs(t.y-r.y)]}};function Fa(t,e,i,n,r){ja(t,e,i||0,n||t.length-1,r||za)}function ja(t,e,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,s=e-i+1,a=Math.log(o),h=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*h*(o-h)/o)*(s-o/2<0?-1:1);ja(t,e,Math.max(i,Math.floor(e-s*h/o+u)),Math.min(n,Math.floor(e+(o-s)*h/o+u)),r)}var l=t[e],c=i,p=n;for(Ga(t,i,e),r(t[n],l)>0&&Ga(t,i,n);c<p;){for(Ga(t,c,p),c++,p--;r(t[c],l)<0;)c++;for(;r(t[p],l)>0;)p--}0===r(t[i],l)?Ga(t,i,p):Ga(t,++p,n),p<=e&&(i=p+1),e<=p&&(n=p-1)}}function Ga(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function za(t,e){return t<e?-1:t>e?1:0}Dr.include(ka),Ar.include(ka),kr.include({_getPaintParams:function(){var t=this.getMap().getGLZoom(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t)]},_paintOn:oi.polygon}),Fr.include(ka,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return xr.prototype._getPaintParams.call(this,!0);var t=this.getMap(),e=t._prjToPoint(this._getPrjCoordinates(),t.getGLZoom());return[e,this._getRenderSize(e)[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return oi.polygon.apply(oi,arguments);var t=this.getMap().getBearing(),e=arguments;return t&&(e[3]=e[3].slice(0),e[3][0]+=t,e[3][1]+=t),oi.sector.apply(oi,e)}}),mr.include({_paintAsPath:function(){return!0}}),Mr.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,i,n,r){if(!t||!e||t.equals(e))return null;r||(r=0);var o,s=i*n[0],a=i*n[1]+r,h=s/2+r;(o=e.nextCtrlPoint||e.prevCtrlPoint?e.prevCtrlPoint?e.sub(new de(e.prevCtrlPoint)):e.sub(new de(e.nextCtrlPoint)):e.sub(t))._unit();var u=e.sub(o.multi(a));o._perp();var l=u.add(o.multi(h));return o._multi(-1),[l,e,u.add(o.multi(h)),l]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLZoom())]},_paintOn:function(t,e,i,n,r){this.options.smoothness?oi.paintSmoothLine(t,e,i,this.options.smoothness,!1,this._animIdx,this._animTailRatio):oi.path(t,e,i,null,r),this._paintArrow(t,e,i)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,i){var n=this._getArrowStyle();if(!n||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0])?t:[t],o=this._getArrowPlacement(),s=[],a=this.getMap(),h=a.coordToContainerPoint(this.getFirstCoordinate()),u=a.coordToContainerPoint(this.getLastCoordinate()),l=r.length-1;l>=0;l--){if("vertex-first"===o||"vertex-firstlast"===o&&r[l][0].closeTo(h,.01)){var c=this._getArrowShape(r[l][1],r[l][0],e,n,i);c&&s.push(c)}if("vertex-last"===o||"vertex-firstlast"===o&&r[l][r[l].length-1].closeTo(u,.01)){var p=this._getArrowShape(r[l][r[l].length-2],r[l][r[l].length-1],e,n,i);p&&s.push(p)}else"point"===o&&this._getArrowPoints(s,r[l],e,n,i)}return s},_getArrowPoints:function(t,e,i,n,r){for(var o=0,s=e.length-1;o<s;o++){var a=this._getArrowShape(e[o],e[o+1],i,n,r);a&&t.push(a)}},_paintArrow:function(t,e,i){var n=this._getInternalSymbol().lineWidth;(!c(n)||n<3)&&(n=3);var r=this._getArrows(e,n);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,oi.polygon(t,r[o],i,i)}}}),xr.include({_getPaintParams:function(t){var e=this.getMap().getGLZoom(),i=this._getPrjShell(),n=this._getPath2DPoints(i,t,e),r=n.length>0&&Array.isArray(n[0]);r&&(n=[[n[0]],[n[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0){for(var a=this._simplified,h=0;h<o.length;h++){var u=this._getPath2DPoints(o[h],t,e);Array.isArray(u)&&r?Array.isArray(u[0])?(n[0].push(u[0]),n[1].push(u[1])):n[0].push(u):s.push(u)}a&&(this._simplified=a)}return r||L(n=[n],s),[n]},_paintOn:function(t,e,i,n,r){oi.polygon(t,e,i,n,r,this.options.smoothness)}}),nr.VERSION="0.2.3";class Ba{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!$a(t,e))return i;const n=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const s=e.children[o],a=e.leaf?n(s):s;$a(t,a)&&(e.leaf?i.push(s):Ka(t,a)?this._all(s,i):r.push(s))}e=r.pop()}return i}collides(t){let e=this.data;if(!$a(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const r=e.children[n],o=e.leaf?this.toBBox(r):r;if($a(t,o)){if(e.leaf||Ka(t,o))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=th([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),r=[],o=[];let s,a,h;for(;i||r.length;){if(i||(i=r.pop(),a=r[r.length-1],s=o.pop(),h=!0),i.leaf){const n=Va(t,i.children,e);if(-1!==n)return i.children.splice(n,1),r.push(i),this._condense(r),this}h||i.leaf||!Ka(i,n)?a?(s++,i=a.children[s],h=!1):i=null:(r.push(i),o.push(s),s=0,a=i,i=i.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const r=i-e+1;let o,s=this._maxEntries;if(r<=s)return o=th(t.slice(e,i+1)),Ha(o,this.toBBox),o;n||(n=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,n-1))),o=th([]),o.leaf=!1,o.height=n;const a=Math.ceil(r/s),h=a*Math.ceil(Math.sqrt(s));eh(t,e,i,h,this.compareMinX);for(let r=e;r<=i;r+=h){const e=Math.min(r+h-1,i);eh(t,r,e,a,this.compareMinY);for(let i=r;i<=e;i+=a){const r=Math.min(i+a-1,e);o.children.push(this._build(t,i,r,n-1))}}return Ha(o,this.toBBox),o}_chooseSubtree(t,e,i,n){for(;n.push(e),!e.leaf&&n.length-1!==i;){let i,n=1/0,r=1/0;for(let o=0;o<e.children.length;o++){const s=e.children[o],a=Ya(s),h=Ja(t,s)-a;h<r?(r=h,n=a<n?a:n,i=s):h===r&&a<n&&(n=a,i=s)}e=i||e.children[0]}return e}_insert(t,e,i){const n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),Za(o,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)}_split(t,e){const i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),s=th(i.children.splice(o,i.children.length-o));s.height=i.height,s.leaf=i.leaf,Ha(i,this.toBBox),Ha(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(i,s)}_splitRoot(t,e){this.data=th([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ha(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,r=1/0,o=1/0;for(let s=e;s<=i-e;s++){const e=qa(t,0,s,this.toBBox),a=qa(t,s,i,this.toBBox),h=Qa(e,a),u=Ya(e)+Ya(a);h<r?(r=h,n=s,o=u<o?u:o):h===r&&u<o&&(o=u,n=s)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:Ua,r=t.leaf?this.compareMinY:Wa;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,r)&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const r=this.toBBox,o=qa(t,0,e,r),s=qa(t,i-e,i,r);let a=Xa(o)+Xa(s);for(let n=e;n<i-e;n++){const e=t.children[n];Za(o,t.leaf?r(e):e),a+=Xa(o)}for(let n=i-e-1;n>=e;n--){const e=t.children[n];Za(s,t.leaf?r(e):e),a+=Xa(s)}return a}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)Za(e[n],t)}_condense(t){for(let e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children,e.splice(e.indexOf(t[i]),1)):this.clear():Ha(t[i],this.toBBox)}}function Va(t,e,i){if(!i)return e.indexOf(t);for(let n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function Ha(t,e){qa(t,0,t.children.length,e,t)}function qa(t,e,i,n,r){r||(r=th(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<i;o++){const e=t.children[o];Za(r,t.leaf?n(e):e)}return r}function Za(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Ua(t,e){return t.minX-e.minX}function Wa(t,e){return t.minY-e.minY}function Ya(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Xa(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ja(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function Qa(t,e){const i=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-i)*Math.max(0,o-n)}function Ka(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function $a(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function th(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function eh(t,e,i,n,r){const o=[e,i];for(;o.length;){if((i=o.pop())-(e=o.pop())<=n)continue;const s=e+Math.ceil((i-e)/n/2)*n;Fa(t,s,e,i,r),o.push(e,s,s,i)}}const ih={highlightLayer:{id:`${e}highlight`,zIndex:100,geometryEvents:!1},flashLayer:{id:`${e}falsh`,zIndex:100,geometryEvents:!1},animateLayer:{id:`${e}animate`,zIndex:100,geometryEvents:!1},antsLayer:{id:`${e}ants`,zIndex:100,geometryEvents:!1},imgAntsLayer:{id:`${e}imgAnts`,zIndex:100,geometryEvents:!1},identifyCount:5,flashCount:1e3,typhoon:{strong:[{name:"热带低压",level:[6,7],color:"limegreen"},{name:"热带风暴",level:[8,9],color:"dodgerblue"},{name:"强热带风暴",level:[10,11],color:"yellow"},{name:"台风",level:[12,13],color:"goldenrod"},{name:"强台风",level:[14,15],color:"violet"},{name:"超强台风",level:[16,17,18,19,20,21,22],color:"red"}],playRate:60},maxZoom:20,declutterSymbolItems:["markerWidth","markerHeight","textSize","textHorizontalAlignment","textVerticalAlignment"]},nh={lineDxDySymbol:{default:{lineDx:0,lineDy:0},identity:{lineDx:{property:"lineDx",type:"identity",default:0},lineDy:{property:"lineDy",type:"identity",default:0}}},station:{hightlight:{on:{markerWidth:30,markerHeight:30},off:{markerWidth:20,markerHeight:20}}}},rh={LAYER_NOTIN_MAP:"图层未加载到地图",NONE_ORDER_LAYERS:"避让排序图层组为空",NONE_MAP:"地图未初始化",REPEATED_LAYERNAME:"重复的图层名称",INVALID_STYLE:"无效的样式",INVALID_EVENT_TYPE:"无效的事件类型（添加click事件请使用addClickEvent接口）",INVALID_SAMPlE_DATA_KRIGING:"采样点个数不足，无法差值",INVALID_BOUNDARY_DATA_KRIGING:"无效的边界数据格式，应为MultiPolygon|Polygon|FeatureCollection(MultiPolygon|Polygon)"};class oh{static mapSource2projection(t){let e="EPSG:3857";return"baidu"===t&&(e=t),e}static deepClone(t){let e=JSON.stringify(t);return JSON.parse(e)}static deepCloneObj(t){if(null===t)return null;if("object"!==t.constructor)return t;if(t.constructor===Date)return new Date(t);if(t.constructor===RegExp)return new RegExp(t);var e=new t.constructor;for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];e[i]="object"==typeof n?arguments.callee(n):n}return e}static deepCloneArray(t){let e=JSON.stringify(t);return JSON.parse(e)}static getMarkerBox_bak(t,e){let i={minX:NaN,maxX:NaN,minY:NaN,maxY:NaN},n=t.getSize();if(!n)return i;let r=n.width,o=n.height;if(!t.getCoordinates())return i;let s=e.coordinateToContainerPoint(t.getCoordinates()),a=s.x,h=s.y;return i.minX=Math.round(a-r/2),i.maxX=Math.round(a+r/2),i.minY=Math.round(h-o/2),i.maxY=Math.round(h+o/2),i}static getMarkerBox(t,e,i){let n={minX:NaN,maxX:NaN,minY:NaN,maxY:NaN};return i?(n.minX=Math.round(t-i.width/2),n.maxX=Math.round(t+i.width/2),n.minY=Math.round(e-i.height/2),n.maxY=Math.round(e+i.height),n):n}static getMarkerWithBottomTextBox(t,e,i,n){let r={minX:NaN,maxX:NaN,minY:NaN,maxY:NaN};if(!i)return r;const o=i.height+n.height+2*n.haloRadius,s=i.width>n.width?i.width:n.width;return r.minX=Math.round(t-s/2),r.maxX=Math.round(t+s/2),r.minY=Math.round(e-i.height/2),r.maxY=Math.round(e+o),r}static getBBox(t,e,i,n,r){let o={id:t,minX:NaN,maxX:NaN,minY:NaN,maxY:NaN,declutterFlag:"show"};n.height,n.dy;const s=n.width>r.width?n.width:r.width;return o.minX=Math.round(e-s/2),o.maxX=Math.round(e+s/2),o.minY=Math.round(i-n.height+n.dy),o.maxY=Math.round(i+r.dy+r.height/2),o}static getTrueLength(t){let e=t.length,i=0;for(let n=0;n<e;n++)t.charCodeAt(n)>128?i+=2:i+=1;return i}static getSymbolValue(t,e){if(Array.isArray(t)){for(let i=0;i<t.length;i++){const n=t[i][e];if(n)return n}return null}return t[e]}static delSomeSymbol(t,e){if(t&&Array.isArray(t)){t=t.map((t=>t.class===e?null:t));let i=t.filter(Boolean);return 0===i.length&&(i=null),i}return null}static updateSymbol(t,e,i){let n=[];n=t?Array.isArray(t)?t:[t]:[],Object.assign(e,{class:i});let r=n.find((t=>t.class===i));return r?Object.assign(r,e):n=n.concat(e),n}static delSymbol(t,e){if(!t)return null;let i=[];return i=Array.isArray(t)?this.deepClone(t):[this.deepCloneObj(t)],i=i.filter((t=>t.class!==e)),0===i.length&&(i=null),i}static getArrayCount(t){for(var e=[],i=1,n=0;n<t.length;n++)if(t[n]instanceof Array)for(var r=0;r<t[n].length;r++)e.push(t[n][r]);return e.length&&(i=1,i+=this.getArrayCount(e)),i}static getGeoCount(t){return t?++this.GEO_COUNT:this.GEO_COUNT}static excuteDeclutter(t,e,i=!0){}static excuteDeclutterbak(t,e,i=!0){if(0===t.length)return void console.warn(rh.NONE_ORDER_LAYERS);let n=new Ba;n.clear();let r=e.getLayers((e=>t.includes(e.getId()))).filter((t=>t.isVisible())),o=oh.deepCloneArray(t).reverse();const s={type:"categorical",default:"center",property:"__declutter",stops:[["bottom","center"],["right","right"],["left","left"]]},a={type:"categorical",default:"middle",property:"__declutter",stops:[["bottom","bottom"]]};for(let t=0;t<o.length;t++){let h=r.find((e=>e.getId()===o[t]));if(!h||!h.getStyle()||!h.getStyle().symbolBak)continue;const u=h.options.style.symbolBak,l=u.markerWidth,c=u.markerHeight;if(!l||0===l||!c||0===c||"number"!=typeof l||"number"!=typeof c)continue;let p=u.textName,f="",d="",g=28,y=0;"string"==typeof p&&(p.startsWith("{")&&p.endsWith("}")&&(f=p.slice(1,-1)),g=u.textSize||28,y=u.textHaloRadius||0);const _={type:"categorical",default:0,property:"__declutter",stops:[["bottom",g],["right",g],["left",g]]},m={type:"categorical",default:l,property:"__declutter",stops:[["hide",0]]},v={type:"categorical",default:c,property:"__declutter",stops:[["hide",0]]},x=h.getStyle();Object.assign(x.symbol,{markerWidth:m,markerHeight:v,textSize:_,textHorizontalAlignment:s,textVerticalAlignment:a}),h.setStyle(x);const w=h.getGeometries().sort(((t,e)=>t.getId()-e.getId()));w.forEach((t=>{if(t instanceof br&&t.isVisible()){t.setZIndexSilently(0);let r="",o=e.coordinateToContainerPoint(t.getCoordinates()),s=o.x,a=o.y;if("string"!=typeof p){let t=oh.getMarkerBox(s,a,{width:l,height:c});0!==n.search(t).length?r="hideWithOutText":(r="showWithOutText",n.insert(t))}else if(i){let e=oh.getMarkerBox(s,a,{width:l,height:c});if(0!==n.search(e).length)r="hide";else{d=f.length>0?t.getProperties()[f]:d;const e=this.getTrueLength(d)/2*g;let i=oh.getMarkerWithBottomTextBox(s,a,{width:l,height:c},{width:e,height:g,haloRadius:y});0!==n.search(i).length?(r="hideText",t.setZIndexSilently(-1)):(r="bottom",n.insert(i))}}else{d=f.length>0?t.getProperties()[f]:d;const e=this.getTrueLength(d)/2*g;let i=oh.getMarkerWithBottomTextBox(s,a,{width:l,height:c},{width:e,height:g,haloRadius:y});0!==n.search(i).length?r="hide":(r="bottom",n.insert(i))}t.setProperties(Object.assign(t.getProperties(),{__declutter:r}))}}))}}static closeDeclutter(t,e){}static isInZoomInterval(t,e){return e.getMaxZoom()>=t&&e.getMinZoom()<=t}}oh.GEO_COUNT=0;class sh extends to{constructor(t,e,i){super(t,e,i=Object.assign({fitExtent:!1},i)),this._events={mouseover:new Map,mouseout:new Map,click:new Map,mouseenter:new Map},this._geoType=i.geoType,this._fitExtent=i.fitExtent;let n=this;if(this._geoOutCallback=function(t){n._events.mouseout.forEach((e=>{e.on&&e.callback(t.target,t.coordinate)}))},this._geoEnterCallback=function(t){n._events.mouseenter.forEach((e=>{e.on&&e.callback(t.target,t.coordinate)}))},this._geoOverCallback=function(t){n._events.mouseover.forEach((e=>{e.on&&e.callback(t.target,t.coordinate)}))},i&&i.style){i.style.symbolBak=Object.assign({},i.style.symbol),i.style.hoverSymbol&&(i.style.hoverSymbol=Object.assign({},i.style.symbolBak,i.style.hoverSymbol),n.addEvent("mouseenter",(t=>{const e=oh.updateSymbol(t.getSymbol(),i.style.hoverSymbol,"hoverSymbol");t.setSymbol(e)}),"hoverSymbol"),n.addEvent("mouseout",(t=>{const e=oh.delSymbol(t.getSymbol(),"hoverSymbol");t.setSymbol(e)}),"hoverSymbol"));let t=i.style.clickSymbol;t&&(i.style.clickSymbol=Object.assign({},i.style.symbolBak,i.style.clickSymbol),n.addClickEvent((e=>{const i=n.getMap();i&&e.forEach((e=>{const n=oh.updateSymbol(e.getSymbol(),t,"clickSymbol");e.setSymbol(n),i._clickGeos.push(e)}))}),"clickSymbol"))}n._setIdAndEvents(),n.on("addgeo",(()=>{n._setIdAndEvents()}));let r=i.tipContent;if(r){const t=/\{\{(.+?)\}\}/g;let e=r.match(t);e&&e.length>0&&(n.addEvent("mouseenter",((t,i)=>{const o=n.getMap();if(t){let n=r;e&&e.length>0&&(e.forEach((e=>{let i=t.getProperties()[e.replace("{{","").replace("}}","")];i&&(n=n.replace(e,i))})),o._tip.setContent(n),o._tip.setCoordinates(i),o._tip.isVisible()||o._tip.show())}}),"tipContent"),n.addEvent("mouseout",(()=>{n.getMap()._tip.hide()}),"tipContent"))}}highlight(t,e){let i=this.getGeos(e);return i.forEach((e=>{const i=Object.assign({},this.getStyle().symbolBak,t),n=oh.updateSymbol(this.getStyle().symbol,i,"highlight");e.setSymbol(n)})),i}removeHighlight(t){let e=this.getGeos(t);return e.forEach((t=>{const e=oh.delSymbol(t.getSymbol(),"highlight");t.setSymbol(e)})),e}flash(t,e,i={count:1e3,interVal:500}){let n=this.getGeos(e);return n.forEach((e=>{if(t){const i=oh.updateSymbol(this.getStyle().symbol,t,"flash");e.setSymbol(i)}e.flash(i.interVal,i.count)})),n}removeFlash(t){let e=this.getGeos(t);return e.forEach((t=>{t.flash(100,1);const e=oh.delSymbol(t.getSymbol(),"flash");t.setSymbol(e)})),e}animate(t,e,i,n={duration:500,repeat:!0}){let r=this.getGeos(i);return r.forEach((i=>{const r=Object.assign({},this.getStyle().symbolBak,t),o=Object.assign({},this.getStyle().symbolBak,e);i.setSymbol(r),i.animate({symbol:o},n)})),r}removeAnimate(t){let e=this.getGeos(t);return e.forEach((t=>{t._animPlayer.finish();const e=oh.delSymbol(t.getSymbol(),"animate");t.setSymbol(e)})),e}highlightInCover(t,e){let i=this.getGeos(e,"highlight");const n=this;return i.forEach((e=>{const i=Object.assign({},n.getStyle().symbolBak,t);e.setSymbol(i)})),i}flashInCover(t,e,i={count:1e3,interVal:300}){let n=this.getGeos(e,"flash");return n.forEach((e=>{e.setSymbol(t),e.flash(i.interVal,i.count)})),n}animateInCover(t,e,i,n={duration:500,repeat:!0}){let r=this.getGeos(i,"animate");return r.forEach((i=>{i.setSymbol(t),i.animate({symbol:e},n)})),r}removeInCover(t,e){this.getMap().removeCover(this.getId(),t,e)}addEvent(t,e,i){let n=new Map;switch(t){case"mouseover":n=this._events.mouseover;break;case"mouseout":n=this._events.mouseout;break;case"mouseenter":n=this._events.mouseenter;break;default:throw new Error(rh.INVALID_EVENT_TYPE)}i=i||e.name,n.set(i,{on:!0,callback:e})}addClickEvent(t,e){let i=this._events.click;e=e||t.name,i.set(e,{on:!0,callback:t})}removeEvent(t,e){let i=new Map;switch(t){case"mouseover":i=this._events.mouseover;break;case"mouseout":i=this._events.mouseout;break;case"mouseenter":i=this._events.mouseenter;break;case"click":i=this._events.click;break;default:throw new Error(rh.INVALID_EVENT_TYPE)}i.delete(e)}onOffEvent(t,e,i){let n=new Map;switch(t){case"mouseover":n=this._events.mouseover;break;case"mouseout":n=this._events.mouseout;break;case"mouseenter":n=this._events.mouseenter;break;case"click":n=this._events.click;break;default:throw new Error(rh.INVALID_EVENT_TYPE)}n.get(e).on=i}_setIdAndEvents(){let t=this;t.forEach((e=>{e.getId()||(e.setId(oh.getGeoCount(!0)),e.off("mouseover",t._geoOverCallback),e.on("mouseover",t._geoOverCallback),e.off("mouseout",t._geoOutCallback),e.on("mouseout",t._geoOutCallback),e.off("mouseenter",t._geoEnterCallback),e.on("mouseenter",t._geoEnterCallback))}))}cover(t,e){let i=this,n=i.getMap();if(!n)return console.error(rh.LAYER_NOTIN_MAP),[];let r=[];const o=n._interLayers.get(t);if(!o)return[];let s=[];return s=e?"function"==typeof e?this.filter(e):e:this.getGeometries(),s.forEach((e=>{let n=e.copy(),s={};Object.assign(s,{coverType:t,layerId:i.getId()}),n.config(s),n.getId()&&o.removeGeometry(n.getId()),o.addGeometry(n),r.push(n)})),r}getGeos(t,e){let i=[];return i=e?this.cover(e,t):"function"==typeof t?this.filter(t):Array.isArray(t)?t:this.getGeometries(),i}}class ah extends sh{constructor(t,e,i){super(t,e,i);this.forEach((t=>{t._declutterShowHideFlag=!0,t._showHideFlag=!0,Object.defineProperty(t,"declutterShowHideFlag",{get:function(){return t._declutterShowHideFlag},set:function(e){e!==t._declutterShowHideFlag&&(e&&t._showHideFlag?t.show():t.hide()),t._declutterShowHideFlag=e}}),Object.defineProperty(t,"showHideFlag",{get:function(){return t._showHideFlag},set:function(e){e!==t._showHideFlag&&(e&&t._declutterShowHideFlag?t.show():t.hide()),t._showHideFlag=e}})}))}}var hh=6371008.8,uh={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*hh,kilometers:6371.0088,kilometres:6371.0088,meters:hh,metres:hh,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:hh/1852,radians:1,yards:6967335.223679999};function lh(t,e,i){void 0===i&&(i={});var n={type:"Feature"};return(0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function ch(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vh(t[0])||!vh(t[1]))throw new Error("coordinates must contain numbers");return lh({type:"Point",coordinates:t},e,i)}function ph(t,e,i){void 0===i&&(i={});for(var n=0,r=t;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return lh({type:"Polygon",coordinates:t},e,i)}function fh(t,e,i){if(void 0===i&&(i={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return lh({type:"LineString",coordinates:t},e,i)}function dh(t,e){void 0===e&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function gh(t,e,i){return void 0===i&&(i={}),lh({type:"MultiPolygon",coordinates:t},e,i)}function yh(t,e){void 0===e&&(e="kilometers");var i=uh[e];if(!i)throw new Error(e+" units is invalid");return t*i}function _h(t,e){void 0===e&&(e="kilometers");var i=uh[e];if(!i)throw new Error(e+" units is invalid");return t/i}function mh(t){return t%360*Math.PI/180}function vh(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function xh(t){return!!t&&t.constructor===Object}function wh(t,e,i){if(null!==t)for(var n,r,o,s,a,h,u,l,c=0,p=0,f=t.type,d="FeatureCollection"===f,g="Feature"===f,y=d?t.features.length:1,_=0;_<y;_++){a=(l=!!(u=d?t.features[_].geometry:g?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var m=0;m<a;m++){var v=0,x=0;if(null!==(s=l?u.geometries[m]:u)){h=s.coordinates;var w=s.type;switch(c=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(h,p,_,v,x))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(!1===e(h[n],p,_,v,x))return!1;p++,"MultiPoint"===w&&v++}"LineString"===w&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(r=0;r<h[n].length-c;r++){if(!1===e(h[n][r],p,_,v,x))return!1;p++}"MultiLineString"===w&&v++,"Polygon"===w&&x++}"Polygon"===w&&v++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(x=0,r=0;r<h[n].length;r++){for(o=0;o<h[n][r].length-c;o++){if(!1===e(h[n][r][o],p,_,v,x))return!1;p++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===wh(s.geometries[n],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function bh(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var i=0;i<t.features.length&&!1!==e(t.features[i],i);i++);}function Ch(t,e){var i,n,r,o,s,a,h,u,l,c,p=0,f="FeatureCollection"===t.type,d="Feature"===t.type,g=f?t.features.length:1;for(i=0;i<g;i++){for(a=f?t.features[i].geometry:d?t.geometry:t,u=f?t.features[i].properties:d?t.properties:{},l=f?t.features[i].bbox:d?t.bbox:void 0,c=f?t.features[i].id:d?t.id:void 0,s=(h=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=h?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,u,l,c))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,u,l,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,u,l,c))return!1;p++}}function Mh(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Eh(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Sh(t,e,i){if(!t)throw new Error("No featureCollection passed");if(!i)throw new Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw new Error("Invalid input to "+i+", FeatureCollection required");for(var n=0,r=t.features;n<r.length;n++){var o=r[n];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!o.geometry||o.geometry.type!==e)throw new Error("Invalid input to "+i+": must be a "+e+", given "+o.geometry.type)}}function Ph(t){return"Feature"===t.type?t.geometry:t}function Ih(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}function Th(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Lh(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(i){switch(i){case"type":case"features":return;default:e[i]=t[i]}})),e.features=t.features.map((function(t){return Lh(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Rh(t);default:throw new Error("unknown GeoJSON type")}}function Lh(t){var e={type:"Feature"};return Object.keys(t).forEach((function(i){switch(i){case"type":case"properties":case"geometry":return;default:e[i]=t[i]}})),e.properties=Oh(t.properties),e.geometry=Rh(t.geometry),e}function Oh(t){var e={};return t?(Object.keys(t).forEach((function(i){var n=t[i];"object"==typeof n?null===n?e[i]=null:Array.isArray(n)?e[i]=n.map((function(t){return t})):e[i]=Oh(n):e[i]=n})),e):e}function Rh(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return Rh(t)})),e):(e.coordinates=Nh(t.coordinates),e)}function Nh(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return Nh(t)}))}function Ah(t,e,i,n){void 0===n&&(n={});var r=e<0,o=function(t,e,i){if(void 0===e&&(e="kilometers"),void 0===i&&(i="kilometers"),!(t>=0))throw new Error("length must be a positive number");return yh(_h(t,e),i)}(Math.abs(e),n.units,"meters");r&&(o=-Math.abs(o));var s=Mh(t),a=function(t,e,i,n){n=void 0===n?hh:Number(n);var r=e/n,o=t[0]*Math.PI/180,s=mh(t[1]),a=mh(i),h=r*Math.cos(a),u=s+h;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var l=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(l)>1e-11?h/l:Math.cos(s),p=r*Math.sin(a)/c;return[(180*(o+p)/Math.PI+540)%360-180,180*u/Math.PI]}(s,o,i);return a[0]+=a[0]-s[0]>180?-360:s[0]-a[0]>180?360:0,ch(a,n.properties)}function Dh(t,e,i){if(void 0===i&&(i={}),!0===i.final)return function(t,e){var i=Dh(e,t);return i=(i+180)%360}(t,e);var n=Mh(t),r=Mh(e),o=mh(n[0]),s=mh(r[0]),a=mh(n[1]),h=mh(r[1]),u=Math.sin(s-o)*Math.cos(h),l=Math.cos(a)*Math.sin(h)-Math.sin(a)*Math.cos(h)*Math.cos(s-o);return function(t){return t%(2*Math.PI)*180/Math.PI}(Math.atan2(u,l))}var kh,Fh=Object.prototype.toString,jh=function(t){var e=Fh.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===Fh.call(t.callee)),i};if(!Object.keys){var Gh=Object.prototype.hasOwnProperty,zh=Object.prototype.toString,Bh=jh,Vh=Object.prototype.propertyIsEnumerable,Hh=!Vh.call({toString:null},"toString"),qh=Vh.call((function(){}),"prototype"),Zh=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Uh=function(t){var e=t.constructor;return e&&e.prototype===t},Wh={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Yh=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!Wh["$"+t]&&Gh.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{Uh(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();kh=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===zh.call(t),n=Bh(t),r=e&&"[object String]"===zh.call(t),o=[];if(!e&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var s=qh&&i;if(r&&t.length>0&&!Gh.call(t,0))for(var a=0;a<t.length;++a)o.push(String(a));if(n&&t.length>0)for(var h=0;h<t.length;++h)o.push(String(h));else for(var u in t)s&&"prototype"===u||!Gh.call(t,u)||o.push(String(u));if(Hh)for(var l=function(t){if("undefined"==typeof window||!Yh)return Uh(t);try{return Uh(t)}catch(t){return!1}}(t),c=0;c<Zh.length;++c)l&&"constructor"===Zh[c]||!Gh.call(t,Zh[c])||o.push(Zh[c]);return o}}var Xh=kh,Jh=Array.prototype.slice,Qh=Object.keys,Kh=Qh?function(t){return Qh(t)}:Xh,$h=Object.keys;Kh.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return jh(t)?$h(Jh.call(t)):$h(t)})}else Object.keys=Kh;return Object.keys||Kh};var tu,eu=Kh,iu=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0},nu=function(){return iu()&&!!Symbol.toStringTag},ru="undefined"!=typeof Symbol&&Symbol,ou="Function.prototype.bind called on incompatible ",su=Array.prototype.slice,au=Object.prototype.toString,hu="[object Function]",uu=Function.prototype.bind||function(t){var e=this;if("function"!=typeof e||au.call(e)!==hu)throw new TypeError(ou+e);for(var i,n=su.call(arguments,1),r=function(){if(this instanceof i){var r=e.apply(this,n.concat(su.call(arguments)));return Object(r)===r?r:this}return e.apply(t,n.concat(su.call(arguments)))},o=Math.max(0,e.length-n.length),s=[],a=0;a<o;a++)s.push("$"+a);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(r),e.prototype){var h=function(){};h.prototype=e.prototype,i.prototype=new h,h.prototype=null}return i},lu=uu.call(Function.call,Object.prototype.hasOwnProperty),cu=SyntaxError,pu=Function,fu=TypeError,du=function(t){try{return pu('"use strict"; return ('+t+").constructor;")()}catch(t){}},gu=Object.getOwnPropertyDescriptor;if(gu)try{gu({},"")}catch(t){gu=null}var yu=function(){throw new fu},_u=gu?function(){try{return yu}catch(t){try{return gu(arguments,"callee").get}catch(t){return yu}}}():yu,mu="function"==typeof ru&&"function"==typeof Symbol&&"symbol"==typeof ru("foo")&&"symbol"==typeof Symbol("bar")&&iu(),vu=Object.getPrototypeOf||function(t){return t.__proto__},xu={},wu="undefined"==typeof Uint8Array?tu:vu(Uint8Array),bu={"%AggregateError%":"undefined"==typeof AggregateError?tu:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?tu:ArrayBuffer,"%ArrayIteratorPrototype%":mu?vu([][Symbol.iterator]()):tu,"%AsyncFromSyncIteratorPrototype%":tu,"%AsyncFunction%":xu,"%AsyncGenerator%":xu,"%AsyncGeneratorFunction%":xu,"%AsyncIteratorPrototype%":xu,"%Atomics%":"undefined"==typeof Atomics?tu:Atomics,"%BigInt%":"undefined"==typeof BigInt?tu:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?tu:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?tu:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?tu:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?tu:FinalizationRegistry,"%Function%":pu,"%GeneratorFunction%":xu,"%Int8Array%":"undefined"==typeof Int8Array?tu:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?tu:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?tu:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":mu?vu(vu([][Symbol.iterator]())):tu,"%JSON%":"object"==typeof JSON?JSON:tu,"%Map%":"undefined"==typeof Map?tu:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&mu?vu((new Map)[Symbol.iterator]()):tu,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?tu:Promise,"%Proxy%":"undefined"==typeof Proxy?tu:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?tu:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?tu:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&mu?vu((new Set)[Symbol.iterator]()):tu,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?tu:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":mu?vu(""[Symbol.iterator]()):tu,"%Symbol%":mu?Symbol:tu,"%SyntaxError%":cu,"%ThrowTypeError%":_u,"%TypedArray%":wu,"%TypeError%":fu,"%Uint8Array%":"undefined"==typeof Uint8Array?tu:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?tu:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?tu:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?tu:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?tu:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?tu:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?tu:WeakSet},Cu=function t(e){var i;if("%AsyncFunction%"===e)i=du("async function () {}");else if("%GeneratorFunction%"===e)i=du("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=du("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&(i=vu(r.prototype))}return bu[e]=i,i},Mu={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Eu=uu.call(Function.call,Array.prototype.concat),Su=uu.call(Function.apply,Array.prototype.splice),Pu=uu.call(Function.call,String.prototype.replace),Iu=uu.call(Function.call,String.prototype.slice),Tu=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Lu=/\\(\\)?/g,Ou=function(t){var e=Iu(t,0,1),i=Iu(t,-1);if("%"===e&&"%"!==i)throw new cu("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new cu("invalid intrinsic syntax, expected opening `%`");var n=[];return Pu(t,Tu,(function(t,e,i,r){n[n.length]=i?Pu(r,Lu,"$1"):e||t})),n},Ru=function(t,e){var i,n=t;if(lu(Mu,n)&&(n="%"+(i=Mu[n])[0]+"%"),lu(bu,n)){var r=bu[n];if(r===xu&&(r=Cu(n)),void 0===r&&!e)throw new fu("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new cu("intrinsic "+t+" does not exist!")},Nu=function(t,e){if("string"!=typeof t||0===t.length)throw new fu("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new fu('"allowMissing" argument must be a boolean');var i=Ou(t),n=i.length>0?i[0]:"",r=Ru("%"+n+"%",e),o=r.name,s=r.value,a=!1,h=r.alias;h&&(n=h[0],Su(i,Eu([0,1],h)));for(var u=1,l=!0;u<i.length;u+=1){var c=i[u],p=Iu(c,0,1),f=Iu(c,-1);if(('"'===p||"'"===p||"`"===p||'"'===f||"'"===f||"`"===f)&&p!==f)throw new cu("property names with quotes must have matching quotes");if("constructor"!==c&&l||(a=!0),lu(bu,o="%"+(n+="."+c)+"%"))s=bu[o];else if(null!=s){if(!(c in s)){if(!e)throw new fu("base intrinsic for "+t+" exists, but the property is not available.");return}if(gu&&u+1>=i.length){var d=gu(s,c);s=(l=!!d)&&"get"in d&&!("originalValue"in d.get)?d.get:s[c]}else l=lu(s,c),s=s[c];l&&!a&&(bu[o]=s)}}return s};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Au(t,e){return t(e={exports:{}},e.exports),e.exports}var Du=Au((function(t){var e=Nu("%Function.prototype.apply%"),i=Nu("%Function.prototype.call%"),n=Nu("%Reflect.apply%",!0)||uu.call(i,e),r=Nu("%Object.getOwnPropertyDescriptor%",!0),o=Nu("%Object.defineProperty%",!0),s=Nu("%Math.max%");if(o)try{o({},"a",{value:1})}catch(t){o=null}t.exports=function(t){var e=n(uu,i,arguments);if(r&&o){var a=r(e,"length");a.configurable&&o(e,"length",{value:1+s(0,t.length-(arguments.length-1))})}return e};var a=function(){return n(uu,e,arguments)};o?o(t.exports,"apply",{value:a}):t.exports.apply=a}));Du.apply;var ku=Du(Nu("String.prototype.indexOf")),Fu=function(t,e){var i=Nu(t,!!e);return"function"==typeof i&&ku(t,".prototype.")>-1?Du(i):i},ju=nu(),Gu=Fu("Object.prototype.toString"),zu=function(t){return!(ju&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===Gu(t)},Bu=function(t){return!!zu(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==Gu(t)&&"[object Function]"===Gu(t.callee)},Vu=function(){return zu(arguments)}();zu.isLegacyArguments=Bu;var Hu=Vu?zu:Bu,qu=Nu("%Object.defineProperty%",!0),Zu=function(){if(qu)try{return qu({},"a",{value:1}),!0}catch(t){return!1}return!1};Zu.hasArrayLengthDefineBug=function(){if(!Zu())return null;try{return 1!==qu([],"length",{value:1}).length}catch(t){return!0}};var Uu=Zu,Wu="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Yu=Object.prototype.toString,Xu=Array.prototype.concat,Ju=Object.defineProperty,Qu=Uu(),Ku=Ju&&Qu,$u=function(t,e,i,n){var r;(!(e in t)||"function"==typeof(r=n)&&"[object Function]"===Yu.call(r)&&n())&&(Ku?Ju(t,e,{configurable:!0,enumerable:!1,value:i,writable:!0}):t[e]=i)},tl=function(t,e){var i=arguments.length>2?arguments[2]:{},n=eu(e);Wu&&(n=Xu.call(n,Object.getOwnPropertySymbols(e)));for(var r=0;r<n.length;r+=1)$u(t,n[r],e[n[r]],i[n[r]])};tl.supportsDescriptors=!!Ku;var el=tl,il=function(t){return t!=t},nl=function(t,e){return 0===t&&0===e?1/t==1/e:t===e||!(!il(t)||!il(e))},rl=function(){return"function"==typeof Object.is?Object.is:nl},ol=Du(rl(),Object);el(ol,{getPolyfill:rl,implementation:nl,shim:function(){var t=rl();return el(Object,{is:t},{is:function(){return Object.is!==t}}),t}});var sl,al,hl,ul,ll=ol,cl=nu();if(cl){sl=Fu("Object.prototype.hasOwnProperty"),al=Fu("RegExp.prototype.exec"),hl={};var pl=function(){throw hl};ul={toString:pl,valueOf:pl},"symbol"==typeof Symbol.toPrimitive&&(ul[Symbol.toPrimitive]=pl)}var fl=Fu("Object.prototype.toString"),dl=Object.getOwnPropertyDescriptor,gl=cl?function(t){if(!t||"object"!=typeof t)return!1;var e=dl(t,"lastIndex");if(!(e&&sl(e,"value")))return!1;try{al(t,ul)}catch(t){return t===hl}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===fl(t)},yl=function(){return"string"==typeof function(){}.name},_l=Object.getOwnPropertyDescriptor;if(_l)try{_l([],"length")}catch(t){_l=null}yl.functionsHaveConfigurableNames=function(){if(!yl()||!_l)return!1;var t=_l((function(){}),"name");return!!t&&!!t.configurable};var ml=Function.prototype.bind;yl.boundFunctionsHaveNames=function(){return yl()&&"function"==typeof ml&&""!==function(){}.bind().name};var vl=yl,xl=Au((function(t){var e=vl.functionsHaveConfigurableNames(),i=Object,n=TypeError;t.exports=function(){if(null!=this&&this!==i(this))throw new n("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.sticky&&(t+="y"),t},e&&Object.defineProperty&&Object.defineProperty(t.exports,"name",{value:"get flags"})})),wl=el.supportsDescriptors,bl=Object.getOwnPropertyDescriptor,Cl=function(){if(wl&&"gim"===/a/gim.flags){var t=bl(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return xl},Ml=el.supportsDescriptors,El=Object.getOwnPropertyDescriptor,Sl=Object.defineProperty,Pl=TypeError,Il=Object.getPrototypeOf,Tl=/a/,Ll=Du(Cl());el(Ll,{getPolyfill:Cl,implementation:xl,shim:function(){if(!Ml||!Il)throw new Pl("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=Cl(),e=Il(Tl),i=El(e,"flags");return i&&i.get===t||Sl(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}});var Ol=Ll,Rl=Date.prototype.getDay,Nl=Object.prototype.toString,Al=nu(),Dl=function(t){return"object"==typeof t&&null!==t&&(Al?function(t){try{return Rl.call(t),!0}catch(t){return!1}}(t):"[object Date]"===Nl.call(t))},kl=Date.prototype.getTime;function Fl(t,e,i){var n=i||{};return!!(n.strict?ll(t,e):t===e)||(!t||!e||"object"!=typeof t&&"object"!=typeof e?n.strict?ll(t,e):t==e:function(t,e,i){var n,r;if(typeof t!=typeof e)return!1;if(jl(t)||jl(e))return!1;if(t.prototype!==e.prototype)return!1;if(Hu(t)!==Hu(e))return!1;var o=gl(t),s=gl(e);if(o!==s)return!1;if(o||s)return t.source===e.source&&Ol(t)===Ol(e);if(Dl(t)&&Dl(e))return kl.call(t)===kl.call(e);var a=Gl(t),h=Gl(e);if(a!==h)return!1;if(a||h){if(t.length!==e.length)return!1;for(n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}if(typeof t!=typeof e)return!1;try{var u=eu(t),l=eu(e)}catch(t){return!1}if(u.length!==l.length)return!1;for(u.sort(),l.sort(),n=u.length-1;n>=0;n--)if(u[n]!=l[n])return!1;for(n=u.length-1;n>=0;n--)if(!Fl(t[r=u[n]],e[r],i))return!1;return!0}(t,e,n))}function jl(t){return null==t}function Gl(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}var zl=Fl,Bl=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:ql};function Vl(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function Hl(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function ql(t,e){return zl(t,e,{strict:!0})}Bl.prototype.compare=function(t,e){if(t.type!==e.type||!Hl(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var i=this,n=Vl(t),r=Vl(e);return n.every((function(t){return this.some((function(e){return i.compare(t,e)}))}),r)}}return!1},Bl.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i].toFixed(this.precision)!==e[i].toFixed(this.precision))return!1;return!0},Bl.prototype.compareLine=function(t,e,i,n){if(!Hl(t,e))return!1;var r=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!n||this.compareCoord(r[0],o[0])||(o=this.fixStartIndex(o,r))){var s=this.compareCoord(r[i],o[i]);return this.direction||s?this.comparePath(r,o):!!this.compareCoord(r[i],o[o.length-(1+i)])&&this.comparePath(r.slice().reverse(),o)}},Bl.prototype.fixStartIndex=function(t,e){for(var i,n=-1,r=0;r<t.length;r++)if(this.compareCoord(t[r],e[0])){n=r;break}return n>=0&&(i=[].concat(t.slice(n,t.length),t.slice(1,n+1))),i},Bl.prototype.comparePath=function(t,e){var i=this;return t.every((function(t,e){return i.compareCoord(t,this[e])}),e)},Bl.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var i=t.coordinates.slice(1,t.coordinates.length),n=e.coordinates.slice(1,e.coordinates.length),r=this;return i.every((function(t){return this.some((function(e){return r.compareLine(t,e,1,!0)}))}),n)}return!1},Bl.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},Bl.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},Bl.prototype.removePseudo=function(t){return t};var Zl=Bl;function Ul(t,e){void 0===e&&(e={});var i="object"==typeof e?e.mutate:e;if(!t)throw new Error("geojson is required");var n=Ih(t),r=[];switch(n){case"LineString":r=Wl(t);break;case"MultiLineString":case"Polygon":Eh(t).forEach((function(t){r.push(Wl(t))}));break;case"MultiPolygon":Eh(t).forEach((function(t){var e=[];t.forEach((function(t){e.push(Wl(t))})),r.push(e)}));break;case"Point":return t;case"MultiPoint":var o={};Eh(t).forEach((function(t){var e=t.join("-");Object.prototype.hasOwnProperty.call(o,e)||(r.push(t),o[e]=!0)}));break;default:throw new Error(n+" geometry not supported")}return t.coordinates?!0===i?(t.coordinates=r,t):{type:n,coordinates:r}:!0===i?(t.geometry.coordinates=r,t):lh({type:n,coordinates:r},t.properties,{bbox:t.bbox,id:t.id})}function Wl(t){var e=Eh(t);if(2===e.length&&!Yl(e[0],e[1]))return e;var i=[],n=e.length-1,r=i.length;i.push(e[0]);for(var o=1;o<n;o++){var s=i[i.length-1];e[o][0]===s[0]&&e[o][1]===s[1]||(i.push(e[o]),(r=i.length)>2&&Xl(i[r-3],i[r-1],i[r-2])&&i.splice(i.length-2,1))}if(i.push(e[e.length-1]),r=i.length,Yl(e[0],e[e.length-1])&&r<4)throw new Error("invalid polygon");return Xl(i[r-3],i[r-1],i[r-2])&&i.splice(i.length-2,1),i}function Yl(t,e){return t[0]===e[0]&&t[1]===e[1]}function Xl(t,e,i){var n=i[0],r=i[1],o=t[0],s=t[1],a=e[0],h=e[1],u=a-o,l=h-s;return 0===(n-o)*l-(r-s)*u&&(Math.abs(u)>=Math.abs(l)?u>0?o<=n&&n<=a:a<=n&&n<=o:l>0?s<=r&&r<=h:h<=r&&r<=s)}function Jl(t,e){return Ph(t).type===Ph(e).type&&new Zl({precision:6}).compare(Ul(t),Ul(e))}function Ql(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var Kl=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function $l(t,e){return t>e?1:t<e?-1:0}function tc(t,e,i){for(var n=new Kl(null,null),r=n,o=n;;){var s=i(t,e.key);if(s<0){if(null===e.left)break;if(i(t,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,null===(e=a).left)break}o.left=e,o=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(i(t,e.right.key)>0){a=e.right;if(e.right=a.left,a.left=e,null===(e=a).right)break}r.right=e,r=e,e=e.right}}return r.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function ec(t,e,i,n){var r=new Kl(t,e);if(null===i)return r.left=r.right=null,r;var o=n(t,(i=tc(t,i,n)).key);return o<0?(r.left=i.left,r.right=i,i.left=null):o>=0&&(r.right=i.right,r.left=i,i.right=null),r}function ic(t,e,i){var n=null,r=null;if(e){var o=i((e=tc(t,e,i)).key,t);0===o?(n=e.left,r=e.right):o<0?(r=e.right,e.right=null,n=e):(n=e.left,e.left=null,r=e)}return{left:n,right:r}}function nc(t,e,i,n,r){if(t){n(e+(i?"└── ":"├── ")+r(t)+"\n");var o=e+(i?"    ":"│   ");t.left&&nc(t.left,o,!1,n,r),t.right&&nc(t.right,o,!0,n,r)}}var rc=function(){function t(t){void 0===t&&(t=$l),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=ec(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var i=new Kl(t,e);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var n=this._comparator,r=tc(t,this._root,n),o=n(t,r.key);return 0===o?this._root=r:(o<0?(i.left=r.left,i.right=r,r.left=null):o>0&&(i.right=r.right,i.left=r,r.right=null),this._size++,this._root=i),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,i){var n;return null===e?null:0===i(t,(e=tc(t,e,i)).key)?(null===e.left?n=e.right:(n=tc(t,e.left,i)).right=e.right,this._size--,n):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=tc(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,i=this._comparator;e;){var n=i(t,e.key);if(0===n)return e;e=n<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=tc(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,i=this._comparator;e;){var n=i(t,e.key);if(0===n)return!0;e=n<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var i=this._root,n=[],r=!1;!r;)null!==i?(n.push(i),i=i.left):0!==n.length?(i=n.pop(),t.call(e,i),i=i.right):r=!0;return this},t.prototype.range=function(t,e,i,n){for(var r=[],o=this._comparator,s=this._root;0!==r.length||s;)if(s)r.push(s),s=s.left;else{if(o((s=r.pop()).key,e)>0)break;if(o(s.key,t)>=0&&i.call(n,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var i=e.key;return t.push(i)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var i=e.data;return t.push(i)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,i=!1,n=0,r=[];!i;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),n===t)return e;n++,e=e.right}else i=!0;return null},t.prototype.next=function(t){var e=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var n=this._comparator;e;){var r=n(t.key,e.key);if(0===r)break;r<0?(i=e,e=e.left):e=e.right}return i},t.prototype.prev=function(t){var e=this._root,i=null;if(null!==t.left){for(i=t.left;i.right;)i=i.right;return i}for(var n=this._comparator;e;){var r=n(t.key,e.key);if(0===r)break;r<0?e=e.left:(i=e,e=e.right)}return i},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){var e=t,i=[],n=!1,r=new Kl(null,null),o=r;for(;!n;)e?(i.push(e),e=e.left):i.length>0?e=(e=o=o.next=i.pop()).right:n=!0;return o.next=null,r.next}(this._root)},t.prototype.load=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=!1);var n=t.length,r=this._comparator;if(i&&ac(t,e,0,n-1,r),null===this._root)this._root=oc(t,e,0,n),this._size=n;else{var o=function(t,e,i){var n=new Kl(null,null),r=n,o=t,s=e;for(;null!==o&&null!==s;)i(o.key,s.key)<0?(r.next=o,o=o.next):(r.next=s,s=s.next),r=r.next;null!==o?r.next=o:null!==s&&(r.next=s);return n.next}(this.toList(),function(t,e){for(var i=new Kl(null,null),n=i,r=0;r<t.length;r++)n=n.next=new Kl(t[r],e[r]);return n.next=null,i.next}(t,e),r);n=this._size+n,this._root=sc({head:o},0,n)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return nc(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,i){var n=this._comparator,r=ic(t,this._root,n),o=r.left,s=r.right;n(t,e)<0?s=ec(e,i,s,n):o=ec(e,i,o,n),this._root=function(t,e,i){return null===e?t:(null===t||((e=tc(t.key,e,i)).left=t),e)}(o,s,n)},t.prototype.split=function(t){return ic(t,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var t;return Ql(this,(function(e){switch(e.label){case 0:t=this.minNode(),e.label=1;case 1:return t?[4,t]:[3,3];case 2:return e.sent(),t=this.next(t),[3,1];case 3:return[2]}}))},t}();function oc(t,e,i,n){var r=n-i;if(r>0){var o=i+Math.floor(r/2),s=t[o],a=e[o],h=new Kl(s,a);return h.left=oc(t,e,i,o),h.right=oc(t,e,o+1,n),h}return null}function sc(t,e,i){var n=i-e;if(n>0){var r=e+Math.floor(n/2),o=sc(t,e,r),s=t.head;return s.left=o,t.head=t.head.next,s.right=sc(t,r+1,i),s}return null}function ac(t,e,i,n,r){if(!(i>=n)){for(var o=t[i+n>>1],s=i-1,a=n+1;;){do{s++}while(r(t[s],o)<0);do{a--}while(r(t[a],o)>0);if(s>=a)break;var h=t[s];t[s]=t[a],t[a]=h,h=e[s],e[s]=e[a],e[a]=h}ac(t,e,i,a,r),ac(t,e,a+1,n,r)}}function hc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function uc(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lc(t,e,i){return e&&uc(t.prototype,e),i&&uc(t,i),t}var cc=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},pc=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var i=t.ll.x<e.ll.x?e.ll.x:t.ll.x,n=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:i,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:n,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},fc=Number.EPSILON;void 0===fc&&(fc=Math.pow(2,-52));var dc=fc*fc,gc=function(t,e){if(-fc<t&&t<fc&&-fc<e&&e<fc)return 0;var i=t-e;return i*i<dc*t*e?0:t<e?-1:1},yc=function(){function t(){hc(this,t),this.reset()}return lc(t,[{key:"reset",value:function(){this.xRounder=new _c,this.yRounder=new _c}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),_c=function(){function t(){hc(this,t),this.tree=new rc,this.round(0)}return lc(t,[{key:"round",value:function(t){var e=this.tree.add(t),i=this.tree.prev(e);if(null!==i&&0===gc(e.key,i.key))return this.tree.remove(t),i.key;var n=this.tree.next(e);return null!==n&&0===gc(e.key,n.key)?(this.tree.remove(t),n.key):t}}]),t}(),mc=new yc,vc=function(t,e){return t.x*e.y-t.y*e.x},xc=function(t,e){return t.x*e.x+t.y*e.y},wc=function(t,e,i){var n={x:e.x-t.x,y:e.y-t.y},r={x:i.x-t.x,y:i.y-t.y},o=vc(n,r);return gc(o,0)},bc=function(t){return Math.sqrt(xc(t,t))},Cc=function(t,e,i){var n={x:e.x-t.x,y:e.y-t.y},r={x:i.x-t.x,y:i.y-t.y};return xc(r,n)/bc(r)/bc(n)},Mc=function(t,e,i){return 0===e.y?null:{x:t.x+e.x/e.y*(i-t.y),y:i}},Ec=function(t,e,i){return 0===e.x?null:{x:i,y:t.y+e.y/e.x*(i-t.x)}},Sc=function(){function t(e,i){hc(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=i}return lc(t,null,[{key:"compare",value:function(e,i){var n=t.comparePoints(e.point,i.point);return 0!==n?n:(e.point!==i.point&&e.link(i),e.isLeft!==i.isLeft?e.isLeft?1:-1:Ic.compare(e.segment,i.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),lc(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,i=0,n=e.length;i<n;i++){var r=e[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var i=this.point.events[e];if(void 0===i.segment.consumedBy)for(var n=e+1;n<t;n++){var r=this.point.events[n];void 0===r.consumedBy&&(i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,i=this.point.events.length;e<i;e++){var n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,i=new Map,n=function(n){var r,o,s,a,h,u=n.otherSE;i.set(n,{sine:(r=e.point,o=t.point,s=u.point,a={x:o.x-r.x,y:o.y-r.y},h={x:s.x-r.x,y:s.y-r.y},vc(h,a)/bc(h)/bc(a)),cosine:Cc(e.point,t.point,u.point)})};return function(t,e){i.has(t)||n(t),i.has(e)||n(e);var r=i.get(t),o=r.sine,s=r.cosine,a=i.get(e),h=a.sine,u=a.cosine;return o>=0&&h>=0?s<u?1:s>u?-1:0:o<0&&h<0?s<u?-1:s>u?1:0:h<o?-1:h>o?1:0}}}]),t}(),Pc=0,Ic=function(){function t(e,i,n,r){hc(this,t),this.id=++Pc,this.leftSE=e,e.segment=this,e.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=e,this.rings=n,this.windings=r}return lc(t,null,[{key:"compare",value:function(t,e){var i=t.leftSE.point.x,n=e.leftSE.point.x,r=t.rightSE.point.x,o=e.rightSE.point.x;if(o<i)return 1;if(r<n)return-1;var s=t.leftSE.point.y,a=e.leftSE.point.y,h=t.rightSE.point.y,u=e.rightSE.point.y;if(i<n){if(a<s&&a<h)return 1;if(a>s&&a>h)return-1;var l=t.comparePoint(e.leftSE.point);if(l<0)return 1;if(l>0)return-1;var c=e.comparePoint(t.rightSE.point);return 0!==c?c:-1}if(i>n){if(s<a&&s<u)return-1;if(s>a&&s>u)return 1;var p=e.comparePoint(t.leftSE.point);if(0!==p)return p;var f=t.comparePoint(e.rightSE.point);return f<0?1:f>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(r<o){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(r>o){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(g>0)return-1}if(r!==o){var y=h-s,_=r-i,m=u-a,v=o-n;if(y>_&&m<v)return 1;if(y<_&&m>v)return-1}return r>o?1:r<o||h<u?-1:h>u?1:t.id<e.id?-1:t.id>e.id?1:0}}]),lc(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,i=this.rightSE.point,n=this.vector();if(e.x===i.x)return t.x===e.x?0:t.x<e.x?1:-1;var r=(t.y-e.y)/n.y,o=e.x+r*n.x;if(t.x===o)return 0;var s=(t.x-e.x)/n.x,a=e.y+s*n.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),i=t.bbox(),n=pc(e,i);if(null===n)return null;var r=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,h=cc(e,s)&&0===this.comparePoint(s),u=cc(i,r)&&0===t.comparePoint(r),l=cc(e,a)&&0===this.comparePoint(a),c=cc(i,o)&&0===t.comparePoint(o);if(u&&h)return c&&!l?o:!c&&l?a:null;if(u)return l&&r.x===a.x&&r.y===a.y?null:r;if(h)return c&&o.x===s.x&&o.y===s.y?null:s;if(c&&l)return null;if(c)return o;if(l)return a;var p=function(t,e,i,n){if(0===e.x)return Ec(i,n,t.x);if(0===n.x)return Ec(t,e,i.x);if(0===e.y)return Mc(i,n,t.y);if(0===n.y)return Mc(t,e,i.y);var r=vc(e,n);if(0==r)return null;var o={x:i.x-t.x,y:i.y-t.y},s=vc(o,e)/r,a=vc(o,n)/r;return{x:(t.x+a*e.x+(i.x+s*n.x))/2,y:(t.y+a*e.y+(i.y+s*n.y))/2}}(r,this.vector(),s,t.vector());return null===p?null:cc(n,p)?mc.round(p.x,p.y):null}},{key:"split",value:function(e){var i=[],n=void 0!==e.events,r=new Sc(e,!0),o=new Sc(e,!1),s=this.rightSE;this.replaceRightSE(o),i.push(o),i.push(r);var a=new t(r,s,this.rings.slice(),this.windings.slice());return Sc.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Sc.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),o.checkForConsuming()),i}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var i=this,n=e;i.consumedBy;)i=i.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var r=t.compare(i,n);if(0!==r){if(r>0){var o=i;i=n,n=o}if(i.prev===n){var s=i;i=n,n=s}for(var a=0,h=n.rings.length;a<h;a++){var u=n.rings[a],l=n.windings[a],c=i.rings.indexOf(u);-1===c?(i.rings.push(u),i.windings.push(l)):i.windings[c]+=l}n.rings=null,n.windings=null,n.consumedBy=i,n.leftSE.consumedBy=i.leftSE,n.rightSE.consumedBy=i.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys,r=0,o=this.rings.length;r<o;r++){var s=this.rings[r],a=this.windings[r],h=e.indexOf(s);-1===h?(e.push(s),i.push(a)):i[h]+=a}for(var u=[],l=[],c=0,p=e.length;c<p;c++)if(0!==i[c]){var f=e[c],d=f.poly;if(-1===l.indexOf(d))if(f.isExterior)u.push(d);else{-1===l.indexOf(d)&&l.push(d);var g=u.indexOf(f.poly);-1!==g&&u.splice(g,1)}}for(var y=0,_=u.length;y<_;y++){var m=u[y].multiPoly;-1===n.indexOf(m)&&n.push(m)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Gc.type){case"union":var i=0===t.length,n=0===e.length;this._isInResult=i!==n;break;case"intersection":var r,o;t.length<e.length?(r=t.length,o=e.length):(r=e.length,o=t.length),this._isInResult=o===Gc.numMultiPolys&&r<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var a=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=a(t)!==a(e);break;default:throw new Error("Unrecognized operation type found ".concat(Gc.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,i,n){var r,o,s,a=Sc.comparePoints(e,i);if(a<0)r=e,o=i,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));r=i,o=e,s=-1}return new t(new Sc(r,!0),new Sc(o,!1),[n],[s])}}]),t}(),Tc=function(){function t(e,i,n){if(hc(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=n,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=mc.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var o=r,s=1,a=e.length;s<a;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var h=mc.round(e[s][0],e[s][1]);h.x===o.x&&h.y===o.y||(this.segments.push(Ic.fromRing(o,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),o=h)}r.x===o.x&&r.y===o.y||this.segments.push(Ic.fromRing(o,r,this))}return lc(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,i=this.segments.length;e<i;e++){var n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}]),t}(),Lc=function(){function t(e,i){if(hc(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Tc(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,r=e.length;n<r;n++){var o=new Tc(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=i}return lc(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,i=this.interiorRings.length;e<i;e++)for(var n=this.interiorRings[e].getSweepEvents(),r=0,o=n.length;r<o;r++)t.push(n[r]);return t}}]),t}(),Oc=function(){function t(e,i){if(hc(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,r=e.length;n<r;n++){var o=new Lc(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=i}return lc(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,i=this.polys.length;e<i;e++)for(var n=this.polys[e].getSweepEvents(),r=0,o=n.length;r<o;r++)t.push(n[r]);return t}}]),t}(),Rc=function(){function t(e){hc(this,t),this.events=e;for(var i=0,n=e.length;i<n;i++)e[i].segment.ringOut=this;this.poly=null}return lc(t,null,[{key:"factory",value:function(e){for(var i=[],n=0,r=e.length;n<r;n++){var o=e[n];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,h=o.rightSE,u=[a],l=a.point,c=[];s=a,a=h,u.push(a),a.point!==l;)for(;;){var p=a.getAvailableLinkedEvents();if(0===p.length){var f=u[0].point,d=u[u.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===p.length){h=p[0].otherSE;break}for(var g=null,y=0,_=c.length;y<_;y++)if(c[y].point===a.point){g=y;break}if(null===g){c.push({index:u.length,point:a.point});var m=a.getLeftmostComparator(s);h=p.sort(m)[0].otherSE;break}var v=c.splice(g)[0],x=u.splice(v.index);x.unshift(x[0].otherSE),i.push(new t(x.reverse()))}i.push(new t(u))}}return i}}]),lc(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],i=1,n=this.events.length-1;i<n;i++){var r=this.events[i].point,o=this.events[i+1].point;0!==wc(r,t,o)&&(e.push(r),t=r)}if(1===e.length)return null;var s=e[0],a=e[1];0===wc(s,t,a)&&e.shift(),e.push(e[0]);for(var h=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:e.length-1,l=this.isExteriorRing()?e.length:-1,c=[],p=u;p!=l;p+=h)c.push([e[p].x,e[p].y]);return c}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,i=this.events.length;e<i;e++){var n=this.events[e];Sc.compare(t,n)>0&&(t=n)}for(var r=t.segment.prevInResult(),o=r?r.prevInResult():null;;){if(!r)return null;if(!o)return r.ringOut;if(o.ringOut!==r.ringOut)return o.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=o.prevInResult(),o=r?r.prevInResult():null}}}]),t}(),Nc=function(){function t(e){hc(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return lc(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,i=this.interiorRings.length;e<i;e++){var n=this.interiorRings[e].getGeom();null!==n&&t.push(n)}return t}}]),t}(),Ac=function(){function t(e){hc(this,t),this.rings=e,this.polys=this._composePolys(e)}return lc(t,[{key:"getGeom",value:function(){for(var t=[],e=0,i=this.polys.length;e<i;e++){var n=this.polys[e].getGeom();null!==n&&t.push(n)}return t}},{key:"_composePolys",value:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];if(!r.poly)if(r.isExteriorRing())e.push(new Nc(r));else{var o=r.enclosingRing();o.poly||e.push(new Nc(o)),o.poly.addInterior(r)}}return e}}]),t}(),Dc=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ic.compare;hc(this,t),this.queue=e,this.tree=new rc(i),this.segments=[]}return lc(t,[{key:"process",value:function(t){var e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),i;var n=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!n)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var r=n,o=n,s=void 0,a=void 0;void 0===s;)null===(r=this.tree.prev(r))?s=null:void 0===r.key.consumedBy&&(s=r.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(t.isLeft){var h=null;if(s){var u=s.getIntersection(e);if(null!==u&&(e.isAnEndpoint(u)||(h=u),!s.isAnEndpoint(u)))for(var l=this._splitSafely(s,u),c=0,p=l.length;c<p;c++)i.push(l[c])}var f=null;if(a){var d=a.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(f=d),!a.isAnEndpoint(d)))for(var g=this._splitSafely(a,d),y=0,_=g.length;y<_;y++)i.push(g[y])}if(null!==h||null!==f){var m=null;if(null===h)m=f;else if(null===f)m=h;else{m=Sc.comparePoints(h,f)<=0?h:f}this.queue.remove(e.rightSE),i.push(e.rightSE);for(var v=e.split(m),x=0,w=v.length;x<w;x++)i.push(v[x])}i.length>0?(this.tree.remove(e),i.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&a){var b=s.getIntersection(a);if(null!==b){if(!s.isAnEndpoint(b))for(var C=this._splitSafely(s,b),M=0,E=C.length;M<E;M++)i.push(C[M]);if(!a.isAnEndpoint(b))for(var S=this._splitSafely(a,b),P=0,I=S.length;P<I;P++)i.push(S[P])}}this.tree.remove(e)}return i}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var n=t.split(e);return n.push(i),void 0===t.consumedBy&&this.tree.insert(t),n}}]),t}(),kc="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Fc="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,jc=function(){function t(){hc(this,t)}return lc(t,[{key:"run",value:function(t,e,i){Gc.type=t,mc.reset();for(var n=[new Oc(e,!0)],r=0,o=i.length;r<o;r++)n.push(new Oc(i[r],!1));if(Gc.numMultiPolys=n.length,"difference"===Gc.type)for(var s=n[0],a=1;a<n.length;)null!==pc(n[a].bbox,s.bbox)?a++:n.splice(a,1);if("intersection"===Gc.type)for(var h=0,u=n.length;h<u;h++)for(var l=n[h],c=h+1,p=n.length;c<p;c++)if(null===pc(l.bbox,n[c].bbox))return[];for(var f=new rc(Sc.compare),d=0,g=n.length;d<g;d++)for(var y=n[d].getSweepEvents(),_=0,m=y.length;_<m;_++)if(f.insert(y[_]),f.size>kc)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var v=new Dc(f),x=f.size,w=f.pop();w;){var b=w.key;if(f.size===x){var C=b.segment;throw new Error("Unable to pop() ".concat(b.isLeft?"left":"right"," SweepEvent ")+"[".concat(b.point.x,", ").concat(b.point.y,"] from segment #").concat(C.id," ")+"[".concat(C.leftSE.point.x,", ").concat(C.leftSE.point.y,"] -> ")+"[".concat(C.rightSE.point.x,", ").concat(C.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(f.size>kc)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(v.segments.length>Fc)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var M=v.process(b),E=0,S=M.length;E<S;E++){var P=M[E];void 0===P.consumedBy&&f.insert(P)}x=f.size,w=f.pop()}mc.reset();var I=Rc.factory(v.segments);return new Ac(I).getGeom()}}]),t}(),Gc=new jc,zc={union:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return Gc.run("union",t,i)},intersection:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return Gc.run("intersection",t,i)},xor:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return Gc.run("xor",t,i)},difference:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return Gc.run("difference",t,i)}},Bc=zc;class Vc{static Translate(t,e){return t.features.forEach((t=>{if(t.properties){let r=t.properties[e];if("number"==typeof r&&0!=r){var i=ch(t.geometry.coordinates[0]),n=ch(t.geometry.coordinates[t.geometry.coordinates.length-1]);t.geometry=function(t,e,i,n){if(!xh(n=n||{}))throw new Error("options is invalid");var r=n.units,o=n.zTranslation,s=n.mutate;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===e&&0===o)return t;if(null==i||isNaN(i))throw new Error("direction is required");return e<0&&(e=-e,i+=180),!1!==s&&void 0!==s||(t=Th(t)),wh(t,(function(t){var n=Eh(Ah(t,e,i,{units:r}));t[0]=n[0],t[1]=n[1],o&&3===t.length&&(t[2]+=o)})),t}(t.geometry,r,Dh(i,n)+90)}}})),t}static GetGeoJSON(t){let e=[];return t.forEach((t=>{switch(oh.getArrayCount(t.coordinate)){case 1:e.push(ch(t.coordinate,t.properties));break;case 2:e.push(fh(t.coordinate,t.properties));break;case 3:e.push(ph(t.coordinate,t.properties))}})),dh(e)}static GetTranslateOffset(t,e,i){let n={dx:0,dy:0},r=t[0]-e[0],o=t[1]-e[1];return 0===o?n.dx=0:(n.dx=i/Math.sqrt(1+Math.pow((t[0]-e[0])/(t[1]-e[1]),2)),o>0&&(n.dx=-1*n.dx)),0===r?n.dy=0:(n.dy=i/Math.sqrt(1+Math.pow((t[1]-e[1])/(t[0]-e[0]),2)),r>0&&(n.dy=-1*n.dy)),n}static MarkOverlapLines(t,e=4){let i=this,n=[];for(let r=0;r<t.features.length;r++){let o=t.features[r];if(n.includes(r)||i.IsSamePointsLine(o.geometry))continue;let s=1,a=0;for(let h=r+1;h<t.features.length;h++){let r=t.features[h];const u=r.geometry.coordinates.length;if(u!==o.geometry.coordinates.length)continue;const l=r.geometry.coordinates[0],c=r.geometry.coordinates[u-1],p=o.geometry.coordinates[0],f=o.geometry.coordinates[u-1];if((l[0]===p[0]&&l[1]===p[1]&&c[0]===f[0]&&c[1]===f[1]||c[0]===p[0]&&c[1]===p[1]&&l[0]===f[0]&&l[1]===f[1])&&Jl(r.geometry,o.geometry)){a++;let t=s;if(a%2==0&&(t=-1*s,s++),r.properties){let n=i.GetTranslateOffset(r.geometry.coordinates[0],r.geometry.coordinates[r.geometry.coordinates.length-1],e*t);r.properties.lineDx=n.dx,r.properties.lineDy=n.dy}n.push(h)}}}return t}static IsSamePointsLine(t){let e=!0;const i=t.coordinates;let n=i[0];for(let t=1;t<i.length;t++){const r=i[t];if(r[0]-n[0]!=0||r[1]-n[1]!=0){e=!1;break}n=r}return e}static MarkSameEndPointsLines(t,e=4){let i=this,n=[];for(let r=0;r<t.features.length;r++){let o=t.features[r];if(n.includes(r)||i.IsSamePointsLine(o.geometry))continue;let s=1,a=0;for(let h=r+1;h<t.features.length;h++){let r=t.features[h];const u=r.geometry.coordinates.length;if(u!==o.geometry.coordinates.length)continue;const l=r.geometry.coordinates[0],c=r.geometry.coordinates[u-1],p=o.geometry.coordinates[0],f=o.geometry.coordinates[u-1];if(l[0]===p[0]&&l[1]===p[1]&&c[0]===f[0]&&c[1]===f[1]||c[0]===p[0]&&c[1]===p[1]&&l[0]===f[0]&&l[1]===f[1]){a++;let t=s;if(a%2==0&&(t=-1*s,s++),r.properties){let n=i.GetTranslateOffset(r.geometry.coordinates[0],r.geometry.coordinates[r.geometry.coordinates.length-1],e*t);r.properties.lineDx=n.dx,r.properties.lineDy=n.dy}n.push(h)}}}return t}static Point2Line(t,e){let i=[];return t.features.forEach((t=>{i.push(t.geometry.coordinates)})),fh(i,e||{})}static GetIntersections(t,e){let i;switch(Ih(e)){case"FeatureCollection":if(e.features.length>1)throw new Error(rh.INVALID_SAMPlE_DATA_KRIGING);i=e.features[0];break;case"MultiPolygon":case"Polygon":i=e;break;default:throw new Error(rh.INVALID_BOUNDARY_DATA_KRIGING)}let n=[];t.features.forEach((t=>{if(t.properties&&t.properties.value){let e=function(t,e,i){void 0===i&&(i={});var n=Ph(t),r=Ph(e),o=Bc.intersection(n.coordinates,r.coordinates);return 0===o.length?null:1===o.length?ph(o[0],i.properties):gh(o,i.properties)}(t,i,{properties:{value:t.properties.value}});e&&n.push(e)}}));return dh(n)}}class Hc extends sh{constructor(t,e,i){e&&i&&i.splitOverlap&&i.splitInterval>0&&(Object.assign(i.style.symbol,nh.lineDxDySymbol.identity),e=Vc.MarkOverlapLines(e,i.splitInterval)),super(t,e,i)}ants(t,e,i,n={duration:5e3,cover:!1}){let r=this.getGeos((t=>i.some((e=>t.getProperties()[e.property]==e.value)))),o={lineDasharray:[2,8],lineDashOffset:0,lineColor:t,lineWidth:e};Object.assign(o,this.options.splitOverlap?nh.lineDxDySymbol.identity:nh.lineDxDySymbol.default);for(let t=0;t<r.length;t++){const e=r[t];let s=i.find((t=>e.getProperties()[t.property]==t.value));if(!s)continue;let a=1,h=0,u=0,l=s.coord;l instanceof Mi?(h=l.x,u=l.y):(h=l[0],u=l[1]),a=Math.abs(e.getFirstCoordinate().x-h)<.01&&Math.abs(e.getFirstCoordinate().y-u)<.01?1:-1,e.setSymbol(o),e.animate({symbol:{lineDashOffset:-100*a}},{duration:n.duration,repeat:!0})}return r}updateAnts(t,e=5e3){}imgAnts(t,e,i,n,r={duration:5e3,showHideByZoom:!0}){let o=this.getGeos((t=>n.some((e=>t.getProperties()[e.property]==e.value)))),s={linePatternDx:0,lineWidth:e};Object.assign(s,this.options.splitOverlap?nh.lineDxDySymbol.identity:nh.lineDxDySymbol.default);for(let e=0;e<o.length;e++){const a=o[e];let h=n.find((t=>a.getProperties()[t.property]==t.value));if(!h)continue;let u=1,l=0,c=0,p=h.coord;p instanceof Mi?(l=p.x,c=p.y):(l=p[0],c=p[1]),u=Math.abs(a.getFirstCoordinate().x-l)<.01&&Math.abs(a.getFirstCoordinate().y-c)<.01?1:-1,Object.assign(s,{linePatternFile:1==u?t[0]:t[1]}),a.setSymbol(s),a.animate({symbol:{linePatternDx:i*u}},{duration:r.duration,repeat:!0})}return o}}class qc extends sh{}var Zc=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){function e(t){if(!(this instanceof e))return new e(t);this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._max=1,this._data=[]}t.exports=e,e.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,e){e=void 0===e?15:e;var i=this._circle=this._createCanvas(),n=i.getContext("2d"),r=this._r=t+e;return i.width=i.height=2*r,n.shadowOffsetX=n.shadowOffsetY=2*r,n.shadowBlur=e,n.shadowColor="black",n.beginPath(),n.arc(-r,-r,t,0,2*Math.PI,!0),n.closePath(),n.fill(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var e=this._createCanvas(),i=e.getContext("2d"),n=i.createLinearGradient(0,0,0,256);for(var r in e.width=1,e.height=256,t)n.addColorStop(+r,t[r]);return i.fillStyle=n,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._width,this._height);for(var i,n=0,r=this._data.length;n<r;n++)i=this._data[n],e.globalAlpha=Math.max(i[2]/this._max,void 0===t?.05:t),e.drawImage(this._circle,i[0]-this._r,i[1]-this._r);var o=e.getImageData(0,0,this._width,this._height);return this._colorize(o.data,this._grad),e.putImageData(o,0,0),this},_colorize:function(t,e){for(var i,n=0,r=t.length;n<r;n+=4)(i=4*t[n+3])&&(t[n]=e[i],t[n+1]=e[i+1],t[n+2]=e[i+2])},_createCanvas:function(){return"undefined"!=typeof document?document.createElement("canvas"):new this._canvas.constructor}}}));function Uc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wc(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Yc(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}}(t,e))}var Xc={max:1,gradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},radius:25,blur:15,heatValueScale:1,minOpacity:.05},Jc=function(t){function e(i,n,r){Uc(this,e),Array.isArray(n)||(r=n,n=null);var o=Wc(this,t.call(this,i,r));return o._heats=n||[],o}return Yc(e,t),e.prototype.getData=function(){return this._heats},e.prototype.setData=function(t){return this._heats=t||[],this.redraw()},e.prototype.addPoint=function(t){return t?(t[0]&&Array.isArray(t[0])?Gt.pushIn(this._heats,t):this._heats.push(t),this.redraw()):this},e.prototype.onConfig=function(t){for(var e in t)if(Xc[e])return this.redraw();return this},e.prototype.redraw=function(){var t=this._getRenderer();return t&&(t.clearHeatCache(),t.setToRedraw()),this},e.prototype.isEmpty=function(){return!this._heats.length},e.prototype.clear=function(){return this._heats=[],this.redraw(),this.fire("clear"),this},e.prototype.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()},i=this.getData();if(t.clipExtent){var n=new ji(t.clipExtent),r=this._getHeatRadius();r&&(n=n._expand(r));for(var o=[],s=0,a=i.length;s<a;s++)n.contains(new Mi(i[s][0],i[s][1]))&&o.push(i[s]);e.data=o}else e.data=i;return e},e.fromJSON=function(t){return t&&"HeatLayer"===t.type?new e(t.id,t.data,t.options):null},e.prototype._getHeatRadius=function(){return this._getRenderer()?this._getRenderer()._heatRadius:null},e}(Yn);function Qc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kc(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function $c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}}(t,e))}function tp(t){if(!(this instanceof tp))return new tp(t);this._canvas=t="string"==typeof t?document.getElementById(t):t,this._ctx=t.getContext("2d"),this._width=t.width,this._height=t.height,this._max=1,this._data=[]}Jc.mergeOptions(Xc),Jc.registerJSONType("HeatLayer"),Jc.registerRenderer("canvas",function(t){function e(){return Uc(this,e),Wc(this,t.apply(this,arguments))}return Yc(e,t),e.prototype.draw=function(){var t=this.getMap(),e=this.layer,i=t.getContainerExtent(),n=this.prepareCanvas(),r=i;if(n){if(!(n=n.convertTo((function(e){return t._pointToContainerPoint(e)}))).intersects(i))return void this.completeRender();r=i.intersection(n)}this._heater||(this._heater=Zc(this.canvas)),this._heater.radius(e.options.radius||this._heater.defaultRadius,e.options.blur),e.options.gradient&&this._heater.gradient(e.options.gradient),this._heater.max(e.options.max),this._heatViews||(this._heatViews=[]);var o=e.getData();if(0!==o.length){var s=this._heatData(o,r);this._heater.data(s).draw(e.options.minOpacity),this.completeRender()}else this.completeRender()},e.prototype.drawOnInteracting=function(){this.draw()},e.prototype._heatData=function(t,e){var i=this.getMap(),n=this.layer,r=i.getProjection(),o=[],s=this._heater._r,a=void 0===n.options.max?1:n.options.max,h=s/2,u=[],l=i.offsetPlatform(),c=l.x%h,p=l.y%h,f=void 0,d=void 0,g=void 0,y=void 0,_=void 0,m=void 0;e=e.expand(s).convertTo((function(t){return new de(i._containerPointToPrj(t))})),this._heatRadius=s;for(var v=0,x=t.length;v<x;v++)f=t[v],this._heatViews[v]||(this._heatViews[v]=r.project(new Mi(f[0],f[1]))),d=this._heatViews[v],e.contains(d)&&(d=i._prjToContainerPoint(d),y=Math.floor((d.x-c)/h)+2,_=Math.floor((d.y-p)/h)+2,m=(void 0!==f[2]?+f[2]:.1)*n.options.heatValueScale,u[_]=u[_]||[],(g=u[_][y])?(g[0]=(g[0]*g[2]+d.x*m)/(g[2]+m),g[1]=(g[1]*g[2]+d.y*m)/(g[2]+m),g[2]+=m):u[_][y]=[d.x,d.y,m]);for(var w=0,b=u.length;w<b;w++)if(u[w])for(var C=0,M=u[w].length;C<M;C++)(g=u[w][C])&&o.push([Math.round(g[0]),Math.round(g[1]),Math.min(g[2],a)]);return o},e.prototype.onZoomEnd=function(){delete this._heatViews,t.prototype.onZoomEnd.apply(this,arguments)},e.prototype.onResize=function(){t.prototype.onResize.apply(this,arguments),this.canvas&&(this._heater._width=this.canvas.width,this._heater._height=this.canvas.height)},e.prototype.onRemove=function(){this.clearHeatCache(),delete this._heater},e.prototype.clearHeatCache=function(){delete this._heatViews},e}(Na.CanvasRenderer)),tp.prototype={defaultCellSize:25,defaultGradient:{0:"#000066",.1:"blue",.2:"cyan",.3:"lime",.4:"yellow",.5:"orange",.6:"red",.7:"Maroon",.8:"#660066",.9:"#990099",1:"#ff66ff"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},cellSize:function(t){var e=this._cell=document.createElement("canvas"),i=e.getContext("2d");return this._r=t,e.width=e.height=t,i.beginPath(),i.rect(0,0,t,t),i.fill(),i.closePath(),this},resize:function(){this._width=this._canvas.width,this._height=this._canvas.height},gradient:function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n=i.createLinearGradient(0,0,0,256);for(var r in e.width=1,e.height=256,t)n.addColorStop(+r,t[r]);return i.fillStyle=n,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},draw:function(t){this._cell||this.cellSize(this.defaultCellSize),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._width,this._height);for(var i,n=0,r=this._data.length;n<r;n++)i=this._data[n],e.globalAlpha=i[2]/this._max,e.drawImage(this._cell,i[0]-this._r,i[1]-this._r);var o=e.getImageData(0,0,this._width,this._height);return this._colorize(o.data,this._grad,5*t),e.putImageData(o,0,0),this},_colorize:function(t,e,i){for(var n,r=0,o=t.length;r<o;r+=4)n=4*t[r+3],t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=256*i}};var ep=function(t){function e(i,n,r){Qc(this,e),Array.isArray(n)||(r=n,n=null);var o=Kc(this,t.call(this,i,r));return o._idws=n||[],o}return $c(e,t),e.prototype.getData=function(){return this._idws},e.prototype.setData=function(t){return this._idws=t||[],this.redraw()},e.prototype.addPoint=function(t){return t?(t[0]&&Array.isArray(t[0])?Gt.pushIn(this._idws,t):this._idws.push(t),this.redraw()):this},e.prototype.onConfig=function(t){for(var e in t)if(options[e])return this.redraw();return this},e.prototype.redraw=function(){var t=this._getRenderer();return t&&(t.clearIdwCache(),t.setToRedraw()),this},e.prototype.isEmpty=function(){return!this._idws.length},e.prototype.clear=function(){return this._idws=[],this.redraw(),this.fire("clear"),this},e.prototype.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()},i=this.getData();if(t.clipExtent){var n=new ji(t.clipExtent),r=this._getIdwRadius();r&&(n=n._expand(r));for(var o=[],s=0,a=i.length;s<a;s++)n.contains(new Mi(i[s][0],i[s][1]))&&o.push(i[s]);e.data=o}else e.data=i;return e},e.fromJSON=function(t){return t&&"IdwLayer"===t.type?new e(t.id,t.data,t.options):null},e.prototype._getIdwRadius=function(){return this._getRenderer()?this._getRenderer()._idwRadius:null},e}(Yn);ep.registerJSONType("IdwLayer"),ep.registerRenderer("canvas",function(t){function e(){return Qc(this,e),Kc(this,t.apply(this,arguments))}return $c(e,t),e.prototype.draw=function(){var t=this.getMap(),e=this.layer,i=t.getContainerExtent(),n=this.prepareCanvas(),r=i;if(n){if(!(n=n.convertTo((function(e){return t._pointToContainerPoint(e)}))).intersects(i))return void this.completeRender();r=i.intersection(n)}this._idw||(this._idw=tp(this.canvas)),this._updateOptions(),this._idwViews||(this._idwViews=[]);var o=e.getData();if(0!==o.length){var s=this._idwData(o,r);this._idw.data(s).draw(e.options.opacity),this.completeRender()}else this.completeRender()},e.prototype._updateOptions=function(){this._idw.cellSize(this.layer.options.cellSize||this._idw.defaultCellSize),this.layer.options.gradient&&this._idw.gradient(this.layer.options.gradient),this.layer.options.max&&this._idw.max(this.layer.options.max),this.layer.options.hasOwnProperty("opacity")||(this.layer.options.opacity=.3)},e.prototype.drawOnInteracting=function(){this.draw()},e.prototype._idwData=function(t){var e,i=this.getMap(),n=this.layer,r=[],o=this._idw._r,s=i.getSize(),a=new ji(new de([-o,-o]),new de([s.width+o,s.height+o])),h=void 0===n.options.exp?1:n.options.exp,u=void 0===n.options.max?1:n.options.max,l=o/2,c=Math.ceil((a.xmax-a.xmin)/o)+1,p=void 0,f=void 0,d=void 0,g=void 0,y=void 0,_=void 0;for(p=0,e=Math.ceil((a.ymax-a.ymin)/o)+1;p<e;p++)for(d=0,g=c;d<g;d++){var m=p*o,v=d*o,x=0,w=0;for(_=0,y=t.length;_<y;_++){var b=i.coordinateToContainerPoint(new Mi([t[_][0],t[_][1]])),C=new de(v-l,m-l).distanceTo(b),M=void 0!==t[_].alt?t[_].alt:void 0!==t[_][2]?+t[_][2]:1;if(0===C){x=M,w=1;break}var E=Math.pow(C,h);x+=M/E,w+=1/E}(f=[d*o,p*o,x/w])&&r.push([Math.round(f[0]),Math.round(f[1]),Math.min(f[2],u)])}return r},e.prototype.onZoomEnd=function(){delete this._idwViews,t.prototype.onZoomEnd.apply(this,arguments)},e.prototype.onResize=function(){this.canvas&&(this._idw._width=this.canvas.width,this._idw._height=this.canvas.height),t.prototype.onResize.apply(this,arguments)},e.prototype.onRemove=function(){this.clearHeatCache(),delete this._idw},e.prototype.clearHeatCache=function(){delete this._idwViews},e}(Na.CanvasRenderer));var ip=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function np(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}}(t,e))}function rp(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var op=function(){function t(e){rp(this,t),this.route=e,this.path=e.path}return t.prototype.getCoordinates=function(t,e){if(t<this.getStart()||t>this.getEnd())return null;for(var i=null,n=null,r=0,o=this.path.length;r<o;r++)if(t<this.path[r][2]){i=r,n=this.path[r][3];break}null===i&&(i=this.path.length-1);var s=this.path[i-1],a=this.path[i],h=(t-s[2])/(a[2]-s[2]),u=s[0]+(a[0]-s[0])*h,l=s[1]+(a[1]-s[1])*h,c=new Mi(u,l),p=e.coordinateToViewPoint(c);return{coordinate:c,viewPoint:p,degree:Gt.computeDegree(e.coordinateToViewPoint(new Mi(s)),p),index:i,payload:n}},t.prototype.getStart=function(){return this.path[0][2]},t.prototype.getEnd=function(){return this.path[this.getCount()-1][2]},t.prototype.getCount=function(){return this.path.length},ip(t,[{key:"markerSymbol",get:function(){return this.route.markerSymbol},set:function(t){this.route.markerSymbol=t,this._painter&&this._painter.marker&&this._painter.marker.setSymbol(t)}},{key:"lineSymbol",get:function(){return this.route.lineSymbol},set:function(t){this.route.lineSymbol=t,this._painter&&this._painter.marker&&this._painter.line.setSymbol(t)}},{key:"trailLineSymbol",get:function(){return this.route.trailLineSymbol},set:function(t){this.route.trailLineSymbol=t,this._painter&&this._painter.marker&&this._painter.trailLine.setSymbol(t)}}]),t}(),sp=function(t){function i(e,n,r){rp(this,i);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,r));return Array.isArray(e)||(e=[e]),o.id=Gt.UID(),o._map=n,o._setup(e),o}return np(i,t),i.prototype.remove=function(){return this.markerLayer?(this.finish(),this.markerLayer.remove(),this.lineLayer.remove(),this.trailLineLayer.remove(),delete this.markerLayer,delete this.lineLayer,delete this.trailLineLayer,delete this._map,this):this},i.prototype.play=function(){return"running"===this.player.playState||(this.player.play(),this.fire("playstart")),this},i.prototype.pause=function(){return"paused"===this.player.playState||(this.player.pause(),this.fire("playpause")),this},i.prototype.cancel=function(){this.player.cancel(),this.played=0,this.trailLinePoints=[];var t=this.trailLineLayer.getGeometries()[0];return void 0!==t&&t.setCoordinates(this.trailLinePoints),this._createPlayer(),this._step({styles:{t:0}}),this.fire("playcancel"),this},i.prototype.finish=function(){if("finished"===this.player.playState)return this;var t=this.trailLineLayer.getGeometries()[0],e=this.routes[0].path.map((function(t){return[t[0],t[1]]}));return this.trailLinePoints=e,t.setCoordinates(this.trailLinePoints),this.player.finish(),this._step({styles:{t:1}}),this.fire("playfinish"),this},i.prototype.getStartTime=function(){return this.startTime||0},i.prototype.getEndTime=function(){return this.endTime||0},i.prototype.getCurrentTime=function(){return this.played?this.startTime+this.played:this.startTime},i.prototype.setTime=function(t){return this.played=t-this.startTime,this.played<0&&(this.played=0),this._resetPlayer(),this},i.prototype.getUnitTime=function(){return this.options.unitTime},i.prototype.setUnitTime=function(t){this.options.unitTime=+t,this._resetPlayer()},i.prototype.getCurrentProperties=function(t){return t||(t=0),this.routes[t]&&this.routes[t]._painter?this.routes[t]._painter.marker.getProperties():null},i.prototype.getCurrentCoordinates=function(t){return t||(t=0),this.routes[t]&&this.routes[t]._painter?this.routes[t]._painter.marker.getCoordinates():null},i.prototype.getMarkerSymbol=function(t){return this.routes&&this.routes[t]?this.routes[t].markerSymbol:null},i.prototype.setMarkerSymbol=function(t,e){return this.routes&&this.routes[t]&&(this.routes[t].markerSymbol=e),this},i.prototype.getLineSymbol=function(t){return this.routes&&this.routes[t]?this.routes[t].lineSymbol:null},i.prototype.setLineSymbol=function(t,e){return this.routes&&this.routes[t]&&(this.routes[t].lineSymbol=e),this},i.prototype.showRoute=function(){this.lineLayer.show()},i.prototype.showTrail=function(){this.trailLineLayer.show()},i.prototype.hideRoute=function(){this.lineLayer.hide()},i.prototype.hideTrail=function(){this.trailLineLayer.hide()},i.prototype._resetPlayer=function(){var t=this.player&&"running"===this.player.playState;t&&this.player.finish(),this._createPlayer(),t&&this.player.play()},i.prototype._step=function(t){if(t.state&&"running"!==t.state.playState)"finished"===t.state.playState&&this.fire("playfinish");else{this.played=this.duration*t.styles.t;for(var e=0,i=this.routes.length;e<i;e++)this._drawRoute(this.routes[e],this.startTime+this.played);this.fire("playing")}},i.prototype._drawRoute=function(t,e){if(this._map){var i=t.getCoordinates(e,this._map);if(i){if(t._painter||(t._painter={}),t._painter.marker)t._painter.marker.setProperties(i.payload),t._painter.marker.setCoordinates(i.coordinate);else{var n=new br(i.coordinate,{symbol:t.markerSymbol||this.options.markerSymbol}).addTo(this.markerLayer);t._painter.marker=n}if(!t._painter.line){var r=new Mr(t.path,{symbol:t.lineSymbol||this.options.lineSymbol}).addTo(this.lineLayer);t._painter.line=r}if(t._painter.trailLine){var o=this.options.maxTrailLine;0!==o&&this.trailLinePoints.length>o&&this.trailLinePoints.shift(),this.trailLinePoints.push(i.coordinate),this.trailLinePoints.length>1&&t._painter.trailLine.setCoordinates(this.trailLinePoints)}else{this.trailLinePoints=[i.coordinate];var s=new Mr([],{symbol:t.trailLineSymbol||this.options.trailLineSymbol}).addTo(this.trailLineLayer);t._painter.trailLine=s}}else t._painter&&t._painter.marker&&(t._painter.marker.remove(),delete t._painter.marker)}},i.prototype._setup=function(t){for(var e=t.map((function(t){return new op(t)})),i=e[0].getStart(),n=e[0].getEnd(),r=1;r<e.length;r++){var o=e[r];o.getStart()<i&&(i=o.getStart()),o.getEnd()>n&&(n=o.getEnd())}this.trailLinePoints=[],this.routes=e,this.startTime=i,this.endTime=n,this.played=0,this.duration=n-i,this._createLayers(),this._createPlayer()},i.prototype._createPlayer=function(){var t=(this.duration-this.played)/this.options.unitTime,e=void 0,i=this._map._getRenderer();i.callInFrameLoop&&(e=function(t){i.callInFrameLoop(t)}),this.player=yr.Animation.animate({t:[this.played/this.duration,1]},{framer:e,speed:t,easing:"linear"},this._step.bind(this))},i.prototype._createLayers=function(){this.lineLayer=new to(e+"_routeplay_r_"+this.id,[],{visible:this.options.showRoutes,enableSimplify:!1}).addTo(this._map),this.trailLineLayer=new to(e+"_routeplay_t_"+this.id,[],{visible:this.options.showTrail,enableSimplify:!1}).addTo(this._map),this.markerLayer=new to(e+"_routeplay_m_"+this.id).addTo(this._map)},i}(di(yi));function ap(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hp(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function up(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var r=i[n],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}}(t,e))}sp.mergeOptions({unitTime:1e3,showRoutes:!0,showTrail:!0,maxTrailLine:0,markerSymbol:null,lineSymbol:{lineWidth:2,lineColor:"#004A8D"},trailLineSymbol:{lineColor:"rgba(250,0,0,1)",lineWidth:4,lineJoin:"round",lineCap:"round",lineDasharray:null,"lineOpacity ":1}});var lp=function(t){function e(){return ap(this,e),hp(this,t.apply(this,arguments))}return up(e,t),e.fromJSON=function(t){if(!t||"ClusterLayer"!==t.type)return null;for(var i=new e(t.id,t.options),n=t.geometries,r=[],o=0;o<n.length;o++){var s=Un.fromJSON(n[o]);s&&r.push(s)}return i.addGeometry(r),i},e.prototype.addMarker=function(t){return this.addGeometry(t)},e.prototype.addGeometry=function(e){for(var i=0,n=e.length;i<=n;i++)if(!e[i]instanceof br)throw new Error("Only a point(Marker) can be added into a ClusterLayer");return t.prototype.addGeometry.apply(this,arguments)},e.prototype.onConfig=function(e){if(t.prototype.onConfig.call(this,e),e.maxClusterRadius||e.symbol||e.drawClusterText||e.textSymbol||e.maxClusterZoom){var i=this._getRenderer();i&&i.render()}return this},e.prototype.identify=function(e,i){var n=this.getMap(),r=this.options.maxClusterZoom;return r&&n&&n.getZoom()>r?t.prototype.identify.call(this,e,i):this._getRenderer()?this._getRenderer().identify(e,i):null},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.type="ClusterLayer",e},e.prototype.getClusters=function(){var t=this._getRenderer();return t&&t._currentClusters||[]},e}(to);lp.mergeOptions({maxClusterRadius:160,textSumProperty:null,symbol:null,drawClusterText:!0,textSymbol:null,animation:!0,animationDuration:450,maxClusterZoom:null,noClusterWithOneMarker:!0,forceRenderOnZooming:!0}),lp.registerJSONType("ClusterLayer");var cp={textFaceName:'"microsoft yahei"',textSize:16,textDx:0,textDy:0},pp={markerType:"ellipse",markerFill:{property:"count",type:"interval",stops:[[0,"rgb(135, 196, 240)"],[9,"#1bbc9b"],[99,"rgb(216, 115, 149)"]]},markerFillOpacity:.7,markerLineOpacity:1,markerLineWidth:3,markerLineColor:"#fff",markerWidth:{property:"count",type:"interval",stops:[[0,40],[9,60],[99,80]]},markerHeight:{property:"count",type:"interval",stops:[[0,40],[9,60],[99,80]]}};lp.registerRenderer("canvas",function(t){function e(i){ap(this,e);var n=hp(this,t.call(this,i));return n._animated=!0,n._refreshStyle(),n._clusterNeedRedraw=!0,n}return up(e,t),e.prototype.checkResources=function(){var e=this.layer.options.symbol||pp,i=t.prototype.checkResources.apply(this,arguments);if(e!==this._symbolResourceChecked){var n=Gt.getExternalResources(e,!0);n&&i.push.apply(i,n),this._symbolResourceChecked=e}return i},e.prototype.draw=function(){this.canvas||this.prepareCanvas();var e=this.getMap(),i=e.getZoom(),n=this.layer.options.maxClusterZoom;if(n&&i>n)return delete this._currentClusters,this._markersToDraw=this.layer._geoList,void t.prototype.draw.apply(this,arguments);this._clusterNeedRedraw&&(this._clearDataCache(),this._computeGrid(),this._clusterNeedRedraw=!1);var r=this._clusterCache[i]?this._clusterCache[i].clusters:null,o=this._getClustersToDraw(r);o.zoom=i,this._drawLayer(o)},e.prototype._getClustersToDraw=function(t){this._markersToDraw=[];var e=this.getMap(),i=Te.getFont(this._textSymbol),n=Te.stringLength("9",i).toPoint(),r=e.getContainerExtent(),o=[],s=void 0,a=void 0,h=void 0,u=void 0,l=void 0;for(var c in t)if(this._currentGrid=t[c],1===t[c].count&&this.layer.options.noClusterWithOneMarker){var p=t[c].children[0];p._cluster=t[c],this._markersToDraw.push(p)}else if(u=(h=this._getSprite()).canvas.width,l=h.canvas.height,s=e._prjToContainerPoint(t[c].center),a=new zi(s.sub(u,l),s.add(u,l)),r.intersects(a)){if(!t[c].textSize){var f=this._getClusterText(t[c]);t[c].textSize=new de(n.x*f.length,n.y)._multi(.5)}o.push(t[c])}return o},e.prototype.drawOnInteracting=function(){this._currentClusters&&this._drawClusters(this._currentClusters,1),t.prototype.drawOnInteracting.apply(this,arguments)},e.prototype.forEachGeo=function(t,e){this._markersToDraw&&this._markersToDraw.forEach((function(i){e?t.call(e,i):t(i)}))},e.prototype.onGeometryShow=function(){this._clusterNeedRedraw=!0,t.prototype.onGeometryShow.apply(this,arguments)},e.prototype.onGeometryHide=function(){this._clusterNeedRedraw=!0,t.prototype.onGeometryHide.apply(this,arguments)},e.prototype.onGeometryAdd=function(){this._clusterNeedRedraw=!0,t.prototype.onGeometryAdd.apply(this,arguments)},e.prototype.onGeometryRemove=function(){this._clusterNeedRedraw=!0,t.prototype.onGeometryRemove.apply(this,arguments)},e.prototype.onGeometryPositionChange=function(){this._clusterNeedRedraw=!0,t.prototype.onGeometryPositionChange.apply(this,arguments)},e.prototype.onRemove=function(){this._clearDataCache()},e.prototype.identify=function(e,i){var n=this.getMap(),r=this.layer.options.maxClusterZoom;if(r&&n.getZoom()>r)return t.prototype.identify.call(this,e,i);if(this._currentClusters){for(var o=n.coordinateToContainerPoint(e),s=this._currentGrid,a=0;a<this._currentClusters.length;a++){var h=this._currentClusters[a],u=n._prjToContainerPoint(h.center);this._currentGrid=h;var l=this._getSprite().canvas.width;if(o.distanceTo(u)<=l)return{center:n.getProjection().unproject(h.center.copy()),children:h.children.slice(0)}}this._currentGrid=s}return this._markersToDraw?this.layer._hitGeos(this._markersToDraw,e,i):null},e.prototype.onSymbolChanged=function(){this._refreshStyle(),this._computeGrid(),this._stopAnim(),this.setToRedraw()},e.prototype._refreshStyle=function(){var t=this,e=this.layer.options.symbol||pp,i=this.layer.options.textSymbol||cp,n=function(){return[t.getMap().getZoom(),t._currentGrid]};this._symbol=Mt.loadFunctionTypes(e,n),this._textSymbol=Mt.loadFunctionTypes(i,n)},e.prototype._drawLayer=function(t){var e=this,i=this._currentClusters||t;this._currentClusters=t,delete this._clusterMaskExtent;var n=this.layer;if(n.options.animation&&this._animated&&this._inout){var r=[0,1];"in"===this._inout&&(r=[1,0]),this._player=yr.Animation.animate({d:r},{speed:n.options.animationDuration,easing:"inAndOut"},(function(n){"finished"===n.state.playState?(e._animated=!1,e._drawClusters(t,1),e._drawMarkers(),e.completeRender()):("in"===e._inout?e._drawClustersFrame(t,i,n.styles.d):e._drawClustersFrame(i,t,n.styles.d),e.setCanvasUpdated())})).play()}else this._animated=!1,this._drawClusters(t,1),this._drawMarkers(),this.completeRender()},e.prototype._drawMarkers=function(){t.prototype.drawGeos.call(this,this._clusterMaskExtent)},e.prototype._drawClustersFrame=function(t,e,i){var n=this;this._clusterMaskExtent=this.prepareCanvas();var r=this.getMap(),o={};if(t&&t.forEach((function(t){var e=r._prjToContainerPoint(t.center);o[t.key]||(o[t.key]=1,n._drawCluster(e,t,1-i))})),0!==i&&e){var s=t.zoom,a=r._getResolution(s)*this.layer.options.maxClusterRadius,h=this._markerExtent.getMin();e.forEach((function(t){var e=r._prjToContainerPoint(t.center),o=t.center,u=Math.floor((o.x-h.x)/a)+"_"+Math.floor((o.y-h.y)/a),l=n._clusterCache[s].clusterMap[u];if(l){var c=r._prjToContainerPoint(l.center);e=c.add(e.sub(c)._multi(i))}n._drawCluster(e,t,i>.5?1:i)}))}},e.prototype._drawClusters=function(t,e){var i=this;if(t){this._clusterMaskExtent=this.prepareCanvas();var n=this.getMap();t.forEach((function(t){var r=n._prjToContainerPoint(t.center);i._drawCluster(r,t,e>.5?1:e)}))}},e.prototype._drawCluster=function(t,e,i){this._currentGrid=e;var n=this.context,r=this._getSprite(),o=n.globalAlpha;if(o*i!=0){if(n.globalAlpha=o*i,r){var s=t.add(r.offset)._sub(r.canvas.width/2,r.canvas.height/2);n.drawImage(r.canvas,s.x,s.y)}if(this.layer.options.drawClusterText&&e.textSize){oi.prepareCanvasFont(n,this._textSymbol),n.textBaseline="middle";var a=this._textSymbol.textDx||0,h=this._textSymbol.textDy||0,u=this._getClusterText(e);oi.fillText(n,u,t.sub(e.textSize.x,0)._add(a,h))}n.globalAlpha=o}},e.prototype._getClusterText=function(t){return(this.layer.options.textSumProperty?t.textSumProperty:t.count)+""},e.prototype._getSprite=function(){this._spriteCache||(this._spriteCache={});var t=Gt.getSymbolStamp(this._symbol);return this._spriteCache[t]||(this._spriteCache[t]=new br([0,0],{symbol:this._symbol})._getSprite(this.resources,this.getMap().CanvasClass)),this._spriteCache[t]},e.prototype._initGridSystem=function(){var t=[],e=void 0,i=void 0;this.layer.forEach((function(n){n.isVisible()&&(i=n._getPrjCoordinates(),e=e?e._combine(n._getPrjExtent()):n._getPrjExtent(),t.push({x:i.x,y:i.y,id:n._getInternalId(),geometry:n}))})),this._markerExtent=e,this._markerPoints=t},e.prototype._computeGrid=function(){var t=this.getMap(),e=t.getZoom();this._markerExtent||this._initGridSystem(),this._clusterCache||(this._clusterCache={});var i=t._getResolution(t.getMinZoom())>t._getResolution(t.getMaxZoom())?e-1:e+1;this._clusterCache[i]&&this._clusterCache[i].length===this.layer.getCount()&&(this._clusterCache[e]=this._clusterCache[i]),this._clusterCache[e]||(this._clusterCache[e]=this._computeZoomGrid(e))},e.prototype._computeZoomGrid=function(t){if(!this._markerExtent)return null;var e=this.getMap(),i=e._getResolution(t)*this.layer.options.maxClusterRadius,n=e._getResolution(t-1)?e._getResolution(t-1)*this.layer.options.maxClusterRadius:null,r=this._clusterCache[t-1];!r&&t-1>=e.getMinZoom()&&(this._clusterCache[t-1]=r=this._computeZoomGrid(t-1));for(var o=this._markerPoints,s=this.layer.options.textSumProperty,a={},h=this._markerExtent.getMin(),u=void 0,l=void 0,c=0,p=o.length;c<p;c++){var f=o[c].geometry,d=0;s&&f.getProperties()&&f.getProperties()[s]&&(d=f.getProperties()[s]),a[u=Math.floor((o[c].x-h.x)/i)+"_"+Math.floor((o[c].y-h.y)/i)]?(a[u].sum._add(new Mi(o[c].x,o[c].y)),a[u].count++,a[u].center=a[u].sum.multi(1/a[u].count),a[u].children.push(f),a[u].textSumProperty+=d):(a[u]={sum:new Mi(o[c].x,o[c].y),center:new Mi(o[c].x,o[c].y),count:1,textSumProperty:d,children:[f],key:u+""},n&&r&&(l=Math.floor((o[c].x-h.x)/n)+"_"+Math.floor((o[c].y-h.y)/n),a[u].parent=r.clusterMap[l]))}return this._mergeClusters(a,i/2)},e.prototype._mergeClusters=function(t,e){var i={};for(var n in t)i[n]=t[n];var r={},o={},s=void 0,a=void 0;for(var h in t)if(!o[(s=t[h]).key])for(var u=s.key.split("_"),l=+u[0],c=+u[1],p=-1;p<=1;p++)for(var f=-1;f<=1;f++){if(0!==p||0!==f)(a=t[l+p+"_"+(c+f)])&&this._distanceTo(s.center,a.center)<=e&&(r[s.key]||(r[s.key]=[]),r[s.key].push(a),o[a.key]=1)}for(var d in r){var g=t[d];if(g){for(var y=r[d],_=0;_<y.length;_++)t[y[_].key]&&(g.sum._add(y[_].sum),g.count+=y[_].count,g.textSumProperty+=y[_].textSumProperty,g.children=g.children.concat(y[_].children),i[y[_].key]=g,delete t[y[_].key]);g.center=g.sum.multi(1/g.count)}}return{clusters:t,clusterMap:i}},e.prototype._distanceTo=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},e.prototype._stopAnim=function(){this._player&&"finished"!==this._player.playState&&this._player.finish()},e.prototype.onZoomStart=function(e){this._stopAnim(),t.prototype.onZoomStart.call(this,e)},e.prototype.onZoomEnd=function(e){!this.layer.isEmpty()&&this.layer.isVisible()?(this._inout=e.from>e.to?"in":"out",this._animated=!0,this._computeGrid(),t.prototype.onZoomEnd.apply(this,arguments)):t.prototype.onZoomEnd.apply(this,arguments)},e.prototype._clearDataCache=function(){this._stopAnim(),delete this._markerExtent,delete this._markerPoints,delete this._clusterCache,delete this._zoomInClusters},e}(Na.VectorLayerCanvasRenderer));class fp extends fs.Panel{constructor(t,e){Object.assign(e,{custom:!0}),super(e),this.id=t}}class dp extends is.UIMarker{constructor(t,e){Object.assign(e,{custom:!0,draggable:!1,autoPan:!0}),super(t,e)}}function gp(t,e){return t<e?-1:t>e?1:0}var yp=function(t,e,i,n){var r=t[0],o=t[1],s=!1;void 0===i&&(i=0),void 0===n&&(n=e.length);for(var a=(n-i)/2,h=0,u=a-1;h<a;u=h++){var l=e[i+2*h+0],c=e[i+2*h+1],p=e[i+2*u+0],f=e[i+2*u+1];c>o!=f>o&&r<(p-l)*(o-c)/(f-c)+l&&(s=!s)}return s},_p=function(t,e,i,n){var r=t[0],o=t[1],s=!1;void 0===i&&(i=0),void 0===n&&(n=e.length);for(var a=n-i,h=0,u=a-1;h<a;u=h++){var l=e[h+i][0],c=e[h+i][1],p=e[u+i][0],f=e[u+i][1];c>o!=f>o&&r<(p-l)*(o-c)/(f-c)+l&&(s=!s)}return s},mp=function(t,e,i,n){return e.length>0&&Array.isArray(e[0])?_p(t,e,i,n):yp(t,e,i,n)},vp=yp;mp.nested=_p,mp.flat=vp;var xp,wp=Au((function(t,e){!function(t){const e=134217729,i=33306690738754706e-32;function n(t,e,i,n,r){let o,s,a,h,u=e[0],l=n[0],c=0,p=0;l>u==l>-u?(o=u,u=e[++c]):(o=l,l=n[++p]);let f=0;if(c<t&&p<i)for(l>u==l>-u?(a=o-((s=u+o)-u),u=e[++c]):(a=o-((s=l+o)-l),l=n[++p]),o=s,0!==a&&(r[f++]=a);c<t&&p<i;)l>u==l>-u?(a=o-((s=o+u)-(h=s-o))+(u-h),u=e[++c]):(a=o-((s=o+l)-(h=s-o))+(l-h),l=n[++p]),o=s,0!==a&&(r[f++]=a);for(;c<t;)a=o-((s=o+u)-(h=s-o))+(u-h),u=e[++c],o=s,0!==a&&(r[f++]=a);for(;p<i;)a=o-((s=o+l)-(h=s-o))+(l-h),l=n[++p],o=s,0!==a&&(r[f++]=a);return 0===o&&0!==f||(r[f++]=o),f}function r(t){return new Float64Array(t)}const o=33306690738754716e-32,s=22204460492503146e-32,a=11093356479670487e-47,h=r(4),u=r(8),l=r(12),c=r(16),p=r(4);t.orient2d=function(t,r,f,d,g,y){const _=(r-y)*(f-g),m=(t-g)*(d-y),v=_-m;if(0===_||0===m||_>0!=m>0)return v;const x=Math.abs(_+m);return Math.abs(v)>=o*x?v:-function(t,r,o,f,d,g,y){let _,m,v,x,w,b,C,M,E,S,P,I,T,L,O,R,N,A;const D=t-d,k=o-d,F=r-g,j=f-g;w=(O=(M=D-(C=(b=e*D)-(b-D)))*(S=j-(E=(b=e*j)-(b-j)))-((L=D*j)-C*E-M*E-C*S))-(P=O-(N=(M=F-(C=(b=e*F)-(b-F)))*(S=k-(E=(b=e*k)-(b-k)))-((R=F*k)-C*E-M*E-C*S))),h[0]=O-(P+w)+(w-N),w=(T=L-((I=L+P)-(w=I-L))+(P-w))-(P=T-R),h[1]=T-(P+w)+(w-R),w=(A=I+P)-I,h[2]=I-(A-w)+(P-w),h[3]=A;let G=function(t,e){let i=e[0];for(let n=1;n<t;n++)i+=e[n];return i}(4,h),z=s*y;if(G>=z||-G>=z)return G;if(_=t-(D+(w=t-D))+(w-d),v=o-(k+(w=o-k))+(w-d),m=r-(F+(w=r-F))+(w-g),x=f-(j+(w=f-j))+(w-g),0===_&&0===m&&0===v&&0===x)return G;if(z=a*y+i*Math.abs(G),(G+=D*x+j*_-(F*v+k*m))>=z||-G>=z)return G;w=(O=(M=_-(C=(b=e*_)-(b-_)))*(S=j-(E=(b=e*j)-(b-j)))-((L=_*j)-C*E-M*E-C*S))-(P=O-(N=(M=m-(C=(b=e*m)-(b-m)))*(S=k-(E=(b=e*k)-(b-k)))-((R=m*k)-C*E-M*E-C*S))),p[0]=O-(P+w)+(w-N),w=(T=L-((I=L+P)-(w=I-L))+(P-w))-(P=T-R),p[1]=T-(P+w)+(w-R),w=(A=I+P)-I,p[2]=I-(A-w)+(P-w),p[3]=A;const B=n(4,h,4,p,u);w=(O=(M=D-(C=(b=e*D)-(b-D)))*(S=x-(E=(b=e*x)-(b-x)))-((L=D*x)-C*E-M*E-C*S))-(P=O-(N=(M=F-(C=(b=e*F)-(b-F)))*(S=v-(E=(b=e*v)-(b-v)))-((R=F*v)-C*E-M*E-C*S))),p[0]=O-(P+w)+(w-N),w=(T=L-((I=L+P)-(w=I-L))+(P-w))-(P=T-R),p[1]=T-(P+w)+(w-R),w=(A=I+P)-I,p[2]=I-(A-w)+(P-w),p[3]=A;const V=n(B,u,4,p,l);w=(O=(M=_-(C=(b=e*_)-(b-_)))*(S=x-(E=(b=e*x)-(b-x)))-((L=_*x)-C*E-M*E-C*S))-(P=O-(N=(M=m-(C=(b=e*m)-(b-m)))*(S=v-(E=(b=e*v)-(b-v)))-((R=m*v)-C*E-M*E-C*S))),p[0]=O-(P+w)+(w-N),w=(T=L-((I=L+P)-(w=I-L))+(P-w))-(P=T-R),p[1]=T-(P+w)+(w-R),w=(A=I+P)-I,p[2]=I-(A-w)+(P-w),p[3]=A;const H=n(V,l,4,p,c);return c[H-1]}(t,r,f,d,g,y,x)},t.orient2dfast=function(t,e,i,n,r,o){return(e-o)*(i-r)-(t-r)*(n-o)},Object.defineProperty(t,"__esModule",{value:!0})}(e)}));(xp=wp)&&xp.__esModule&&Object.prototype.hasOwnProperty.call(xp,"default")&&xp.default;var bp=class{constructor(t=[],e=gp){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const s=n+1;if(s<this.length&&i(e[s],o)<0&&(n=s,o=e[s]),i(o,r)>=0)break;e[t]=o,t=n}e[t]=r}},Cp=wp.orient2d;bp.default&&(bp=bp.default);var Mp=Ep;function Ep(t,e,i){e=Math.max(0,void 0===e?2:e),i=i||0;var n=function(t){for(var e=t[0],i=t[0],n=t[0],r=t[0],o=0;o<t.length;o++){var s=t[o];s[0]<e[0]&&(e=s),s[0]>n[0]&&(n=s),s[1]<i[1]&&(i=s),s[1]>r[1]&&(r=s)}var a=[e,i,n,r],h=a.slice();for(o=0;o<t.length;o++)mp(t[o],a)||h.push(t[o]);return function(t){t.sort(Fp);for(var e=[],i=0;i<t.length;i++){for(;e.length>=2&&Op(e[e.length-2],e[e.length-1],t[i])<=0;)e.pop();e.push(t[i])}for(var n=[],r=t.length-1;r>=0;r--){for(;n.length>=2&&Op(n[n.length-2],n[n.length-1],t[r])<=0;)n.pop();n.push(t[r])}return n.pop(),e.pop(),e.concat(n)}(h)}(t),r=new Ba(16);r.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},r.compareMinX=function(t,e){return t[0]-e[0]},r.compareMinY=function(t,e){return t[1]-e[1]},r.load(t);for(var o,s=[],a=0;a<n.length;a++){var h=n[a];r.remove(h),o=Np(h,o),s.push(o)}var u=new Ba(16);for(a=0;a<s.length;a++)u.insert(Rp(s[a]));for(var l=e*e,c=i*i;s.length;){var p=s.shift(),f=p.p,d=p.next.p,g=Ap(f,d);if(!(g<c)){var y=g/l;(h=Sp(r,p.prev.p,f,d,p.next.next.p,y,u))&&Math.min(Ap(h,f),Ap(h,d))<=y&&(s.push(p),s.push(Np(h,p)),r.remove(h),u.remove(p),u.insert(Rp(p)),u.insert(Rp(p.next)))}}p=o;var _=[];do{_.push(p.p),p=p.next}while(p!==o);return _.push(p.p),_}function Sp(t,e,i,n,r,o,s){for(var a=new bp([],Pp),h=t.data;h;){for(var u=0;u<h.children.length;u++){var l=h.children[u],c=h.leaf?Dp(l,i,n):Ip(i,n,l);c>o||a.push({node:l,dist:c})}for(;a.length&&!a.peek().node.children;){var p=a.pop(),f=p.node,d=Dp(f,e,i),g=Dp(f,n,r);if(p.dist<d&&p.dist<g&&Lp(i,f,s)&&Lp(n,f,s))return f}(h=a.pop())&&(h=h.node)}return null}function Pp(t,e){return t.dist-e.dist}function Ip(t,e,i){if(Tp(t,i)||Tp(e,i))return 0;var n=kp(t[0],t[1],e[0],e[1],i.minX,i.minY,i.maxX,i.minY);if(0===n)return 0;var r=kp(t[0],t[1],e[0],e[1],i.minX,i.minY,i.minX,i.maxY);if(0===r)return 0;var o=kp(t[0],t[1],e[0],e[1],i.maxX,i.minY,i.maxX,i.maxY);if(0===o)return 0;var s=kp(t[0],t[1],e[0],e[1],i.minX,i.maxY,i.maxX,i.maxY);return 0===s?0:Math.min(n,r,o,s)}function Tp(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function Lp(t,e,i){for(var n,r,o,s,a=Math.min(t[0],e[0]),h=Math.min(t[1],e[1]),u=Math.max(t[0],e[0]),l=Math.max(t[1],e[1]),c=i.search({minX:a,minY:h,maxX:u,maxY:l}),p=0;p<c.length;p++)if(n=c[p].p,r=c[p].next.p,o=t,n!==(s=e)&&r!==o&&Op(n,r,o)>0!=Op(n,r,s)>0&&Op(o,s,n)>0!=Op(o,s,r)>0)return!1;return!0}function Op(t,e,i){return Cp(t[0],t[1],e[0],e[1],i[0],i[1])}function Rp(t){var e=t.p,i=t.next.p;return t.minX=Math.min(e[0],i[0]),t.minY=Math.min(e[1],i[1]),t.maxX=Math.max(e[0],i[0]),t.maxY=Math.max(e[1],i[1]),t}function Np(t,e){var i={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(i.next=e.next,i.prev=e,e.next.prev=i,e.next=i):(i.prev=i,i.next=i),i}function Ap(t,e){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function Dp(t,e,i){var n=e[0],r=e[1],o=i[0]-n,s=i[1]-r;if(0!==o||0!==s){var a=((t[0]-n)*o+(t[1]-r)*s)/(o*o+s*s);a>1?(n=i[0],r=i[1]):a>0&&(n+=o*a,r+=s*a)}return(o=t[0]-n)*o+(s=t[1]-r)*s}function kp(t,e,i,n,r,o,s,a){var h,u,l,c,p=i-t,f=n-e,d=s-r,g=a-o,y=t-r,_=e-o,m=p*p+f*f,v=p*d+f*g,x=d*d+g*g,w=p*y+f*_,b=d*y+g*_,C=m*x-v*v,M=C,E=C;0===C?(u=0,M=1,c=b,E=x):(c=m*b-v*w,(u=v*b-x*w)<0?(u=0,c=b,E=x):u>M&&(u=M,c=b+v,E=x)),c<0?(c=0,-w<0?u=0:-w>m?u=M:(u=-w,M=m)):c>E&&(c=E,-w+v<0?u=0:-w+v>m?u=M:(u=-w+v,M=m));var S=(1-(l=0===c?0:c/E))*r+l*s-((1-(h=0===u?0:u/M))*t+h*i),P=(1-l)*o+l*a-((1-h)*e+h*n);return S*S+P*P}function Fp(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}var jp=Ep;function Gp(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var i=[];if(wh(t,(function(t){i.push([t[0],t[1]])})),!i.length)return null;var n=jp(i,e.concavity);return n.length>3?ph([n]):null}function zp(t){var e=[1/0,1/0,-1/0,-1/0];return wh(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}Ep.default=Mp,zp.default=zp,"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),i=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(i+n,0):Math.min(n,i);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(r=r<0?Math.max(i+arguments[2],0):Math.min(r,i);n<r;)e[n]=t,++n;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Bp=function(){};Bp.prototype.interfaces_=function(){return[]},Bp.prototype.getClass=function(){return Bp},Bp.prototype.equalsWithTolerance=function(t,e,i){return Math.abs(t-e)<=i};var Vp=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Hp=function(){},qp={MAX_VALUE:{configurable:!0}};Hp.isNaN=function(t){return Number.isNaN(t)},Hp.doubleToLongBits=function(t){return t},Hp.longBitsToDouble=function(t){return t},Hp.isInfinite=function(t){return!Number.isFinite(t)},qp.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(Hp,qp);var Zp=function(){},Up=function(){},Wp=function(){};function Yp(){}var Xp=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Jp={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Xp.prototype.setOrdinate=function(t,e){switch(t){case Xp.X:this.x=e;break;case Xp.Y:this.y=e;break;case Xp.Z:this.z=e;break;default:throw new Vp("Invalid ordinate index: "+t)}},Xp.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!Bp.equalsWithTolerance(this.x,e.x,i)&&!!Bp.equalsWithTolerance(this.y,e.y,i)}},Xp.prototype.getOrdinate=function(t){switch(t){case Xp.X:return this.x;case Xp.Y:return this.y;case Xp.Z:return this.z}throw new Vp("Invalid ordinate index: "+t)},Xp.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||Hp.isNaN(this.z))&&Hp.isNaN(t.z)},Xp.prototype.equals=function(t){return t instanceof Xp&&this.equals2D(t)},Xp.prototype.equalInZ=function(t,e){return Bp.equalsWithTolerance(this.z,t.z,e)},Xp.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},Xp.prototype.clone=function(){},Xp.prototype.copy=function(){return new Xp(this)},Xp.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},Xp.prototype.distance3D=function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)},Xp.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},Xp.prototype.hashCode=function(){var t=17;return t=37*(t=37*t+Xp.hashCode(this.x))+Xp.hashCode(this.y)},Xp.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},Xp.prototype.interfaces_=function(){return[Zp,Up,Yp]},Xp.prototype.getClass=function(){return Xp},Xp.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=Hp.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},Jp.DimensionalComparator.get=function(){return Qp},Jp.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},Jp.NULL_ORDINATE.get=function(){return Hp.NaN},Jp.X.get=function(){return 0},Jp.Y.get=function(){return 1},Jp.Z.get=function(){return 2},Object.defineProperties(Xp,Jp);var Qp=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new Vp("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};Qp.prototype.compare=function(t,e){var i=t,n=e,r=Qp.compare(i.x,n.x);if(0!==r)return r;var o=Qp.compare(i.y,n.y);return 0!==o?o:this._dimensionsToTest<=2?0:Qp.compare(i.z,n.z)},Qp.prototype.interfaces_=function(){return[Wp]},Qp.prototype.getClass=function(){return Qp},Qp.compare=function(t,e){return t<e?-1:t>e?1:Hp.isNaN(t)?Hp.isNaN(e)?0:-1:Hp.isNaN(e)?1:0};var Kp=function(){};Kp.prototype.create=function(){},Kp.prototype.interfaces_=function(){return[]},Kp.prototype.getClass=function(){return Kp};var $p=function(){},tf={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};$p.prototype.interfaces_=function(){return[]},$p.prototype.getClass=function(){return $p},$p.toLocationSymbol=function(t){switch(t){case $p.EXTERIOR:return"e";case $p.BOUNDARY:return"b";case $p.INTERIOR:return"i";case $p.NONE:return"-"}throw new Vp("Unknown location value: "+t)},tf.INTERIOR.get=function(){return 0},tf.BOUNDARY.get=function(){return 1},tf.EXTERIOR.get=function(){return 2},tf.NONE.get=function(){return-1},Object.defineProperties($p,tf);var ef=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},nf=function(){},rf={LOG_10:{configurable:!0}};nf.prototype.interfaces_=function(){return[]},nf.prototype.getClass=function(){return nf},nf.log10=function(t){var e=Math.log(t);return Hp.isInfinite(e)||Hp.isNaN(e)?e:e/nf.LOG_10},nf.min=function(t,e,i,n){var r=t;return e<r&&(r=e),i<r&&(r=i),n<r&&(r=n),r},nf.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],r=arguments[1],o=arguments[2];return n<r?r:n>o?o:n}},nf.wrap=function(t,e){return t<0?e- -t%e:t%e},nf.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2],n=t;return e>n&&(n=e),i>n&&(n=i),n}if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],h=r;return o>h&&(h=o),s>h&&(h=s),a>h&&(h=a),h}},nf.average=function(t,e){return(t+e)/2},rf.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(nf,rf);var of=function(t){this.str=t};of.prototype.append=function(t){this.str+=t},of.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},of.prototype.toString=function(t){return this.str};var sf=function(t){this.value=t};sf.prototype.intValue=function(){return this.value},sf.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},sf.isNaN=function(t){return Number.isNaN(t)};var af=function(){};af.isWhitespace=function(t){return t<=32&&t>=0||127===t},af.toUpperCase=function(t){return t.toUpperCase()};var hf=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}else if("string"==typeof arguments[0]){var n=arguments[0];t.call(this,t.parse(n))}}else if(2===arguments.length){var r=arguments[0],o=arguments[1];this.init(r,o)}},uf={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};hf.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},hf.prototype.extractSignificantDigits=function(t,e){var i=this.abs(),n=hf.magnitude(i._hi),r=hf.TEN.pow(n);(i=i.divide(r)).gt(hf.TEN)?(i=i.divide(hf.TEN),n+=1):i.lt(hf.ONE)&&(i=i.multiply(hf.TEN),n-=1);for(var o=n+1,s=new of,a=hf.MAX_PRINT_DIGITS-1,h=0;h<=a;h++){t&&h===o&&s.append(".");var u=Math.trunc(i._hi);if(u<0)break;var l=!1,c=0;u>9?(l=!0,c="9"):c="0"+u,s.append(c),i=i.subtract(hf.valueOf(u)).multiply(hf.TEN),l&&i.selfAdd(hf.TEN);var p=!0,f=hf.magnitude(i._hi);if(f<0&&Math.abs(f)>=a-h&&(p=!1),!p)break}return e[0]=n,s.toString()},hf.prototype.sqr=function(){return this.multiply(this)},hf.prototype.doubleValue=function(){return this._hi+this._lo},hf.prototype.subtract=function(){if(arguments[0]instanceof hf){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},hf.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},hf.prototype.isZero=function(){return 0===this._hi&&0===this._lo},hf.prototype.selfSubtract=function(){if(arguments[0]instanceof hf){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},hf.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},hf.prototype.min=function(t){return this.le(t)?this:t},hf.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof hf){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1],r=null,o=null,s=null,a=null,h=null,u=null,l=null,c=null;return h=this._hi/i,c=(r=(u=hf.SPLIT*h)-(r=u-h))*(s=(c=hf.SPLIT*i)-(s=c-i))-(l=h*i)+r*(a=i-s)+(o=h-r)*s+o*a,c=h+(u=(this._hi-l-c+this._lo-h*n)/i),this._hi=c,this._lo=h-c+u,this}},hf.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},hf.prototype.divide=function(){if(arguments[0]instanceof hf){var t=arguments[0],e=null,i=null,n=null,r=null,o=null,s=null,a=null,h=null;i=(o=this._hi/t._hi)-(e=(s=hf.SPLIT*o)-(e=s-o)),h=e*(n=(h=hf.SPLIT*t._hi)-(n=h-t._hi))-(a=o*t._hi)+e*(r=t._hi-n)+i*n+i*r;var u=h=o+(s=(this._hi-a-h+this._lo-o*t._lo)/t._hi),l=o-h+s;return new hf(u,l)}if("number"==typeof arguments[0]){var c=arguments[0];return Hp.isNaN(c)?hf.createNaN():hf.copy(this).selfDivide(c,0)}},hf.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},hf.prototype.pow=function(t){if(0===t)return hf.valueOf(1);var e=new hf(this),i=hf.valueOf(1),n=Math.abs(t);if(n>1)for(;n>0;)n%2==1&&i.selfMultiply(e),(n/=2)>0&&(e=e.sqr());else i=e;return t<0?i.reciprocal():i},hf.prototype.ceil=function(){if(this.isNaN())return hf.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new hf(t,e)},hf.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},hf.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},hf.prototype.setValue=function(){if(arguments[0]instanceof hf){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},hf.prototype.max=function(t){return this.ge(t)?this:t},hf.prototype.sqrt=function(){if(this.isZero())return hf.valueOf(0);if(this.isNegative())return hf.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,i=hf.valueOf(e),n=this.subtract(i.sqr())._hi*(.5*t);return i.add(n)},hf.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof hf){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],i=null,n=null,r=null,o=null,s=null,a=null;return o=(r=this._hi+e)-(s=r-this._hi),n=(a=(o=e-s+(this._hi-o))+this._lo)+(r-(i=r+a)),this._hi=i+n,this._lo=n+(i-this._hi),this}}else if(2===arguments.length){var h=arguments[0],u=arguments[1],l=null,c=null,p=null,f=null,d=null,g=null,y=null;f=this._hi+h,c=this._lo+u,d=f-(g=f-this._hi),p=c-(y=c-this._lo);var _=(l=f+(g=(d=h-g+(this._hi-d))+c))+(g=(p=u-y+(this._lo-p))+(g+(f-l))),m=g+(l-_);return this._hi=_,this._lo=m,this}},hf.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof hf){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1],r=null,o=null,s=null,a=null,h=null,u=null;r=(h=hf.SPLIT*this._hi)-this._hi,u=hf.SPLIT*i,r=h-r,o=this._hi-r,s=u-i;var l=(h=this._hi*i)+(u=r*(s=u-s)-h+r*(a=i-s)+o*s+o*a+(this._hi*n+this._lo*i)),c=u+(r=h-l);return this._hi=l,this._lo=c,this}},hf.prototype.selfSqr=function(){return this.selfMultiply(this)},hf.prototype.floor=function(){if(this.isNaN())return hf.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new hf(t,e)},hf.prototype.negate=function(){return this.isNaN()?this:new hf(-this._hi,-this._lo)},hf.prototype.clone=function(){},hf.prototype.multiply=function(){if(arguments[0]instanceof hf){var t=arguments[0];return t.isNaN()?hf.createNaN():hf.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return Hp.isNaN(e)?hf.createNaN():hf.copy(this).selfMultiply(e,0)}},hf.prototype.isNaN=function(){return Hp.isNaN(this._hi)},hf.prototype.intValue=function(){return Math.trunc(this._hi)},hf.prototype.toString=function(){var t=hf.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},hf.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!0,e),n=e[0]+1,r=i;if("."===i.charAt(0))r="0"+i;else if(n<0)r="0."+hf.stringOfChar("0",-n)+i;else if(-1===i.indexOf(".")){var o=n-i.length;r=i+hf.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+r:r},hf.prototype.reciprocal=function(){var t,e,i,n,r=null,o=null,s=null,a=null;t=(i=1/this._hi)-(r=(s=hf.SPLIT*i)-(r=s-i)),o=(a=hf.SPLIT*this._hi)-this._hi;var h=i+(s=(1-(n=i*this._hi)-(a=r*(o=a-o)-n+r*(e=this._hi-o)+t*o+t*e)-i*this._lo)/this._hi);return new hf(h,i-h+s)},hf.prototype.toSciNotation=function(){if(this.isZero())return hf.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!1,e),n=hf.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var r="";i.length>1&&(r=i.substring(1));var o=i.charAt(0)+"."+r;return this.isNegative()?"-"+o+n:o+n},hf.prototype.abs=function(){return this.isNaN()?hf.NaN:this.isNegative()?this.negate():new hf(this)},hf.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},hf.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},hf.prototype.add=function(){if(arguments[0]instanceof hf){var t=arguments[0];return hf.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return hf.copy(this).selfAdd(e)}},hf.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof hf){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this._hi=i,this._lo=n}},hf.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},hf.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},hf.prototype.trunc=function(){return this.isNaN()?hf.NaN:this.isPositive()?this.floor():this.ceil()},hf.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},hf.prototype.interfaces_=function(){return[Yp,Zp,Up]},hf.prototype.getClass=function(){return hf},hf.sqr=function(t){return hf.valueOf(t).selfMultiply(t)},hf.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return hf.parse(t)}if("number"==typeof arguments[0]){var e=arguments[0];return new hf(e)}},hf.sqrt=function(t){return hf.valueOf(t).sqrt()},hf.parse=function(t){for(var e=0,i=t.length;af.isWhitespace(t.charAt(e));)e++;var n=!1;if(e<i){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(n=!0))}for(var o=new hf,s=0,a=0,h=0;!(e>=i);){var u=t.charAt(e);if(e++,af.isDigit(u)){var l=u-"0";o.selfMultiply(hf.TEN),o.selfAdd(l),s++}else{if("."!==u){if("e"===u||"E"===u){var c=t.substring(e);try{h=sf.parseInt(c)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+c+" in string "+t):e}break}throw new Error("Unexpected character '"+u+"' at position "+e+" in string "+t)}a=s}}var p=o,f=s-a-h;if(0===f)p=o;else if(f>0){var d=hf.TEN.pow(f);p=o.divide(d)}else if(f<0){var g=hf.TEN.pow(-f);p=o.multiply(g)}return n?p.negate():p},hf.createNaN=function(){return new hf(Hp.NaN,Hp.NaN)},hf.copy=function(t){return new hf(t)},hf.magnitude=function(t){var e=Math.abs(t),i=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(i));return 10*Math.pow(10,n)<=e&&(n+=1),n},hf.stringOfChar=function(t,e){for(var i=new of,n=0;n<e;n++)i.append(t);return i.toString()},uf.PI.get=function(){return new hf(3.141592653589793,12246467991473532e-32)},uf.TWO_PI.get=function(){return new hf(6.283185307179586,24492935982947064e-32)},uf.PI_2.get=function(){return new hf(1.5707963267948966,6123233995736766e-32)},uf.E.get=function(){return new hf(2.718281828459045,14456468917292502e-32)},uf.NaN.get=function(){return new hf(Hp.NaN,Hp.NaN)},uf.EPS.get=function(){return 123259516440783e-46},uf.SPLIT.get=function(){return 134217729},uf.MAX_PRINT_DIGITS.get=function(){return 32},uf.TEN.get=function(){return hf.valueOf(10)},uf.ONE.get=function(){return hf.valueOf(1)},uf.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},uf.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(hf,uf);var lf=function(){},cf={DP_SAFE_EPSILON:{configurable:!0}};lf.prototype.interfaces_=function(){return[]},lf.prototype.getClass=function(){return lf},lf.orientationIndex=function(t,e,i){var n=lf.orientationIndexFilter(t,e,i);if(n<=1)return n;var r=hf.valueOf(e.x).selfAdd(-t.x),o=hf.valueOf(e.y).selfAdd(-t.y),s=hf.valueOf(i.x).selfAdd(-e.x),a=hf.valueOf(i.y).selfAdd(-e.y);return r.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},lf.signOfDet2x2=function(t,e,i,n){return t.multiply(n).selfSubtract(e.multiply(i)).signum()},lf.intersection=function(t,e,i,n){var r=hf.valueOf(n.y).selfSubtract(i.y).selfMultiply(hf.valueOf(e.x).selfSubtract(t.x)),o=hf.valueOf(n.x).selfSubtract(i.x).selfMultiply(hf.valueOf(e.y).selfSubtract(t.y)),s=r.subtract(o),a=hf.valueOf(n.x).selfSubtract(i.x).selfMultiply(hf.valueOf(t.y).selfSubtract(i.y)),h=hf.valueOf(n.y).selfSubtract(i.y).selfMultiply(hf.valueOf(t.x).selfSubtract(i.x)),u=a.subtract(h).selfDivide(s).doubleValue(),l=hf.valueOf(t.x).selfAdd(hf.valueOf(e.x).selfSubtract(t.x).selfMultiply(u)).doubleValue(),c=hf.valueOf(e.x).selfSubtract(t.x).selfMultiply(hf.valueOf(t.y).selfSubtract(i.y)),p=hf.valueOf(e.y).selfSubtract(t.y).selfMultiply(hf.valueOf(t.x).selfSubtract(i.x)),f=c.subtract(p).selfDivide(s).doubleValue(),d=hf.valueOf(i.y).selfAdd(hf.valueOf(n.y).selfSubtract(i.y).selfMultiply(f)).doubleValue();return new Xp(l,d)},lf.orientationIndexFilter=function(t,e,i){var n=null,r=(t.x-i.x)*(e.y-i.y),o=(t.y-i.y)*(e.x-i.x),s=r-o;if(r>0){if(o<=0)return lf.signum(s);n=r+o}else{if(!(r<0))return lf.signum(s);if(o>=0)return lf.signum(s);n=-r-o}var a=lf.DP_SAFE_EPSILON*n;return s>=a||-s>=a?lf.signum(s):2},lf.signum=function(t){return t>0?1:t<0?-1:0},cf.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(lf,cf);var pf=function(){},ff={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};ff.X.get=function(){return 0},ff.Y.get=function(){return 1},ff.Z.get=function(){return 2},ff.M.get=function(){return 3},pf.prototype.setOrdinate=function(t,e,i){},pf.prototype.size=function(){},pf.prototype.getOrdinate=function(t,e){},pf.prototype.getCoordinate=function(){},pf.prototype.getCoordinateCopy=function(t){},pf.prototype.getDimension=function(){},pf.prototype.getX=function(t){},pf.prototype.clone=function(){},pf.prototype.expandEnvelope=function(t){},pf.prototype.copy=function(){},pf.prototype.getY=function(t){},pf.prototype.toCoordinateArray=function(){},pf.prototype.interfaces_=function(){return[Up]},pf.prototype.getClass=function(){return pf},Object.defineProperties(pf,ff);var df=function(){},gf=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(df),yf=function(){};yf.arraycopy=function(t,e,i,n,r){for(var o=0,s=e;s<e+r;s++)i[n+o]=t[s],o++},yf.getProperty=function(t){return{"line.separator":"\n"}[t]};var _f=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],n=arguments[1];this.x=i,this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var r=arguments[0],o=arguments[1];this.x=r.y*o.w-o.y*r.w,this.y=o.x*r.w-r.x*o.w,this.w=r.x*o.y-o.x*r.y}else if(arguments[0]instanceof Xp&&arguments[1]instanceof Xp){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var h=arguments[0],u=arguments[1],l=arguments[2];this.x=h,this.y=u,this.w=l}else if(4===arguments.length){var c=arguments[0],p=arguments[1],f=arguments[2],d=arguments[3],g=c.y-p.y,y=p.x-c.x,_=c.x*p.y-p.x*c.y,m=f.y-d.y,v=d.x-f.x,x=f.x*d.y-d.x*f.y;this.x=y*x-v*_,this.y=m*_-g*x,this.w=g*v-m*y}};_f.prototype.getY=function(){var t=this.y/this.w;if(Hp.isNaN(t)||Hp.isInfinite(t))throw new gf;return t},_f.prototype.getX=function(){var t=this.x/this.w;if(Hp.isNaN(t)||Hp.isInfinite(t))throw new gf;return t},_f.prototype.getCoordinate=function(){var t=new Xp;return t.x=this.getX(),t.y=this.getY(),t},_f.prototype.interfaces_=function(){return[]},_f.prototype.getClass=function(){return _f},_f.intersection=function(t,e,i,n){var r=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=i.y-n.y,h=n.x-i.x,u=i.x*n.y-n.x*i.y,l=r*h-a*o,c=(o*u-h*s)/l,p=(a*s-r*u)/l;if(Hp.isNaN(c)||Hp.isInfinite(c)||Hp.isNaN(p)||Hp.isInfinite(p))throw new gf;return new Xp(c,p)};var mf=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof Xp){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],h=arguments[3];this.init(o,s,a,h)}},vf={serialVersionUID:{configurable:!0}};mf.prototype.getArea=function(){return this.getWidth()*this.getHeight()},mf.prototype.equals=function(t){if(!(t instanceof mf))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},mf.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new mf;var e=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny,n=this._maxx<t._maxx?this._maxx:t._maxx,r=this._maxy<t._maxy?this._maxy:t._maxy;return new mf(e,n,i,r)},mf.prototype.isNull=function(){return this._maxx<this._minx},mf.prototype.getMaxX=function(){return this._maxx},mf.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof Xp){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof mf){var e=arguments[0];return!this.isNull()&&!e.isNull()&&(e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return!this.isNull()&&(i>=this._minx&&i<=this._maxx&&n>=this._miny&&n<=this._maxy)}},mf.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof mf){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof Xp){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return!this.isNull()&&!(i>this._maxx||i<this._minx||n>this._maxy||n<this._miny)}},mf.prototype.getMinY=function(){return this._miny},mf.prototype.getMinX=function(){return this._minx},mf.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof Xp){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof mf){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=n,this._maxy=n):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}},mf.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},mf.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},mf.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},mf.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},mf.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},mf.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},mf.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},mf.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},mf.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},mf.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof mf){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof Xp){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return this.covers(i,n)}},mf.prototype.centre=function(){return this.isNull()?null:new Xp((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},mf.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof Xp){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof mf){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.init(i.x,n.x,i.y,n.y)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];r<o?(this._minx=r,this._maxx=o):(this._minx=o,this._maxx=r),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},mf.prototype.getMaxY=function(){return this._maxy},mf.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var i=0;return this._maxy<t._miny?i=t._miny-this._maxy:this._miny>t._maxy&&(i=this._miny-t._maxy),0===e?i:0===i?e:Math.sqrt(e*e+i*i)},mf.prototype.hashCode=function(){var t=17;return t=37*(t=37*(t=37*(t=37*t+Xp.hashCode(this._minx))+Xp.hashCode(this._maxx))+Xp.hashCode(this._miny))+Xp.hashCode(this._maxy)},mf.prototype.interfaces_=function(){return[Zp,Yp]},mf.prototype.getClass=function(){return mf},mf.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2];return i.x>=(t.x<e.x?t.x:e.x)&&i.x<=(t.x>e.x?t.x:e.x)&&i.y>=(t.y<e.y?t.y:e.y)&&i.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),h=Math.max(o.x,s.x),u=Math.min(n.x,r.x),l=Math.max(n.x,r.x);return!(u>h)&&(!(l<a)&&(a=Math.min(o.y,s.y),h=Math.max(o.y,s.y),u=Math.min(n.y,r.y),l=Math.max(n.y,r.y),!(u>h)&&!(l<a)))}},vf.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(mf,vf);var xf={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},wf=function(t){this.geometryFactory=t||new sg};wf.prototype.read=function(t){var e,i,n;t=t.replace(/[\n\r]/g," ");var r=xf.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((r=xf.emptyTypeStr.exec(t))[2]=void 0),r&&(i=r[1].toLowerCase(),n=r[2],Cf[i]&&(e=Cf[i].apply(this,[n]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},wf.prototype.write=function(t){return this.extractGeometry(t)},wf.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!bf[e])return null;var i=e.toUpperCase();return t.isEmpty()?i+" EMPTY":i+"("+bf[e].apply(this,[t])+")"};var bf={coordinate:function(t){return t.x+" "+t.y},point:function(t){return bf.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+bf.point.apply(this,[t._geometries[i]])+")");return e.join(",")},linestring:function(t){for(var e=[],i=0,n=t._points._coordinates.length;i<n;++i)e.push(bf.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},linearring:function(t){for(var e=[],i=0,n=t._points._coordinates.length;i<n;++i)e.push(bf.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},multilinestring:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+bf.linestring.apply(this,[t._geometries[i]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+bf.linestring.apply(this,[t._shell])+")");for(var i=0,n=t._holes.length;i<n;++i)e.push("("+bf.linestring.apply(this,[t._holes[i]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+bf.polygon.apply(this,[t._geometries[i]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push(this.extractGeometry(t._geometries[i]));return e.join(",")}},Cf={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(xf.spaces);return this.geometryFactory.createPoint(new Xp(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPoint();for(var i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace(xf.trimParens,"$1"),n.push(Cf.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(n)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].trim().split(xf.spaces),n.push(new Xp(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].trim().split(xf.spaces),n.push(new Xp(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiLineString();for(var i=t.trim().split(xf.parenComma),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace(xf.trimParens,"$1"),n.push(Cf.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(n)},polygon:function(t){var e,i,n;if(void 0===t)return this.geometryFactory.createPolygon();for(var r,o=t.trim().split(xf.parenComma),s=[],a=0,h=o.length;a<h;++a)e=o[a].replace(xf.trimParens,"$1"),i=Cf.linestring.apply(this,[e]),n=this.geometryFactory.createLinearRing(i._points),0===a?r=n:s.push(n);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var i=t.trim().split(xf.doubleParenComma),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace(xf.trimParens,"$1"),n.push(Cf.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(n)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],n=0,r=e.length;n<r;++n)i.push(this.read(e[n]));return this.geometryFactory.createGeometryCollection(i)}},Mf=function(t){this.parser=new wf(t)};Mf.prototype.write=function(t){return this.parser.write(t)},Mf.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Ef=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Sf=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ef),Pf=function(){};Pf.prototype.interfaces_=function(){return[]},Pf.prototype.getClass=function(){return Pf},Pf.shouldNeverReachHere=function(){if(0===arguments.length)Pf.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new Sf("Should never reach here"+(null!==t?": "+t:""))}},Pf.isTrue=function(){var t;if(1===arguments.length)Pf.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new Sf:new Sf(t)},Pf.equals=function(){var t,e,i;if(2===arguments.length)Pf.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],i=arguments[2],!(e=arguments[1]).equals(t)))throw new Sf("Expected "+t+" but encountered "+e+(null!==i?": "+i:""))};var If=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Xp,this._intPt[1]=new Xp,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Tf={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};If.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},If.prototype.getTopologySummary=function(){var t=new of;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},If.prototype.computeIntersection=function(t,e,i,n){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=i,this._inputLines[1][1]=n,this._result=this.computeIntersect(t,e,i,n)},If.prototype.getIntersectionNum=function(){return this._result},If.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),i=this.getEdgeDistance(t,1);e>i?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},If.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},If.prototype.setPrecisionModel=function(t){this._precisionModel=t},If.prototype.isInteriorIntersection=function(){var t=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],i=0;i<this._result;i++)if(!t._intPt[i].equals2D(t._inputLines[e][0])&&!t._intPt[i].equals2D(t._inputLines[e][1]))return!0;return!1}},If.prototype.getIntersection=function(t){return this._intPt[t]},If.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},If.prototype.hasIntersection=function(){return this._result!==If.NO_INTERSECTION},If.prototype.getEdgeDistance=function(t,e){return If.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},If.prototype.isCollinear=function(){return this._result===If.COLLINEAR_INTERSECTION},If.prototype.toString=function(){return Mf.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Mf.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},If.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},If.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},If.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},If.prototype.interfaces_=function(){return[]},If.prototype.getClass=function(){return If},If.computeEdgeDistance=function(t,e,i){var n=Math.abs(i.x-e.x),r=Math.abs(i.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(i))o=n>r?n:r;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=n>r?s:a)||t.equals(e)||(o=Math.max(s,a))}return Pf.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},If.nonRobustComputeEdgeDistance=function(t,e,i){var n=t.x-e.x,r=t.y-e.y,o=Math.sqrt(n*n+r*r);return Pf.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},Tf.DONT_INTERSECT.get=function(){return 0},Tf.DO_INTERSECT.get=function(){return 1},Tf.COLLINEAR.get=function(){return 2},Tf.NO_INTERSECTION.get=function(){return 0},Tf.POINT_INTERSECTION.get=function(){return 1},Tf.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(If,Tf);var Lf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new mf(this._inputLines[0][0],this._inputLines[0][1]),i=new mf(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&i.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],i=arguments[1],n=arguments[2];if(this._isProper=!1,mf.intersects(i,n,e)&&0===Nf.orientationIndex(i,n,e)&&0===Nf.orientationIndex(n,i,e))return this._isProper=!0,(e.equals(i)||e.equals(n))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,i,n,r){r.x=this.smallestInAbsValue(t.x,e.x,i.x,n.x),r.y=this.smallestInAbsValue(t.y,e.y,i.y,n.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,i.x-=r.x,i.y-=r.y,n.x-=r.x,n.y-=r.y},e.prototype.safeHCoordinateIntersection=function(t,i,n,r){var o=null;try{o=_f.intersection(t,i,n,r)}catch(s){if(!(s instanceof gf))throw s;o=e.nearestEndpoint(t,i,n,r)}return o},e.prototype.intersection=function(t,i,n,r){var o=this.intersectionWithNormalization(t,i,n,r);return this.isInSegmentEnvelopes(o)||(o=new Xp(e.nearestEndpoint(t,i,n,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,i,n){var r=t,o=Math.abs(r);return Math.abs(e)<o&&(r=e,o=Math.abs(e)),Math.abs(i)<o&&(r=i,o=Math.abs(i)),Math.abs(n)<o&&(r=n),r},e.prototype.checkDD=function(t,e,i,n,r){var o=lf.intersection(t,e,i,n),s=this.isInSegmentEnvelopes(o);yf.out.println("DD in env = "+s+"  --------------------- "+o),r.distance(o)>1e-4&&yf.out.println("Distance = "+r.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,i,n){var r=new Xp(t),o=new Xp(e),s=new Xp(i),a=new Xp(n),h=new Xp;this.normalizeToEnvCentre(r,o,s,a,h);var u=this.safeHCoordinateIntersection(r,o,s,a);return u.x+=h.x,u.y+=h.y,u},e.prototype.computeCollinearIntersection=function(e,i,n,r){var o=mf.intersects(e,i,n),s=mf.intersects(e,i,r),a=mf.intersects(n,r,e),h=mf.intersects(n,r,i);return o&&s?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):a&&h?(this._intPt[0]=e,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||h?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&h?(this._intPt[0]=n,this._intPt[1]=i,!n.equals(i)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||o||h?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&h?(this._intPt[0]=r,this._intPt[1]=i,!r.equals(i)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,i,n,r){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,h=t.y>e.y?t.y:e.y,u=i.x<n.x?i.x:n.x,l=i.y<n.y?i.y:n.y,c=i.x>n.x?i.x:n.x,p=i.y>n.y?i.y:n.y,f=((o>u?o:u)+(a<c?a:c))/2,d=((s>l?s:l)+(h<p?h:p))/2;r.x=f,r.y=d,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,i.x-=r.x,i.y-=r.y,n.x-=r.x,n.y-=r.y},e.prototype.computeIntersect=function(e,i,n,r){if(this._isProper=!1,!mf.intersects(e,i,n,r))return t.NO_INTERSECTION;var o=Nf.orientationIndex(e,i,n),s=Nf.orientationIndex(e,i,r);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=Nf.orientationIndex(n,r,e),h=Nf.orientationIndex(n,r,i);return a>0&&h>0||a<0&&h<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===h?this.computeCollinearIntersection(e,i,n,r):(0===o||0===s||0===a||0===h?(this._isProper=!1,e.equals2D(n)||e.equals2D(r)?this._intPt[0]=e:i.equals2D(n)||i.equals2D(r)?this._intPt[0]=i:0===o?this._intPt[0]=new Xp(n):0===s?this._intPt[0]=new Xp(r):0===a?this._intPt[0]=new Xp(e):0===h&&(this._intPt[0]=new Xp(i))):(this._isProper=!0,this._intPt[0]=this.intersection(e,i,n,r)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,i,n){var r=t,o=Nf.distancePointLine(t,i,n),s=Nf.distancePointLine(e,i,n);return s<o&&(o=s,r=e),(s=Nf.distancePointLine(i,t,e))<o&&(o=s,r=i),(s=Nf.distancePointLine(n,t,e))<o&&(o=s,r=n),r},e}(If),Of=function(){};Of.prototype.interfaces_=function(){return[]},Of.prototype.getClass=function(){return Of},Of.orientationIndex=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,o=i.x-e.x,s=i.y-e.y;return Of.signOfDet2x2(n,r,o,s)},Of.signOfDet2x2=function(t,e,i,n){var r=null,o=null,s=null;if(r=1,0===t||0===n)return 0===e||0===i?0:e>0?i>0?-r:r:i>0?r:-r;if(0===e||0===i)return n>0?t>0?r:-r:t>0?-r:r;if(e>0?n>0?e<=n||(r=-r,o=t,t=i,i=o,o=e,e=n,n=o):e<=-n?(r=-r,i=-i,n=-n):(o=t,t=-i,i=o,o=e,e=-n,n=o):n>0?-e<=n?(r=-r,t=-t,e=-e):(o=-t,t=i,i=o,o=-e,e=n,n=o):e>=n?(t=-t,e=-e,i=-i,n=-n):(r=-r,o=-t,t=-i,i=o,o=-e,e=-n,n=o),t>0){if(!(i>0))return r;if(!(t<=i))return r}else{if(i>0)return-r;if(!(t>=i))return-r;r=-r,t=-t,i=-i}for(;;){if((n-=(s=Math.floor(i/t))*e)<0)return-r;if(n>e)return r;if(t>(i-=s*t)+i){if(e<n+n)return r}else{if(e>n+n)return-r;i=t-i,n=e-n,r=-r}if(0===n)return 0===i?0:-r;if(0===i)return r;if((e-=(s=Math.floor(t/i))*n)<0)return r;if(e>n)return-r;if(i>(t-=s*i)+t){if(n<e+e)return-r}else{if(n>e+e)return r;t=i-t,e=n-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}};var Rf=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Rf.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var i=t.x,n=e.x;return i>n&&(i=e.x,n=t.x),this._p.x>=i&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var r=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,h=Of.signOfDet2x2(r,o,s,a);if(0===h)return this._isPointOnSegment=!0,null;a<o&&(h=-h),h>0&&this._crossingCount++}},Rf.prototype.isPointInPolygon=function(){return this.getLocation()!==$p.EXTERIOR},Rf.prototype.getLocation=function(){return this._isPointOnSegment?$p.BOUNDARY:this._crossingCount%2==1?$p.INTERIOR:$p.EXTERIOR},Rf.prototype.isOnSegment=function(){return this._isPointOnSegment},Rf.prototype.interfaces_=function(){return[]},Rf.prototype.getClass=function(){return Rf},Rf.locatePointInRing=function(){if(arguments[0]instanceof Xp&&ef(arguments[1],pf)){for(var t=arguments[0],e=arguments[1],i=new Rf(t),n=new Xp,r=new Xp,o=1;o<e.size();o++)if(e.getCoordinate(o,n),e.getCoordinate(o-1,r),i.countSegment(n,r),i.isOnSegment())return i.getLocation();return i.getLocation()}if(arguments[0]instanceof Xp&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],h=new Rf(s),u=1;u<a.length;u++){var l=a[u],c=a[u-1];if(h.countSegment(l,c),h.isOnSegment())return h.getLocation()}return h.getLocation()}};var Nf=function(){},Af={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Nf.prototype.interfaces_=function(){return[]},Nf.prototype.getClass=function(){return Nf},Nf.orientationIndex=function(t,e,i){return lf.orientationIndex(t,e,i)},Nf.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,i=t[0].x,n=1;n<t.length-1;n++){var r=t[n].x-i,o=t[n+1].y,s=t[n-1].y;e+=r*(s-o)}return e/2}if(ef(arguments[0],pf)){var a=arguments[0],h=a.size();if(h<3)return 0;var u=new Xp,l=new Xp,c=new Xp;a.getCoordinate(0,l),a.getCoordinate(1,c);var p=l.x;c.x-=p;for(var f=0,d=1;d<h-1;d++)u.y=l.y,l.x=c.x,l.y=c.y,a.getCoordinate(d+1,c),c.x-=p,f+=l.x*(u.y-c.y);return f/2}},Nf.distanceLineLine=function(t,e,i,n){if(t.equals(e))return Nf.distancePointLine(t,i,n);if(i.equals(n))return Nf.distancePointLine(n,t,e);var r=!1;if(mf.intersects(t,e,i,n)){var o=(e.x-t.x)*(n.y-i.y)-(e.y-t.y)*(n.x-i.x);if(0===o)r=!0;else{var s=(t.y-i.y)*(n.x-i.x)-(t.x-i.x)*(n.y-i.y),a=((t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y))/o,h=s/o;(h<0||h>1||a<0||a>1)&&(r=!0)}}else r=!0;return r?nf.min(Nf.distancePointLine(t,i,n),Nf.distancePointLine(e,i,n),Nf.distancePointLine(i,t,e),Nf.distancePointLine(n,t,e)):0},Nf.isPointInRing=function(t,e){return Nf.locatePointInRing(t,e)!==$p.EXTERIOR},Nf.computeLength=function(t){var e=t.size();if(e<=1)return 0;var i=0,n=new Xp;t.getCoordinate(0,n);for(var r=n.x,o=n.y,s=1;s<e;s++){t.getCoordinate(s,n);var a=n.x,h=n.y,u=a-r,l=h-o;i+=Math.sqrt(u*u+l*l),r=a,o=h}return i},Nf.isCCW=function(t){var e=t.length-1;if(e<3)throw new Vp("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],n=0,r=1;r<=e;r++){var o=t[r];o.y>i.y&&(i=o,n=r)}var s=n;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(i)&&s!==n);var a=n;do{a=(a+1)%e}while(t[a].equals2D(i)&&a!==n);var h=t[s],u=t[a];if(h.equals2D(i)||u.equals2D(i)||h.equals2D(u))return!1;var l=Nf.computeOrientation(h,i,u),c=!1;return c=0===l?h.x>u.x:l>0,c},Nf.locatePointInRing=function(t,e){return Rf.locatePointInRing(t,e)},Nf.distancePointLinePerpendicular=function(t,e,i){var n=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),r=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/n;return Math.abs(r)*Math.sqrt(n)},Nf.computeOrientation=function(t,e,i){return Nf.orientationIndex(t,e,i)},Nf.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new Vp("Line array must contain at least one vertex");for(var i=t.distance(e[0]),n=0;n<e.length-1;n++){var r=Nf.distancePointLine(t,e[n],e[n+1]);r<i&&(i=r)}return i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var h=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),u=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/h;if(u<=0)return o.distance(s);if(u>=1)return o.distance(a);var l=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/h;return Math.abs(l)*Math.sqrt(h)}},Nf.isOnLine=function(t,e){for(var i=new Lf,n=1;n<e.length;n++){var r=e[n-1],o=e[n];if(i.computeIntersection(t,r,o),i.hasIntersection())return!0}return!1},Af.CLOCKWISE.get=function(){return-1},Af.RIGHT.get=function(){return Nf.CLOCKWISE},Af.COUNTERCLOCKWISE.get=function(){return 1},Af.LEFT.get=function(){return Nf.COUNTERCLOCKWISE},Af.COLLINEAR.get=function(){return 0},Af.STRAIGHT.get=function(){return Nf.COLLINEAR},Object.defineProperties(Nf,Af);var Df=function(){};Df.prototype.filter=function(t){},Df.prototype.interfaces_=function(){return[]},Df.prototype.getClass=function(){return Df};var kf=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},Ff={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};kf.prototype.isGeometryCollection=function(){return this.getSortIndex()===kf.SORTINDEX_GEOMETRYCOLLECTION},kf.prototype.getFactory=function(){return this._factory},kf.prototype.getGeometryN=function(t){return this},kf.prototype.getArea=function(){return 0},kf.prototype.isRectangle=function(){return!1},kf.prototype.equals=function(){if(arguments[0]instanceof kf){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof kf))return!1;var i=e;return this.equalsExact(i)}},kf.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},kf.prototype.geometryChanged=function(){this.apply(kf.geometryChangedFilter)},kf.prototype.geometryChangedAction=function(){this._envelope=null},kf.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},kf.prototype.getLength=function(){return 0},kf.prototype.getNumGeometries=function(){return 1},kf.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var i=arguments[0],n=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,n)}},kf.prototype.getUserData=function(){return this._userData},kf.prototype.getSRID=function(){return this._SRID},kf.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},kf.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===kf.SORTINDEX_GEOMETRYCOLLECTION)throw new Vp("This method does not support GeometryCollection arguments")},kf.prototype.equal=function(t,e,i){return 0===i?t.equals(e):t.distance(e)<=i},kf.prototype.norm=function(){var t=this.copy();return t.normalize(),t},kf.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},kf.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new mf(this._envelope)},kf.prototype.setSRID=function(t){this._SRID=t},kf.prototype.setUserData=function(t){this._userData=t},kf.prototype.compare=function(t,e){for(var i=t.iterator(),n=e.iterator();i.hasNext()&&n.hasNext();){var r=i.next(),o=n.next(),s=r.compareTo(o);if(0!==s)return s}return i.hasNext()?1:n.hasNext()?-1:0},kf.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},kf.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===kf.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===kf.SORTINDEX_MULTIPOINT||this.getSortIndex()===kf.SORTINDEX_MULTILINESTRING||this.getSortIndex()===kf.SORTINDEX_MULTIPOLYGON},kf.prototype.interfaces_=function(){return[Up,Zp,Yp]},kf.prototype.getClass=function(){return kf},kf.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},kf.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},Ff.serialVersionUID.get=function(){return 0x799ea46522854c00},Ff.SORTINDEX_POINT.get=function(){return 0},Ff.SORTINDEX_MULTIPOINT.get=function(){return 1},Ff.SORTINDEX_LINESTRING.get=function(){return 2},Ff.SORTINDEX_LINEARRING.get=function(){return 3},Ff.SORTINDEX_MULTILINESTRING.get=function(){return 4},Ff.SORTINDEX_POLYGON.get=function(){return 5},Ff.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Ff.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Ff.geometryChangedFilter.get=function(){return jf},Object.defineProperties(kf,Ff);var jf=function(){};jf.interfaces_=function(){return[Df]},jf.filter=function(t){t.geometryChangedAction()};var Gf=function(){};Gf.prototype.filter=function(t){},Gf.prototype.interfaces_=function(){return[]},Gf.prototype.getClass=function(){return Gf};var zf=function(){},Bf={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};zf.prototype.isInBoundary=function(t){},zf.prototype.interfaces_=function(){return[]},zf.prototype.getClass=function(){return zf},Bf.Mod2BoundaryNodeRule.get=function(){return Vf},Bf.EndPointBoundaryNodeRule.get=function(){return Hf},Bf.MultiValentEndPointBoundaryNodeRule.get=function(){return qf},Bf.MonoValentEndPointBoundaryNodeRule.get=function(){return Zf},Bf.MOD2_BOUNDARY_RULE.get=function(){return new Vf},Bf.ENDPOINT_BOUNDARY_RULE.get=function(){return new Hf},Bf.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new qf},Bf.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Zf},Bf.OGC_SFS_BOUNDARY_RULE.get=function(){return zf.MOD2_BOUNDARY_RULE},Object.defineProperties(zf,Bf);var Vf=function(){};Vf.prototype.isInBoundary=function(t){return t%2==1},Vf.prototype.interfaces_=function(){return[zf]},Vf.prototype.getClass=function(){return Vf};var Hf=function(){};Hf.prototype.isInBoundary=function(t){return t>0},Hf.prototype.interfaces_=function(){return[zf]},Hf.prototype.getClass=function(){return Hf};var qf=function(){};qf.prototype.isInBoundary=function(t){return t>1},qf.prototype.interfaces_=function(){return[zf]},qf.prototype.getClass=function(){return qf};var Zf=function(){};Zf.prototype.isInBoundary=function(t){return 1===t},Zf.prototype.interfaces_=function(){return[zf]},Zf.prototype.getClass=function(){return Zf};var Uf=function(){};function Wf(t){this.message=t||""}Uf.prototype.add=function(){},Uf.prototype.addAll=function(){},Uf.prototype.isEmpty=function(){},Uf.prototype.iterator=function(){},Uf.prototype.size=function(){},Uf.prototype.toArray=function(){},Uf.prototype.remove=function(){},Wf.prototype=new Error,Wf.prototype.name="IndexOutOfBoundsException";var Yf=function(){};Yf.prototype.hasNext=function(){},Yf.prototype.next=function(){},Yf.prototype.remove=function(){};var Xf=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(Uf);function Jf(t){this.message=t||""}Jf.prototype=new Error,Jf.prototype.name="NoSuchElementException";var Qf=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Uf&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,Uf]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var i=this.array_[t];return this.array_[t]=e,i},e.prototype.iterator=function(){return new Kf(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new Wf;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,i=0,n=this.array_.length;i<n;i++)if(this.array_[i]===t){this.array_.splice(i,1),e=!0;break}return e},e}(Xf),Kf=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Jf;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Yf),$f=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.ensureCapacity(i.length),this.add(i,n)}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={coordArrayType:{configurable:!0}};return i.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){var e=this;if(2===arguments.length){for(var i=arguments[0],n=arguments[1],r=!1,o=i.iterator();o.hasNext();)e.add(o.next(),n),r=!0;return r}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),i=0;i<this.size();i++)e.add(i,this.get(i).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var e=this;if(1===arguments.length){var i=arguments[0];t.prototype.add.call(this,i)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var n=arguments[0],r=arguments[1];return this.add(n,r,!0),!0}if(arguments[0]instanceof Xp&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var a=this.get(this.size()-1);if(a.equals2D(o))return null}t.prototype.add.call(this,o)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var h=arguments[0],u=arguments[1];return this.add(h,u),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var l=arguments[0],c=arguments[1],p=arguments[2];if(p)for(var f=0;f<l.length;f++)e.add(l[f],c);else for(var d=l.length-1;d>=0;d--)e.add(l[d],c);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof Xp){var g=arguments[0],y=arguments[1],_=arguments[2];if(!_){var m=this.size();if(m>0){if(g>0){var v=this.get(g-1);if(v.equals2D(y))return null}if(g<m){var x=this.get(g);if(x.equals2D(y))return null}}}t.prototype.add.call(this,g,y)}}else if(4===arguments.length){var w=arguments[0],b=arguments[1],C=arguments[2],M=arguments[3],E=1;C>M&&(E=-1);for(var S=C;S!==M;S+=E)e.add(w[S],b);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Xp(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,i),e}(Qf),td=function(){},ed={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};ed.ForwardComparator.get=function(){return id},ed.BidirectionalComparator.get=function(){return nd},ed.coordArrayType.get=function(){return new Array(0).fill(null)},td.prototype.interfaces_=function(){return[]},td.prototype.getClass=function(){return td},td.isRing=function(t){return!(t.length<4)&&!!t[0].equals2D(t[t.length-1])},td.ptNotInList=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(td.indexOf(n,e)<0)return n}return null},td.scroll=function(t,e){var i=td.indexOf(e,t);if(i<0)return null;var n=new Array(t.length).fill(null);yf.arraycopy(t,i,n,0,t.length-i),yf.arraycopy(t,0,n,t.length-i,i),yf.arraycopy(n,0,t,0,t.length)},td.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];if(n===r)return!0;if(null===n||null===r)return!1;if(n.length!==r.length)return!1;for(var s=0;s<n.length;s++)if(0!==o.compare(n[s],r[s]))return!1;return!0}},td.intersection=function(t,e){for(var i=new $f,n=0;n<t.length;n++)e.intersects(t[n])&&i.add(t[n],!0);return i.toCoordinateArray()},td.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},td.removeRepeatedPoints=function(t){return td.hasRepeatedPoints(t)?new $f(t,!1).toCoordinateArray():t},td.reverse=function(t){for(var e=t.length-1,i=Math.trunc(e/2),n=0;n<=i;n++){var r=t[n];t[n]=t[e-n],t[e-n]=r}},td.removeNull=function(t){for(var e=0,i=0;i<t.length;i++)null!==t[i]&&e++;var n=new Array(e).fill(null);if(0===e)return n;for(var r=0,o=0;o<t.length;o++)null!==t[o]&&(n[r++]=t[o]);return n},td.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),i=0;i<t.length;i++)e[i]=new Xp(t[i]);return e}if(5===arguments.length)for(var n=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],h=0;h<a;h++)o[s+h]=new Xp(n[r+h])},td.isEqualReversed=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=e[t.length-i-1];if(0!==n.compareTo(r))return!1}return!0},td.envelope=function(t){for(var e=new mf,i=0;i<t.length;i++)e.expandToInclude(t[i]);return e},td.toCoordinateArray=function(t){return t.toArray(td.coordArrayType)},td.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},td.indexOf=function(t,e){for(var i=0;i<e.length;i++)if(t.equals(e[i]))return i;return-1},td.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var i=t.length-1-e,n=t[e].compareTo(t[i]);if(0!==n)return n}return 1},td.compare=function(t,e){for(var i=0;i<t.length&&i<e.length;){var n=t[i].compareTo(e[i]);if(0!==n)return n;i++}return i<e.length?-1:i<t.length?1:0},td.minCoordinate=function(t){for(var e=null,i=0;i<t.length;i++)(null===e||e.compareTo(t[i])>0)&&(e=t[i]);return e},td.extract=function(t,e,i){e=nf.clamp(e,0,t.length);var n=(i=nf.clamp(i,-1,t.length))-e+1;i<0&&(n=0),e>=t.length&&(n=0),i<e&&(n=0);var r=new Array(n).fill(null);if(0===n)return r;for(var o=0,s=e;s<=i;s++)r[o++]=t[s];return r},Object.defineProperties(td,ed);var id=function(){};id.prototype.compare=function(t,e){return td.compare(t,e)},id.prototype.interfaces_=function(){return[Wp]},id.prototype.getClass=function(){return id};var nd=function(){};nd.prototype.compare=function(t,e){var i=t,n=e;if(i.length<n.length)return-1;if(i.length>n.length)return 1;if(0===i.length)return 0;var r=td.compare(i,n);return td.isEqualReversed(i,n)?0:r},nd.prototype.OLDcompare=function(t,e){var i=t,n=e;if(i.length<n.length)return-1;if(i.length>n.length)return 1;if(0===i.length)return 0;for(var r=td.increasingDirection(i),o=td.increasingDirection(n),s=r>0?0:i.length-1,a=o>0?0:i.length-1,h=0;h<i.length;h++){var u=i[s].compareTo(n[a]);if(0!==u)return u;s+=r,a+=o}return 0},nd.prototype.interfaces_=function(){return[Wp]},nd.prototype.getClass=function(){return nd};var rd=function(){};rd.prototype.get=function(){},rd.prototype.put=function(){},rd.prototype.size=function(){},rd.prototype.values=function(){},rd.prototype.entrySet=function(){};var od=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(rd);function sd(t){this.message=t||""}function ad(){}sd.prototype=new Error,sd.prototype.name="OperationNotSupported",ad.prototype=new Uf,ad.prototype.contains=function(){};var hd=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Uf&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,i=this.array_.length;e<i;e++){if(this.array_[e]===t)return!0}return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new ud(this)},e}(ad),ud=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Jf;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new sd},e}(Yf);function ld(t){return null===t?0:t.color}function cd(t){return null===t?null:t.parent}function pd(t,e){null!==t&&(t.color=e)}function fd(t){return null===t?null:t.left}function dd(t){return null===t?null:t.right}function gd(){this.root_=null,this.size_=0}gd.prototype=new od,gd.prototype.get=function(t){for(var e=this.root_;null!==e;){var i=t.compareTo(e.key);if(i<0)e=e.left;else{if(!(i>0))return e.value;e=e.right}}return null},gd.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,n,r=this.root_;do{if(i=r,(n=t.compareTo(r.key))<0)r=r.left;else{if(!(n>0)){var o=r.value;return r.value=e,o}r=r.right}}while(null!==r);var s={key:t,left:null,right:null,value:e,parent:i,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return n<0?i.left=s:i.right=s,this.fixAfterInsertion(s),this.size_++,null},gd.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(cd(t)===fd(cd(cd(t)))){var i=dd(cd(cd(t)));1===ld(i)?(pd(cd(t),0),pd(i,0),pd(cd(cd(t)),1),t=cd(cd(t))):(t===dd(cd(t))&&(t=cd(t),e.rotateLeft(t)),pd(cd(t),0),pd(cd(cd(t)),1),e.rotateRight(cd(cd(t))))}else{var n=fd(cd(cd(t)));1===ld(n)?(pd(cd(t),0),pd(n,0),pd(cd(cd(t)),1),t=cd(cd(t))):(t===fd(cd(t))&&(t=cd(t),e.rotateRight(t)),pd(cd(t),0),pd(cd(cd(t)),1),e.rotateLeft(cd(cd(t))))}this.root_.color=0},gd.prototype.values=function(){var t=new Qf,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=gd.successor(e));)t.add(e.value);return t},gd.prototype.entrySet=function(){var t=new hd,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=gd.successor(e));)t.add(e);return t},gd.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},gd.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},gd.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},gd.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var i=t.parent,n=t;null!==i&&n===i.right;)n=i,i=i.parent;return i},gd.prototype.size=function(){return this.size_};var yd=function(){};function _d(){}function md(){this.array_=[],arguments[0]instanceof Uf&&this.addAll(arguments[0])}yd.prototype.interfaces_=function(){return[]},yd.prototype.getClass=function(){return yd},_d.prototype=new ad,md.prototype=new _d,md.prototype.contains=function(t){for(var e=0,i=this.array_.length;e<i;e++){if(0===this.array_[e].compareTo(t))return!0}return!1},md.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,i=this.array_.length;e<i;e++){if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0}return this.array_.push(t),!0},md.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},md.prototype.remove=function(t){throw new sd},md.prototype.size=function(){return this.array_.length},md.prototype.isEmpty=function(){return 0===this.array_.length},md.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},md.prototype.iterator=function(){return new vd(this)};var vd=function(t){this.treeSet_=t,this.position_=0};vd.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Jf;return this.treeSet_.array_[this.position_++]},vd.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},vd.prototype.remove=function(){throw new sd};var xd=function(){};xd.sort=function(){var t,e,i,n,r=arguments[0];if(1===arguments.length)n=function(t,e){return t.compareTo(e)},r.sort(n);else if(2===arguments.length)i=arguments[1],n=function(t,e){return i.compare(t,e)},r.sort(n);else if(3===arguments.length){(e=r.slice(arguments[1],arguments[2])).sort();var o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])}else if(4===arguments.length)for(e=r.slice(arguments[1],arguments[2]),i=arguments[3],n=function(t,e){return i.compare(t,e)},e.sort(n),o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])},xd.asList=function(t){for(var e=new Qf,i=0,n=t.length;i<n;i++)e.add(t[i]);return e};var wd=function(){},bd={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};bd.P.get=function(){return 0},bd.L.get=function(){return 1},bd.A.get=function(){return 2},bd.FALSE.get=function(){return-1},bd.TRUE.get=function(){return-2},bd.DONTCARE.get=function(){return-3},bd.SYM_FALSE.get=function(){return"F"},bd.SYM_TRUE.get=function(){return"T"},bd.SYM_DONTCARE.get=function(){return"*"},bd.SYM_P.get=function(){return"0"},bd.SYM_L.get=function(){return"1"},bd.SYM_A.get=function(){return"2"},wd.prototype.interfaces_=function(){return[]},wd.prototype.getClass=function(){return wd},wd.toDimensionSymbol=function(t){switch(t){case wd.FALSE:return wd.SYM_FALSE;case wd.TRUE:return wd.SYM_TRUE;case wd.DONTCARE:return wd.SYM_DONTCARE;case wd.P:return wd.SYM_P;case wd.L:return wd.SYM_L;case wd.A:return wd.SYM_A}throw new Vp("Unknown dimension value: "+t)},wd.toDimensionValue=function(t){switch(af.toUpperCase(t)){case wd.SYM_FALSE:return wd.FALSE;case wd.SYM_TRUE:return wd.TRUE;case wd.SYM_DONTCARE:return wd.DONTCARE;case wd.SYM_P:return wd.P;case wd.SYM_L:return wd.L;case wd.SYM_A:return wd.A}throw new Vp("Unknown dimension symbol: "+t)},Object.defineProperties(wd,bd);var Cd=function(){};Cd.prototype.filter=function(t){},Cd.prototype.interfaces_=function(){return[]},Cd.prototype.getClass=function(){return Cd};var Md=function(){};Md.prototype.filter=function(t,e){},Md.prototype.isDone=function(){},Md.prototype.isGeometryChanged=function(){},Md.prototype.interfaces_=function(){return[]},Md.prototype.getClass=function(){return Md};var Ed=function(t){function e(e,i){if(t.call(this,i),this._geometries=e||[],t.hasNullElements(this._geometries))throw new Vp("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new mf,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=0;i<this._geometries.length;i++)for(var n=this._geometries[i].getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var i=arguments[0],n=arguments[1];if(!this.isEquivalentClass(i))return!1;var r=i;if(this._geometries.length!==r._geometries.length)return!1;for(var o=0;o<this._geometries.length;o++)if(!e._geometries[o].equalsExact(r._geometries[o],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();xd.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=wd.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=wd.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],i=new md(xd.asList(this._geometries)),n=new md(xd.asList(e._geometries));return this.compare(i,n)}if(2===arguments.length){for(var r=arguments[0],o=arguments[1],s=r,a=this.getNumGeometries(),h=s.getNumGeometries(),u=0;u<a&&u<h;){var l=t.getGeometryN(u),c=s.getGeometryN(u),p=l.compareToSameClass(c,o);if(0!==p)return p;u++}return u<a?1:u<h?-1:0}},e.prototype.apply=function(){var t=this;if(ef(arguments[0],Gf))for(var e=arguments[0],i=0;i<this._geometries.length;i++)t._geometries[i].apply(e);else if(ef(arguments[0],Md)){var n=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(t._geometries[r].apply(n),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(ef(arguments[0],Cd)){var o=arguments[0];o.filter(this);for(var s=0;s<this._geometries.length;s++)t._geometries[s].apply(o)}else if(ef(arguments[0],Df)){var a=arguments[0];a.filter(this);for(var h=0;h<this._geometries.length;h++)t._geometries[h].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Pf.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var i=0;i<this._geometries.length;i++)e._geometries[i]=this._geometries[i].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,i),e}(kf),Sd=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return kf.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?wd.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[t-1-i]=this._geometries[i].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Pd(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[yd]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,i),e}(Ed),Pd=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=zf.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=n}};Pd.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Pd.prototype.getBoundary=function(){return this._geom instanceof jd?this.boundaryLineString(this._geom):this._geom instanceof Sd?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Pd.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Pd.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Pd.prototype.computeBoundaryCoordinates=function(t){var e=this,i=new Qf;this._endpointMap=new gd;for(var n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);0!==r.getNumPoints()&&(e.addEndpoint(r.getCoordinateN(0)),e.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var s=o.next(),a=s.getValue().count;e._bnRule.isInBoundary(a)&&i.add(s.getKey())}return td.toCoordinateArray(i)},Pd.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new Id,this._endpointMap.put(t,e)),e.count++},Pd.prototype.interfaces_=function(){return[]},Pd.prototype.getClass=function(){return Pd},Pd.getBoundary=function(){if(1===arguments.length){var t=arguments[0],e=new Pd(t);return e.getBoundary()}if(2===arguments.length){var i=arguments[0],n=arguments[1],r=new Pd(i,n);return r.getBoundary()}};var Id=function(){this.count=null};function Td(){}function Ld(){}Id.prototype.interfaces_=function(){return[]},Id.prototype.getClass=function(){return Id};var Od=function(){};function Rd(){}function Nd(){}function Ad(){}var Dd=function(){},kd={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Dd.prototype.interfaces_=function(){return[]},Dd.prototype.getClass=function(){return Dd},Dd.chars=function(t,e){for(var i=new Array(e).fill(null),n=0;n<e;n++)i[n]=t;return String(i)},Dd.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new Rd,i=new Td(e);return t.printStackTrace(i),e.toString()}if(2===arguments.length){for(var n=arguments[0],r=arguments[1],o="",s=new Ld(Dd.getStackTrace(n)),a=new Ad(s),h=0;h<r;h++)try{o+=a.readLine()+Dd.NEWLINE}catch(t){if(!(t instanceof Nd))throw t;Pf.shouldNeverReachHere()}return o}},Dd.split=function(t,e){for(var i=e.length,n=new Qf,r=""+t,o=r.indexOf(e);o>=0;){var s=r.substring(0,o);n.add(s),o=(r=r.substring(o+i)).indexOf(e)}r.length>0&&n.add(r);for(var a=new Array(n.size()).fill(null),h=0;h<a.length;h++)a[h]=n.get(h);return a},Dd.toString=function(){if(1===arguments.length){var t=arguments[0];return Dd.SIMPLE_ORDINATE_FORMAT.format(t)}},Dd.spaces=function(t){return Dd.chars(" ",t)},kd.NEWLINE.get=function(){return yf.getProperty("line.separator")},kd.SIMPLE_ORDINATE_FORMAT.get=function(){return new Od("0.#")},Object.defineProperties(Dd,kd);var Fd=function(){};Fd.prototype.interfaces_=function(){return[]},Fd.prototype.getClass=function(){return Fd},Fd.copyCoord=function(t,e,i,n){for(var r=Math.min(t.getDimension(),i.getDimension()),o=0;o<r;o++)i.setOrdinate(n,o,t.getOrdinate(e,o))},Fd.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&(t.getOrdinate(0,pf.X)===t.getOrdinate(e-1,pf.X)&&t.getOrdinate(0,pf.Y)===t.getOrdinate(e-1,pf.Y))},Fd.isEqual=function(t,e){var i=t.size();if(i!==e.size())return!1;for(var n=Math.min(t.getDimension(),e.getDimension()),r=0;r<i;r++)for(var o=0;o<n;o++){var s=t.getOrdinate(r,o),a=e.getOrdinate(r,o);if(t.getOrdinate(r,o)!==e.getOrdinate(r,o)&&(!Hp.isNaN(s)||!Hp.isNaN(a)))return!1}return!0},Fd.extend=function(t,e,i){var n=t.create(i,e.getDimension()),r=e.size();if(Fd.copy(e,0,n,0,r),r>0)for(var o=r;o<i;o++)Fd.copy(e,r-1,n,o,1);return n},Fd.reverse=function(t){for(var e=t.size()-1,i=Math.trunc(e/2),n=0;n<=i;n++)Fd.swap(t,n,e-n)},Fd.swap=function(t,e,i){if(e===i)return null;for(var n=0;n<t.getDimension();n++){var r=t.getOrdinate(e,n);t.setOrdinate(e,n,t.getOrdinate(i,n)),t.setOrdinate(i,n,r)}},Fd.copy=function(t,e,i,n,r){for(var o=0;o<r;o++)Fd.copyCoord(t,e+o,i,n+o)},Fd.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var i=t.getDimension(),n=new of;n.append("(");for(var r=0;r<e;r++){r>0&&n.append(" ");for(var o=0;o<i;o++)o>0&&n.append(","),n.append(Dd.toString(t.getOrdinate(r,o)))}return n.append(")"),n.toString()}},Fd.ensureValidRing=function(t,e){var i=e.size();return 0===i?e:i<=3?Fd.createClosedRing(t,e,4):e.getOrdinate(0,pf.X)===e.getOrdinate(i-1,pf.X)&&e.getOrdinate(0,pf.Y)===e.getOrdinate(i-1,pf.Y)?e:Fd.createClosedRing(t,e,i+1)},Fd.createClosedRing=function(t,e,i){var n=t.create(i,e.getDimension()),r=e.size();Fd.copy(e,0,n,0,r);for(var o=r;o<i;o++)Fd.copy(e,0,n,o,1);return n};var jd=function(t){function e(e,i){t.call(this,i),this._points=null,this.init(e)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new mf:this._points.expandEnvelope(new mf)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var i=arguments[0],n=arguments[1];if(!this.isEquivalentClass(i))return!1;var r=i;if(this._points.size()!==r._points.size())return!1;for(var o=0;o<this._points.size();o++)if(!e.equal(e._points.getCoordinate(o),r._points.getCoordinate(o),n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<Math.trunc(this._points.size()/2);e++){var i=t._points.size()-1-e;if(!t._points.getCoordinate(e).equals(t._points.getCoordinate(i)))return t._points.getCoordinate(e).compareTo(t._points.getCoordinate(i))>0&&Fd.reverse(t._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?wd.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Nf.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Fd.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],i=e,n=0,r=0;n<this._points.size()&&r<i._points.size();){var o=t._points.getCoordinate(n).compareTo(i._points.getCoordinate(r));if(0!==o)return o;n++,r++}return n<this._points.size()?1:r<i._points.size()?-1:0}if(2===arguments.length){var s=arguments[0],a=arguments[1],h=s;return a.compare(this._points,h._points)}},e.prototype.apply=function(){var t=this;if(ef(arguments[0],Gf))for(var e=arguments[0],i=0;i<this._points.size();i++)e.filter(t._points.getCoordinate(i));else if(ef(arguments[0],Md)){var n=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(n.filter(t._points,r),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(ef(arguments[0],Cd)){var o=arguments[0];o.filter(this)}else if(ef(arguments[0],Df)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return new Pd(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new Vp("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[yd]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,i),e}(kf),Gd=function(){};Gd.prototype.interfaces_=function(){return[]},Gd.prototype.getClass=function(){return Gd};var zd=function(t){function e(e,i){t.call(this,i),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new mf;var t=new mf;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),i))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return wd.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var i=arguments[0],n=arguments[1],r=i;return n.compare(this._coordinates,r._coordinates)}},e.prototype.apply=function(){if(ef(arguments[0],Gf)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(ef(arguments[0],Md)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(ef(arguments[0],Cd)){var i=arguments[0];i.filter(this)}else if(ef(arguments[0],Df)){var n=arguments[0];n.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),Pf.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Gd]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,i),e}(kf),Bd=function(){};Bd.prototype.interfaces_=function(){return[]},Bd.prototype.getClass=function(){return Bd};var Vd=function(t){function e(e,i,n){if(t.call(this,n),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===i&&(i=[]),t.hasNullElements(i))throw new Vp("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(i))throw new Vp("shell is empty but holes are not");this._shell=e,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=this._shell.getCoordinates(),n=0;n<i.length;n++)t[++e]=i[n];for(var r=0;r<this._holes.length;r++)for(var o=this._holes[r].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(Nf.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(Nf.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),i=0;i<5;i++){var n=t.getX(i);if(n!==e.getMinX()&&n!==e.getMaxX())return!1;var r=t.getY(i);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var h=t.getX(a),u=t.getY(a);if(h!==o===(u!==s))return!1;o=h,s=u}return!0},e.prototype.equalsExact=function(){var e=this;if(2===arguments.length){var i=arguments[0],n=arguments[1];if(!this.isEquivalentClass(i))return!1;var r=i,o=this._shell,s=r._shell;if(!o.equalsExact(s,n))return!1;if(this._holes.length!==r._holes.length)return!1;for(var a=0;a<this._holes.length;a++)if(!e._holes[a].equalsExact(r._holes[a],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var t=this;if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)t.normalize(t._holes[e],!1);xd.sort(this._holes)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];if(i.isEmpty())return null;var r=new Array(i.getCoordinates().length-1).fill(null);yf.arraycopy(i.getCoordinates(),0,r,0,r.length);var o=td.minCoordinate(i.getCoordinates());td.scroll(r,o),yf.arraycopy(r,0,i.getCoordinates(),0,r.length),i.getCoordinates()[r.length]=r[0],Nf.isCCW(i.getCoordinates())===n&&td.reverse(i.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var t=this;if(1===arguments.length){var e=arguments[0],i=this._shell,n=e._shell;return i.compareToSameClass(n)}if(2===arguments.length){var r=arguments[0],o=arguments[1],s=r,a=this._shell,h=s._shell,u=a.compareToSameClass(h,o);if(0!==u)return u;for(var l=this.getNumInteriorRing(),c=s.getNumInteriorRing(),p=0;p<l&&p<c;){var f=t.getInteriorRingN(p),d=s.getInteriorRingN(p),g=f.compareToSameClass(d,o);if(0!==g)return g;p++}return p<l?1:p<c?-1:0}},e.prototype.apply=function(t){var e=this;if(ef(t,Gf)){this._shell.apply(t);for(var i=0;i<this._holes.length;i++)e._holes[i].apply(t)}else if(ef(t,Md)){if(this._shell.apply(t),!t.isDone())for(var n=0;n<this._holes.length&&(e._holes[n].apply(t),!t.isDone());n++);t.isGeometryChanged()&&this.geometryChanged()}else if(ef(t,Cd))t.filter(this);else if(ef(t,Df)){t.filter(this),this._shell.apply(t);for(var r=0;r<this._holes.length;r++)e._holes[r].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var i=0;i<this._holes.length;i++)e._holes[i]=this._holes[i].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),i=new Array(this._holes.length).fill(null),n=0;n<i.length;n++)i[n]=this._holes[n].copy();return new e(t,i,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Bd]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,i),e}(kf),Hd=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return kf.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return wd.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Gd]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,i),e}(Ed),qd=function(t){function e(e,i){e instanceof Xp&&i instanceof sg&&(e=i.getCoordinateSequenceFactory().create(e)),t.call(this,e,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return kf.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return wd.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Fd.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new Vp("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Vp("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.MINIMUM_VALID_SIZE.get=function(){return 4},i.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,i),e}(jd),Zd=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return kf.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new Qf,e=0;e<this._geometries.length;e++)for(var i=this._geometries[e].getBoundary(),n=0;n<i.getNumGeometries();n++)t.add(i.getGeometryN(n));var r=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(r))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Bd]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,i),e}(Ed),Ud=function(t){this._factory=t||null,this._isUserDataCopied=!1},Wd={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Ud.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},Ud.prototype.edit=function(t,e){if(null===t)return null;var i=this.editInternal(t,e);return this._isUserDataCopied&&i.setUserData(t.getUserData()),i},Ud.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Ed?this.editGeometryCollection(t,e):t instanceof Vd?this.editPolygon(t,e):t instanceof zd||t instanceof jd?e.edit(t,this._factory):(Pf.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},Ud.prototype.editGeometryCollection=function(t,e){for(var i=e.edit(t,this._factory),n=new Qf,r=0;r<i.getNumGeometries();r++){var o=this.edit(i.getGeometryN(r),e);null===o||o.isEmpty()||n.add(o)}return i.getClass()===Hd?this._factory.createMultiPoint(n.toArray([])):i.getClass()===Sd?this._factory.createMultiLineString(n.toArray([])):i.getClass()===Zd?this._factory.createMultiPolygon(n.toArray([])):this._factory.createGeometryCollection(n.toArray([]))},Ud.prototype.editPolygon=function(t,e){var i=e.edit(t,this._factory);if(null===i&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var n=this.edit(i.getExteriorRing(),e);if(null===n||n.isEmpty())return this._factory.createPolygon();for(var r=new Qf,o=0;o<i.getNumInteriorRing();o++){var s=this.edit(i.getInteriorRingN(o),e);null===s||s.isEmpty()||r.add(s)}return this._factory.createPolygon(n,r.toArray([]))},Ud.prototype.interfaces_=function(){return[]},Ud.prototype.getClass=function(){return Ud},Ud.GeometryEditorOperation=function(){},Wd.NoOpGeometryOperation.get=function(){return Yd},Wd.CoordinateOperation.get=function(){return Xd},Wd.CoordinateSequenceOperation.get=function(){return Jd},Object.defineProperties(Ud,Wd);var Yd=function(){};Yd.prototype.edit=function(t,e){return t},Yd.prototype.interfaces_=function(){return[Ud.GeometryEditorOperation]},Yd.prototype.getClass=function(){return Yd};var Xd=function(){};Xd.prototype.edit=function(t,e){var i=this.editCoordinates(t.getCoordinates(),t);return null===i?t:t instanceof qd?e.createLinearRing(i):t instanceof jd?e.createLineString(i):t instanceof zd?i.length>0?e.createPoint(i[0]):e.createPoint():t},Xd.prototype.interfaces_=function(){return[Ud.GeometryEditorOperation]},Xd.prototype.getClass=function(){return Xd};var Jd=function(){};Jd.prototype.edit=function(t,e){return t instanceof qd?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof jd?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof zd?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},Jd.prototype.interfaces_=function(){return[Ud.GeometryEditorOperation]},Jd.prototype.getClass=function(){return Jd};var Qd=function(){var t=this;if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var i=0;i<e;i++)t._coordinates[i]=new Xp}else if(ef(arguments[0],pf)){var n=arguments[0];if(null===n)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)t._coordinates[r]=n.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1];this._coordinates=o,this._dimension=s,null===o&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=h;for(var u=0;u<a;u++)t._coordinates[u]=new Xp}},Kd={serialVersionUID:{configurable:!0}};Qd.prototype.setOrdinate=function(t,e,i){switch(e){case pf.X:this._coordinates[t].x=i;break;case pf.Y:this._coordinates[t].y=i;break;case pf.Z:this._coordinates[t].z=i;break;default:throw new Vp("invalid ordinateIndex")}},Qd.prototype.size=function(){return this._coordinates.length},Qd.prototype.getOrdinate=function(t,e){switch(e){case pf.X:return this._coordinates[t].x;case pf.Y:return this._coordinates[t].y;case pf.Z:return this._coordinates[t].z}return Hp.NaN},Qd.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],i=arguments[1];i.x=this._coordinates[e].x,i.y=this._coordinates[e].y,i.z=this._coordinates[e].z}},Qd.prototype.getCoordinateCopy=function(t){return new Xp(this._coordinates[t])},Qd.prototype.getDimension=function(){return this._dimension},Qd.prototype.getX=function(t){return this._coordinates[t].x},Qd.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new Qd(t,this._dimension)},Qd.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},Qd.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new Qd(t,this._dimension)},Qd.prototype.toString=function(){if(this._coordinates.length>0){var t=new of(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},Qd.prototype.getY=function(t){return this._coordinates[t].y},Qd.prototype.toCoordinateArray=function(){return this._coordinates},Qd.prototype.interfaces_=function(){return[pf,Yp]},Qd.prototype.getClass=function(){return Qd},Kd.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Qd,Kd);var $d=function(){},tg={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};$d.prototype.readResolve=function(){return $d.instance()},$d.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new Qd(t)}if(ef(arguments[0],pf)){var e=arguments[0];return new Qd(e)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new Qd(i):new Qd(i,n)}},$d.prototype.interfaces_=function(){return[Kp,Yp]},$d.prototype.getClass=function(){return $d},$d.instance=function(){return $d.instanceObject},tg.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},tg.instanceObject.get=function(){return new $d},Object.defineProperties($d,tg);var eg=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new Qf,e=this.map_.values(),i=e.next();!i.done;)t.add(i.value),i=e.next();return t},e.prototype.entrySet=function(){var t=new hd;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(rd),ig=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof rg){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this._modelType=t.FIXED,this.setScale(i)}else if(arguments[0]instanceof t){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}},ng={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};ig.prototype.equals=function(t){if(!(t instanceof ig))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},ig.prototype.compareTo=function(t){var e=t,i=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new sf(i).compareTo(new sf(n))},ig.prototype.getScale=function(){return this._scale},ig.prototype.isFloating=function(){return this._modelType===ig.FLOATING||this._modelType===ig.FLOATING_SINGLE},ig.prototype.getType=function(){return this._modelType},ig.prototype.toString=function(){var t="UNKNOWN";return this._modelType===ig.FLOATING?t="Floating":this._modelType===ig.FLOATING_SINGLE?t="Floating-Single":this._modelType===ig.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},ig.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];if(Hp.isNaN(t))return t;if(this._modelType===ig.FLOATING_SINGLE){return t}return this._modelType===ig.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof Xp){var e=arguments[0];if(this._modelType===ig.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},ig.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===ig.FLOATING?t=16:this._modelType===ig.FLOATING_SINGLE?t=6:this._modelType===ig.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},ig.prototype.setScale=function(t){this._scale=Math.abs(t)},ig.prototype.interfaces_=function(){return[Yp,Zp]},ig.prototype.getClass=function(){return ig},ig.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},ng.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},ng.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(ig,ng);var rg=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},og={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};rg.prototype.readResolve=function(){return rg.nameToTypeMap.get(this._name)},rg.prototype.toString=function(){return this._name},rg.prototype.interfaces_=function(){return[Yp]},rg.prototype.getClass=function(){return rg},og.serialVersionUID.get=function(){return-552860263173159e4},og.nameToTypeMap.get=function(){return new eg},Object.defineProperties(rg,og),ig.Type=rg,ig.FIXED=new rg("FIXED"),ig.FLOATING=new rg("FLOATING"),ig.FLOATING_SINGLE=new rg("FLOATING SINGLE");var sg=function t(){this._precisionModel=new ig,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?ef(arguments[0],Kp)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof ig&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ag={serialVersionUID:{configurable:!0}};sg.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Xp(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Xp(t.getMinX(),t.getMinY()),new Xp(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Xp(t.getMinX(),t.getMinY()),new Xp(t.getMinX(),t.getMaxY()),new Xp(t.getMaxX(),t.getMaxY()),new Xp(t.getMaxX(),t.getMinY()),new Xp(t.getMinX(),t.getMinY())]),null)},sg.prototype.createLineString=function(t){return t?t instanceof Array?new jd(this.getCoordinateSequenceFactory().create(t),this):ef(t,pf)?new jd(t,this):void 0:new jd(this.getCoordinateSequenceFactory().create([]),this)},sg.prototype.createMultiLineString=function(){if(0===arguments.length)return new Sd(null,this);if(1===arguments.length){var t=arguments[0];return new Sd(t,this)}},sg.prototype.buildGeometry=function(t){for(var e=null,i=!1,n=!1,r=t.iterator();r.hasNext();){var o=r.next(),s=o.getClass();null===e&&(e=s),s!==e&&(i=!0),o.isGeometryCollectionOrDerived()&&(n=!0)}if(null===e)return this.createGeometryCollection();if(i||n)return this.createGeometryCollection(sg.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Vd)return this.createMultiPolygon(sg.toPolygonArray(t));if(a instanceof jd)return this.createMultiLineString(sg.toLineStringArray(t));if(a instanceof zd)return this.createMultiPoint(sg.toPointArray(t));Pf.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},sg.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},sg.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Xp){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(ef(arguments[0],pf)){var e=arguments[0];return new zd(e,this)}}},sg.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},sg.prototype.createPolygon=function(){if(0===arguments.length)return new Vd(null,null,this);if(1===arguments.length){if(ef(arguments[0],pf)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof qd){var i=arguments[0];return this.createPolygon(i,null)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return new Vd(n,r,this)}},sg.prototype.getSRID=function(){return this._SRID},sg.prototype.createGeometryCollection=function(){if(0===arguments.length)return new Ed(null,this);if(1===arguments.length){var t=arguments[0];return new Ed(t,this)}},sg.prototype.createGeometry=function(t){return new Ud(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},sg.prototype.getPrecisionModel=function(){return this._precisionModel},sg.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(ef(arguments[0],pf)){var e=arguments[0];return new qd(e,this)}}},sg.prototype.createMultiPolygon=function(){if(0===arguments.length)return new Zd(null,this);if(1===arguments.length){var t=arguments[0];return new Zd(t,this)}},sg.prototype.createMultiPoint=function(){var t=this;if(0===arguments.length)return new Hd(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new Hd(e,this)}if(arguments[0]instanceof Array){var i=arguments[0];return this.createMultiPoint(null!==i?this.getCoordinateSequenceFactory().create(i):null)}if(ef(arguments[0],pf)){var n=arguments[0];if(null===n)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(n.size()).fill(null),o=0;o<n.size();o++){var s=t.getCoordinateSequenceFactory().create(1,n.getDimension());Fd.copy(n,o,s,0,1),r[o]=t.createPoint(s)}return this.createMultiPoint(r)}}},sg.prototype.interfaces_=function(){return[Yp]},sg.prototype.getClass=function(){return sg},sg.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.getDefaultCoordinateSequenceFactory=function(){return $d.instance()},sg.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},sg.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ag.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(sg,ag);var hg=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ug=function(t){this.geometryFactory=t||new sg};ug.prototype.read=function(t){var e,i=(e="string"==typeof t?JSON.parse(t):t).type;if(!lg[i])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==hg.indexOf(i)?lg[i].apply(this,[e.coordinates]):"GeometryCollection"===i?lg[i].apply(this,[e.geometries]):lg[i].apply(this,[e])},ug.prototype.write=function(t){var e=t.getGeometryType();if(!cg[e])throw new Error("Geometry is not supported");return cg[e].apply(this,[t])};var lg={Feature:function(t){var e={};for(var i in t)e[i]=t[i];if(t.geometry){var n=t.geometry.type;if(!lg[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=lg.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var i=0;i<t.features.length;++i)e.features.push(this.read(t.features[i]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(new Xp(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Xp(t[0],t[1]),new Xp(t[2],t[1]),new Xp(t[2],t[3]),new Xp(t[0],t[3]),new Xp(t[0],t[1])])},Point:function(t){var e=new Xp(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],i=0;i<t.length;++i)e.push(lg.Point.apply(this,[t[i]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=lg.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],i=0;i<t.length;++i)e.push(lg.LineString.apply(this,[t[i]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=lg.coordinates.apply(this,[t[0]]),i=this.geometryFactory.createLinearRing(e),n=[],r=1;r<t.length;++r){var o=t[r],s=lg.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);n.push(a)}return this.geometryFactory.createPolygon(i,n)},MultiPolygon:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(lg.Polygon.apply(this,[n]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},cg={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:cg.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=cg.Point.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],i=t.getCoordinates(),n=0;n<i.length;++n){var r=i[n];e.push(cg.coordinate.apply(this,[r]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=cg.LineString.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],i=cg.LineString.apply(this,[t._shell]);e.push(i.coordinates);for(var n=0;n<t._holes.length;++n){var r=t._holes[n],o=cg.LineString.apply(this,[r]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=cg.Polygon.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=n.getGeometryType();e.push(cg[r].apply(this,[n]))}return{type:"GeometryCollection",geometries:e}}},pg=function(t){this.geometryFactory=t||new sg,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ug(this.geometryFactory)};pg.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===ig.FIXED&&this.reducePrecision(e),e},pg.prototype.reducePrecision=function(t){var e,i;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,i=t.points.length;e<i;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,i=t.geometries.length;e<i;e++)this.reducePrecision(t.geometries[e])};var fg=function(){this.parser=new ug(this.geometryFactory)};fg.prototype.write=function(t){return this.parser.write(t)};var dg=function(){},gg={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function yg(t){this.message=t||""}function _g(){this.array_=[]}dg.prototype.interfaces_=function(){return[]},dg.prototype.getClass=function(){return dg},dg.opposite=function(t){return t===dg.LEFT?dg.RIGHT:t===dg.RIGHT?dg.LEFT:t},gg.ON.get=function(){return 0},gg.LEFT.get=function(){return 1},gg.RIGHT.get=function(){return 2},Object.defineProperties(dg,gg),yg.prototype=new Error,yg.prototype.name="EmptyStackException",_g.prototype=new Xf,_g.prototype.add=function(t){return this.array_.push(t),!0},_g.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},_g.prototype.push=function(t){return this.array_.push(t),t},_g.prototype.pop=function(t){if(0===this.array_.length)throw new yg;return this.array_.pop()},_g.prototype.peek=function(){if(0===this.array_.length)throw new yg;return this.array_[this.array_.length-1]},_g.prototype.empty=function(){return 0===this.array_.length},_g.prototype.isEmpty=function(){return this.empty()},_g.prototype.search=function(t){return this.array_.indexOf(t)},_g.prototype.size=function(){return this.array_.length},_g.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t};var mg=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};mg.prototype.getCoordinate=function(){return this._minCoord},mg.prototype.getRightmostSide=function(t,e){var i=this.getRightmostSideOfSegment(t,e);return i<0&&(i=this.getRightmostSideOfSegment(t,e-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),i},mg.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();Pf.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],i=t[this._minIndex+1],n=Nf.computeOrientation(this._minCoord,i,e),r=!1;(e.y<this._minCoord.y&&i.y<this._minCoord.y&&n===Nf.COUNTERCLOCKWISE||e.y>this._minCoord.y&&i.y>this._minCoord.y&&n===Nf.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)},mg.prototype.getRightmostSideOfSegment=function(t,e){var i=t.getEdge().getCoordinates();if(e<0||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;var n=dg.LEFT;return i[e].y<i[e+1].y&&(n=dg.RIGHT),n},mg.prototype.getEdge=function(){return this._orientedDe},mg.prototype.checkForRightmostCoordinate=function(t){for(var e=this,i=t.getEdge().getCoordinates(),n=0;n<i.length-1;n++)(null===e._minCoord||i[n].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=n,e._minCoord=i[n])},mg.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},mg.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();i.isForward()&&this.checkForRightmostCoordinate(i)}Pf.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===dg.LEFT&&(this._orientedDe=this._minDe.getSym())},mg.prototype.interfaces_=function(){return[]},mg.prototype.getClass=function(){return mg};var vg=function(t){function e(i,n){t.call(this,e.msgWithCoord(i,n)),this.pt=n?new Xp(n):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Ef),xg=function(){this.array_=[]};xg.prototype.addLast=function(t){this.array_.push(t)},xg.prototype.removeFirst=function(){return this.array_.shift()},xg.prototype.isEmpty=function(){return 0===this.array_.length};var wg=function(){this._finder=null,this._dirEdgeList=new Qf,this._nodes=new Qf,this._rightMostCoord=null,this._env=null,this._finder=new mg};wg.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){t.next().setVisited(!1)}},wg.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},wg.prototype.computeNodeDepth=function(t){for(var e=null,i=t.getEdges().iterator();i.hasNext();){var n=i.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(null===e)throw new vg("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var r=t.getEdges().iterator();r.hasNext();){var o=r.next();o.setVisited(!0),this.copySymDepths(o)}},wg.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(dg.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},wg.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},wg.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(dg.RIGHT)>=1&&e.getDepth(dg.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},wg.prototype.computeDepths=function(t){var e=new hd,i=new xg,n=t.getNode();for(i.addLast(n),e.add(n),t.setVisited(!0);!i.isEmpty();){var r=i.removeFirst();e.add(r),this.computeNodeDepth(r);for(var o=r.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(i.addLast(a),e.add(a))}}}},wg.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},wg.prototype.getEnvelope=function(){if(null===this._env){for(var t=new mf,e=this._dirEdgeList.iterator();e.hasNext();)for(var i=e.next().getEdge().getCoordinates(),n=0;n<i.length-1;n++)t.expandToInclude(i[n]);this._env=t}return this._env},wg.prototype.addReachable=function(t){var e=new _g;for(e.add(t);!e.empty();){var i=e.pop();this.add(i,e)}},wg.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(dg.LEFT,t.getDepth(dg.RIGHT)),e.setDepth(dg.RIGHT,t.getDepth(dg.LEFT))},wg.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var i=t.getEdges().iterator();i.hasNext();){var n=i.next();this._dirEdgeList.add(n);var r=n.getSym().getNode();r.isVisited()||e.push(r)}},wg.prototype.getNodes=function(){return this._nodes},wg.prototype.getDirectedEdges=function(){return this._dirEdgeList},wg.prototype.interfaces_=function(){return[Zp]},wg.prototype.getClass=function(){return wg};var bg=function t(){var e=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var i=arguments[0];this.init(i.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[dg.ON]=n}else if(arguments[0]instanceof t){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var o=0;o<this.location.length;o++)e.location[o]=r.location[o]}}else if(3===arguments.length){var s=arguments[0],a=arguments[1],h=arguments[2];this.init(3),this.location[dg.ON]=s,this.location[dg.LEFT]=a,this.location[dg.RIGHT]=h}};bg.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},bg.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==$p.NONE)return!1;return!0},bg.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===$p.NONE&&(this.location[e]=t)},bg.prototype.isLine=function(){return 1===this.location.length},bg.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[dg.ON]=this.location[dg.ON],e[dg.LEFT]=$p.NONE,e[dg.RIGHT]=$p.NONE,this.location=e}for(var i=0;i<this.location.length;i++)this.location[i]===$p.NONE&&i<t.location.length&&(this.location[i]=t.location[i])},bg.prototype.getLocations=function(){return this.location},bg.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[dg.LEFT];this.location[dg.LEFT]=this.location[dg.RIGHT],this.location[dg.RIGHT]=t},bg.prototype.toString=function(){var t=new of;return this.location.length>1&&t.append($p.toLocationSymbol(this.location[dg.LEFT])),t.append($p.toLocationSymbol(this.location[dg.ON])),this.location.length>1&&t.append($p.toLocationSymbol(this.location[dg.RIGHT])),t.toString()},bg.prototype.setLocations=function(t,e,i){this.location[dg.ON]=t,this.location[dg.LEFT]=e,this.location[dg.RIGHT]=i},bg.prototype.get=function(t){return t<this.location.length?this.location[t]:$p.NONE},bg.prototype.isArea=function(){return this.location.length>1},bg.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===$p.NONE)return!0;return!1},bg.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(dg.ON,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.location[e]=i}},bg.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations($p.NONE)},bg.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},bg.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},bg.prototype.interfaces_=function(){return[]},bg.prototype.getClass=function(){return bg};var Cg=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new bg(e),this.elt[1]=new bg(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.elt[0]=new bg(i.elt[0]),this.elt[1]=new bg(i.elt[1])}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.elt[0]=new bg($p.NONE),this.elt[1]=new bg($p.NONE),this.elt[n].setLocation(r)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new bg(o,s,a),this.elt[1]=new bg(o,s,a)}else if(4===arguments.length){var h=arguments[0],u=arguments[1],l=arguments[2],c=arguments[3];this.elt[0]=new bg($p.NONE,$p.NONE,$p.NONE),this.elt[1]=new bg($p.NONE,$p.NONE,$p.NONE),this.elt[h].setLocations(u,l,c)}};Cg.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Cg.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Cg.prototype.isNull=function(t){return this.elt[t].isNull()},Cg.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.elt[e].setAllLocationsIfNull(i)}},Cg.prototype.isLine=function(t){return this.elt[t].isLine()},Cg.prototype.merge=function(t){for(var e=this,i=0;i<2;i++)null===e.elt[i]&&null!==t.elt[i]?e.elt[i]=new bg(t.elt[i]):e.elt[i].merge(t.elt[i])},Cg.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Cg.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(dg.ON)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return this.elt[e].get(i)}},Cg.prototype.toString=function(){var t=new of;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Cg.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Cg.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Cg.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(dg.ON,e)}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this.elt[i].setLocation(n,r)}},Cg.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Cg.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Cg.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new bg(this.elt[t].location[0]))},Cg.prototype.interfaces_=function(){return[]},Cg.prototype.getClass=function(){return Cg},Cg.toLineLabel=function(t){for(var e=new Cg($p.NONE),i=0;i<2;i++)e.setLocation(i,t.getLocation(i));return e};var Mg=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Qf,this._pts=new Qf,this._label=new Cg($p.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Qf,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Mg.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=Nf.isCCW(this._ring.getCoordinates())},Mg.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Mg.prototype.computePoints=function(t){var e=this;this._startDe=t;var i=t,n=!0;do{if(null===i)throw new vg("Found null DirectedEdge");if(i.getEdgeRing()===e)throw new vg("Directed Edge visited twice during ring-building at "+i.getCoordinate());e._edges.add(i);var r=i.getLabel();Pf.isTrue(r.isArea()),e.mergeLabel(r),e.addPoints(i.getEdge(),i.isForward(),n),n=!1,e.setEdgeRing(i,e),i=e.getNext(i)}while(i!==this._startDe)},Mg.prototype.getLinearRing=function(){return this._ring},Mg.prototype.getCoordinate=function(t){return this._pts.get(t)},Mg.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var i=e.getNode().getEdges().getOutgoingDegree(t);i>t._maxNodeDegree&&(t._maxNodeDegree=i),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},Mg.prototype.addPoints=function(t,e,i){var n=t.getCoordinates();if(e){var r=1;i&&(r=0);for(var o=r;o<n.length;o++)this._pts.add(n[o])}else{var s=n.length-2;i&&(s=n.length-1);for(var a=s;a>=0;a--)this._pts.add(n[a])}},Mg.prototype.isHole=function(){return this._isHole},Mg.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Mg.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!Nf.isPointInRing(t,e.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){if(i.next().containsPoint(t))return!1}return!0},Mg.prototype.addHole=function(t){this._holes.add(t)},Mg.prototype.isShell=function(){return null===this._shell},Mg.prototype.getLabel=function(){return this._label},Mg.prototype.getEdges=function(){return this._edges},Mg.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Mg.prototype.getShell=function(){return this._shell},Mg.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],n=e.getLocation(i,dg.RIGHT);if(n===$p.NONE)return null;if(this._label.getLocation(i)===$p.NONE)return this._label.setLocation(i,n),null}},Mg.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Mg.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)e[i]=this._holes.get(i).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Mg.prototype.interfaces_=function(){return[]},Mg.prototype.getClass=function(){return Mg};var Eg=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Mg),Sg=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new Qf,e=this._startDe;do{if(null===e.getMinEdgeRing()){var i=new Eg(e,this._geometryFactory);t.add(i)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Mg),Pg=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Pg.prototype.setVisited=function(t){this._isVisited=t},Pg.prototype.setInResult=function(t){this._isInResult=t},Pg.prototype.isCovered=function(){return this._isCovered},Pg.prototype.isCoveredSet=function(){return this._isCoveredSet},Pg.prototype.setLabel=function(t){this._label=t},Pg.prototype.getLabel=function(){return this._label},Pg.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Pg.prototype.updateIM=function(t){Pf.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Pg.prototype.isInResult=function(){return this._isInResult},Pg.prototype.isVisited=function(){return this._isVisited},Pg.prototype.interfaces_=function(){return[]},Pg.prototype.getClass=function(){return Pg};var Ig=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],i=arguments[1];this._coord=e,this._edges=i,this._label=new Cg(0,$p.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();){if(t.next().getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var i=$p.NONE;if(i=this._label.getLocation(e),!t.isNull(e)){var n=t.getLocation(e);i!==$p.BOUNDARY&&(i=n)}return i},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],i=arguments[1];null===this._label?this._label=new Cg(e,i):this._label.setLocation(e,i)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof Cg)for(var n=arguments[0],r=0;r<2;r++){var o=t.computeMergedLocation(n,r),s=t._label.getLocation(r);s===$p.NONE&&t._label.setLocation(r,o)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=$p.NONE;null!==this._label&&(e=this._label.getLocation(t));var i=null;if(e===$p.BOUNDARY)i=$p.INTERIOR;else i=$p.BOUNDARY;this._label.setLocation(t,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Pg),Tg=function(){this.nodeMap=new gd,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Tg.prototype.find=function(t){return this.nodeMap.get(t)},Tg.prototype.addNode=function(){if(arguments[0]instanceof Xp){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Ig){var i=arguments[0],n=this.nodeMap.get(i.getCoordinate());return null===n?(this.nodeMap.put(i.getCoordinate(),i),i):(n.mergeLabel(i),n)}},Tg.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){e.next().print(t)}},Tg.prototype.iterator=function(){return this.nodeMap.values().iterator()},Tg.prototype.values=function(){return this.nodeMap.values()},Tg.prototype.getBoundaryNodes=function(t){for(var e=new Qf,i=this.iterator();i.hasNext();){var n=i.next();n.getLabel().getLocation(t)===$p.BOUNDARY&&e.add(n)}return e},Tg.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Tg.prototype.interfaces_=function(){return[]},Tg.prototype.getClass=function(){return Tg};var Lg=function(){},Og={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Lg.prototype.interfaces_=function(){return[]},Lg.prototype.getClass=function(){return Lg},Lg.isNorthern=function(t){return t===Lg.NE||t===Lg.NW},Lg.isOpposite=function(t,e){return t!==e&&2===(t-e+4)%4},Lg.commonHalfPlane=function(t,e){if(t===e)return t;if(2===(t-e+4)%4)return-1;var i=t<e?t:e;return 0===i&&3===(t>e?t:e)?3:i},Lg.isInHalfPlane=function(t,e){return e===Lg.SE?t===Lg.SE||t===Lg.SW:t===e||t===e+1},Lg.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new Vp("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Lg.NE:Lg.SE:e>=0?Lg.NW:Lg.SW}if(arguments[0]instanceof Xp&&arguments[1]instanceof Xp){var i=arguments[0],n=arguments[1];if(n.x===i.x&&n.y===i.y)throw new Vp("Cannot compute the quadrant for two identical points "+i);return n.x>=i.x?n.y>=i.y?Lg.NE:Lg.SE:n.y>=i.y?Lg.NW:Lg.SW}},Og.NE.get=function(){return 0},Og.NW.get=function(){return 1},Og.SW.get=function(){return 2},Og.SE.get=function(){return 3},Object.defineProperties(Lg,Og);var Rg=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=null;this._edge=e,this.init(i,n),this._label=r}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],h=arguments[3];this._edge=o,this.init(s,a),this._label=h}};Rg.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Nf.computeOrientation(t._p0,t._p1,this._p1)},Rg.prototype.getDy=function(){return this._dy},Rg.prototype.getCoordinate=function(){return this._p0},Rg.prototype.setNode=function(t){this._node=t},Rg.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),n=i.lastIndexOf("."),r=i.substring(n+1);t.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Rg.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Rg.prototype.getDirectedCoordinate=function(){return this._p1},Rg.prototype.getDx=function(){return this._dx},Rg.prototype.getLabel=function(){return this._label},Rg.prototype.getEdge=function(){return this._edge},Rg.prototype.getQuadrant=function(){return this._quadrant},Rg.prototype.getNode=function(){return this._node},Rg.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),i=e.lastIndexOf(".");return"  "+e.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Rg.prototype.computeLabel=function(t){},Rg.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Lg.quadrant(this._dx,this._dy),Pf.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Rg.prototype.interfaces_=function(){return[Zp]},Rg.prototype.getClass=function(){return Rg};var Ng=function(t){function e(){var e=arguments[0],i=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Cg(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new vg("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=this,e=!0,i=0;i<2;i++)t._label.isArea(i)&&t._label.getLocation(i,dg.LEFT)===$p.INTERIOR&&t._label.getLocation(i,dg.RIGHT)===$p.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[dg.LEFT]+"/"+this._depth[dg.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,$p.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,$p.EXTERIOR);return t&&e&&i},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var n=1;t===dg.LEFT&&(n=-1);var r=dg.opposite(t),o=e+i*n;this.setDepth(t,e),this.setDepth(r,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===$p.EXTERIOR&&e===$p.INTERIOR?1:t===$p.INTERIOR&&e===$p.EXTERIOR?-1:0},e}(Rg),Ag=function(){};Ag.prototype.createNode=function(t){return new Ig(t,null)},Ag.prototype.interfaces_=function(){return[]},Ag.prototype.getClass=function(){return Ag};var Dg=function(){if(this._edges=new Qf,this._nodes=null,this._edgeEndList=new Qf,0===arguments.length)this._nodes=new Tg(new Ag);else if(1===arguments.length){var t=arguments[0];this._nodes=new Tg(t)}};Dg.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var i=this._edges.get(e);i.print(t),i.eiList.print(t)}},Dg.prototype.find=function(t){return this._nodes.find(t)},Dg.prototype.addNode=function(){if(arguments[0]instanceof Ig){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof Xp){var e=arguments[0];return this._nodes.addNode(e)}},Dg.prototype.getNodeIterator=function(){return this._nodes.iterator()},Dg.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){t.next().getEdges().linkResultDirectedEdges()}},Dg.prototype.debugPrintln=function(t){yf.out.println(t)},Dg.prototype.isBoundaryNode=function(t,e){var i=this._nodes.find(e);if(null===i)return!1;var n=i.getLabel();return null!==n&&n.getLocation(t)===$p.BOUNDARY},Dg.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){t.next().getEdges().linkAllDirectedEdges()}},Dg.prototype.matchInSameDirection=function(t,e,i,n){return!!t.equals(i)&&(Nf.computeOrientation(t,e,n)===Nf.COLLINEAR&&Lg.quadrant(t,e)===Lg.quadrant(i,n))},Dg.prototype.getEdgeEnds=function(){return this._edgeEndList},Dg.prototype.debugPrint=function(t){yf.out.print(t)},Dg.prototype.getEdgeIterator=function(){return this._edges.iterator()},Dg.prototype.findEdgeInSameDirection=function(t,e){for(var i=this,n=0;n<this._edges.size();n++){var r=i._edges.get(n),o=r.getCoordinates();if(i.matchInSameDirection(t,e,o[0],o[1]))return r;if(i.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return r}return null},Dg.prototype.insertEdge=function(t){this._edges.add(t)},Dg.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var i=e.next();if(i.getEdge()===t)return i}return null},Dg.prototype.addEdges=function(t){for(var e=this,i=t.iterator();i.hasNext();){var n=i.next();e._edges.add(n);var r=new Ng(n,!0),o=new Ng(n,!1);r.setSym(o),o.setSym(r),e.add(r),e.add(o)}},Dg.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Dg.prototype.getNodes=function(){return this._nodes.values()},Dg.prototype.findEdge=function(t,e){for(var i=0;i<this._edges.size();i++){var n=this._edges.get(i),r=n.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return n}return null},Dg.prototype.interfaces_=function(){return[]},Dg.prototype.getClass=function(){return Dg},Dg.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){e.next().getEdges().linkResultDirectedEdges()}};var kg=function(){this._geometryFactory=null,this._shellList=new Qf;var t=arguments[0];this._geometryFactory=t};kg.prototype.sortShellsAndHoles=function(t,e,i){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()?i.add(r):e.add(r)}},kg.prototype.computePolygons=function(t){for(var e=new Qf,i=t.iterator();i.hasNext();){var n=i.next().toPolygon(this._geometryFactory);e.add(n)}return e},kg.prototype.placeFreeHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();if(null===n.getShell()){var r=this.findEdgeRingContaining(n,t);if(null===r)throw new vg("unable to assign hole to a shell",n.getCoordinate(0));n.setShell(r)}}},kg.prototype.buildMinimalEdgeRings=function(t,e,i){for(var n=new Qf,r=t.iterator();r.hasNext();){var o=r.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):i.addAll(s)}else n.add(o)}return n},kg.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){if(e.next().containsPoint(t))return!0}return!1},kg.prototype.buildMaximalEdgeRings=function(t){for(var e=new Qf,i=t.iterator();i.hasNext();){var n=i.next();if(n.isInResult()&&n.getLabel().isArea()&&null===n.getEdgeRing()){var r=new Sg(n,this._geometryFactory);e.add(r),r.setInResult()}}return e},kg.prototype.placePolygonHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();n.isHole()&&n.setShell(t)}},kg.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},kg.prototype.findEdgeRingContaining=function(t,e){for(var i=t.getLinearRing(),n=i.getEnvelopeInternal(),r=i.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var h=a.next(),u=h.getLinearRing(),l=u.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var c=!1;l.contains(n)&&Nf.isPointInRing(r,u.getCoordinates())&&(c=!0),c&&(null===o||s.contains(l))&&(o=h)}return o},kg.prototype.findShell=function(t){for(var e=0,i=null,n=t.iterator();n.hasNext();){var r=n.next();r.isHole()||(i=r,e++)}return Pf.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),i},kg.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],i=arguments[1];Dg.linkResultDirectedEdges(i);var n=this.buildMaximalEdgeRings(e),r=new Qf,o=this.buildMinimalEdgeRings(n,this._shellList,r);this.sortShellsAndHoles(o,this._shellList,r),this.placeFreeHoles(this._shellList,r)}},kg.prototype.interfaces_=function(){return[]},kg.prototype.getClass=function(){return kg};var Fg=function(){};Fg.prototype.getBounds=function(){},Fg.prototype.interfaces_=function(){return[]},Fg.prototype.getClass=function(){return Fg};var jg=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};jg.prototype.getItem=function(){return this._item},jg.prototype.getBounds=function(){return this._bounds},jg.prototype.interfaces_=function(){return[Fg,Yp]},jg.prototype.getClass=function(){return jg};var Gg=function(){this._size=null,this._items=null,this._size=0,this._items=new Qf,this._items.add(null)};Gg.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Gg.prototype.size=function(){return this._size},Gg.prototype.reorder=function(t){for(var e=this,i=null,n=this._items.get(t);2*t<=this._size&&((i=2*t)!==e._size&&e._items.get(i+1).compareTo(e._items.get(i))<0&&i++,e._items.get(i).compareTo(n)<0);t=i)e._items.set(t,e._items.get(i));this._items.set(t,n)},Gg.prototype.clear=function(){this._size=0,this._items.clear()},Gg.prototype.isEmpty=function(){return 0===this._size},Gg.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Gg.prototype.interfaces_=function(){return[]},Gg.prototype.getClass=function(){return Gg};var zg=function(){};zg.prototype.visitItem=function(t){},zg.prototype.interfaces_=function(){return[]},zg.prototype.getClass=function(){return zg};var Bg=function(){};Bg.prototype.insert=function(t,e){},Bg.prototype.remove=function(t,e){},Bg.prototype.query=function(){},Bg.prototype.interfaces_=function(){return[]},Bg.prototype.getClass=function(){return Bg};var Vg=function(){if(this._childBoundables=new Qf,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Hg={serialVersionUID:{configurable:!0}};Vg.prototype.getLevel=function(){return this._level},Vg.prototype.size=function(){return this._childBoundables.size()},Vg.prototype.getChildBoundables=function(){return this._childBoundables},Vg.prototype.addChildBoundable=function(t){Pf.isTrue(null===this._bounds),this._childBoundables.add(t)},Vg.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Vg.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Vg.prototype.interfaces_=function(){return[Fg,Yp]},Vg.prototype.getClass=function(){return Vg},Hg.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Vg,Hg);var qg=function(){};qg.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},qg.min=function(t){return qg.sort(t),t.get(0)},qg.sort=function(t,e){var i=t.toArray();e?xd.sort(i,e):xd.sort(i);for(var n=t.iterator(),r=0,o=i.length;r<o;r++)n.next(),n.set(i[r])},qg.singletonList=function(t){var e=new Qf;return e.add(t),e};var Zg=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],i=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=i,this._distance=this.distance()};Zg.prototype.expandToQueue=function(t,e){var i=Zg.isComposite(this._boundable1),n=Zg.isComposite(this._boundable2);if(i&&n)return Zg.area(this._boundable1)>Zg.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(i)return this.expand(this._boundable1,this._boundable2,t,e),null;if(n)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new Vp("neither boundable is composite")},Zg.prototype.isLeaves=function(){return!(Zg.isComposite(this._boundable1)||Zg.isComposite(this._boundable2))},Zg.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},Zg.prototype.expand=function(t,e,i,n){for(var r=t.getChildBoundables().iterator();r.hasNext();){var o=r.next(),s=new Zg(o,e,this._itemDistance);s.getDistance()<n&&i.add(s)}},Zg.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},Zg.prototype.getDistance=function(){return this._distance},Zg.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},Zg.prototype.interfaces_=function(){return[Zp]},Zg.prototype.getClass=function(){return Zg},Zg.area=function(t){return t.getBounds().getArea()},Zg.isComposite=function(t){return t instanceof Vg};var Ug=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new Qf,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var i=arguments[0];Pf.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}},Wg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Ug.prototype.getNodeCapacity=function(){return this._nodeCapacity},Ug.prototype.lastNode=function(t){return t.get(t.size()-1)},Ug.prototype.size=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=arguments[0],i=0,n=e.getChildBoundables().iterator();n.hasNext();){var r=n.next();r instanceof Vg?i+=t.size(r):r instanceof jg&&(i+=1)}return i}},Ug.prototype.removeItem=function(t,e){for(var i=null,n=t.getChildBoundables().iterator();n.hasNext();){var r=n.next();r instanceof jg&&r.getItem()===e&&(i=r)}return null!==i&&(t.getChildBoundables().remove(i),!0)},Ug.prototype.itemsTree=function(){var t=this;if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new Qf:e}if(1===arguments.length){for(var i=arguments[0],n=new Qf,r=i.getChildBoundables().iterator();r.hasNext();){var o=r.next();if(o instanceof Vg){var s=t.itemsTree(o);null!==s&&n.add(s)}else o instanceof jg?n.add(o.getItem()):Pf.shouldNeverReachHere()}return n.size()<=0?null:n}},Ug.prototype.insert=function(t,e){Pf.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new jg(t,e))},Ug.prototype.boundablesAtLevel=function(){var t=this;if(1===arguments.length){var e=arguments[0],i=new Qf;return this.boundablesAtLevel(e,this._root,i),i}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];if(Pf.isTrue(n>-2),r.getLevel()===n)return o.add(r),null;for(var s=r.getChildBoundables().iterator();s.hasNext();){var a=s.next();a instanceof Vg?t.boundablesAtLevel(n,a,o):(Pf.isTrue(a instanceof jg),-1===n&&o.add(a))}return null}},Ug.prototype.query=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.build();var i=new Qf;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,i),i}if(2===arguments.length){var n=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,r)}else if(3===arguments.length)if(ef(arguments[2],zg)&&arguments[0]instanceof Object&&arguments[1]instanceof Vg)for(var o=arguments[0],s=arguments[1],a=arguments[2],h=s.getChildBoundables(),u=0;u<h.size();u++){var l=h.get(u);t.getIntersectsOp().intersects(l.getBounds(),o)&&(l instanceof Vg?t.query(o,l,a):l instanceof jg?a.visitItem(l.getItem()):Pf.shouldNeverReachHere())}else if(ef(arguments[2],Xf)&&arguments[0]instanceof Object&&arguments[1]instanceof Vg)for(var c=arguments[0],p=arguments[1],f=arguments[2],d=p.getChildBoundables(),g=0;g<d.size();g++){var y=d.get(g);t.getIntersectsOp().intersects(y.getBounds(),c)&&(y instanceof Vg?t.query(c,y,f):y instanceof jg?f.add(y.getItem()):Pf.shouldNeverReachHere())}},Ug.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Ug.prototype.getRoot=function(){return this.build(),this._root},Ug.prototype.remove=function(){var t=this;if(2===arguments.length){var e=arguments[0],i=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,i)}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=this.removeItem(r,o);if(s)return!0;for(var a=null,h=r.getChildBoundables().iterator();h.hasNext();){var u=h.next();if(t.getIntersectsOp().intersects(u.getBounds(),n)&&(u instanceof Vg&&(s=t.remove(n,u,o)))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(a),s}},Ug.prototype.createHigherLevels=function(t,e){Pf.isTrue(!t.isEmpty());var i=this.createParentBoundables(t,e+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,e+1)},Ug.prototype.depth=function(){var t=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=arguments[0],i=0,n=e.getChildBoundables().iterator();n.hasNext();){var r=n.next();if(r instanceof Vg){var o=t.depth(r);o>i&&(i=o)}}return i+1}},Ug.prototype.createParentBoundables=function(t,e){var i=this;Pf.isTrue(!t.isEmpty());var n=new Qf;n.add(this.createNode(e));var r=new Qf(t);qg.sort(r,this.getComparator());for(var o=r.iterator();o.hasNext();){var s=o.next();i.lastNode(n).getChildBoundables().size()===i.getNodeCapacity()&&n.add(i.createNode(e)),i.lastNode(n).addChildBoundable(s)}return n},Ug.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Ug.prototype.interfaces_=function(){return[Yp]},Ug.prototype.getClass=function(){return Ug},Ug.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},Wg.IntersectsOp.get=function(){return Yg},Wg.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},Wg.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Ug,Wg);var Yg=function(){},Xg=function(){};Xg.prototype.distance=function(t,e){},Xg.prototype.interfaces_=function(){return[]},Xg.prototype.getClass=function(){return Xg};var Jg=function(t){function e(i){i=i||e.DEFAULT_NODE_CAPACITY,t.call(this,i)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){Pf.isTrue(t.length>0);for(var i=new Qf,n=0;n<t.length;n++)i.addAll(this.createParentBoundablesFromVerticalSlice(t[n],e));return i},e.prototype.createNode=function(t){return new Qg(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],i=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,i)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var i=Math.trunc(Math.ceil(t.size()/e)),n=new Array(e).fill(null),r=t.iterator(),o=0;o<e;o++){n[o]=new Qf;for(var s=0;r.hasNext()&&s<i;){var a=r.next();n[o].add(a),s++}}return n},e.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var i=arguments[0],n=arguments[1];t.prototype.query.call(this,i,n)}else if(3===arguments.length)if(ef(arguments[2],zg)&&arguments[0]instanceof Object&&arguments[1]instanceof Vg){var r=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,r,o,s)}else if(ef(arguments[2],Xf)&&arguments[0]instanceof Object&&arguments[1]instanceof Vg){var a=arguments[0],h=arguments[1],u=arguments[2];t.prototype.query.call(this,a,h,u)}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,i){return t.prototype.createParentBoundables.call(this,e,i)},e.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return t.prototype.remove.call(this,e,i)}return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,i){Pf.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),r=new Qf(t);qg.sort(r,e.xComparator);var o=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(o,i)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(ef(arguments[0],Xg)){var t=arguments[0],i=new Zg(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(i)}if(arguments[0]instanceof Zg){var n=arguments[0];return this.nearestNeighbour(n,Hp.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof e&&ef(arguments[1],Xg)){var r=arguments[0],o=arguments[1],s=new Zg(this.getRoot(),r.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof Zg&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1],u=h,l=null,c=new Gg;for(c.add(a);!c.isEmpty()&&u>0;){var p=c.poll(),f=p.getDistance();if(f>=u)break;p.isLeaves()?(u=f,l=p):p.expandToQueue(c,u)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var d=arguments[0],g=arguments[1],y=arguments[2],_=new jg(d,g),m=new Zg(this.getRoot(),_,y);return this.nearestNeighbour(m)[0]}},e.prototype.interfaces_=function(){return[Bg,Yp]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},i.STRtreeNode.get=function(){return Qg},i.serialVersionUID.get=function(){return 0x39920f7d5f261e0},i.xComparator.get=function(){return{interfaces_:function(){return[Wp]},compare:function(i,n){return t.compareDoubles(e.centreX(i.getBounds()),e.centreX(n.getBounds()))}}},i.yComparator.get=function(){return{interfaces_:function(){return[Wp]},compare:function(i,n){return t.compareDoubles(e.centreY(i.getBounds()),e.centreY(n.getBounds()))}}},i.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},i.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,i),e}(Ug),Qg=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var i=e.next();null===t?t=new mf(i.getBounds()):t.expandToInclude(i.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Vg),Kg=function(){};Kg.prototype.interfaces_=function(){return[]},Kg.prototype.getClass=function(){return Kg},Kg.relativeSign=function(t,e){return t<e?-1:t>e?1:0},Kg.compare=function(t,e,i){if(e.equals2D(i))return 0;var n=Kg.relativeSign(e.x,i.x),r=Kg.relativeSign(e.y,i.y);switch(t){case 0:return Kg.compareValue(n,r);case 1:return Kg.compareValue(r,n);case 2:return Kg.compareValue(r,-n);case 3:return Kg.compareValue(-n,r);case 4:return Kg.compareValue(-n,-r);case 5:return Kg.compareValue(-r,-n);case 6:return Kg.compareValue(-r,n);case 7:return Kg.compareValue(n,-r)}return Pf.shouldNeverReachHere("invalid octant value"),0},Kg.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var $g=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this._segString=t,this.coord=new Xp(e),this.segmentIndex=i,this._segmentOctant=n,this._isInterior=!e.equals2D(t.getCoordinate(i))};$g.prototype.getCoordinate=function(){return this.coord},$g.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},$g.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Kg.compare(this._segmentOctant,this.coord,e.coord)},$g.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},$g.prototype.isInterior=function(){return this._isInterior},$g.prototype.interfaces_=function(){return[Zp]},$g.prototype.getClass=function(){return $g};var ty=function(){this._nodeMap=new gd,this._edge=null;var t=arguments[0];this._edge=t};ty.prototype.getSplitCoordinates=function(){var t=new $f;this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(i,n,t),i=n}return t.toCoordinateArray()},ty.prototype.addCollapsedNodes=function(){var t=new Qf;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var i=e.next().intValue();this.add(this._edge.getCoordinate(i),i)}},ty.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},ty.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var i=this._edge.getCoordinate(e),n=this._edge.getCoordinate(e+2);i.equals2D(n)&&t.add(new sf(e+1))}},ty.prototype.addEdgeCoordinates=function(t,e,i){var n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);i.add(new Xp(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)i.add(this._edge.getCoordinate(o));r&&i.add(new Xp(e.coord))},ty.prototype.iterator=function(){return this._nodeMap.values().iterator()},ty.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(i,n);t.add(r),i=n}},ty.prototype.findCollapseIndex=function(t,e,i){if(!t.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-t.segmentIndex;return e.isInterior()||n--,1===n&&(i[0]=t.segmentIndex+1,!0)},ty.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),i=this.iterator(),n=i.next();i.hasNext();){var r=i.next();this.findCollapseIndex(n,r,e)&&t.add(new sf(e[0])),n=r}},ty.prototype.getEdge=function(){return this._edge},ty.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},ty.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);r||i--;var o=new Array(i).fill(null),s=0;o[s++]=new Xp(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return r&&(o[s]=new Xp(e.coord)),new ry(o,this._edge.getData())},ty.prototype.add=function(t,e){var i=new $g(this._edge,t,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(i);return null!==n?(Pf.isTrue(n.coord.equals2D(t),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(i,i),i)},ty.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),i=t.get(0).getCoordinate(0);if(!i.equals2D(e[0]))throw new Ef("bad split edge start point at "+i);var n=t.get(t.size()-1).getCoordinates(),r=n[n.length-1];if(!r.equals2D(e[e.length-1]))throw new Ef("bad split edge end point at "+r)},ty.prototype.interfaces_=function(){return[]},ty.prototype.getClass=function(){return ty};var ey=function(){};ey.prototype.interfaces_=function(){return[]},ey.prototype.getClass=function(){return ey},ey.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new Vp("Cannot compute the octant for point ( "+t+", "+e+" )");var i=Math.abs(t),n=Math.abs(e);return t>=0?e>=0?i>=n?0:1:i>=n?7:6:e>=0?i>=n?3:2:i>=n?4:5}if(arguments[0]instanceof Xp&&arguments[1]instanceof Xp){var r=arguments[0],o=arguments[1],s=o.x-r.x,a=o.y-r.y;if(0===s&&0===a)throw new Vp("Cannot compute the octant for two identical points "+r);return ey.octant(s,a)}};var iy=function(){};iy.prototype.getCoordinates=function(){},iy.prototype.size=function(){},iy.prototype.getCoordinate=function(t){},iy.prototype.isClosed=function(){},iy.prototype.setData=function(t){},iy.prototype.getData=function(){},iy.prototype.interfaces_=function(){return[]},iy.prototype.getClass=function(){return iy};var ny=function(){};ny.prototype.addIntersection=function(t,e){},ny.prototype.interfaces_=function(){return[iy]},ny.prototype.getClass=function(){return ny};var ry=function(){this._nodeList=new ty(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};ry.prototype.getCoordinates=function(){return this._pts},ry.prototype.size=function(){return this._pts.length},ry.prototype.getCoordinate=function(t){return this._pts[t]},ry.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},ry.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},ry.prototype.setData=function(t){this._data=t},ry.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:ey.octant(t,e)},ry.prototype.getData=function(){return this._data},ry.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[3],o=new Xp(i.getIntersection(r));this.addIntersection(o,n)}},ry.prototype.toString=function(){return Mf.toLineString(new Qd(this._pts))},ry.prototype.getNodeList=function(){return this._nodeList},ry.prototype.addIntersectionNode=function(t,e){var i=e,n=i+1;if(n<this._pts.length){var r=this._pts[n];t.equals2D(r)&&(i=n)}return this._nodeList.add(t,i)},ry.prototype.addIntersections=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,i,n)},ry.prototype.interfaces_=function(){return[ny]},ry.prototype.getClass=function(){return ry},ry.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new Qf;return ry.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var i=arguments[0],n=arguments[1],r=i.iterator();r.hasNext();){var o=r.next();o.getNodeList().addSplitEdges(n)}};var oy=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new Xp,this.p1=new Xp;else if(1===arguments.length){var t=arguments[0];this.p0=new Xp(t.p0),this.p1=new Xp(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=arguments[3];this.p0=new Xp(e,i),this.p1=new Xp(n,r)}},sy={serialVersionUID:{configurable:!0}};oy.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},oy.prototype.orientationIndex=function(){if(arguments[0]instanceof oy){var t=arguments[0],e=Nf.orientationIndex(this.p0,this.p1,t.p0),i=Nf.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&i>=0||e<=0&&i<=0?Math.max(e,i):0}if(arguments[0]instanceof Xp){var n=arguments[0];return Nf.orientationIndex(this.p0,this.p1,n)}},oy.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},oy.prototype.isVertical=function(){return this.p0.x===this.p1.x},oy.prototype.equals=function(t){if(!(t instanceof oy))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},oy.prototype.intersection=function(t){var e=new Lf;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},oy.prototype.project=function(){if(arguments[0]instanceof Xp){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Xp(t);var e=this.projectionFactor(t),i=new Xp;return i.x=this.p0.x+e*(this.p1.x-this.p0.x),i.y=this.p0.y+e*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof oy){var n=arguments[0],r=this.projectionFactor(n.p0),o=this.projectionFactor(n.p1);if(r>=1&&o>=1)return null;if(r<=0&&o<=0)return null;var s=this.project(n.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var a=this.project(n.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new oy(s,a)}},oy.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},oy.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},oy.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},oy.prototype.distancePerpendicular=function(t){return Nf.distancePointLinePerpendicular(t,this.p0,this.p1)},oy.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},oy.prototype.midPoint=function(){return oy.midPoint(this.p0,this.p1)},oy.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,n=e*e+i*i;return n<=0?Hp.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*i)/n},oy.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var i=new Array(2).fill(null),n=Hp.MAX_VALUE,r=null,o=this.closestPoint(t.p0);n=o.distance(t.p0),i[0]=o,i[1]=t.p0;var s=this.closestPoint(t.p1);(r=s.distance(t.p1))<n&&(n=r,i[0]=s,i[1]=t.p1);var a=t.closestPoint(this.p0);(r=a.distance(this.p0))<n&&(n=r,i[0]=this.p0,i[1]=a);var h=t.closestPoint(this.p1);return(r=h.distance(this.p1))<n&&(n=r,i[0]=this.p1,i[1]=h),i},oy.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},oy.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},oy.prototype.getLength=function(){return this.p0.distance(this.p1)},oy.prototype.compareTo=function(t){var e=t,i=this.p0.compareTo(e.p0);return 0!==i?i:this.p1.compareTo(e.p1)},oy.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},oy.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},oy.prototype.lineIntersection=function(t){try{return _f.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof gf))throw t}return null},oy.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},oy.prototype.pointAlongOffset=function(t,e){var i=this.p0.x+t*(this.p1.x-this.p0.x),n=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(r*r+o*o),a=0,h=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*r/s,h=e*o/s}return new Xp(i-h,n+a)},oy.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=i.x,this.p1.y=i.y}},oy.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||Hp.isNaN(e))&&(e=1),e},oy.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},oy.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},oy.prototype.distance=function(){if(arguments[0]instanceof oy){var t=arguments[0];return Nf.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof Xp){var e=arguments[0];return Nf.distancePointLine(e,this.p0,this.p1)}},oy.prototype.pointAlong=function(t){var e=new Xp;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},oy.prototype.hashCode=function(){var t=Hp.doubleToLongBits(this.p0.x);t^=31*Hp.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),i=Hp.doubleToLongBits(this.p1.x);return i^=31*Hp.doubleToLongBits(this.p1.y),e^(Math.trunc(i)^Math.trunc(i>>32))},oy.prototype.interfaces_=function(){return[Zp,Yp]},oy.prototype.getClass=function(){return oy},oy.midPoint=function(t,e){return new Xp((t.x+e.x)/2,(t.y+e.y)/2)},sy.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(oy,sy);var ay=function(){this.tempEnv1=new mf,this.tempEnv2=new mf,this._overlapSeg1=new oy,this._overlapSeg2=new oy};ay.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];t.getLineSegment(e,this._overlapSeg1),i.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},ay.prototype.interfaces_=function(){return[]},ay.prototype.getClass=function(){return ay};var hy=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this._pts=t,this._start=e,this._end=i,this._context=n};hy.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},hy.prototype.computeSelect=function(t,e,i,n){var r=this._pts[e],o=this._pts[i];if(n.tempEnv1.init(r,o),i-e==1)return n.select(this,e),null;if(!t.intersects(n.tempEnv1))return null;var s=Math.trunc((e+i)/2);e<s&&this.computeSelect(t,e,s,n),s<i&&this.computeSelect(t,s,i,n)},hy.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,i=this._start;i<=this._end;i++)t[e++]=this._pts[i];return t},hy.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},hy.prototype.setId=function(t){this._id=t},hy.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},hy.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new mf(t,e)}return this._env},hy.prototype.getEndIndex=function(){return this._end},hy.prototype.getStartIndex=function(){return this._start},hy.prototype.getContext=function(){return this._context},hy.prototype.getId=function(){return this._id},hy.prototype.computeOverlapsInternal=function(t,e,i,n,r,o){var s=this._pts[t],a=this._pts[e],h=i._pts[n],u=i._pts[r];if(e-t==1&&r-n==1)return o.overlap(this,t,i,n),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(h,u),!o.tempEnv1.intersects(o.tempEnv2))return null;var l=Math.trunc((t+e)/2),c=Math.trunc((n+r)/2);t<l&&(n<c&&this.computeOverlapsInternal(t,l,i,n,c,o),c<r&&this.computeOverlapsInternal(t,l,i,c,r,o)),l<e&&(n<c&&this.computeOverlapsInternal(l,e,i,n,c,o),c<r&&this.computeOverlapsInternal(l,e,i,c,r,o))},hy.prototype.interfaces_=function(){return[]},hy.prototype.getClass=function(){return hy};var uy=function(){};uy.prototype.interfaces_=function(){return[]},uy.prototype.getClass=function(){return uy},uy.getChainStartIndices=function(t){var e=0,i=new Qf;i.add(new sf(e));do{var n=uy.findChainEnd(t,e);i.add(new sf(n)),e=n}while(e<t.length-1);return uy.toIntArray(i)},uy.findChainEnd=function(t,e){for(var i=e;i<t.length-1&&t[i].equals2D(t[i+1]);)i++;if(i>=t.length-1)return t.length-1;for(var n=Lg.quadrant(t[i],t[i+1]),r=e+1;r<t.length;){if(!t[r-1].equals2D(t[r]))if(Lg.quadrant(t[r-1],t[r])!==n)break;r++}return r-1},uy.getChains=function(){if(1===arguments.length){var t=arguments[0];return uy.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],i=arguments[1],n=new Qf,r=uy.getChainStartIndices(e),o=0;o<r.length-1;o++){var s=new hy(e,r[o],r[o+1],i);n.add(s)}return n}},uy.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var ly=function(){};ly.prototype.computeNodes=function(t){},ly.prototype.getNodedSubstrings=function(){},ly.prototype.interfaces_=function(){return[]},ly.prototype.getClass=function(){return ly};var cy=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};cy.prototype.setSegmentIntersector=function(t){this._segInt=t},cy.prototype.interfaces_=function(){return[ly]},cy.prototype.getClass=function(){return cy};var py=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new Qf,this._index=new Jg,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return ry.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=this,i=uy.getChains(t.getCoordinates(),t).iterator();i.hasNext();){var n=i.next();n.setId(e._idCounter++),e._index.insert(n.getEnvelope(),n),e._monoChains.add(n)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=this,e=new fy(this._segInt),i=this._monoChains.iterator();i.hasNext();)for(var n=i.next(),r=t._index.query(n.getEnvelope()).iterator();r.hasNext();){var o=r.next();if(o.getId()>n.getId()&&(n.computeOverlaps(o,e),t._nOverlaps++),t._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.SegmentOverlapAction.get=function(){return fy},Object.defineProperties(e,i),e}(cy),fy=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[0],i=arguments[1],n=arguments[2],r=arguments[3],o=e.getContext(),s=n.getContext();this._si.processIntersections(o,i,s,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ay),dy=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(n)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},gy={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};dy.prototype.getEndCapStyle=function(){return this._endCapStyle},dy.prototype.isSingleSided=function(){return this._isSingleSided},dy.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=dy.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=dy.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==dy.JOIN_ROUND&&(this._quadrantSegments=dy.DEFAULT_QUADRANT_SEGMENTS)},dy.prototype.getJoinStyle=function(){return this._joinStyle},dy.prototype.setJoinStyle=function(t){this._joinStyle=t},dy.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},dy.prototype.getSimplifyFactor=function(){return this._simplifyFactor},dy.prototype.getQuadrantSegments=function(){return this._quadrantSegments},dy.prototype.setEndCapStyle=function(t){this._endCapStyle=t},dy.prototype.getMitreLimit=function(){return this._mitreLimit},dy.prototype.setMitreLimit=function(t){this._mitreLimit=t},dy.prototype.setSingleSided=function(t){this._isSingleSided=t},dy.prototype.interfaces_=function(){return[]},dy.prototype.getClass=function(){return dy},dy.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},gy.CAP_ROUND.get=function(){return 1},gy.CAP_FLAT.get=function(){return 2},gy.CAP_SQUARE.get=function(){return 3},gy.JOIN_ROUND.get=function(){return 1},gy.JOIN_MITRE.get=function(){return 2},gy.JOIN_BEVEL.get=function(){return 3},gy.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},gy.DEFAULT_MITRE_LIMIT.get=function(){return 5},gy.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(dy,gy);var yy=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Nf.COUNTERCLOCKWISE,this._inputLine=t||null},_y={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};yy.prototype.isDeletable=function(t,e,i,n){var r=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[i];return!!this.isConcave(r,o,s)&&(!!this.isShallow(r,o,s,n)&&this.isShallowSampled(r,o,t,i,n))},yy.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,i=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(i),r=!1;n<this._inputLine.length;){var o=!1;t.isDeletable(e,i,n,t._distanceTol)&&(t._isDeleted[i]=yy.DELETE,o=!0,r=!0),e=o?n:i,i=t.findNextNonDeletedIndex(e),n=t.findNextNonDeletedIndex(i)}return r},yy.prototype.isShallowConcavity=function(t,e,i,n){return Nf.computeOrientation(t,e,i)===this._angleOrientation&&Nf.distancePointLine(e,t,i)<n},yy.prototype.isShallowSampled=function(t,e,i,n,r){var o=Math.trunc((n-i)/yy.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=i;s<n;s+=o)if(!this.isShallow(t,e,this._inputLine[s],r))return!1;return!0},yy.prototype.isConcave=function(t,e,i){var n=Nf.computeOrientation(t,e,i)===this._angleOrientation;return n},yy.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Nf.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},yy.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===yy.DELETE;)e++;return e},yy.prototype.isShallow=function(t,e,i,n){return Nf.distancePointLine(e,t,i)<n},yy.prototype.collapseLine=function(){for(var t=new $f,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==yy.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},yy.prototype.interfaces_=function(){return[]},yy.prototype.getClass=function(){return yy},yy.simplify=function(t,e){return new yy(t).simplify(e)},_y.INIT.get=function(){return 0},_y.DELETE.get=function(){return 1},_y.KEEP.get=function(){return 1},_y.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(yy,_y);var my=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Qf},vy={COORDINATE_ARRAY_TYPE:{configurable:!0}};my.prototype.getCoordinates=function(){return this._ptList.toArray(my.COORDINATE_ARRAY_TYPE)},my.prototype.setPrecisionModel=function(t){this._precisionModel=t},my.prototype.addPt=function(t){var e=new Xp(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},my.prototype.revere=function(){},my.prototype.addPts=function(t,e){if(e)for(var i=0;i<t.length;i++)this.addPt(t[i]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},my.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},my.prototype.toString=function(){return(new sg).createLineString(this.getCoordinates()).toString()},my.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new Xp(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},my.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},my.prototype.interfaces_=function(){return[]},my.prototype.getClass=function(){return my},vy.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(my,vy);var xy=function(){},wy={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};xy.prototype.interfaces_=function(){return[]},xy.prototype.getClass=function(){return xy},xy.toDegrees=function(t){return 180*t/Math.PI},xy.normalize=function(t){for(;t>Math.PI;)t-=xy.PI_TIMES_2;for(;t<=-Math.PI;)t+=xy.PI_TIMES_2;return t},xy.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],i=arguments[1],n=i.x-e.x,r=i.y-e.y;return Math.atan2(r,n)}},xy.isAcute=function(t,e,i){var n=t.x-e.x,r=t.y-e.y;return n*(i.x-e.x)+r*(i.y-e.y)>0},xy.isObtuse=function(t,e,i){var n=t.x-e.x,r=t.y-e.y;return n*(i.x-e.x)+r*(i.y-e.y)<0},xy.interiorAngle=function(t,e,i){var n=xy.angle(e,t),r=xy.angle(e,i);return Math.abs(r-n)},xy.normalizePositive=function(t){if(t<0){for(;t<0;)t+=xy.PI_TIMES_2;t>=xy.PI_TIMES_2&&(t=0)}else{for(;t>=xy.PI_TIMES_2;)t-=xy.PI_TIMES_2;t<0&&(t=0)}return t},xy.angleBetween=function(t,e,i){var n=xy.angle(e,t),r=xy.angle(e,i);return xy.diff(n,r)},xy.diff=function(t,e){var i=null;return(i=t<e?e-t:t-e)>Math.PI&&(i=2*Math.PI-i),i},xy.toRadians=function(t){return t*Math.PI/180},xy.getTurn=function(t,e){var i=Math.sin(e-t);return i>0?xy.COUNTERCLOCKWISE:i<0?xy.CLOCKWISE:xy.NONE},xy.angleBetweenOriented=function(t,e,i){var n=xy.angle(e,t),r=xy.angle(e,i)-n;return r<=-Math.PI?r+xy.PI_TIMES_2:r>Math.PI?r-xy.PI_TIMES_2:r},wy.PI_TIMES_2.get=function(){return 2*Math.PI},wy.PI_OVER_2.get=function(){return Math.PI/2},wy.PI_OVER_4.get=function(){return Math.PI/4},wy.COUNTERCLOCKWISE.get=function(){return Nf.COUNTERCLOCKWISE},wy.CLOCKWISE.get=function(){return Nf.CLOCKWISE},wy.NONE.get=function(){return Nf.COLLINEAR},Object.defineProperties(xy,wy);var by=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new oy,this._seg1=new oy,this._offset0=new oy,this._offset1=new oy,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],i=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=i,this._li=new Lf,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===dy.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Cy={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};by.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=Nf.computeOrientation(this._s0,this._s1,this._s2),n=i===Nf.CLOCKWISE&&this._side===dg.LEFT||i===Nf.COUNTERCLOCKWISE&&this._side===dg.RIGHT;0===i?this.addCollinear(e):n?this.addOutsideTurn(i,e):this.addInsideTurn(i,e)},by.prototype.addLineEndCap=function(t,e){var i=new oy(t,e),n=new oy;this.computeOffsetSegment(i,dg.LEFT,this._distance,n);var r=new oy;this.computeOffsetSegment(i,dg.RIGHT,this._distance,r);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case dy.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,Nf.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case dy.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(r.p1);break;case dy.CAP_SQUARE:var h=new Xp;h.x=Math.abs(this._distance)*Math.cos(a),h.y=Math.abs(this._distance)*Math.sin(a);var u=new Xp(n.p1.x+h.x,n.p1.y+h.y),l=new Xp(r.p1.x+h.x,r.p1.y+h.y);this._segList.addPt(u),this._segList.addPt(l)}},by.prototype.getCoordinates=function(){return this._segList.getCoordinates()},by.prototype.addMitreJoin=function(t,e,i,n){var r=!0,o=null;try{o=_f.intersection(e.p0,e.p1,i.p0,i.p1),(n<=0?1:o.distance(t)/Math.abs(n))>this._bufParams.getMitreLimit()&&(r=!1)}catch(t){if(!(t instanceof gf))throw t;o=new Xp(0,0),r=!1}r?this._segList.addPt(o):this.addLimitedMitreJoin(e,i,n,this._bufParams.getMitreLimit())},by.prototype.addFilletCorner=function(t,e,i,n,r){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),h=i.x-t.x,u=i.y-t.y,l=Math.atan2(u,h);n===Nf.CLOCKWISE?a<=l&&(a+=2*Math.PI):a>=l&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,l,n,r),this._segList.addPt(i)},by.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*by.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===dy.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===dy.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},by.prototype.createSquare=function(t){this._segList.addPt(new Xp(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Xp(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Xp(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Xp(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},by.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},by.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},by.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},by.prototype.initSideSegments=function(t,e,i){this._s1=t,this._s2=e,this._side=i,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)},by.prototype.addLimitedMitreJoin=function(t,e,i,n){var r=this._seg0.p1,o=xy.angle(r,this._seg0.p0),s=xy.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1)/2,a=xy.normalize(o+s),h=xy.normalize(a+Math.PI),u=n*i,l=i-u*Math.abs(Math.sin(s)),c=r.x+u*Math.cos(h),p=r.y+u*Math.sin(h),f=new Xp(c,p),d=new oy(r,f),g=d.pointAlongOffset(1,l),y=d.pointAlongOffset(1,-l);this._side===dg.LEFT?(this._segList.addPt(g),this._segList.addPt(y)):(this._segList.addPt(y),this._segList.addPt(g))},by.prototype.computeOffsetSegment=function(t,e,i,n){var r=e===dg.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),h=r*i*o/a,u=r*i*s/a;n.p0.x=t.p0.x-u,n.p0.y=t.p0.y+h,n.p1.x=t.p1.x-u,n.p1.y=t.p1.y+h},by.prototype.addFilletArc=function(t,e,i,n,r){var o=n===Nf.CLOCKWISE?-1:1,s=Math.abs(e-i),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var h=s/a,u=0,l=new Xp;u<s;){var c=e+o*u;l.x=t.x+r*Math.cos(c),l.y=t.y+r*Math.sin(c),this._segList.addPt(l),u+=h}},by.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*by.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new Xp((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var n=new Xp((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},by.prototype.createCircle=function(t){var e=new Xp(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},by.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},by.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new my,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*by.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},by.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===dy.JOIN_BEVEL||this._bufParams.getJoinStyle()===dy.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Nf.CLOCKWISE,this._distance))},by.prototype.closeRing=function(){this._segList.closeRing()},by.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},by.prototype.interfaces_=function(){return[]},by.prototype.getClass=function(){return by},Cy.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Cy.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Cy.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Cy.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(by,Cy);var My=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};My.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var i=e<0,n=Math.abs(e),r=this.getSegGen(n);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,i,r);var o=r.getCoordinates();return i&&td.reverse(o),o},My.prototype.computeSingleSidedBufferCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);if(e){i.addSegments(t,!0);var r=yy.simplify(t,-n),o=r.length-1;i.initSideSegments(r[o],r[o-1],dg.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(r[s],!0)}else{i.addSegments(t,!1);var a=yy.simplify(t,n),h=a.length-1;i.initSideSegments(a[0],a[1],dg.LEFT),i.addFirstSegment();for(var u=2;u<=h;u++)i.addNextSegment(a[u],!0)}i.addLastSegment(),i.closeRing()},My.prototype.computeRingBufferCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);e===dg.RIGHT&&(n=-n);var r=yy.simplify(t,n),o=r.length-1;i.initSideSegments(r[o-1],r[0],e);for(var s=1;s<=o;s++){var a=1!==s;i.addNextSegment(r[s],a)}i.closeRing()},My.prototype.computeLineBufferCurve=function(t,e){var i=this.simplifyTolerance(this._distance),n=yy.simplify(t,i),r=n.length-1;e.initSideSegments(n[0],n[1],dg.LEFT);for(var o=2;o<=r;o++)e.addNextSegment(n[o],!0);e.addLastSegment(),e.addLineEndCap(n[r-1],n[r]);var s=yy.simplify(t,-i),a=s.length-1;e.initSideSegments(s[a],s[a-1],dg.LEFT);for(var h=a-2;h>=0;h--)e.addNextSegment(s[h],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},My.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case dy.CAP_ROUND:e.createCircle(t);break;case dy.CAP_SQUARE:e.createSquare(t)}},My.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var i=Math.abs(e),n=this.getSegGen(i);if(t.length<=1)this.computePointCurve(t[0],n);else if(this._bufParams.isSingleSided()){var r=e<0;this.computeSingleSidedBufferCurve(t,r,n)}else this.computeLineBufferCurve(t,n);return n.getCoordinates()},My.prototype.getBufferParameters=function(){return this._bufParams},My.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},My.prototype.getRingCurve=function(t,e,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return My.copyCoordinates(t);var n=this.getSegGen(i);return this.computeRingBufferCurve(t,e,n),n.getCoordinates()},My.prototype.computeOffsetCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);if(e){var r=yy.simplify(t,-n),o=r.length-1;i.initSideSegments(r[o],r[o-1],dg.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(r[s],!0)}else{var a=yy.simplify(t,n),h=a.length-1;i.initSideSegments(a[0],a[1],dg.LEFT),i.addFirstSegment();for(var u=2;u<=h;u++)i.addNextSegment(a[u],!0)}i.addLastSegment()},My.prototype.getSegGen=function(t){return new by(this._precisionModel,this._bufParams,t)},My.prototype.interfaces_=function(){return[]},My.prototype.getClass=function(){return My},My.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),i=0;i<e.length;i++)e[i]=new Xp(t[i]);return e};var Ey=function(){this._subgraphs=null,this._seg=new oy,this._cga=new Nf;var t=arguments[0];this._subgraphs=t},Sy={DepthSegment:{configurable:!0}};Ey.prototype.findStabbedSegments=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],i=new Qf,n=this._subgraphs.iterator();n.hasNext();){var r=n.next(),o=r.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,r.getDirectedEdges(),i)}return i}if(3===arguments.length)if(ef(arguments[2],Xf)&&arguments[0]instanceof Xp&&arguments[1]instanceof Ng)for(var s=arguments[0],a=arguments[1],h=arguments[2],u=a.getEdge().getCoordinates(),l=0;l<u.length-1;l++){t._seg.p0=u[l],t._seg.p1=u[l+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var c=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(c<s.x)&&!(t._seg.isHorizontal()||s.y<t._seg.p0.y||s.y>t._seg.p1.y||Nf.computeOrientation(t._seg.p0,t._seg.p1,s)===Nf.RIGHT)){var p=a.getDepth(dg.LEFT);t._seg.p0.equals(u[l])||(p=a.getDepth(dg.RIGHT));var f=new Py(t._seg,p);h.add(f)}}else if(ef(arguments[2],Xf)&&arguments[0]instanceof Xp&&ef(arguments[1],Xf))for(var d=arguments[0],g=arguments[1],y=arguments[2],_=g.iterator();_.hasNext();){var m=_.next();m.isForward()&&t.findStabbedSegments(d,m,y)}},Ey.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:qg.min(e)._leftDepth},Ey.prototype.interfaces_=function(){return[]},Ey.prototype.getClass=function(){return Ey},Sy.DepthSegment.get=function(){return Py},Object.defineProperties(Ey,Sy);var Py=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new oy(t),this._leftDepth=e};Py.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==i||0!==(i=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?i:this._upwardSeg.compareTo(e._upwardSeg)},Py.prototype.compareX=function(t,e){var i=t.p0.compareTo(e.p0);return 0!==i?i:t.p1.compareTo(e.p1)},Py.prototype.toString=function(){return this._upwardSeg.toString()},Py.prototype.interfaces_=function(){return[Zp]},Py.prototype.getClass=function(){return Py};var Iy=function(t,e,i){this.p0=t||null,this.p1=e||null,this.p2=i||null};Iy.prototype.area=function(){return Iy.area(this.p0,this.p1,this.p2)},Iy.prototype.signedArea=function(){return Iy.signedArea(this.p0,this.p1,this.p2)},Iy.prototype.interpolateZ=function(t){if(null===t)throw new Vp("Supplied point is null.");return Iy.interpolateZ(t,this.p0,this.p1,this.p2)},Iy.prototype.longestSideLength=function(){return Iy.longestSideLength(this.p0,this.p1,this.p2)},Iy.prototype.isAcute=function(){return Iy.isAcute(this.p0,this.p1,this.p2)},Iy.prototype.circumcentre=function(){return Iy.circumcentre(this.p0,this.p1,this.p2)},Iy.prototype.area3D=function(){return Iy.area3D(this.p0,this.p1,this.p2)},Iy.prototype.centroid=function(){return Iy.centroid(this.p0,this.p1,this.p2)},Iy.prototype.inCentre=function(){return Iy.inCentre(this.p0,this.p1,this.p2)},Iy.prototype.interfaces_=function(){return[]},Iy.prototype.getClass=function(){return Iy},Iy.area=function(t,e,i){return Math.abs(((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2)},Iy.signedArea=function(t,e,i){return((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2},Iy.det=function(t,e,i,n){return t*n-e*i},Iy.interpolateZ=function(t,e,i,n){var r=e.x,o=e.y,s=i.x-r,a=n.x-r,h=i.y-o,u=n.y-o,l=s*u-a*h,c=t.x-r,p=t.y-o,f=(u*c-a*p)/l,d=(-h*c+s*p)/l;return e.z+f*(i.z-e.z)+d*(n.z-e.z)},Iy.longestSideLength=function(t,e,i){var n=t.distance(e),r=e.distance(i),o=i.distance(t),s=n;return r>s&&(s=r),o>s&&(s=o),s},Iy.isAcute=function(t,e,i){return!!xy.isAcute(t,e,i)&&(!!xy.isAcute(e,i,t)&&!!xy.isAcute(i,t,e))},Iy.circumcentre=function(t,e,i){var n=i.x,r=i.y,o=t.x-n,s=t.y-r,a=e.x-n,h=e.y-r,u=2*Iy.det(o,s,a,h),l=Iy.det(s,o*o+s*s,h,a*a+h*h),c=Iy.det(o,o*o+s*s,a,a*a+h*h);return new Xp(n-l/u,r+c/u)},Iy.perpendicularBisector=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=new _f(t.x+i/2,t.y+n/2,1),o=new _f(t.x-n+i/2,t.y+i+n/2,1);return new _f(r,o)},Iy.angleBisector=function(t,e,i){var n=e.distance(t),r=n/(n+e.distance(i)),o=i.x-t.x,s=i.y-t.y;return new Xp(t.x+r*o,t.y+r*s)},Iy.area3D=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,o=e.z-t.z,s=i.x-t.x,a=i.y-t.y,h=i.z-t.z,u=r*h-o*a,l=o*s-n*h,c=n*a-r*s,p=u*u+l*l+c*c,f=Math.sqrt(p)/2;return f},Iy.centroid=function(t,e,i){var n=(t.x+e.x+i.x)/3,r=(t.y+e.y+i.y)/3;return new Xp(n,r)},Iy.inCentre=function(t,e,i){var n=e.distance(i),r=t.distance(i),o=t.distance(e),s=n+r+o,a=(n*t.x+r*e.x+o*i.x)/s,h=(n*t.y+r*e.y+o*i.y)/s;return new Xp(a,h)};var Ty=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Qf;var t=arguments[0],e=arguments[1],i=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=i};Ty.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,$p.EXTERIOR,$p.INTERIOR)},Ty.prototype.addPolygon=function(t){var e=this,i=this._distance,n=dg.LEFT;this._distance<0&&(i=-this._distance,n=dg.RIGHT);var r=t.getExteriorRing(),o=td.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,i,n,$p.EXTERIOR,$p.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var a=t.getInteriorRingN(s),h=td.removeRepeatedPoints(a.getCoordinates());e._distance>0&&e.isErodedCompletely(a,-e._distance)||e.addPolygonRing(h,i,dg.opposite(n),$p.INTERIOR,$p.EXTERIOR)}},Ty.prototype.isTriangleErodedCompletely=function(t,e){var i=new Iy(t[0],t[1],t[2]),n=i.inCentre();return Nf.distancePointLine(n,i.p0,i.p1)<Math.abs(e)},Ty.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=td.removeRepeatedPoints(t.getCoordinates()),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,$p.EXTERIOR,$p.INTERIOR)},Ty.prototype.addCurve=function(t,e,i){if(null===t||t.length<2)return null;var n=new ry(t,new Cg(0,$p.BOUNDARY,e,i));this._curveList.add(n)},Ty.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Ty.prototype.addPolygonRing=function(t,e,i,n,r){if(0===e&&t.length<qd.MINIMUM_VALID_SIZE)return null;var o=n,s=r;t.length>=qd.MINIMUM_VALID_SIZE&&Nf.isCCW(t)&&(o=r,s=n,i=dg.opposite(i));var a=this._curveBuilder.getRingCurve(t,i,e);this.addCurve(a,o,s)},Ty.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Vd?this.addPolygon(t):t instanceof jd?this.addLineString(t):t instanceof zd?this.addPoint(t):(t instanceof Hd||t instanceof Sd||t instanceof Zd||t instanceof Ed)&&this.addCollection(t)},Ty.prototype.isErodedCompletely=function(t,e){var i=t.getCoordinates();if(i.length<4)return e<0;if(4===i.length)return this.isTriangleErodedCompletely(i,e);var n=t.getEnvelopeInternal(),r=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>r},Ty.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},Ty.prototype.interfaces_=function(){return[]},Ty.prototype.getClass=function(){return Ty};var Ly=function(){};Ly.prototype.locate=function(t){},Ly.prototype.interfaces_=function(){return[]},Ly.prototype.getClass=function(){return Ly};var Oy=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Oy.prototype.next=function(){if(this._atStart)return this._atStart=!1,Oy.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Jf;var t=this._parent.getGeometryN(this._index++);return t instanceof Ed?(this._subcollectionIterator=new Oy(t),this._subcollectionIterator.next()):t},Oy.prototype.remove=function(){throw new Error(this.getClass().getName())},Oy.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Oy.prototype.interfaces_=function(){return[Yf]},Oy.prototype.getClass=function(){return Oy},Oy.isAtomic=function(t){return!(t instanceof Ed)};var Ry=function(){this._geom=null;var t=arguments[0];this._geom=t};Ry.prototype.locate=function(t){return Ry.locate(t,this._geom)},Ry.prototype.interfaces_=function(){return[Ly]},Ry.prototype.getClass=function(){return Ry},Ry.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&Nf.isPointInRing(t,e.getCoordinates())},Ry.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var i=e.getExteriorRing();if(!Ry.isPointInRing(t,i))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var r=e.getInteriorRingN(n);if(Ry.isPointInRing(t,r))return!1}return!0},Ry.containsPoint=function(t,e){if(e instanceof Vd)return Ry.containsPointInPolygon(t,e);if(e instanceof Ed)for(var i=new Oy(e);i.hasNext();){var n=i.next();if(n!==e&&Ry.containsPoint(t,n))return!0}return!1},Ry.locate=function(t,e){return e.isEmpty()?$p.EXTERIOR:Ry.containsPoint(t,e)?$p.INTERIOR:$p.EXTERIOR};var Ny=function(){this._edgeMap=new gd,this._edgeList=null,this._ptInAreaLocation=[$p.NONE,$p.NONE]};Ny.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),i=e-1;return 0===e&&(i=this._edgeList.size()-1),this._edgeList.get(i)},Ny.prototype.propagateSideLabels=function(t){for(var e=$p.NONE,i=this.iterator();i.hasNext();){var n=i.next().getLabel();n.isArea(t)&&n.getLocation(t,dg.LEFT)!==$p.NONE&&(e=n.getLocation(t,dg.LEFT))}if(e===$p.NONE)return null;for(var r=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,dg.ON)===$p.NONE&&a.setLocation(t,dg.ON,r),a.isArea(t)){var h=a.getLocation(t,dg.LEFT),u=a.getLocation(t,dg.RIGHT);if(u!==$p.NONE){if(u!==r)throw new vg("side location conflict",s.getCoordinate());h===$p.NONE&&Pf.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=h}else Pf.isTrue(a.getLocation(t,dg.LEFT)===$p.NONE,"found single null side"),a.setLocation(t,dg.RIGHT,r),a.setLocation(t,dg.LEFT,r)}}},Ny.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Ny.prototype.print=function(t){yf.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){e.next().print(t)}},Ny.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Ny.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var i=e.size()-1,n=e.get(i).getLabel().getLocation(t,dg.LEFT);Pf.isTrue(n!==$p.NONE,"Found unlabelled area edge");for(var r=n,o=this.iterator();o.hasNext();){var s=o.next().getLabel();Pf.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,dg.LEFT),h=s.getLocation(t,dg.RIGHT);if(a===h)return!1;if(h!==r)return!1;r=a}return!0},Ny.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++){if(this._edgeList.get(e)===t)return e}return-1},Ny.prototype.iterator=function(){return this.getEdges().iterator()},Ny.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Qf(this._edgeMap.values())),this._edgeList},Ny.prototype.getLocation=function(t,e,i){return this._ptInAreaLocation[t]===$p.NONE&&(this._ptInAreaLocation[t]=Ry.locate(e,i[t].getGeometry())),this._ptInAreaLocation[t]},Ny.prototype.toString=function(){var t=new of;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var i=e.next();t.append(i),t.append("\n")}return t.toString()},Ny.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){e.next().computeLabel(t)}},Ny.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],i=this.iterator();i.hasNext();)for(var n=i.next().getLabel(),r=0;r<2;r++)n.isLine(r)&&n.getLocation(r)===$p.BOUNDARY&&(e[r]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),h=0;h<2;h++)if(a.isAnyNull(h)){var u=$p.NONE;if(e[h])u=$p.EXTERIOR;else{var l=s.getCoordinate();u=this.getLocation(h,l,t)}a.setAllLocationsIfNull(h,u)}},Ny.prototype.getDegree=function(){return this._edgeMap.size()},Ny.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Ny.prototype.interfaces_=function(){return[]},Ny.prototype.getClass=function(){return Ny};var Ay=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var e=null,i=null,n=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var o=t._resultAreaEdgeList.get(r),s=o.getSym();if(o.getLabel().isArea())switch(null===e&&o.isInResult()&&(e=o),n){case t._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;i=s,n=t._LINKING_TO_OUTGOING;break;case t._LINKING_TO_OUTGOING:if(!o.isInResult())continue;i.setNext(o),n=t._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new vg("no outgoing dirEdge found",this.getCoordinate());Pf.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),i.setNext(e)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var i=t.get(0);if(1===e)return i;var n=t.get(e-1),r=i.getQuadrant(),o=n.getQuadrant();return Lg.isNorthern(r)&&Lg.isNorthern(o)?i:Lg.isNorthern(r)||Lg.isNorthern(o)?0!==i.getDy()?i:0!==n.getDy()?n:(Pf.shouldNeverReachHere("found two horizontal edges incident on node"),null):n},e.prototype.print=function(t){yf.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var i=e.next();t.print("out "),i.print(t),t.println(),t.print("in "),i.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Qf;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var i=e.next().getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,i=this._edgeList.size()-1;i>=0;i--){var n=this._edgeList.get(i),r=n.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=n}e.setNext(t)},e.prototype.computeDepths=function(){var t=this;if(1===arguments.length){var e=arguments[0],i=this.findIndex(e),n=e.getDepth(dg.LEFT),r=e.getDepth(dg.RIGHT),o=this.computeDepths(i+1,this._edgeList.size(),n),s=this.computeDepths(0,i,o);if(s!==r)throw new vg("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var a=arguments[0],h=arguments[1],u=arguments[2],l=u,c=a;c<h;c++){var p=t._edgeList.get(c);p.setEdgeDepths(dg.RIGHT,l),l=p.getDepth(dg.LEFT)}return l}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=this,i=null,n=null,r=this._SCANNING_FOR_INCOMING,o=this._resultAreaEdgeList.size()-1;o>=0;o--){var s=e._resultAreaEdgeList.get(o),a=s.getSym();switch(null===i&&s.getEdgeRing()===t&&(i=s),r){case e._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;n=a,r=e._LINKING_TO_OUTGOING;break;case e._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;n.setNextMin(s),r=e._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(Pf.isTrue(null!==i,"found null for first outgoing dirEdge"),Pf.isTrue(i.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(i))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){var i=e.next();i.isInResult()&&t++}return t}if(1===arguments.length){for(var n=arguments[0],r=0,o=this.iterator();o.hasNext();){var s=o.next();s.getEdgeRing()===n&&r++}return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=$p.NONE,e=this.iterator();e.hasNext();){var i=e.next(),n=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){t=$p.INTERIOR;break}if(n.isInResult()){t=$p.EXTERIOR;break}}}if(t===$p.NONE)return null;for(var r=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===$p.INTERIOR):(s.isInResult()&&(r=$p.EXTERIOR),a.isInResult()&&(r=$p.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Cg($p.NONE);for(var i=this.iterator();i.hasNext();)for(var n=i.next().getEdge().getLabel(),r=0;r<2;r++){var o=n.getLocation(r);o!==$p.INTERIOR&&o!==$p.BOUNDARY||this._label.setLocation(r,$p.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ny),Dy=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Ig(t,new Ay)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ag),ky=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};ky.prototype.compareTo=function(t){var e=t;return ky.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},ky.prototype.interfaces_=function(){return[Zp]},ky.prototype.getClass=function(){return ky},ky.orientation=function(t){return 1===td.increasingDirection(t)},ky.compareOriented=function(t,e,i,n){for(var r=e?1:-1,o=n?1:-1,s=e?t.length:-1,a=n?i.length:-1,h=e?0:t.length-1,u=n?0:i.length-1;;){var l=t[h].compareTo(i[u]);if(0!==l)return l;var c=(h+=r)===s,p=(u+=o)===a;if(c&&!p)return-1;if(!c&&p)return 1;if(c&&p)return 0}};var Fy=function(){this._edges=new Qf,this._ocaMap=new gd};Fy.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var i=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var n=i.getCoordinates(),r=0;r<n.length;r++)r>0&&t.print(","),t.print(n[r].x+" "+n[r].y);t.println(")")}t.print(")  ")},Fy.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Fy.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Fy.prototype.iterator=function(){return this._edges.iterator()},Fy.prototype.getEdges=function(){return this._edges},Fy.prototype.get=function(t){return this._edges.get(t)},Fy.prototype.findEqualEdge=function(t){var e=new ky(t.getCoordinates());return this._ocaMap.get(e)},Fy.prototype.add=function(t){this._edges.add(t);var e=new ky(t.getCoordinates());this._ocaMap.put(e,t)},Fy.prototype.interfaces_=function(){return[]},Fy.prototype.getClass=function(){return Fy};var jy=function(){};jy.prototype.processIntersections=function(t,e,i,n){},jy.prototype.isDone=function(){},jy.prototype.interfaces_=function(){return[]},jy.prototype.getClass=function(){return jy};var Gy=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Gy.prototype.isTrivialIntersection=function(t,e,i,n){if(t===i&&1===this._li.getIntersectionNum()){if(Gy.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&n===r||0===n&&e===r)return!0}}return!1},Gy.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Gy.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Gy.prototype.getLineIntersector=function(){return this._li},Gy.prototype.hasProperIntersection=function(){return this._hasProper},Gy.prototype.processIntersections=function(t,e,i,n){if(t===i&&e===n)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,i,n)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Gy.prototype.hasIntersection=function(){return this._hasIntersection},Gy.prototype.isDone=function(){return!1},Gy.prototype.hasInteriorIntersection=function(){return this._hasInterior},Gy.prototype.interfaces_=function(){return[jy]},Gy.prototype.getClass=function(){return Gy},Gy.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var zy=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],i=arguments[2];this.coord=new Xp(t),this.segmentIndex=e,this.dist=i};zy.prototype.getSegmentIndex=function(){return this.segmentIndex},zy.prototype.getCoordinate=function(){return this.coord},zy.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},zy.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},zy.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},zy.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},zy.prototype.getDistance=function(){return this.dist},zy.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},zy.prototype.interfaces_=function(){return[Zp]},zy.prototype.getClass=function(){return zy};var By=function(){this._nodeMap=new gd,this.edge=null;var t=arguments[0];this.edge=t};By.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){e.next().print(t)}},By.prototype.iterator=function(){return this._nodeMap.values().iterator()},By.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(i,n);t.add(r),i=n}},By.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},By.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,n=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(n);r||i--;var o=new Array(i).fill(null),s=0;o[s++]=new Xp(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return r&&(o[s]=e.coord),new Uy(o,new Cg(this.edge._label))},By.prototype.add=function(t,e,i){var n=new zy(t,e,i),r=this._nodeMap.get(n);return null!==r?r:(this._nodeMap.put(n,n),n)},By.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){if(e.next().coord.equals(t))return!0}return!1},By.prototype.interfaces_=function(){return[]},By.prototype.getClass=function(){return By};var Vy=function(){};Vy.prototype.getChainStartIndices=function(t){var e=0,i=new Qf;i.add(new sf(e));do{var n=this.findChainEnd(t,e);i.add(new sf(n)),e=n}while(e<t.length-1);return Vy.toIntArray(i)},Vy.prototype.findChainEnd=function(t,e){for(var i=Lg.quadrant(t[e],t[e+1]),n=e+1;n<t.length;){if(Lg.quadrant(t[n-1],t[n])!==i)break;n++}return n-1},Vy.prototype.interfaces_=function(){return[]},Vy.prototype.getClass=function(){return Vy},Vy.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var Hy=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new mf,this.env2=new mf;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Vy;this.startIndex=e.getChainStartIndices(this.pts)};Hy.prototype.getCoordinates=function(){return this.pts},Hy.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e>i?e:i},Hy.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e<i?e:i},Hy.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[i],e.startIndex[i+1],n)}else if(6===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],h=arguments[4],u=arguments[5],l=this.pts[r],c=this.pts[o],p=s.pts[a],f=s.pts[h];if(o-r==1&&h-a==1)return u.addIntersections(this.e,r,s.e,a),null;if(this.env1.init(l,c),this.env2.init(p,f),!this.env1.intersects(this.env2))return null;var d=Math.trunc((r+o)/2),g=Math.trunc((a+h)/2);r<d&&(a<g&&this.computeIntersectsForChain(r,d,s,a,g,u),g<h&&this.computeIntersectsForChain(r,d,s,g,h,u)),d<o&&(a<g&&this.computeIntersectsForChain(d,o,s,a,g,u),g<h&&this.computeIntersectsForChain(d,o,s,g,h,u))}},Hy.prototype.getStartIndexes=function(){return this.startIndex},Hy.prototype.computeIntersects=function(t,e){for(var i=0;i<this.startIndex.length-1;i++)for(var n=0;n<t.startIndex.length-1;n++)this.computeIntersectsForChain(i,t,n,e)},Hy.prototype.interfaces_=function(){return[]},Hy.prototype.getClass=function(){return Hy};var qy=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var i=0;i<3;i++)this._depth[e][i]=t.NULL_VALUE},Zy={NULL_VALUE:{configurable:!0}};qy.prototype.getDepth=function(t,e){return this._depth[t][e]},qy.prototype.setDepth=function(t,e,i){this._depth[t][e]=i},qy.prototype.isNull=function(){var t=this;if(0===arguments.length){for(var e=0;e<2;e++)for(var i=0;i<3;i++)if(t._depth[e][i]!==qy.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this._depth[n][1]===qy.NULL_VALUE}if(2===arguments.length){var r=arguments[0],o=arguments[1];return this._depth[r][o]===qy.NULL_VALUE}},qy.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var i=t._depth[e][1];t._depth[e][2]<i&&(i=t._depth[e][2]),i<0&&(i=0);for(var n=1;n<3;n++){var r=0;t._depth[e][n]>i&&(r=1),t._depth[e][n]=r}}},qy.prototype.getDelta=function(t){return this._depth[t][dg.RIGHT]-this._depth[t][dg.LEFT]},qy.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?$p.EXTERIOR:$p.INTERIOR},qy.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},qy.prototype.add=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],i=0;i<2;i++)for(var n=1;n<3;n++){var r=e.getLocation(i,n);r!==$p.EXTERIOR&&r!==$p.INTERIOR||(t.isNull(i,n)?t._depth[i][n]=qy.depthAtLocation(r):t._depth[i][n]+=qy.depthAtLocation(r))}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];a===$p.INTERIOR&&this._depth[o][s]++}},qy.prototype.interfaces_=function(){return[]},qy.prototype.getClass=function(){return qy},qy.depthAtLocation=function(t){return t===$p.EXTERIOR?0:t===$p.INTERIOR?1:qy.NULL_VALUE},Zy.NULL_VALUE.get=function(){return-1},Object.defineProperties(qy,Zy);var Uy=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new By(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new qy,this._depthDelta=0,1===arguments.length){var i=arguments[0];e.call(this,i,null)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.pts=n,this._label=r}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Cg.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var i=t;if(this.pts.length!==i.pts.length)return!1;for(var n=!0,r=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(i.pts[s])||(n=!1),this.pts[s].equals2D(i.pts[--o])||(r=!1),!n&&!r)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&(3===this.pts.length&&!!this.pts[0].equals(this.pts[2]))},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Hy(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new mf;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,i,n){var r=new Xp(t.getIntersection(n)),o=e,s=t.getEdgeDistance(i,n),a=o+1;if(a<this.pts.length){var h=this.pts[a];r.equals2D(h)&&(o=a,s=0)}this.eiList.add(r,o,s)},e.prototype.toString=function(){var t=new of;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,i,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],i=arguments[1];i.setAtLeastIfValid(e.getLocation(0,dg.ON),e.getLocation(1,dg.ON),1),e.isArea()&&(i.setAtLeastIfValid(e.getLocation(0,dg.LEFT),e.getLocation(1,dg.LEFT),2),i.setAtLeastIfValid(e.getLocation(0,dg.RIGHT),e.getLocation(1,dg.RIGHT),2))},e}(Pg),Wy=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Fy,this._bufParams=t||null};Wy.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},Wy.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Cg(t.getLabel())).flip(),i.merge(n);var r=Wy.depthDelta(n),o=e.getDepthDelta()+r;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(Wy.depthDelta(t.getLabel()))},Wy.prototype.buildSubgraphs=function(t,e){for(var i=new Qf,n=t.iterator();n.hasNext();){var r=n.next(),o=r.getRightmostCoordinate(),s=new Ey(i).getDepth(o);r.computeDepth(s),r.findResultEdges(),i.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},Wy.prototype.createSubgraphs=function(t){for(var e=new Qf,i=t.getNodes().iterator();i.hasNext();){var n=i.next();if(!n.isVisited()){var r=new wg;r.create(n),e.add(r)}}return qg.sort(e,qg.reverseOrder()),e},Wy.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Wy.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new py,i=new Lf;return i.setPrecisionModel(t),e.setSegmentIntersector(new Gy(i)),e},Wy.prototype.buffer=function(t,e){var i=this._workingPrecisionModel;null===i&&(i=t.getPrecisionModel()),this._geomFact=t.getFactory();var n=new My(i,this._bufParams),r=new Ty(t,e,n).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,i),this._graph=new Dg(new Dy),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new kg(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},Wy.prototype.computeNodedEdges=function(t,e){var i=this.getNoder(e);i.computeNodes(t);for(var n=i.getNodedSubstrings().iterator();n.hasNext();){var r=n.next(),o=r.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=r.getData(),a=new Uy(r.getCoordinates(),new Cg(s));this.insertUniqueEdge(a)}}},Wy.prototype.setNoder=function(t){this._workingNoder=t},Wy.prototype.interfaces_=function(){return[]},Wy.prototype.getClass=function(){return Wy},Wy.depthDelta=function(t){var e=t.getLocation(0,dg.LEFT),i=t.getLocation(0,dg.RIGHT);return e===$p.INTERIOR&&i===$p.EXTERIOR?1:e===$p.EXTERIOR&&i===$p.INTERIOR?-1:0},Wy.convertSegStrings=function(t){for(var e=new sg,i=new Qf;t.hasNext();){var n=t.next(),r=e.createLineString(n.getCoordinates());i.add(r)}return e.buildGeometry(i)};var Yy=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3];this._noder=i,this._scaleFactor=n,this._offsetX=r,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};Yy.prototype.rescale=function(){var t=this;if(ef(arguments[0],Uf))for(var e=arguments[0],i=e.iterator();i.hasNext();){var n=i.next();t.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],o=0;o<r.length;o++)r[o].x=r[o].x/t._scaleFactor+t._offsetX,r[o].y=r[o].y/t._scaleFactor+t._offsetY;2===r.length&&r[0].equals2D(r[1])&&yf.out.println(r)}},Yy.prototype.scale=function(){var t=this;if(ef(arguments[0],Uf)){for(var e=arguments[0],i=new Qf,n=e.iterator();n.hasNext();){var r=n.next();i.add(new ry(t.scale(r.getCoordinates()),r.getData()))}return i}if(arguments[0]instanceof Array){for(var o=arguments[0],s=new Array(o.length).fill(null),a=0;a<o.length;a++)s[a]=new Xp(Math.round((o[a].x-t._offsetX)*t._scaleFactor),Math.round((o[a].y-t._offsetY)*t._scaleFactor),o[a].z);var h=td.removeRepeatedPoints(s);return h}},Yy.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},Yy.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},Yy.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},Yy.prototype.interfaces_=function(){return[ly]},Yy.prototype.getClass=function(){return Yy};var Xy=function(){this._li=new Lf,this._segStrings=null;var t=arguments[0];this._segStrings=t},Jy={fact:{configurable:!0}};Xy.prototype.checkEndPtVertexIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var i=e.next(),n=i.getCoordinates();t.checkEndPtVertexIntersections(n[0],t._segStrings),t.checkEndPtVertexIntersections(n[n.length-1],t._segStrings)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],s=o.iterator();s.hasNext();)for(var a=s.next(),h=a.getCoordinates(),u=1;u<h.length-1;u++)if(h[u].equals(r))throw new Ef("found endpt/interior pt intersection at index "+u+" :pt "+r)},Xy.prototype.checkInteriorIntersections=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var i=e.next(),n=this._segStrings.iterator();n.hasNext();){var r=n.next();t.checkInteriorIntersections(i,r)}else if(2===arguments.length)for(var o=arguments[0],s=arguments[1],a=o.getCoordinates(),h=s.getCoordinates(),u=0;u<a.length-1;u++)for(var l=0;l<h.length-1;l++)t.checkInteriorIntersections(o,u,s,l);else if(4===arguments.length){var c=arguments[0],p=arguments[1],f=arguments[2],d=arguments[3];if(c===f&&p===d)return null;var g=c.getCoordinates()[p],y=c.getCoordinates()[p+1],_=f.getCoordinates()[d],m=f.getCoordinates()[d+1];if(this._li.computeIntersection(g,y,_,m),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,g,y)||this.hasInteriorIntersection(this._li,_,m)))throw new Ef("found non-noded intersection at "+g+"-"+y+" and "+_+"-"+m)}},Xy.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},Xy.prototype.checkCollapses=function(){var t=this;if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var i=e.next();t.checkCollapses(i)}else if(1===arguments.length)for(var n=arguments[0],r=n.getCoordinates(),o=0;o<r.length-2;o++)t.checkCollapse(r[o],r[o+1],r[o+2])},Xy.prototype.hasInteriorIntersection=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++){var r=t.getIntersection(n);if(!r.equals(e)&&!r.equals(i))return!0}return!1},Xy.prototype.checkCollapse=function(t,e,i){if(t.equals(i))throw new Ef("found non-noded collapse at "+Xy.fact.createLineString([t,e,i]))},Xy.prototype.interfaces_=function(){return[]},Xy.prototype.getClass=function(){return Xy},Jy.fact.get=function(){return new sg},Object.defineProperties(Xy,Jy);var Qy=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],i=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=i,e<=0)throw new Vp("Scale factor must be non-zero");1!==e&&(this._pt=new Xp(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Xp,this._p1Scaled=new Xp),this.initCorners(this._pt)},Ky={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Qy.prototype.intersectsScaled=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<i||this._minx>n||this._maxy<r||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return Pf.isTrue(!(s&&a),"Found bad envelope test"),a},Qy.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new Xp(this._maxx,this._maxy),this._corner[1]=new Xp(this._minx,this._maxy),this._corner[2]=new Xp(this._minx,this._miny),this._corner[3]=new Xp(this._maxx,this._miny)},Qy.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Qy.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},Qy.prototype.getCoordinate=function(){return this._originalPt},Qy.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},Qy.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=Qy.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new mf(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},Qy.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},Qy.prototype.intersectsToleranceSquare=function(t,e){var i=!1,n=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),!!this._li.isProper()||(!(!i||!n)||(!!t.equals(this._pt)||!!e.equals(this._pt))))))},Qy.prototype.addSnappedNode=function(t,e){var i=t.getCoordinate(e),n=t.getCoordinate(e+1);return!!this.intersects(i,n)&&(t.addIntersection(this.getCoordinate(),e),!0)},Qy.prototype.interfaces_=function(){return[]},Qy.prototype.getClass=function(){return Qy},Ky.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Qy,Ky);var $y=function(){this.tempEnv1=new mf,this.selectedSegment=new oy};$y.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},$y.prototype.interfaces_=function(){return[]},$y.prototype.getClass=function(){return $y};var t_=function(){this._index=null;var t=arguments[0];this._index=t},e_={HotPixelSnapAction:{configurable:!0}};t_.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=e.getSafeEnvelope(),o=new i_(e,i,n);return this._index.query(r,{interfaces_:function(){return[zg]},visitItem:function(t){t.select(r,o)}}),o.isNodeAdded()}},t_.prototype.interfaces_=function(){return[]},t_.prototype.getClass=function(){return t_},e_.HotPixelSnapAction.get=function(){return i_},Object.defineProperties(t_,e_);var i_=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],i=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=i,this._hotPixelVertexIndex=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[0],i=arguments[1],n=e.getContext();if(null!==this._parentEdge&&n===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($y),n_=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new Qf};n_.prototype.processIntersections=function(t,e,i,n){if(t===i&&e===n)return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];if(this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var h=0;h<this._li.getIntersectionNum();h++)this._interiorIntersections.add(this._li.getIntersection(h));t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1)}},n_.prototype.isDone=function(){return!1},n_.prototype.getInteriorIntersections=function(){return this._interiorIntersections},n_.prototype.interfaces_=function(){return[jy]},n_.prototype.getClass=function(){return n_};var r_=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new Lf,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};r_.prototype.checkCorrectness=function(t){var e=ry.getNodedSubstrings(t),i=new Xy(e);try{i.checkValid()}catch(t){if(!(t instanceof df))throw t;t.printStackTrace()}},r_.prototype.getNodedSubstrings=function(){return ry.getNodedSubstrings(this._nodedSegStrings)},r_.prototype.snapRound=function(t,e){var i=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(i),this.computeVertexSnaps(t)},r_.prototype.findInteriorIntersections=function(t,e){var i=new n_(e);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(t),i.getInteriorIntersections()},r_.prototype.computeVertexSnaps=function(){var t=this;if(ef(arguments[0],Uf))for(var e=arguments[0],i=e.iterator();i.hasNext();){var n=i.next();t.computeVertexSnaps(n)}else if(arguments[0]instanceof ry)for(var r=arguments[0],o=r.getCoordinates(),s=0;s<o.length;s++){var a=new Qy(o[s],t._scaleFactor,t._li),h=t._pointSnapper.snap(a,r,s);h&&r.addIntersection(o[s],s)}},r_.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new py,this._pointSnapper=new t_(this._noder.getIndex()),this.snapRound(t,this._li)},r_.prototype.computeIntersectionSnaps=function(t){for(var e=this,i=t.iterator();i.hasNext();){var n=i.next(),r=new Qy(n,e._scaleFactor,e._li);e._pointSnapper.snap(r)}},r_.prototype.interfaces_=function(){return[ly]},r_.prototype.getClass=function(){return r_};var o_=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new dy,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._argGeom=e,this._bufParams=i}},s_={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};o_.prototype.bufferFixedPrecision=function(t){var e=new Yy(new r_(new ig(1)),t.getScale()),i=new Wy(this._bufParams);i.setWorkingPrecisionModel(t),i.setNoder(e),this._resultGeometry=i.buffer(this._argGeom,this._distance)},o_.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=o_.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof vg))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var i=arguments[0],n=o_.precisionScaleFactor(this._argGeom,this._distance,i),r=new ig(n);this.bufferFixedPrecision(r)}},o_.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===ig.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},o_.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},o_.prototype.bufferOriginalPrecision=function(){try{var t=new Wy(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Ef))throw t;this._saveException=t}},o_.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},o_.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},o_.prototype.interfaces_=function(){return[]},o_.prototype.getClass=function(){return o_},o_.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new o_(t),n=i.getResultGeometry(e);return n}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof kf&&"number"==typeof arguments[1]){var r=arguments[0],o=arguments[1],s=arguments[2],a=new o_(r);a.setQuadrantSegments(s);var h=a.getResultGeometry(o);return h}if(arguments[2]instanceof dy&&arguments[0]instanceof kf&&"number"==typeof arguments[1]){var u=arguments[0],l=arguments[1],c=arguments[2],p=new o_(u,c),f=p.getResultGeometry(l);return f}}else if(4===arguments.length){var d=arguments[0],g=arguments[1],y=arguments[2],_=arguments[3],m=new o_(d);m.setQuadrantSegments(y),m.setEndCapStyle(_);var v=m.getResultGeometry(g);return v}},o_.precisionScaleFactor=function(t,e,i){var n=t.getEnvelopeInternal(),r=nf.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY()))+2*(e>0?e:0),o=i-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,o)},s_.CAP_ROUND.get=function(){return dy.CAP_ROUND},s_.CAP_BUTT.get=function(){return dy.CAP_FLAT},s_.CAP_FLAT.get=function(){return dy.CAP_FLAT},s_.CAP_SQUARE.get=function(){return dy.CAP_SQUARE},s_.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(o_,s_);var a_=function(){this._pt=[new Xp,new Xp],this._distance=Hp.NaN,this._isNull=!0};a_.prototype.getCoordinates=function(){return this._pt},a_.prototype.getCoordinate=function(t){return this._pt[t]},a_.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n<this._distance&&this.initialize(e,i,n)}},a_.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(n),this._distance=r,this._isNull=!1}},a_.prototype.getDistance=function(){return this._distance},a_.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n>this._distance&&this.initialize(e,i,n)}},a_.prototype.interfaces_=function(){return[]},a_.prototype.getClass=function(){return a_};var h_=function(){};h_.prototype.interfaces_=function(){return[]},h_.prototype.getClass=function(){return h_},h_.computeDistance=function(){if(arguments[2]instanceof a_&&arguments[0]instanceof jd&&arguments[1]instanceof Xp)for(var t=arguments[0],e=arguments[1],i=arguments[2],n=t.getCoordinates(),r=new oy,o=0;o<n.length-1;o++){r.setCoordinates(n[o],n[o+1]);var s=r.closestPoint(e);i.setMinimum(s,e)}else if(arguments[2]instanceof a_&&arguments[0]instanceof Vd&&arguments[1]instanceof Xp){var a=arguments[0],h=arguments[1],u=arguments[2];h_.computeDistance(a.getExteriorRing(),h,u);for(var l=0;l<a.getNumInteriorRing();l++)h_.computeDistance(a.getInteriorRingN(l),h,u)}else if(arguments[2]instanceof a_&&arguments[0]instanceof kf&&arguments[1]instanceof Xp){var c=arguments[0],p=arguments[1],f=arguments[2];if(c instanceof jd)h_.computeDistance(c,p,f);else if(c instanceof Vd)h_.computeDistance(c,p,f);else if(c instanceof Ed)for(var d=c,g=0;g<d.getNumGeometries();g++){var y=d.getGeometryN(g);h_.computeDistance(y,p,f)}else f.setMinimum(c.getCoordinate(),p)}else if(arguments[2]instanceof a_&&arguments[0]instanceof oy&&arguments[1]instanceof Xp){var _=arguments[0],m=arguments[1],v=arguments[2],x=_.closestPoint(m);v.setMinimum(x,m)}};var u_=function(t){this._maxPtDist=new a_,this._inputGeom=t||null},l_={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};u_.prototype.computeMaxMidpointDistance=function(t){var e=new p_(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},u_.prototype.computeMaxVertexDistance=function(t){var e=new c_(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},u_.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},u_.prototype.getDistancePoints=function(){return this._maxPtDist},u_.prototype.interfaces_=function(){return[]},u_.prototype.getClass=function(){return u_},l_.MaxPointDistanceFilter.get=function(){return c_},l_.MaxMidpointDistanceFilter.get=function(){return p_},Object.defineProperties(u_,l_);var c_=function(t){this._maxPtDist=new a_,this._minPtDist=new a_,this._geom=t||null};c_.prototype.filter=function(t){this._minPtDist.initialize(),h_.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},c_.prototype.getMaxPointDistance=function(){return this._maxPtDist},c_.prototype.interfaces_=function(){return[Gf]},c_.prototype.getClass=function(){return c_};var p_=function(t){this._maxPtDist=new a_,this._minPtDist=new a_,this._geom=t||null};p_.prototype.filter=function(t,e){if(0===e)return null;var i=t.getCoordinate(e-1),n=t.getCoordinate(e),r=new Xp((i.x+n.x)/2,(i.y+n.y)/2);this._minPtDist.initialize(),h_.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},p_.prototype.isDone=function(){return!1},p_.prototype.isGeometryChanged=function(){return!1},p_.prototype.getMaxPointDistance=function(){return this._maxPtDist},p_.prototype.interfaces_=function(){return[Md]},p_.prototype.getClass=function(){return p_};var f_=function(t){this._comps=t||null};f_.prototype.filter=function(t){t instanceof Vd&&this._comps.add(t)},f_.prototype.interfaces_=function(){return[Cd]},f_.prototype.getClass=function(){return f_},f_.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return f_.getPolygons(t,new Qf)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e instanceof Vd?i.add(e):e instanceof Ed&&e.apply(new f_(i)),i}};var d_=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._lines=e,this._isForcedToLineString=i}};d_.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof qd){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof jd&&this._lines.add(t)},d_.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},d_.prototype.interfaces_=function(){return[Df]},d_.prototype.getClass=function(){return d_},d_.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(d_.getLines(t))}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().buildGeometry(d_.getLines(e,i))}},d_.getLines=function(){if(1===arguments.length){var t=arguments[0];return d_.getLines(t,!1)}if(2===arguments.length){if(ef(arguments[0],Uf)&&ef(arguments[1],Uf)){for(var e=arguments[0],i=arguments[1],n=e.iterator();n.hasNext();){var r=n.next();d_.getLines(r,i)}return i}if(arguments[0]instanceof kf&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new Qf;return o.apply(new d_(a,s)),a}if(arguments[0]instanceof kf&&ef(arguments[1],Uf)){var h=arguments[0],u=arguments[1];return h instanceof jd?u.add(h):h.apply(new d_(u)),u}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&ef(arguments[0],Uf)&&ef(arguments[1],Uf)){for(var l=arguments[0],c=arguments[1],p=arguments[2],f=l.iterator();f.hasNext();){var d=f.next();d_.getLines(d,c,p)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof kf&&ef(arguments[1],Uf)){var g=arguments[0],y=arguments[1],_=arguments[2];return g.apply(new d_(y,_)),y}}};var g_=function(){if(this._boundaryRule=zf.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new Vp("Rule must be non-null");this._boundaryRule=t}};g_.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof Xp&&arguments[1]instanceof Vd){var e=arguments[0],i=arguments[1];if(i.isEmpty())return $p.EXTERIOR;var n=i.getExteriorRing(),r=this.locateInPolygonRing(e,n);if(r===$p.EXTERIOR)return $p.EXTERIOR;if(r===$p.BOUNDARY)return $p.BOUNDARY;for(var o=0;o<i.getNumInteriorRing();o++){var s=i.getInteriorRingN(o),a=t.locateInPolygonRing(e,s);if(a===$p.INTERIOR)return $p.EXTERIOR;if(a===$p.BOUNDARY)return $p.BOUNDARY}return $p.INTERIOR}if(arguments[0]instanceof Xp&&arguments[1]instanceof jd){var h=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(h))return $p.EXTERIOR;var l=u.getCoordinates();return u.isClosed()||!h.equals(l[0])&&!h.equals(l[l.length-1])?Nf.isOnLine(h,l)?$p.INTERIOR:$p.EXTERIOR:$p.BOUNDARY}if(arguments[0]instanceof Xp&&arguments[1]instanceof zd){var c=arguments[0],p=arguments[1],f=p.getCoordinate();return f.equals2D(c)?$p.INTERIOR:$p.EXTERIOR}},g_.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Nf.locatePointInRing(t,e.getCoordinates()):$p.EXTERIOR},g_.prototype.intersects=function(t,e){return this.locate(t,e)!==$p.EXTERIOR},g_.prototype.updateLocationInfo=function(t){t===$p.INTERIOR&&(this._isIn=!0),t===$p.BOUNDARY&&this._numBoundaries++},g_.prototype.computeLocation=function(t,e){var i=this;if(e instanceof zd&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof jd)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Vd)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Sd)for(var n=e,r=0;r<n.getNumGeometries();r++){var o=n.getGeometryN(r);i.updateLocationInfo(i.locateInternal(t,o))}else if(e instanceof Zd)for(var s=e,a=0;a<s.getNumGeometries();a++){var h=s.getGeometryN(a);i.updateLocationInfo(i.locateInternal(t,h))}else if(e instanceof Ed)for(var u=new Oy(e);u.hasNext();){var l=u.next();l!==e&&i.computeLocation(t,l)}},g_.prototype.locate=function(t,e){return e.isEmpty()?$p.EXTERIOR:e instanceof jd||e instanceof Vd?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?$p.BOUNDARY:this._numBoundaries>0||this._isIn?$p.INTERIOR:$p.EXTERIOR)},g_.prototype.interfaces_=function(){return[]},g_.prototype.getClass=function(){return g_};var y_=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var e=arguments[0],i=arguments[1];t.call(this,e,t.INSIDE_AREA,i)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._component=n,this._segIndex=r,this._pt=o}},__={INSIDE_AREA:{configurable:!0}};y_.prototype.isInsideArea=function(){return this._segIndex===y_.INSIDE_AREA},y_.prototype.getCoordinate=function(){return this._pt},y_.prototype.getGeometryComponent=function(){return this._component},y_.prototype.getSegmentIndex=function(){return this._segIndex},y_.prototype.interfaces_=function(){return[]},y_.prototype.getClass=function(){return y_},__.INSIDE_AREA.get=function(){return-1},Object.defineProperties(y_,__);var m_=function(t){this._pts=t||null};m_.prototype.filter=function(t){t instanceof zd&&this._pts.add(t)},m_.prototype.interfaces_=function(){return[Cd]},m_.prototype.getClass=function(){return m_},m_.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof zd?qg.singletonList(t):m_.getPoints(t,new Qf)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e instanceof zd?i.add(e):e instanceof Ed&&e.apply(new m_(i)),i}};var v_=function(){this._locations=null;var t=arguments[0];this._locations=t};v_.prototype.filter=function(t){(t instanceof zd||t instanceof jd||t instanceof Vd)&&this._locations.add(new y_(t,0,t.getCoordinate()))},v_.prototype.interfaces_=function(){return[Cd]},v_.prototype.getClass=function(){return v_},v_.getLocations=function(t){var e=new Qf;return t.apply(new v_(e)),e};var x_=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new g_,this._minDistanceLocation=null,this._minDistance=Hp.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=n,this._terminateDistance=r}};x_.prototype.computeContainmentDistance=function(){var t=this;if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var i=arguments[0],n=arguments[1],r=1-i,o=f_.getPolygons(this._geom[i]);if(o.size()>0){var s=v_.getLocations(this._geom[r]);if(this.computeContainmentDistance(s,o,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=n[0],this._minDistanceLocation[i]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&ef(arguments[0],Xf)&&ef(arguments[1],Xf)){for(var a=arguments[0],h=arguments[1],u=arguments[2],l=0;l<a.size();l++)for(var c=a.get(l),p=0;p<h.size();p++)if(t.computeContainmentDistance(c,h.get(p),u),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof y_&&arguments[1]instanceof Vd){var f=arguments[0],d=arguments[1],g=arguments[2],y=f.getCoordinate();if($p.EXTERIOR!==this._ptLocator.locate(y,d))return this._minDistance=0,g[0]=f,g[1]=new y_(d,y),null}},x_.prototype.computeMinDistanceLinesPoints=function(t,e,i){for(var n=this,r=0;r<t.size();r++)for(var o=t.get(r),s=0;s<e.size();s++){var a=e.get(s);if(n.computeMinDistance(o,a,i),n._minDistance<=n._terminateDistance)return null}},x_.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=d_.getLines(this._geom[0]),i=d_.getLines(this._geom[1]),n=m_.getPoints(this._geom[0]),r=m_.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(i,n,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(n,r,t),void this.updateMinDistance(t,!1))))},x_.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},x_.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},x_.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},x_.prototype.computeMinDistance=function(){var t=this;if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof jd&&arguments[1]instanceof zd){var e=arguments[0],i=arguments[1],n=arguments[2];if(e.getEnvelopeInternal().distance(i.getEnvelopeInternal())>this._minDistance)return null;for(var r=e.getCoordinates(),o=i.getCoordinate(),s=0;s<r.length-1;s++){var a=Nf.distancePointLine(o,r[s],r[s+1]);if(a<t._minDistance){t._minDistance=a;var h=new oy(r[s],r[s+1]),u=h.closestPoint(o);n[0]=new y_(e,s,u),n[1]=new y_(i,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof jd&&arguments[1]instanceof jd){var l=arguments[0],c=arguments[1],p=arguments[2];if(l.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var f=l.getCoordinates(),d=c.getCoordinates(),g=0;g<f.length-1;g++)for(var y=0;y<d.length-1;y++){var _=Nf.distanceLineLine(f[g],f[g+1],d[y],d[y+1]);if(_<t._minDistance){t._minDistance=_;var m=new oy(f[g],f[g+1]),v=new oy(d[y],d[y+1]),x=m.closestPoints(v);p[0]=new y_(l,g,x[0]),p[1]=new y_(c,y,x[1])}if(t._minDistance<=t._terminateDistance)return null}}},x_.prototype.computeMinDistancePoints=function(t,e,i){for(var n=this,r=0;r<t.size();r++)for(var o=t.get(r),s=0;s<e.size();s++){var a=e.get(s),h=o.getCoordinate().distance(a.getCoordinate());if(h<n._minDistance&&(n._minDistance=h,i[0]=new y_(o,0,o.getCoordinate()),i[1]=new y_(a,0,a.getCoordinate())),n._minDistance<=n._terminateDistance)return null}},x_.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new Vp("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},x_.prototype.computeMinDistanceLines=function(t,e,i){for(var n=this,r=0;r<t.size();r++)for(var o=t.get(r),s=0;s<e.size();s++){var a=e.get(s);if(n.computeMinDistance(o,a,i),n._minDistance<=n._terminateDistance)return null}},x_.prototype.interfaces_=function(){return[]},x_.prototype.getClass=function(){return x_},x_.distance=function(t,e){return new x_(t,e).distance()},x_.isWithinDistance=function(t,e,i){return new x_(t,e,i).distance()<=i},x_.nearestPoints=function(t,e){return new x_(t,e).nearestPoints()};var w_=function(){this._pt=[new Xp,new Xp],this._distance=Hp.NaN,this._isNull=!0};w_.prototype.getCoordinates=function(){return this._pt},w_.prototype.getCoordinate=function(t){return this._pt[t]},w_.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n<this._distance&&this.initialize(e,i,n)}},w_.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(n),this._distance=r,this._isNull=!1}},w_.prototype.toString=function(){return Mf.toLineString(this._pt[0],this._pt[1])},w_.prototype.getDistance=function(){return this._distance},w_.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n>this._distance&&this.initialize(e,i,n)}},w_.prototype.interfaces_=function(){return[]},w_.prototype.getClass=function(){return w_};var b_=function(){};b_.prototype.interfaces_=function(){return[]},b_.prototype.getClass=function(){return b_},b_.computeDistance=function(){if(arguments[2]instanceof w_&&arguments[0]instanceof jd&&arguments[1]instanceof Xp)for(var t=arguments[0],e=arguments[1],i=arguments[2],n=new oy,r=t.getCoordinates(),o=0;o<r.length-1;o++){n.setCoordinates(r[o],r[o+1]);var s=n.closestPoint(e);i.setMinimum(s,e)}else if(arguments[2]instanceof w_&&arguments[0]instanceof Vd&&arguments[1]instanceof Xp){var a=arguments[0],h=arguments[1],u=arguments[2];b_.computeDistance(a.getExteriorRing(),h,u);for(var l=0;l<a.getNumInteriorRing();l++)b_.computeDistance(a.getInteriorRingN(l),h,u)}else if(arguments[2]instanceof w_&&arguments[0]instanceof kf&&arguments[1]instanceof Xp){var c=arguments[0],p=arguments[1],f=arguments[2];if(c instanceof jd)b_.computeDistance(c,p,f);else if(c instanceof Vd)b_.computeDistance(c,p,f);else if(c instanceof Ed)for(var d=c,g=0;g<d.getNumGeometries();g++){var y=d.getGeometryN(g);b_.computeDistance(y,p,f)}else f.setMinimum(c.getCoordinate(),p)}else if(arguments[2]instanceof w_&&arguments[0]instanceof oy&&arguments[1]instanceof Xp){var _=arguments[0],m=arguments[1],v=arguments[2],x=_.closestPoint(m);v.setMinimum(x,m)}};var C_=function(){this._g0=null,this._g1=null,this._ptDist=new w_,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},M_={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};C_.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},C_.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new Vp("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},C_.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},C_.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},C_.prototype.computeOrientedDistance=function(t,e,i){var n=new E_(e);if(t.apply(n),i.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var r=new S_(e,this._densifyFrac);t.apply(r),i.setMaximum(r.getMaxPointDistance())}},C_.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},C_.prototype.interfaces_=function(){return[]},C_.prototype.getClass=function(){return C_},C_.distance=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new C_(t,e);return i.distance()}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=new C_(n,r);return s.setDensifyFraction(o),s.distance()}},M_.MaxPointDistanceFilter.get=function(){return E_},M_.MaxDensifiedByFractionDistanceFilter.get=function(){return S_},Object.defineProperties(C_,M_);var E_=function(){this._maxPtDist=new w_,this._minPtDist=new w_,this._euclideanDist=new b_,this._geom=null;var t=arguments[0];this._geom=t};E_.prototype.filter=function(t){this._minPtDist.initialize(),b_.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},E_.prototype.getMaxPointDistance=function(){return this._maxPtDist},E_.prototype.interfaces_=function(){return[Gf]},E_.prototype.getClass=function(){return E_};var S_=function(){this._maxPtDist=new w_,this._minPtDist=new w_,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};S_.prototype.filter=function(t,e){var i=this;if(0===e)return null;for(var n=t.getCoordinate(e-1),r=t.getCoordinate(e),o=(r.x-n.x)/this._numSubSegs,s=(r.y-n.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var h=n.x+a*o,u=n.y+a*s,l=new Xp(h,u);i._minPtDist.initialize(),b_.computeDistance(i._geom,l,i._minPtDist),i._maxPtDist.setMaximum(i._minPtDist)}},S_.prototype.isDone=function(){return!1},S_.prototype.isGeometryChanged=function(){return!1},S_.prototype.getMaxPointDistance=function(){return this._maxPtDist},S_.prototype.interfaces_=function(){return[Md]},S_.prototype.getClass=function(){return S_};var P_=function(t,e,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=i||null},I_={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};P_.prototype.checkMaximumDistance=function(t,e,i){var n=new C_(e,t);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var r=n.getCoordinates();this._errorLocation=r[1],this._errorIndicator=t.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Mf.toLineString(r[0],r[1])+")"}},P_.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=P_.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),P_.VERBOSE&&yf.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},P_.prototype.checkNegativeValid=function(){if(!(this._input instanceof Vd||this._input instanceof Zd||this._input instanceof Ed))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},P_.prototype.getErrorIndicator=function(){return this._errorIndicator},P_.prototype.checkMinimumDistance=function(t,e,i){var n=new x_(t,e,i);if(this._minDistanceFound=n.distance(),this._minDistanceFound<i){this._isValid=!1;var r=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Mf.toLineString(r[0],r[1])+" )"}},P_.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},P_.prototype.getErrorLocation=function(){return this._errorLocation},P_.prototype.getPolygonLines=function(t){for(var e=new Qf,i=new d_(e),n=f_.getPolygons(t).iterator();n.hasNext();){n.next().apply(i)}return t.getFactory().buildGeometry(e)},P_.prototype.getErrorMessage=function(){return this._errMsg},P_.prototype.interfaces_=function(){return[]},P_.prototype.getClass=function(){return P_},I_.VERBOSE.get=function(){return!1},I_.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(P_,I_);var T_=function(t,e,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=i||null},L_={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};T_.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},T_.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*T_.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new mf(this._input.getEnvelopeInternal());e.expandBy(this._distance);var i=new mf(this._result.getEnvelopeInternal());i.expandBy(t),i.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")},T_.prototype.checkDistance=function(){var t=new P_(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},T_.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},T_.prototype.checkPolygonal=function(){this._result instanceof Vd||this._result instanceof Zd||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},T_.prototype.getErrorIndicator=function(){return this._errorIndicator},T_.prototype.getErrorLocation=function(){return this._errorLocation},T_.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},T_.prototype.report=function(t){if(!T_.VERBOSE)return null;yf.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},T_.prototype.getErrorMessage=function(){return this._errorMsg},T_.prototype.interfaces_=function(){return[]},T_.prototype.getClass=function(){return T_},T_.isValidMsg=function(t,e,i){var n=new T_(t,e,i);return n.isValid()?null:n.getErrorMessage()},T_.isValid=function(t,e,i){return!!new T_(t,e,i).isValid()},L_.VERBOSE.get=function(){return!1},L_.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(T_,L_);var O_=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};O_.prototype.getCoordinates=function(){return this._pts},O_.prototype.size=function(){return this._pts.length},O_.prototype.getCoordinate=function(t){return this._pts[t]},O_.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},O_.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:ey.octant(this.getCoordinate(t),this.getCoordinate(t+1))},O_.prototype.setData=function(t){this._data=t},O_.prototype.getData=function(){return this._data},O_.prototype.toString=function(){return Mf.toLineString(new Qd(this._pts))},O_.prototype.interfaces_=function(){return[iy]},O_.prototype.getClass=function(){return O_};var R_=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Qf,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};R_.prototype.getInteriorIntersection=function(){return this._interiorIntersection},R_.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},R_.prototype.getIntersectionSegments=function(){return this._intSegments},R_.prototype.count=function(){return this._intersectionCount},R_.prototype.getIntersections=function(){return this._intersections},R_.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},R_.prototype.setKeepIntersections=function(t){this._keepIntersections=t},R_.prototype.processIntersections=function(t,e,i,n){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===i&&e===n)return null;if(this._isCheckEndSegmentsOnly&&!(this.isEndSegment(t,e)||this.isEndSegment(i,n)))return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=r,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},R_.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},R_.prototype.hasIntersection=function(){return null!==this._interiorIntersection},R_.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},R_.prototype.interfaces_=function(){return[jy]},R_.prototype.getClass=function(){return R_},R_.createAllIntersectionsFinder=function(t){var e=new R_(t);return e.setFindAllIntersections(!0),e},R_.createAnyIntersectionFinder=function(t){return new R_(t)},R_.createIntersectionCounter=function(t){var e=new R_(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var N_=function(){this._li=new Lf,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};N_.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},N_.prototype.getIntersections=function(){return this._segInt.getIntersections()},N_.prototype.isValid=function(){return this.execute(),this._isValid},N_.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},N_.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new R_(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new py;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},N_.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new vg(this.getErrorMessage(),this._segInt.getInteriorIntersection())},N_.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Mf.toLineString(t[0],t[1])+" and "+Mf.toLineString(t[2],t[3])},N_.prototype.interfaces_=function(){return[]},N_.prototype.getClass=function(){return N_},N_.computeIntersections=function(t){var e=new N_(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var A_=function t(){this._nv=null;var e=arguments[0];this._nv=new N_(t.toSegmentStrings(e))};A_.prototype.checkValid=function(){this._nv.checkValid()},A_.prototype.interfaces_=function(){return[]},A_.prototype.getClass=function(){return A_},A_.toSegmentStrings=function(t){for(var e=new Qf,i=t.iterator();i.hasNext();){var n=i.next();e.add(new O_(n.getCoordinates(),n))}return e},A_.checkValid=function(t){new A_(t).checkValid()};var D_=function(t){this._mapOp=t};D_.prototype.map=function(t){for(var e=new Qf,i=0;i<t.getNumGeometries();i++){var n=this._mapOp.map(t.getGeometryN(i));n.isEmpty()||e.add(n)}return t.getFactory().createGeometryCollection(sg.toGeometryArray(e))},D_.prototype.interfaces_=function(){return[]},D_.prototype.getClass=function(){return D_},D_.map=function(t,e){return new D_(e).map(t)};var k_=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Qf,this._resultLineList=new Qf;var t=arguments[0],e=arguments[1],i=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=i};k_.prototype.collectLines=function(t){for(var e=this,i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var n=i.next();e.collectLineEdge(n,t,e._lineEdgesList),e.collectBoundaryTouchEdge(n,t,e._lineEdgesList)}},k_.prototype.labelIsolatedLine=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,i)},k_.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},k_.prototype.collectLineEdge=function(t,e,i){var n=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!ym.isResultOfOp(n,e)||r.isCovered()||(i.add(r),t.setVisitedEdge(!0)))},k_.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();){t.next().getEdges().findCoveredLineEdges()}for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next(),n=i.getEdge();if(i.isLineEdge()&&!n.isCoveredSet()){var r=this._op.isCoveredByA(i.getCoordinate());n.setCovered(r)}}},k_.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),n=i.getLabel();i.isIsolated()&&(n.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},k_.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var i=e.next(),n=this._geometryFactory.createLineString(i.getCoordinates());this._resultLineList.add(n),i.setInResult(!0)}},k_.prototype.collectBoundaryTouchEdge=function(t,e,i){var n=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(Pf.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(ym.isResultOfOp(n,e)&&e===ym.INTERSECTION&&(i.add(t.getEdge()),t.setVisitedEdge(!0))))},k_.prototype.interfaces_=function(){return[]},k_.prototype.getClass=function(){return k_};var F_=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Qf;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};F_.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var i=this._geometryFactory.createPoint(e);this._resultPointList.add(i)}},F_.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var i=e.next();if(!i.isInResult()&&(!i.isIncidentEdgeInResult()&&(0===i.getEdges().getDegree()||t===ym.INTERSECTION))){var n=i.getLabel();ym.isResultOfOp(n,t)&&this.filterCoveredNodeToPoint(i)}}},F_.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},F_.prototype.interfaces_=function(){return[]},F_.prototype.getClass=function(){return F_};var j_=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};j_.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},j_.prototype.transformPolygon=function(t,e){var i=!0,n=this.transformLinearRing(t.getExteriorRing(),t);null!==n&&n instanceof qd&&!n.isEmpty()||(i=!1);for(var r=new Qf,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof qd||(i=!1),r.add(s))}if(i)return this._factory.createPolygon(n,r.toArray([]));var a=new Qf;return null!==n&&a.add(n),a.addAll(r),this._factory.buildGeometry(a)},j_.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},j_.prototype.getInputGeometry=function(){return this._inputGeom},j_.prototype.transformMultiLineString=function(t,e){for(var i=new Qf,n=0;n<t.getNumGeometries();n++){var r=this.transformLineString(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},j_.prototype.transformCoordinates=function(t,e){return this.copy(t)},j_.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},j_.prototype.transformMultiPoint=function(t,e){for(var i=new Qf,n=0;n<t.getNumGeometries();n++){var r=this.transformPoint(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},j_.prototype.transformMultiPolygon=function(t,e){for(var i=new Qf,n=0;n<t.getNumGeometries();n++){var r=this.transformPolygon(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},j_.prototype.copy=function(t){return t.copy()},j_.prototype.transformGeometryCollection=function(t,e){for(var i=new Qf,n=0;n<t.getNumGeometries();n++){var r=this.transform(t.getGeometryN(n));null!==r&&(this._pruneEmptyGeometry&&r.isEmpty()||i.add(r))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(sg.toGeometryArray(i)):this._factory.buildGeometry(i)},j_.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof zd)return this.transformPoint(t,null);if(t instanceof Hd)return this.transformMultiPoint(t,null);if(t instanceof qd)return this.transformLinearRing(t,null);if(t instanceof jd)return this.transformLineString(t,null);if(t instanceof Sd)return this.transformMultiLineString(t,null);if(t instanceof Vd)return this.transformPolygon(t,null);if(t instanceof Zd)return this.transformMultiPolygon(t,null);if(t instanceof Ed)return this.transformGeometryCollection(t,null);throw new Vp("Unknown Geometry subtype: "+t.getClass().getName())},j_.prototype.transformLinearRing=function(t,e){var i=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===i)return this._factory.createLinearRing(null);var n=i.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)},j_.prototype.interfaces_=function(){return[]},j_.prototype.getClass=function(){return j_};var G_=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new oy,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof jd&&"number"==typeof arguments[1]){var e=arguments[0],i=arguments[1];t.call(this,e.getCoordinates(),i)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this._srcPts=n,this._isClosed=t.isClosed(n),this._snapTolerance=r}};G_.prototype.snapVertices=function(t,e){for(var i=this._isClosed?t.size()-1:t.size(),n=0;n<i;n++){var r=t.get(n),o=this.findSnapForVertex(r,e);null!==o&&(t.set(n,new Xp(o)),0===n&&this._isClosed&&t.set(t.size()-1,new Xp(o)))}},G_.prototype.findSnapForVertex=function(t,e){for(var i=0;i<e.length;i++){if(t.equals2D(e[i]))return null;if(t.distance(e[i])<this._snapTolerance)return e[i]}return null},G_.prototype.snapTo=function(t){var e=new $f(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},G_.prototype.snapSegments=function(t,e){if(0===e.length)return null;var i=e.length;e[0].equals2D(e[e.length-1])&&(i=e.length-1);for(var n=0;n<i;n++){var r=e[n],o=this.findSegmentIndexToSnap(r,t);o>=0&&t.add(o+1,new Xp(r),!1)}},G_.prototype.findSegmentIndexToSnap=function(t,e){for(var i=this,n=Hp.MAX_VALUE,r=-1,o=0;o<e.size()-1;o++){if(i._seg.p0=e.get(o),i._seg.p1=e.get(o+1),i._seg.p0.equals2D(t)||i._seg.p1.equals2D(t)){if(i._allowSnappingToSourceVertices)continue;return-1}var s=i._seg.distance(t);s<i._snapTolerance&&s<n&&(n=s,r=o)}return r},G_.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},G_.prototype.interfaces_=function(){return[]},G_.prototype.getClass=function(){return G_},G_.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var z_=function(t){this._srcGeom=t||null},B_={SNAP_PRECISION_FACTOR:{configurable:!0}};z_.prototype.snapTo=function(t,e){var i=this.extractTargetCoordinates(t);return new V_(e,i).transform(this._srcGeom)},z_.prototype.snapToSelf=function(t,e){var i=this.extractTargetCoordinates(this._srcGeom),n=new V_(t,i,!0).transform(this._srcGeom),r=n;return e&&ef(r,Bd)&&(r=n.buffer(0)),r},z_.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},z_.prototype.extractTargetCoordinates=function(t){for(var e=new md,i=t.getCoordinates(),n=0;n<i.length;n++)e.add(i[n]);return e.toArray(new Array(0).fill(null))},z_.prototype.computeMinimumSegmentLength=function(t){for(var e=Hp.MAX_VALUE,i=0;i<t.length-1;i++){var n=t[i].distance(t[i+1]);n<e&&(e=n)}return e},z_.prototype.interfaces_=function(){return[]},z_.prototype.getClass=function(){return z_},z_.snap=function(t,e,i){var n=new Array(2).fill(null),r=new z_(t);n[0]=r.snapTo(e,i);var o=new z_(e);return n[1]=o.snapTo(n[0],i),n},z_.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=z_.computeSizeBasedSnapTolerance(t),i=t.getPrecisionModel();if(i.getType()===ig.FIXED){var n=1/i.getScale()*2/1.415;n>e&&(e=n)}return e}if(2===arguments.length){var r=arguments[0],o=arguments[1];return Math.min(z_.computeOverlaySnapTolerance(r),z_.computeOverlaySnapTolerance(o))}},z_.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*z_.SNAP_PRECISION_FACTOR},z_.snapToSelf=function(t,e,i){return new z_(t).snapToSelf(e,i)},B_.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(z_,B_);var V_=function(t){function e(e,i,n){t.call(this),this._snapTolerance=e||null,this._snapPts=i||null,this._isSelfSnap=void 0!==n&&n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var i=new G_(t,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var i=t.toCoordinateArray(),n=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(j_),H_=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};H_.prototype.getCommon=function(){return Hp.longBitsToDouble(this._commonBits)},H_.prototype.add=function(t){var e=Hp.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=H_.signExpBits(this._commonBits),this._isFirst=!1,null):H_.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=H_.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=H_.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},H_.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=Hp.longBitsToDouble(t),i=Hp.toBinaryString(t),n="0000000000000000000000000000000000000000000000000000000000000000"+i,r=n.substring(n.length-64),o=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+e+" ]";return o}},H_.prototype.interfaces_=function(){return[]},H_.prototype.getClass=function(){return H_},H_.getBit=function(t,e){return 0!=(t&1<<e)?1:0},H_.signExpBits=function(t){return t>>52},H_.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},H_.numCommonMostSigMantissaBits=function(t,e){for(var i=0,n=52;n>=0;n--){if(H_.getBit(t,n)!==H_.getBit(e,n))return i;i++}return 52};var q_=function(){this._commonCoord=null,this._ccFilter=new U_},Z_={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};q_.prototype.addCommonBits=function(t){var e=new W_(this._commonCoord);t.apply(e),t.geometryChanged()},q_.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new Xp(this._commonCoord);e.x=-e.x,e.y=-e.y;var i=new W_(e);return t.apply(i),t.geometryChanged(),t},q_.prototype.getCommonCoordinate=function(){return this._commonCoord},q_.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},q_.prototype.interfaces_=function(){return[]},q_.prototype.getClass=function(){return q_},Z_.CommonCoordinateFilter.get=function(){return U_},Z_.Translater.get=function(){return W_},Object.defineProperties(q_,Z_);var U_=function(){this._commonBitsX=new H_,this._commonBitsY=new H_};U_.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},U_.prototype.getCommonCoordinate=function(){return new Xp(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},U_.prototype.interfaces_=function(){return[Gf]},U_.prototype.getClass=function(){return U_};var W_=function(){this.trans=null;var t=arguments[0];this.trans=t};W_.prototype.filter=function(t,e){var i=t.getOrdinate(e,0)+this.trans.x,n=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,i),t.setOrdinate(e,1,n)},W_.prototype.isDone=function(){return!1},W_.prototype.isGeometryChanged=function(){return!0},W_.prototype.interfaces_=function(){return[Md]},W_.prototype.getClass=function(){return W_};var Y_=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};Y_.prototype.selfSnap=function(t){return new z_(t).snapTo(t,this._snapTolerance)},Y_.prototype.removeCommonBits=function(t){this._cbr=new q_,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},Y_.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},Y_.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),i=ym.overlayOp(e[0],e[1],t);return this.prepareResult(i)},Y_.prototype.checkValid=function(t){t.isValid()||yf.out.println("Snapped geometry is invalid")},Y_.prototype.computeSnapTolerance=function(){this._snapTolerance=z_.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},Y_.prototype.snap=function(t){var e=this.removeCommonBits(t);return z_.snap(e[0],e[1],this._snapTolerance)},Y_.prototype.interfaces_=function(){return[]},Y_.prototype.getClass=function(){return Y_},Y_.overlayOp=function(t,e,i){return new Y_(t,e).getResultGeometry(i)},Y_.union=function(t,e){return Y_.overlayOp(t,e,ym.UNION)},Y_.intersection=function(t,e){return Y_.overlayOp(t,e,ym.INTERSECTION)},Y_.symDifference=function(t,e){return Y_.overlayOp(t,e,ym.SYMDIFFERENCE)},Y_.difference=function(t,e){return Y_.overlayOp(t,e,ym.DIFFERENCE)};var X_=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};X_.prototype.getResultGeometry=function(t){var e=null,i=!1,n=null;try{e=ym.overlayOp(this._geom[0],this._geom[1],t);i=!0}catch(t){if(!(t instanceof Ef))throw t;n=t}if(!i)try{e=Y_.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Ef?n:t}return e},X_.prototype.interfaces_=function(){return[]},X_.prototype.getClass=function(){return X_},X_.overlayOp=function(t,e,i){return new X_(t,e).getResultGeometry(i)},X_.union=function(t,e){return X_.overlayOp(t,e,ym.UNION)},X_.intersection=function(t,e){return X_.overlayOp(t,e,ym.INTERSECTION)},X_.symDifference=function(t,e){return X_.overlayOp(t,e,ym.SYMDIFFERENCE)},X_.difference=function(t,e){return X_.overlayOp(t,e,ym.DIFFERENCE)};var J_=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};J_.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},J_.prototype.interfaces_=function(){return[]},J_.prototype.getClass=function(){return J_};var Q_=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],i=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=i}else if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=n,this._xValue=r,this._obj=o}},K_={INSERT:{configurable:!0},DELETE:{configurable:!0}};Q_.prototype.isDelete=function(){return this._eventType===Q_.DELETE},Q_.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},Q_.prototype.getObject=function(){return this._obj},Q_.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},Q_.prototype.getInsertEvent=function(){return this._insertEvent},Q_.prototype.isInsert=function(){return this._eventType===Q_.INSERT},Q_.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},Q_.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},Q_.prototype.interfaces_=function(){return[Zp]},Q_.prototype.getClass=function(){return Q_},K_.INSERT.get=function(){return 1},K_.DELETE.get=function(){return 2},Object.defineProperties(Q_,K_);var $_=function(){};$_.prototype.interfaces_=function(){return[]},$_.prototype.getClass=function(){return $_};var tm=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],i=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=i};tm.prototype.isTrivialIntersection=function(t,e,i,n){if(t===i&&1===this._li.getIntersectionNum()){if(tm.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&n===r||0===n&&e===r)return!0}}return!1},tm.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},tm.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},tm.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},tm.prototype.isBoundaryPointInternal=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next().getCoordinate();if(t.isIntersection(n))return!0}return!1},tm.prototype.hasProperIntersection=function(){return this._hasProper},tm.prototype.hasIntersection=function(){return this._hasIntersection},tm.prototype.isDone=function(){return this._isDone},tm.prototype.isBoundaryPoint=function(t,e){return null!==e&&(!!this.isBoundaryPointInternal(t,e[0])||!!this.isBoundaryPointInternal(t,e[1]))},tm.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},tm.prototype.addIntersections=function(t,e,i,n){if(t===i&&e===n)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,i,n)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},tm.prototype.interfaces_=function(){return[]},tm.prototype.getClass=function(){return tm},tm.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var em=function(t){function e(){t.call(this),this.events=new Qf,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){qg.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var n=t.events.get(i);if(n.isInsert()&&t.processOverlaps(i,n.getDeleteEventIndex(),n,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof tm&&ef(arguments[0],Xf)&&ef(arguments[1],Xf)){var r=arguments[0],o=arguments[1],s=arguments[2];this.addEdges(r,r),this.addEdges(o,o),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&ef(arguments[0],Xf)&&arguments[1]instanceof tm){var a=arguments[0],h=arguments[1],u=arguments[2];u?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(h)}},e.prototype.addEdge=function(t,e){for(var i=t.getMonotoneChainEdge(),n=i.getStartIndexes(),r=0;r<n.length-1;r++){var o=new J_(i,r),s=new Q_(e,i.getMinX(r),o);this.events.add(s),this.events.add(new Q_(i.getMaxX(r),s))}},e.prototype.processOverlaps=function(t,e,i,n){for(var r=i.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();i.isSameLabel(s)||(r.computeIntersections(a,n),this.nOverlaps++)}}},e.prototype.addEdges=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],i=e.iterator();i.hasNext();){var n=i.next();t.addEdge(n,n)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],s=r.iterator();s.hasNext();){var a=s.next();t.addEdge(a,o)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}($_),im=function(){this._min=Hp.POSITIVE_INFINITY,this._max=Hp.NEGATIVE_INFINITY},nm={NodeComparator:{configurable:!0}};im.prototype.getMin=function(){return this._min},im.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},im.prototype.getMax=function(){return this._max},im.prototype.toString=function(){return Mf.toLineString(new Xp(this._min,0),new Xp(this._max,0))},im.prototype.interfaces_=function(){return[]},im.prototype.getClass=function(){return im},nm.NodeComparator.get=function(){return rm},Object.defineProperties(im,nm);var rm=function(){};rm.prototype.compare=function(t,e){var i=t,n=e,r=(i._min+i._max)/2,o=(n._min+n._max)/2;return r<o?-1:r>o?1:0},rm.prototype.interfaces_=function(){return[Wp]},rm.prototype.getClass=function(){return rm};var om=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],i=arguments[1],n=arguments[2];this._min=e,this._max=i,this._item=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(im),sm=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],i=arguments[1];this._node1=e,this._node2=i,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,i),null!==this._node2&&this._node2.query(t,e,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(im),am=function(){this._leaves=new Qf,this._root=null,this._level=0};am.prototype.buildTree=function(){qg.sort(this._leaves,new im.NodeComparator);for(var t=this._leaves,e=null,i=new Qf;;){if(this.buildLevel(t,i),1===i.size())return i.get(0);e=t,t=i,i=e}},am.prototype.insert=function(t,e,i){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new om(t,e,i))},am.prototype.query=function(t,e,i){this.init(),this._root.query(t,e,i)},am.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},am.prototype.printNode=function(t){yf.out.println(Mf.toLineString(new Xp(t._min,this._level),new Xp(t._max,this._level)))},am.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},am.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var i=0;i<t.size();i+=2){var n=t.get(i);if(null===(i+1<t.size()?t.get(i):null))e.add(n);else{var r=new sm(t.get(i),t.get(i+1));e.add(r)}}},am.prototype.interfaces_=function(){return[]},am.prototype.getClass=function(){return am};var hm=function(){this._items=new Qf};hm.prototype.visitItem=function(t){this._items.add(t)},hm.prototype.getItems=function(){return this._items},hm.prototype.interfaces_=function(){return[zg]},hm.prototype.getClass=function(){return hm};var um=function(){this._index=null;var t=arguments[0];if(!ef(t,Bd))throw new Vp("Argument must be Polygonal");this._index=new pm(t)},lm={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};um.prototype.locate=function(t){var e=new Rf(t),i=new cm(e);return this._index.query(t.y,t.y,i),e.getLocation()},um.prototype.interfaces_=function(){return[Ly]},um.prototype.getClass=function(){return um},lm.SegmentVisitor.get=function(){return cm},lm.IntervalIndexedGeometry.get=function(){return pm},Object.defineProperties(um,lm);var cm=function(){this._counter=null;var t=arguments[0];this._counter=t};cm.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},cm.prototype.interfaces_=function(){return[zg]},cm.prototype.getClass=function(){return cm};var pm=function(){this._index=new am;var t=arguments[0];this.init(t)};pm.prototype.init=function(t){for(var e=d_.getLines(t).iterator();e.hasNext();){var i=e.next().getCoordinates();this.addLine(i)}},pm.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var i=new oy(t[e-1],t[e]),n=Math.min(i.p0.y,i.p1.y),r=Math.max(i.p0.y,i.p1.y);this._index.insert(n,r,i)}},pm.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new hm;return this._index.query(t,e,i),i.getItems()}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._index.query(n,r,o)}},pm.prototype.interfaces_=function(){return[]},pm.prototype.getClass=function(){return pm};var fm=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new eg,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new g_,2===arguments.length){var e=arguments[0],i=arguments[1],n=zf.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=i,this._boundaryNodeRule=n,null!==i&&this.add(i)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=r,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,i){var n=this._nodes.addNode(i).getLabel(),r=1;n.getLocation(t,dg.ON)===$p.BOUNDARY&&r++;var o=e.determineBoundary(this._boundaryNodeRule,r);n.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],o=new tm(i,!0,!1);o.setIsDoneIfProperInt(r);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof qd||this._parentGeom instanceof Vd||this._parentGeom instanceof Zd,h=n||!a;return s.computeIntersections(this._edges,o,h),this.addSelfIntersectionNodes(this._argIndex),o}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();){e.next().eiList.addSplitEdges(t)}},e.prototype.computeEdgeIntersections=function(t,e,i){var n=new tm(e,i,!0);return n.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,n),n},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof zd){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this._argIndex,e,$p.INTERIOR)}else if(arguments[0]instanceof Xp){var i=arguments[0];this.insertPoint(this._argIndex,i,$p.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),$p.EXTERIOR,$p.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var i=t.getInteriorRingN(e);this.addPolygonRing(i,$p.INTERIOR,$p.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],$p.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],$p.BOUNDARY)},e.prototype.addLineString=function(t){var e=td.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var i=new Uy(e,new Cg(this._argIndex,$p.INTERIOR));this._lineEdgeMap.put(t,i),this.insertEdge(i),Pf.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),i=0,n=t.iterator();n.hasNext();){var r=n.next();e[i++]=r.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,i){if(this.isBoundaryNode(t,e))return null;i===$p.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,i)},e.prototype.addPolygonRing=function(t,e,i){if(t.isEmpty())return null;var n=td.removeRepeatedPoints(t.getCoordinates());if(n.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var r=e,o=i;Nf.isCCW(n)&&(r=i,o=e);var s=new Uy(n,new Cg(this._argIndex,$p.BOUNDARY,r,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,n[0],$p.BOUNDARY)},e.prototype.insertPoint=function(t,e,i){var n=this._nodes.addNode(e),r=n.getLabel();null===r?n._label=new Cg(t,i):r.setLocation(t,i)},e.prototype.createEdgeSetIntersector=function(){return new em},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var i=e.next(),n=i.getLabel().getLocation(t),r=i.eiList.iterator();r.hasNext();){var o=r.next();this.addSelfIntersectionNode(t,o.coord,n)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof Zd&&(this._useBoundaryDeterminationRule=!1),e instanceof Vd)this.addPolygon(e);else if(e instanceof jd)this.addLineString(e);else if(e instanceof zd)this.addPoint(e);else if(e instanceof Hd)this.addCollection(e);else if(e instanceof Sd)this.addCollection(e);else if(e instanceof Zd)this.addCollection(e);else{if(!(e instanceof Ed))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},e.prototype.locate=function(t){return ef(this._parentGeom,Bd)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new um(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?$p.BOUNDARY:$p.INTERIOR},e}(Dg),dm=function(){if(this._li=new Lf,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new fm(0,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],n=zf.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new fm(0,e,n),this._arg[1]=new fm(1,i,n)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new fm(0,r,s),this._arg[1]=new fm(1,o,s)}};dm.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},dm.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},dm.prototype.interfaces_=function(){return[]},dm.prototype.getClass=function(){return dm};var gm=function(){};gm.prototype.interfaces_=function(){return[]},gm.prototype.getClass=function(){return gm},gm.map=function(){if(arguments[0]instanceof kf&&ef(arguments[1],gm.MapOp)){for(var t=arguments[0],e=arguments[1],i=new Qf,n=0;n<t.getNumGeometries();n++){var r=e.map(t.getGeometryN(n));null!==r&&i.add(r)}return t.getFactory().buildGeometry(i)}if(ef(arguments[0],Uf)&&ef(arguments[1],gm.MapOp)){for(var o=arguments[0],s=arguments[1],a=new Qf,h=o.iterator();h.hasNext();){var u=h.next(),l=s.map(u);null!==l&&a.add(l)}return a}},gm.MapOp=function(){};var ym=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i),this._ptLocator=new g_,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Fy,this._resultPolyList=new Qf,this._resultLineList=new Qf,this._resultPointList=new Qf,this._graph=new Dg(new Dy),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Cg(t.getLabel())).flip();var r=e.getDepth();r.isNull()&&r.add(i),r.add(n),i.merge(n)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),i=e.getSym();e.isInResult()&&i.isInResult()&&(e.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,i,n,r){var o=new Qf;return o.addAll(t),o.addAll(i),o.addAll(n),o.isEmpty()?e.createEmptyResult(r,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){t.next().getEdges().mergeSymLabels()}},e.prototype.isCovered=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();if(this._ptLocator.locate(t,n)!==$p.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new Qf,e=this._edgeList.iterator();e.hasNext();){var i=e.next();i.isCollapsed()&&(e.remove(),t.add(i.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getEdges().getLabel();e.getLabel().merge(i)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this.insertUniqueEdge(i)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new Qf;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),A_.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var i=new kg(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var n=new k_(this,this._geomFact,this._ptLocator);this._resultLineList=n.build(t);var r=new F_(this,this._geomFact,this._ptLocator);this._resultPointList=r.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,i)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var i=e.next();this._graph.addNode(i.getCoordinate()).setLabel(t,i.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var n=i.next(),r=n.getLabel();r.isArea()&&!n.isInteriorAreaEdge()&&e.isResultOfOp(r.getLocation(0,dg.RIGHT),r.getLocation(1,dg.RIGHT),t)&&n.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),i=e.getLabel(),n=e.getDepth();if(!n.isNull()){n.normalize();for(var r=0;r<2;r++)i.isNull(r)||!i.isArea()||n.isNull(r)||(0===n.getDelta(r)?i.toLine(r):(Pf.isTrue(!n.isNull(r,dg.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(r,dg.LEFT,n.getLocation(r,dg.LEFT)),Pf.isTrue(!n.isNull(r,dg.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(r,dg.RIGHT,n.getLocation(r,dg.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){t.next().getEdges().computeLabelling(this._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getLabel();e.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(i)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(dm);ym.overlayOp=function(t,e,i){return new ym(t,e).getResultGeometry(i)},ym.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return ym.createEmptyResult(ym.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var i=e;return D_.map(t,{interfaces_:function(){return[gm.MapOp]},map:function(t){return t.intersection(i)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),X_.overlayOp(t,e,ym.INTERSECTION)},ym.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return ym.createEmptyResult(ym.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),X_.overlayOp(t,e,ym.SYMDIFFERENCE)},ym.resultDimension=function(t,e,i){var n=e.getDimension(),r=i.getDimension(),o=-1;switch(t){case ym.INTERSECTION:o=Math.min(n,r);break;case ym.UNION:o=Math.max(n,r);break;case ym.DIFFERENCE:o=n;break;case ym.SYMDIFFERENCE:o=Math.max(n,r)}return o},ym.createEmptyResult=function(t,e,i,n){var r=null;switch(ym.resultDimension(t,e,i)){case-1:r=n.createGeometryCollection(new Array(0).fill(null));break;case 0:r=n.createPoint();break;case 1:r=n.createLineString();break;case 2:r=n.createPolygon()}return r},ym.difference=function(t,e){return t.isEmpty()?ym.createEmptyResult(ym.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),X_.overlayOp(t,e,ym.DIFFERENCE))},ym.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=t.getLocation(0),n=t.getLocation(1);return ym.isResultOfOp(i,n,e)}if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];switch(r===$p.BOUNDARY&&(r=$p.INTERIOR),o===$p.BOUNDARY&&(o=$p.INTERIOR),s){case ym.INTERSECTION:return r===$p.INTERIOR&&o===$p.INTERIOR;case ym.UNION:return r===$p.INTERIOR||o===$p.INTERIOR;case ym.DIFFERENCE:return r===$p.INTERIOR&&o!==$p.INTERIOR;case ym.SYMDIFFERENCE:return r===$p.INTERIOR&&o!==$p.INTERIOR||r!==$p.INTERIOR&&o===$p.INTERIOR}return!1}},ym.INTERSECTION=1,ym.UNION=2,ym.DIFFERENCE=3,ym.SYMDIFFERENCE=4;var _m=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new g_,this._seg=new oy;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};_m.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,i=0;i<this._linework.getNumGeometries();i++)for(var n=e._linework.getGeometryN(i).getCoordinateSequence(),r=0;r<n.size()-1;r++){if(n.getCoordinate(r,e._seg.p0),n.getCoordinate(r+1,e._seg.p1),e._seg.distance(t)<=e._boundaryDistanceTolerance)return!0}return!1},_m.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?$p.BOUNDARY:this._ptLocator.locate(t,this._g)},_m.prototype.extractLinework=function(t){var e=new mm;t.apply(e);var i=e.getLinework(),n=sg.toLineStringArray(i);return t.getFactory().createMultiLineString(n)},_m.prototype.interfaces_=function(){return[]},_m.prototype.getClass=function(){return _m};var mm=function(){this._linework=null,this._linework=new Qf};mm.prototype.getLinework=function(){return this._linework},mm.prototype.filter=function(t){if(t instanceof Vd){var e=t;this._linework.add(e.getExteriorRing());for(var i=0;i<e.getNumInteriorRing();i++)this._linework.add(e.getInteriorRingN(i))}},mm.prototype.interfaces_=function(){return[Cd]},mm.prototype.getClass=function(){return mm};var vm=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};vm.prototype.extractPoints=function(t,e,i){for(var n=t.getCoordinates(),r=0;r<n.length-1;r++)this.computeOffsetPoints(n[r],n[r+1],e,i)},vm.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},vm.prototype.getPoints=function(t){for(var e=new Qf,i=d_.getLines(this._g).iterator();i.hasNext();){var n=i.next();this.extractPoints(n,t,e)}return e},vm.prototype.computeOffsetPoints=function(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,s=Math.sqrt(r*r+o*o),a=i*r/s,h=i*o/s,u=(e.x+t.x)/2,l=(e.y+t.y)/2;if(this._doLeft){var c=new Xp(u-h,l+a);n.add(c)}if(this._doRight){var p=new Xp(u+h,l-a);n.add(p)}},vm.prototype.interfaces_=function(){return[]},vm.prototype.getClass=function(){return vm};var xm=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new Qf;var e=arguments[0],i=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,i),this._geom=[e,i,n],this._locFinder=[new _m(this._geom[0],this._boundaryDistanceTolerance),new _m(this._geom[1],this._boundaryDistanceTolerance),new _m(this._geom[2],this._boundaryDistanceTolerance)]},wm={TOLERANCE:{configurable:!0}};xm.prototype.reportResult=function(t,e,i){yf.out.println("Overlay result invalid - A:"+$p.toLocationSymbol(e[0])+" B:"+$p.toLocationSymbol(e[1])+" expected:"+(i?"i":"e")+" actual:"+$p.toLocationSymbol(e[2]))},xm.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e},xm.prototype.checkValid=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],i=0;i<this._testCoords.size();i++){var n=t._testCoords.get(i);if(!t.checkValid(e,n))return t._invalidLocation=n,!1}return!0}if(2===arguments.length){var r=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),!!xm.hasLocation(this._location,$p.BOUNDARY)||this.isValidResult(r,this._location)}},xm.prototype.addTestPts=function(t){var e=new vm(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},xm.prototype.isValidResult=function(t,e){var i=ym.isResultOfOp(e[0],e[1],t),n=!(i^e[2]===$p.INTERIOR);return n||this.reportResult(t,e,i),n},xm.prototype.getInvalidLocation=function(){return this._invalidLocation},xm.prototype.interfaces_=function(){return[]},xm.prototype.getClass=function(){return xm},xm.hasLocation=function(t,e){for(var i=0;i<3;i++)if(t[i]===e)return!0;return!1},xm.computeBoundaryDistanceTolerance=function(t,e){return Math.min(z_.computeSizeBasedSnapTolerance(t),z_.computeSizeBasedSnapTolerance(e))},xm.isValid=function(t,e,i,n){return new xm(t,e,n).isValid(i)},wm.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(xm,wm);var bm=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};bm.prototype.extractElements=function(t,e){if(null===t)return null;for(var i=0;i<t.getNumGeometries();i++){var n=t.getGeometryN(i);this._skipEmpty&&n.isEmpty()||e.add(n)}},bm.prototype.combine=function(){for(var t=new Qf,e=this._inputGeoms.iterator();e.hasNext();){var i=e.next();this.extractElements(i,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},bm.prototype.interfaces_=function(){return[]},bm.prototype.getClass=function(){return bm},bm.combine=function(){if(1===arguments.length){var t=arguments[0],e=new bm(t);return e.combine()}if(2===arguments.length){var i=arguments[0],n=arguments[1],r=new bm(bm.createList(i,n));return r.combine()}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],h=new bm(bm.createList(o,s,a));return h.combine()}},bm.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},bm.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new Qf;return i.add(t),i.add(e),i}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=new Qf;return s.add(n),s.add(r),s.add(o),s}};var Cm=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new Qf)},Mm={STRTREE_NODE_CAPACITY:{configurable:!0}};Cm.prototype.reduceToGeometries=function(t){for(var e=new Qf,i=t.iterator();i.hasNext();){var n=i.next(),r=null;ef(n,Xf)?r=this.unionTree(n):n instanceof kf&&(r=n),e.add(r)}return e},Cm.prototype.extractByEnvelope=function(t,e,i){for(var n=new Qf,r=0;r<e.getNumGeometries();r++){var o=e.getGeometryN(r);o.getEnvelopeInternal().intersects(t)?n.add(o):i.add(o)}return this._geomFactory.buildGeometry(n)},Cm.prototype.unionOptimized=function(t,e){var i=t.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!i.intersects(n))return bm.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=i.intersection(n);return this.unionUsingEnvelopeIntersection(t,e,r)},Cm.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new Jg(Cm.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var i=e.next();t.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var n=t.itemsTree();return this.unionTree(n)},Cm.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];if(n-i<=1){var r=Cm.getGeometry(e,i);return this.unionSafe(r,null)}if(n-i==2)return this.unionSafe(Cm.getGeometry(e,i),Cm.getGeometry(e,i+1));var o=Math.trunc((n+i)/2),s=this.binaryUnion(e,i,o),a=this.binaryUnion(e,o,n);return this.unionSafe(s,a)}},Cm.prototype.repeatedUnion=function(t){for(var e=null,i=t.iterator();i.hasNext();){var n=i.next();e=null===e?n.copy():e.union(n)}return e},Cm.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Cm.prototype.unionActual=function(t,e){return Cm.restrictToPolygons(t.union(e))},Cm.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Cm.prototype.unionUsingEnvelopeIntersection=function(t,e,i){var n=new Qf,r=this.extractByEnvelope(i,t,n),o=this.extractByEnvelope(i,e,n),s=this.unionActual(r,o);return n.add(s),bm.combine(n)},Cm.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0],e=t.get(0).getFactory(),i=e.buildGeometry(t),n=i.buffer(0);return n}if(2===arguments.length){var r=arguments[0],o=arguments[1],s=r.getFactory(),a=s.createGeometryCollection([r,o]),h=a.buffer(0);return h}},Cm.prototype.interfaces_=function(){return[]},Cm.prototype.getClass=function(){return Cm},Cm.restrictToPolygons=function(t){if(ef(t,Bd))return t;var e=f_.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(sg.toPolygonArray(e))},Cm.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Cm.union=function(t){return new Cm(t).union()},Mm.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Cm,Mm);var Em=function(){};function Sm(){return new Pm}function Pm(){this.reset()}Em.prototype.interfaces_=function(){return[]},Em.prototype.getClass=function(){return Em},Em.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return ym.createEmptyResult(ym.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),X_.overlayOp(t,e,ym.UNION)},Pm.prototype={constructor:Pm,reset:function(){this.s=this.t=0},add:function(t){Tm(Im,t,this.t),Tm(this,Im.s,this.s),this.s?this.t+=Im.t:this.s=Im.t},valueOf:function(){return this.s}};var Im=new Pm;function Tm(t,e,i){var n=t.s=e+i,r=n-e,o=n-r;t.t=e-o+(i-r)}var Lm=1e-6,Om=Math.PI,Rm=Om/2,Nm=Om/4,Am=2*Om,Dm=180/Om,km=Om/180,Fm=Math.abs,jm=Math.atan,Gm=Math.atan2,zm=Math.cos,Bm=Math.sin,Vm=Math.sqrt;function Hm(t){return t>1?0:t<-1?Om:Math.acos(t)}function qm(t){return t>1?Rm:t<-1?-Rm:Math.asin(t)}function Zm(){}function Um(t,e){t&&Ym.hasOwnProperty(t.type)&&Ym[t.type](t,e)}var Wm={Feature:function(t,e){Um(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,r=i.length;++n<r;)Um(i[n].geometry,e)}},Ym={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){Xm(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)Xm(i[n],e,0)},Polygon:function(t,e){Jm(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)Jm(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,r=i.length;++n<r;)Um(i[n],e)}};function Xm(t,e,i){var n,r=-1,o=t.length-i;for(e.lineStart();++r<o;)n=t[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function Jm(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)Xm(t[i],e,1);e.polygonEnd()}function Qm(t){return[Gm(t[1],t[0]),qm(t[2])]}function Km(t){var e=t[0],i=t[1],n=zm(i);return[n*zm(e),n*Bm(e),Bm(i)]}function $m(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function tv(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ev(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function iv(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function nv(t){var e=Vm(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function rv(t,e){function i(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(i.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),i}function ov(t,e){return[t>Om?t-Am:t<-Om?t+Am:t,e]}function sv(t){return function(e,i){return[(e+=t)>Om?e-Am:e<-Om?e+Am:e,i]}}function av(t){var e=sv(t);return e.invert=sv(-t),e}function hv(t,e){var i=zm(t),n=Bm(t),r=zm(e),o=Bm(e);function s(t,e){var s=zm(e),a=zm(t)*s,h=Bm(t)*s,u=Bm(e),l=u*i+a*n;return[Gm(h*r-l*o,a*i-u*n),qm(l*r+h*o)]}return s.invert=function(t,e){var s=zm(e),a=zm(t)*s,h=Bm(t)*s,u=Bm(e),l=u*r-h*o;return[Gm(h*r+u*o,a*i+l*n),qm(l*i-a*n)]},s}function uv(t,e){(e=Km(e))[0]-=t,nv(e);var i=Hm(-e[1]);return((-e[2]<0?-i:i)+Am-Lm)%Am}function lv(){var t,e=[];return{point:function(e,i){t.push([e,i])},lineStart:function(){e.push(t=[])},lineEnd:Zm,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var i=e;return e=[],t=null,i}}}function cv(t,e){return Fm(t[0]-e[0])<Lm&&Fm(t[1]-e[1])<Lm}function pv(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function fv(t,e,i,n,r){var o,s,a=[],h=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,i,n=t[0],s=t[e];if(cv(n,s)){for(r.lineStart(),o=0;o<e;++o)r.point((n=t[o])[0],n[1]);r.lineEnd()}else a.push(i=new pv(n,t,null,!0)),h.push(i.o=new pv(n,null,i,!1)),a.push(i=new pv(s,t,null,!1)),h.push(i.o=new pv(s,null,i,!0))}})),a.length){for(h.sort(e),dv(a),dv(h),o=0,s=h.length;o<s;++o)h[o].e=i=!i;for(var u,l,c=a[0];;){for(var p=c,f=!0;p.v;)if((p=p.n)===c)return;u=p.z,r.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(o=0,s=u.length;o<s;++o)r.point((l=u[o])[0],l[1]);else n(p.x,p.n.x,1,r);p=p.n}else{if(f)for(u=p.p.z,o=u.length-1;o>=0;--o)r.point((l=u[o])[0],l[1]);else n(p.x,p.p.x,-1,r);p=p.p}u=(p=p.o).z,f=!f}while(!p.v);r.lineEnd()}}}function dv(t){if(e=t.length){for(var e,i,n=0,r=t[0];++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function gv(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function yv(t){for(var e,i,n,r=t.length,o=-1,s=0;++o<r;)s+=t[o].length;for(i=new Array(s);--r>=0;)for(e=(n=t[r]).length;--e>=0;)i[--s]=n[e];return i}Sm(),Sm(),Sm(),ov.invert=ov,function(t){var e;1===t.length&&(e=t,t=function(t,i){return gv(e(t),i)})}(gv);var _v=1e9,mv=-_v;function vv(t,e,i,n){function r(r,o){return t<=r&&r<=i&&e<=o&&o<=n}function o(r,o,a,u){var l=0,c=0;if(null==r||(l=s(r,a))!==(c=s(o,a))||h(r,o)<0^a>0)do{u.point(0===l||3===l?t:i,l>1?n:e)}while((l=(l+a+4)%4)!==c);else u.point(o[0],o[1])}function s(n,r){return Fm(n[0]-t)<Lm?r>0?0:3:Fm(n[0]-i)<Lm?r>0?2:1:Fm(n[1]-e)<Lm?r>0?1:0:r>0?3:2}function a(t,e){return h(t.x,e.x)}function h(t,e){var i=s(t,1),n=s(e,1);return i!==n?i-n:0===i?e[1]-t[1]:1===i?t[0]-e[0]:2===i?t[1]-e[1]:e[0]-t[0]}return function(s){var h,u,l,c,p,f,d,g,y,_,m,v=s,x=lv(),w={point:b,lineStart:function(){w.point=C,u&&u.push(l=[]);_=!0,y=!1,d=g=NaN},lineEnd:function(){h&&(C(c,p),f&&y&&x.rejoin(),h.push(x.result()));w.point=b,y&&v.lineEnd()},polygonStart:function(){v=x,h=[],u=[],m=!0},polygonEnd:function(){var e=function(){for(var e=0,i=0,r=u.length;i<r;++i)for(var o,s,a=u[i],h=1,l=a.length,c=a[0],p=c[0],f=c[1];h<l;++h)o=p,s=f,p=(c=a[h])[0],f=c[1],s<=n?f>n&&(p-o)*(n-s)>(f-s)*(t-o)&&++e:f<=n&&(p-o)*(n-s)<(f-s)*(t-o)&&--e;return e}(),i=m&&e,r=(h=yv(h)).length;(i||r)&&(s.polygonStart(),i&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),r&&fv(h,a,e,o,s),s.polygonEnd());v=s,h=u=l=null}};function b(t,e){r(t,e)&&v.point(t,e)}function C(o,s){var a=r(o,s);if(u&&l.push([o,s]),_)c=o,p=s,f=a,_=!1,a&&(v.lineStart(),v.point(o,s));else if(a&&y)v.point(o,s);else{var h=[d=Math.max(mv,Math.min(_v,d)),g=Math.max(mv,Math.min(_v,g))],x=[o=Math.max(mv,Math.min(_v,o)),s=Math.max(mv,Math.min(_v,s))];!function(t,e,i,n,r,o){var s,a=t[0],h=t[1],u=0,l=1,c=e[0]-a,p=e[1]-h;if(s=i-a,c||!(s>0)){if(s/=c,c<0){if(s<u)return;s<l&&(l=s)}else if(c>0){if(s>l)return;s>u&&(u=s)}if(s=r-a,c||!(s<0)){if(s/=c,c<0){if(s>l)return;s>u&&(u=s)}else if(c>0){if(s<u)return;s<l&&(l=s)}if(s=n-h,p||!(s>0)){if(s/=p,p<0){if(s<u)return;s<l&&(l=s)}else if(p>0){if(s>l)return;s>u&&(u=s)}if(s=o-h,p||!(s<0)){if(s/=p,p<0){if(s>l)return;s>u&&(u=s)}else if(p>0){if(s<u)return;s<l&&(l=s)}return u>0&&(t[0]=a+u*c,t[1]=h+u*p),l<1&&(e[0]=a+l*c,e[1]=h+l*p),!0}}}}}(h,x,t,e,i,n)?a&&(v.lineStart(),v.point(o,s),m=!1):(y||(v.lineStart(),v.point(h[0],h[1])),v.point(x[0],x[1]),a||v.lineEnd(),m=!1)}d=o,g=s,y=a}return w}}var xv=Sm();function wv(t){return t}Sm(),Sm(),Sm();var bv=1/0,Cv=bv,Mv=-bv,Ev=Mv,Sv={point:function(t,e){t<bv&&(bv=t);t>Mv&&(Mv=t);e<Cv&&(Cv=e);e>Ev&&(Ev=e)},lineStart:Zm,lineEnd:Zm,polygonStart:Zm,polygonEnd:Zm,result:function(){var t=[[bv,Cv],[Mv,Ev]];return Mv=Ev=-(Cv=bv=1/0),t}};function Pv(t,e,i,n){return function(r,o){var s,a,h,u=e(o),l=r.invert(n[0],n[1]),c=lv(),p=e(c),f=!1,d={point:g,lineStart:_,lineEnd:m,polygonStart:function(){d.point=v,d.lineStart=x,d.lineEnd=w,a=[],s=[]},polygonEnd:function(){d.point=g,d.lineStart=_,d.lineEnd=m,a=yv(a);var t=function(t,e){var i=e[0],n=e[1],r=[Bm(i),-zm(i),0],o=0,s=0;xv.reset();for(var a=0,h=t.length;a<h;++a)if(l=(u=t[a]).length)for(var u,l,c=u[l-1],p=c[0],f=c[1]/2+Nm,d=Bm(f),g=zm(f),y=0;y<l;++y,p=m,d=x,g=w,c=_){var _=u[y],m=_[0],v=_[1]/2+Nm,x=Bm(v),w=zm(v),b=m-p,C=b>=0?1:-1,M=C*b,E=M>Om,S=d*x;if(xv.add(Gm(S*C*Bm(M),g*w+S*zm(M))),o+=E?b+C*Am:b,E^p>=i^m>=i){var P=tv(Km(c),Km(_));nv(P);var I=tv(r,P);nv(I);var T=(E^b>=0?-1:1)*qm(I[2]);(n>T||n===T&&(P[0]||P[1]))&&(s+=E^b>=0?1:-1)}}return(o<-Lm||o<Lm&&xv<-Lm)^1&s}(s,l);a.length?(f||(o.polygonStart(),f=!0),fv(a,Tv,t,i,o)):t&&(f||(o.polygonStart(),f=!0),o.lineStart(),i(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),i(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function g(e,i){var n=r(e,i);t(e=n[0],i=n[1])&&o.point(e,i)}function y(t,e){var i=r(t,e);u.point(i[0],i[1])}function _(){d.point=y,u.lineStart()}function m(){d.point=g,u.lineEnd()}function v(t,e){h.push([t,e]);var i=r(t,e);p.point(i[0],i[1])}function x(){p.lineStart(),h=[]}function w(){v(h[0][0],h[0][1]),p.lineEnd();var t,e,i,n,r=p.clean(),u=c.result(),l=u.length;if(h.pop(),s.push(h),h=null,l)if(1&r){if((e=(i=u[0]).length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),t=0;t<e;++t)o.point((n=i[t])[0],n[1]);o.lineEnd()}}else l>1&&2&r&&u.push(u.pop().concat(u.shift())),a.push(u.filter(Iv))}return d}}function Iv(t){return t.length>1}function Tv(t,e){return((t=t.x)[0]<0?t[1]-Rm-Lm:Rm-t[1])-((e=e.x)[0]<0?e[1]-Rm-Lm:Rm-e[1])}Sm();var Lv=Pv((function(){return!0}),(function(t){var e,i=NaN,n=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?Om:-Om,h=Fm(o-i);Fm(h-Om)<Lm?(t.point(i,n=(n+s)/2>0?Rm:-Rm),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(o,n),e=0):r!==a&&h>=Om&&(Fm(i-r)<Lm&&(i-=r*Lm),Fm(o-a)<Lm&&(o-=a*Lm),n=function(t,e,i,n){var r,o,s=Bm(t-i);return Fm(s)>Lm?jm((Bm(e)*(o=zm(n))*Bm(i)-Bm(n)*(r=zm(e))*Bm(t))/(r*o*s)):(e+n)/2}(i,n,o,s),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),e=0),t.point(i=o,n=s),r=a},lineEnd:function(){t.lineEnd(),i=n=NaN},clean:function(){return 2-e}}}),(function(t,e,i,n){var r;if(null==t)r=i*Rm,n.point(-Om,r),n.point(0,r),n.point(Om,r),n.point(Om,0),n.point(Om,-r),n.point(0,-r),n.point(-Om,-r),n.point(-Om,0),n.point(-Om,r);else if(Fm(t[0]-e[0])>Lm){var o=t[0]<e[0]?Om:-Om;r=i*o/2,n.point(-o,r),n.point(0,r),n.point(o,r)}else n.point(e[0],e[1])}),[-Om,-Rm]);function Ov(t,e){var i=zm(t),n=i>0,r=Fm(i)>Lm;function o(t,e){return zm(t)*zm(e)>i}function s(t,e,n){var r=[1,0,0],o=tv(Km(t),Km(e)),s=$m(o,o),a=o[0],h=s-a*a;if(!h)return!n&&t;var u=i*s/h,l=-i*a/h,c=tv(r,o),p=iv(r,u);ev(p,iv(o,l));var f=c,d=$m(p,f),g=$m(f,f),y=d*d-g*($m(p,p)-1);if(!(y<0)){var _=Vm(y),m=iv(f,(-d-_)/g);if(ev(m,p),m=Qm(m),!n)return m;var v,x=t[0],w=e[0],b=t[1],C=e[1];w<x&&(v=x,x=w,w=v);var M=w-x,E=Fm(M-Om)<Lm;if(!E&&C<b&&(v=b,b=C,C=v),E||M<Lm?E?b+C>0^m[1]<(Fm(m[0]-x)<Lm?b:C):b<=m[1]&&m[1]<=C:M>Om^(x<=m[0]&&m[0]<=w)){var S=iv(f,(-d+_)/g);return ev(S,p),[m,Qm(S)]}}}function a(e,i){var r=n?t:Om-t,o=0;return e<-r?o|=1:e>r&&(o|=2),i<-r?o|=4:i>r&&(o|=8),o}return Pv(o,(function(t){var e,i,h,u,l;return{lineStart:function(){u=h=!1,l=1},point:function(c,p){var f,d=[c,p],g=o(c,p),y=n?g?0:a(c,p):g?a(c+(c<0?Om:-Om),p):0;if(!e&&(u=h=g)&&t.lineStart(),g!==h&&(!(f=s(e,d))||cv(e,f)||cv(d,f))&&(d[0]+=Lm,d[1]+=Lm,g=o(d[0],d[1])),g!==h)l=0,g?(t.lineStart(),f=s(d,e),t.point(f[0],f[1])):(f=s(e,d),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(r&&e&&n^g){var _;y&i||!(_=s(d,e,!0))||(l=0,n?(t.lineStart(),t.point(_[0][0],_[0][1]),t.point(_[1][0],_[1][1]),t.lineEnd()):(t.point(_[1][0],_[1][1]),t.lineEnd(),t.lineStart(),t.point(_[0][0],_[0][1])))}!g||e&&cv(e,d)||t.point(d[0],d[1]),e=d,h=g,i=y},lineEnd:function(){h&&t.lineEnd(),e=null},clean:function(){return l|(u&&h)<<1}}}),(function(i,n,r,o){!function(t,e,i,n,r,o){if(i){var s=zm(e),a=Bm(e),h=n*i;null==r?(r=e+n*Am,o=e-h/2):(r=uv(s,r),o=uv(s,o),(n>0?r<o:r>o)&&(r+=n*Am));for(var u,l=r;n>0?l>o:l<o;l-=h)u=Qm([s,-a*zm(l),-a*Bm(l)]),t.point(u[0],u[1])}}(o,t,e,r,i,n)}),n?[0,-t]:[-Om,t-Om])}function Rv(t){return function(e){var i=new Nv;for(var n in t)i[n]=t[n];return i.stream=e,i}}function Nv(){}function Av(t,e,i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),function(t,e){t&&Wm.hasOwnProperty(t.type)?Wm[t.type](t,e):Um(t,e)}(i,t.stream(Sv));var s=Sv.result(),a=Math.min(n/(s[1][0]-s[0][0]),r/(s[1][1]-s[0][1])),h=+e[0][0]+(n-a*(s[1][0]+s[0][0]))/2,u=+e[0][1]+(r-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([h,u])}Nv.prototype={constructor:Nv,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Dv=zm(30*km);function kv(t,e){return+e?function(t,e){function i(n,r,o,s,a,h,u,l,c,p,f,d,g,y){var _=u-n,m=l-r,v=_*_+m*m;if(v>4*e&&g--){var x=s+p,w=a+f,b=h+d,C=Vm(x*x+w*w+b*b),M=qm(b/=C),E=Fm(Fm(b)-1)<Lm||Fm(o-c)<Lm?(o+c)/2:Gm(w,x),S=t(E,M),P=S[0],I=S[1],T=P-n,L=I-r,O=m*T-_*L;(O*O/v>e||Fm((_*T+m*L)/v-.5)>.3||s*p+a*f+h*d<Dv)&&(i(n,r,o,s,a,h,P,I,E,x/=C,w/=C,b,g,y),y.point(P,I),i(P,I,E,x,w,b,u,l,c,p,f,d,g,y))}}return function(e){var n,r,o,s,a,h,u,l,c,p,f,d,g={point:y,lineStart:_,lineEnd:v,polygonStart:function(){e.polygonStart(),g.lineStart=x},polygonEnd:function(){e.polygonEnd(),g.lineStart=_}};function y(i,n){i=t(i,n),e.point(i[0],i[1])}function _(){l=NaN,g.point=m,e.lineStart()}function m(n,r){var o=Km([n,r]),s=t(n,r);i(l,c,u,p,f,d,l=s[0],c=s[1],u=n,p=o[0],f=o[1],d=o[2],16,e),e.point(l,c)}function v(){g.point=y,e.lineEnd()}function x(){_(),g.point=w,g.lineEnd=b}function w(t,e){m(n=t,e),r=l,o=c,s=p,a=f,h=d,g.point=m}function b(){i(l,c,u,p,f,d,r,o,n,s,a,h,16,e),g.lineEnd=v,v()}return g}}(t,e):function(t){return Rv({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}(t)}var Fv=Rv({point:function(t,e){this.stream.point(t*km,e*km)}});function jv(t){return function(t){var e,i,n,r,o,s,a,h,u,l,c=150,p=480,f=250,d=0,g=0,y=0,_=0,m=0,v=null,x=Lv,w=null,b=wv,C=.5,M=kv(P,C);function E(t){return[(t=o(t[0]*km,t[1]*km))[0]*c+i,n-t[1]*c]}function S(t){return(t=o.invert((t[0]-i)/c,(n-t[1])/c))&&[t[0]*Dm,t[1]*Dm]}function P(t,r){return[(t=e(t,r))[0]*c+i,n-t[1]*c]}function I(){o=rv(r=function(t,e,i){return(t%=Am)?e||i?rv(av(t),hv(e,i)):av(t):e||i?hv(e,i):ov}(y,_,m),e);var t=e(d,g);return i=p-t[0]*c,n=f+t[1]*c,T()}function T(){return u=l=null,E}return E.stream=function(t){return u&&l===t?u:u=Fv(x(r,M(b(l=t))))},E.clipAngle=function(t){return arguments.length?(x=+t?Ov(v=t*km,6*km):(v=null,Lv),T()):v*Dm},E.clipExtent=function(t){return arguments.length?(b=null==t?(w=s=a=h=null,wv):vv(w=+t[0][0],s=+t[0][1],a=+t[1][0],h=+t[1][1]),T()):null==w?null:[[w,s],[a,h]]},E.scale=function(t){return arguments.length?(c=+t,I()):c},E.translate=function(t){return arguments.length?(p=+t[0],f=+t[1],I()):[p,f]},E.center=function(t){return arguments.length?(d=t[0]%360*km,g=t[1]%360*km,I()):[d*Dm,g*Dm]},E.rotate=function(t){return arguments.length?(y=t[0]%360*km,_=t[1]%360*km,m=t.length>2?t[2]%360*km:0,I()):[y*Dm,_*Dm,m*Dm]},E.precision=function(t){return arguments.length?(M=kv(P,C=t*t),T()):Vm(C)},E.fitExtent=function(t,e){return Av(E,t,e)},E.fitSize=function(t,e){return function(t,e,i){return Av(t,[[0,0],e],i)}(E,t,e)},function(){return e=t.apply(this,arguments),E.invert=e.invert&&S,I()}}((function(){return t}))()}function Gv(t){return function(e,i){var n=zm(e),r=zm(i),o=t(n*r);return[o*r*Bm(e),o*Bm(i)]}}function zv(t){return function(e,i){var n=Vm(e*e+i*i),r=t(n),o=Bm(r),s=zm(r);return[Gm(e*o,n*s),qm(n&&i*o/n)]}}Gv((function(t){return Vm(2/(1+t))})).invert=zv((function(t){return 2*qm(t/2)}));var Bv=Gv((function(t){return(t=Hm(t))&&t/Bm(t)}));function Vv(){return jv(Bv).scale(79.4188).clipAngle(179.999)}function Hv(t,e){return[t,e]}function qv(t,e,i){var n=(i=i||{}).units||"kilometers",r=i.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof i)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return Ch(t,(function(t){var i=Zv(t,e,n,r);i&&o.push(i)})),dh(o);case"FeatureCollection":return bh(t,(function(t){var i=Zv(t,e,n,r);i&&bh(i,(function(t){t&&o.push(t)}))})),dh(o)}return Zv(t,e,n,r)}function Zv(t,e,i,n){var r=t.properties||{},o="Feature"===t.type?t.geometry:t;if("GeometryCollection"===o.type){var s=[];return Ch(t,(function(t){var r=Zv(t,e,i,n);r&&s.push(r)})),dh(s)}var a=function(t){var e=function(t,e){void 0===e&&(e={});var i=zp(t);return ch([(i[0]+i[2])/2,(i[1]+i[3])/2],e.properties,e)}(t).geometry.coordinates,i=[-e[0],-e[1]];return Vv().rotate(i).scale(hh)}(o),h={type:o.type,coordinates:Wv(o.coordinates,a)},u=(new pg).read(h),l=yh(_h(e,i),"meters"),c=o_.bufferOp(u,l,n);if(!Uv((c=(new fg).write(c)).coordinates))return lh({type:c.type,coordinates:Yv(c.coordinates,a)},r)}function Uv(t){return Array.isArray(t[0])?Uv(t[0]):isNaN(t[0])}function Wv(t,e){return"object"!=typeof t[0]?e(t):t.map((function(t){return Wv(t,e)}))}function Yv(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return Yv(t,e)}))}function Xv(t,e){void 0===e&&(e={});var i=0,n=0,r=0;return wh(t,(function(t){i+=t[0],n+=t[1],r++}),!0),ch([i/r,n/r],e.properties)}function Jv(t,e){switch(void 0===e&&(e={}),Ih(t)){case"Point":return ch(Mh(t),e.properties);case"Polygon":var i=[];wh(t,(function(t){i.push(t)}));var n,r,o,s,a,h,u,l,c=Xv(t,{properties:e.properties}),p=c.geometry.coordinates,f=0,d=0,g=0,y=i.map((function(t){return[t[0]-p[0],t[1]-p[1]]}));for(n=0;n<i.length-1;n++)s=(r=y[n])[0],h=r[1],a=(o=y[n+1])[0],g+=l=s*(u=o[1])-a*h,f+=(s+a)*l,d+=(h+u)*l;if(0===g)return c;var _=1/(6*(.5*g));return ch([p[0]+_*f,p[1]+_*d],e.properties);default:var m=Gp(t);return m?Jv(m,{properties:e.properties}):Xv(t,{properties:e.properties})}}Bv.invert=zv((function(t){return t})),Hv.invert=Hv;var Qv=6378137;function Kv(t){return function(t,e,i){var n=i;return Ch(t,(function(t,r,o,s,a){n=0===r&&void 0===i?t:e(n,t,r,o,s,a)})),n}(t,(function(t,e){return t+function(t){var e,i=0;switch(t.type){case"Polygon":return $v(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)i+=$v(t.coordinates[e]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}function $v(t){var e=0;if(t&&t.length>0){e+=Math.abs(tx(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(tx(t[i]))}return e}function tx(t){var e,i,n,r,o,s,a=0,h=t.length;if(h>2){for(s=0;s<h;s++)s===h-2?(n=h-2,r=h-1,o=0):s===h-1?(n=h-1,r=0,o=1):(n=s,r=s+1,o=s+2),e=t[n],i=t[r],a+=(ex(t[o][0])-ex(e[0]))*Math.sin(ex(i[1]));a=a*Qv*Qv/2}return a}function ex(t){return t*Math.PI/180}function ix(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=Mh(t),r=Ph(e),o=r.type,s=e.bbox,a=r.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,s))return!1;"Polygon"===o&&(a=[a]);for(var h=!1,u=0;u<a.length&&!h;u++)if(nx(n,a[u][0],i.ignoreBoundary)){for(var l=!1,c=1;c<a[u].length&&!l;)nx(n,a[u][c],!i.ignoreBoundary)&&(l=!0),c++;l||(h=!0)}return h}function nx(t,e,i){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var r=0,o=e.length-1;r<e.length;o=r++){var s=e[r][0],a=e[r][1],h=e[o][0],u=e[o][1];if(t[1]*(s-h)+a*(h-t[0])+u*(t[0]-s)==0&&(s-t[0])*(h-t[0])<=0&&(a-t[1])*(u-t[1])<=0)return!i;a>t[1]!=u>t[1]&&t[0]<(h-s)*(t[1]-a)/(u-a)+s&&(n=!n)}return n}var rx=Object.getOwnPropertySymbols,ox=Object.prototype.hasOwnProperty,sx=Object.prototype.propertyIsEnumerable;function ax(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var hx=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,n,r=ax(t),o=1;o<arguments.length;o++){for(var s in i=Object(arguments[o]))ox.call(i,s)&&(r[s]=i[s]);if(rx){n=rx(i);for(var a=0;a<n.length;a++)sx.call(i,n[a])&&(r[n[a]]=i[n[a]])}}return r};function ux(t,e){if(!xh(e=e||{}))throw new Error("options is invalid");var i=e.zProperty||"elevation",n=e.flip,r=e.flags;Sh(t,"Point","input must contain Points");for(var o=function(t,e){var i={};bh(t,(function(t){var e=Eh(t)[1];i[e]||(i[e]=[]),i[e].push(t)}));var n=Object.keys(i).map((function(t){var e=i[t].sort((function(t,e){return Eh(t)[0]-Eh(e)[0]}));return e})),r=n.sort((function(t,i){return e?Eh(t[0])[1]-Eh(i[0])[1]:Eh(i[0])[1]-Eh(t[0])[1]}));return r}(t,n),s=[],a=0;a<o.length;a++){for(var h=o[a],u=[],l=0;l<h.length;l++){var c=h[l];c.properties[i]?u.push(c.properties[i]):u.push(0),!0===r&&(c.properties.matrixPosition=[a,l])}s.push(u)}return s}var lx={successCallback:null,verbose:!1,polygons:!1},cx={};function px(t,e,i,n){n=n||{};for(var r=Object.keys(lx),o=0;o<r.length;o++){var s=r[o],a=n[s];a=null!=a?a:lx[s],cx[s]=a}cx.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+e+":"+(e+i)+"]");var h,u=function(t,e,i){for(var n=t.length-1,r=t[0].length-1,o={rows:n,cols:r,cells:[]},s=e+Math.abs(i),a=0;a<n;++a){o.cells[a]=[];for(var h=0;h<r;++h){var u=0,l=t[a+1][h],c=t[a+1][h+1],p=t[a][h+1],f=t[a][h];if(!(isNaN(l)||isNaN(c)||isNaN(p)||isNaN(f))){u|=l<e?0:l>s?128:64,u|=c<e?0:c>s?32:16,u|=p<e?0:p>s?8:4;var d=+(u|=f<e?0:f>s?2:1),g=0;if(17===u||18===u||33===u||34===u||38===u||68===u||72===u||98===u||102===u||132===u||136===u||137===u||152===u||153===u){var y=(l+c+p+f)/4;g=y>s?2:y<e?0:1,34===u?1===g?u=35:0===g&&(u=136):136===u?1===g?(u=35,g=4):0===g&&(u=34):17===u?1===g?(u=155,g=4):0===g&&(u=153):68===u?1===g?(u=103,g=4):0===g&&(u=102):153===u?1===g&&(u=155):102===u?1===g&&(u=103):152===u?g<2&&(u=156,g=1):137===u?g<2&&(u=139,g=1):98===u?g<2&&(u=99,g=1):38===u?g<2&&(u=39,g=1):18===u?g>0?(u=156,g=4):u=152:33===u?g>0?(u=139,g=4):u=137:72===u?g>0?(u=99,g=4):u=98:132===u&&(g>0?(u=39,g=4):u=38)}if(0!=u&&170!=u){var _,m,v,x,w,b,C,M;_=m=v=x=w=b=C=M=.5;var E=[];1===u?(v=1-iw(e,p,f),M=1-iw(e,l,f),E.push(Jx[u])):169===u?(v=iw(s,f,p),M=iw(s,f,l),E.push(Jx[u])):4===u?(b=1-iw(e,c,p),x=iw(e,f,p),E.push(Yx[u])):166===u?(b=iw(s,p,c),x=1-iw(s,p,f),E.push(Yx[u])):16===u?(w=iw(e,p,c),m=iw(e,l,c),E.push(Wx[u])):154===u?(w=1-iw(s,c,p),m=1-iw(s,c,l),E.push(Wx[u])):64===u?(C=iw(e,f,l),_=1-iw(e,c,l),E.push(Kx[u])):106===u?(C=1-iw(s,l,f),_=iw(s,l,c),E.push(Kx[u])):168===u?(x=iw(s,f,p),v=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),E.push(Xx[u]),E.push(Jx[u])):2===u?(x=1-iw(e,p,f),v=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),E.push(Xx[u]),E.push(Jx[u])):162===u?(w=iw(s,p,c),b=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),E.push(Xx[u]),E.push(Jx[u])):8===u?(w=1-iw(e,c,p),b=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),E.push(Wx[u]),E.push(Yx[u])):138===u?(w=1-iw(e,c,p),b=1-iw(s,c,p),_=1-iw(s,c,l),m=1-iw(e,c,l),E.push(Wx[u]),E.push(Yx[u])):32===u?(w=iw(s,p,c),b=iw(e,p,c),_=iw(e,l,c),m=iw(s,l,c),E.push(Wx[u]),E.push(Yx[u])):42===u?(M=1-iw(s,l,f),C=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c),E.push(Qx[u]),E.push(Kx[u])):128===u&&(M=iw(e,f,l),C=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l),E.push(Qx[u]),E.push(Kx[u])),5===u?(b=1-iw(e,c,p),M=1-iw(e,l,f),E.push(Yx[u])):165===u?(b=iw(s,p,c),M=iw(s,f,l),E.push(Yx[u])):20===u?(x=iw(e,f,p),m=iw(e,l,c),E.push(Xx[u])):150===u?(x=1-iw(s,p,f),m=1-iw(s,c,l),E.push(Xx[u])):80===u?(w=iw(e,p,c),C=iw(e,f,l),E.push(Wx[u])):90===u?(w=1-iw(s,c,p),C=1-iw(s,l,f),E.push(Wx[u])):65===u?(v=1-iw(e,p,f),_=1-iw(e,c,l),E.push(Jx[u])):105===u?(v=iw(s,f,p),_=iw(s,l,c),E.push(Jx[u])):160===u?(w=iw(s,p,c),b=iw(e,p,c),M=iw(e,f,l),C=iw(s,f,l),E.push(Wx[u]),E.push(Yx[u])):10===u?(w=1-iw(e,c,p),b=1-iw(s,c,p),M=1-iw(s,l,f),C=1-iw(e,l,f),E.push(Wx[u]),E.push(Yx[u])):130===u?(x=1-iw(e,p,f),v=1-iw(s,p,f),_=1-iw(s,c,l),m=1-iw(e,c,l),E.push(Xx[u]),E.push(Jx[u])):40===u?(x=iw(s,f,p),v=iw(e,f,p),_=iw(e,l,c),m=iw(s,l,c),E.push(Xx[u]),E.push(Jx[u])):101===u?(b=iw(s,p,c),_=iw(s,l,c),E.push(Yx[u])):69===u?(b=1-iw(e,c,p),_=1-iw(e,c,l),E.push(Yx[u])):149===u?(M=iw(s,f,l),m=1-iw(s,c,l),E.push(Qx[u])):21===u?(M=1-iw(e,l,f),m=iw(e,l,c),E.push(Qx[u])):86===u?(x=1-iw(s,p,f),C=1-iw(s,l,f),E.push(Xx[u])):84===u?(x=iw(e,f,p),C=iw(e,f,l),E.push(Xx[u])):89===u?(w=1-iw(s,c,p),v=iw(s,f,p),E.push(Jx[u])):81===u?(w=iw(e,p,c),v=1-iw(e,p,f),E.push(Jx[u])):96===u?(w=iw(s,p,c),b=iw(e,p,c),C=iw(e,f,l),_=iw(s,l,c),E.push(Wx[u]),E.push(Yx[u])):74===u?(w=1-iw(e,c,p),b=1-iw(s,c,p),C=1-iw(s,l,f),_=1-iw(e,c,l),E.push(Wx[u]),E.push(Yx[u])):24===u?(w=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),m=iw(e,l,c),E.push(Wx[u]),E.push(Jx[u])):146===u?(w=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),m=1-iw(s,c,l),E.push(Wx[u]),E.push(Jx[u])):6===u?(b=1-iw(e,c,p),x=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),E.push(Yx[u]),E.push(Xx[u])):164===u?(b=iw(s,p,c),x=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),E.push(Yx[u]),E.push(Xx[u])):129===u?(v=1-iw(e,p,f),M=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l),E.push(Jx[u]),E.push(Qx[u])):41===u?(v=iw(s,f,p),M=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c),E.push(Jx[u]),E.push(Qx[u])):66===u?(x=1-iw(e,p,f),v=1-iw(s,p,f),C=1-iw(s,l,f),_=1-iw(e,c,l),E.push(Xx[u]),E.push(Jx[u])):104===u?(x=iw(s,f,p),v=iw(e,f,p),C=iw(e,f,l),_=iw(s,l,c),E.push(Jx[u]),E.push($x[u])):144===u?(w=iw(e,p,c),M=iw(e,f,l),C=iw(s,f,l),m=1-iw(s,c,l),E.push(Wx[u]),E.push(Kx[u])):26===u?(w=1-iw(s,c,p),M=1-iw(s,l,f),C=1-iw(e,l,f),m=iw(e,l,c),E.push(Wx[u]),E.push(Kx[u])):36===u?(b=iw(s,p,c),x=iw(e,f,p),_=iw(e,l,c),m=iw(s,l,c),E.push(Yx[u]),E.push(Xx[u])):134===u?(b=1-iw(e,c,p),x=1-iw(s,p,f),_=1-iw(s,c,l),m=1-iw(e,c,l),E.push(Yx[u]),E.push(Xx[u])):9===u?(w=1-iw(e,c,p),b=1-iw(s,c,p),v=iw(s,f,p),M=1-iw(e,l,f),E.push(Wx[u]),E.push(Yx[u])):161===u?(w=iw(s,p,c),b=iw(e,p,c),v=1-iw(e,p,f),M=iw(s,f,l),E.push(Wx[u]),E.push(Yx[u])):37===u?(b=iw(s,p,c),M=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c),E.push(Yx[u]),E.push(Qx[u])):133===u?(b=1-iw(e,c,p),M=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l),E.push(Yx[u]),E.push(Qx[u])):148===u?(x=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),m=1-iw(s,c,l),E.push(Xx[u]),E.push(Kx[u])):22===u?(x=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),m=iw(e,l,c),E.push(Xx[u]),E.push(Kx[u])):82===u?(w=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),C=1-iw(s,l,f),E.push(Wx[u]),E.push(Jx[u])):88===u?(w=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),C=iw(e,f,l),E.push(Wx[u]),E.push(Jx[u])):73===u?(w=1-iw(e,c,p),b=1-iw(s,c,p),v=iw(s,f,p),_=1-iw(e,c,l),E.push(Wx[u]),E.push(Yx[u])):97===u?(w=iw(s,p,c),b=iw(e,p,c),v=1-iw(e,p,f),_=iw(s,l,c),E.push(Wx[u]),E.push(Yx[u])):145===u?(w=iw(e,p,c),v=1-iw(e,p,f),M=iw(s,f,l),m=1-iw(s,c,l),E.push(Wx[u]),E.push(Qx[u])):25===u?(w=1-iw(s,c,p),v=iw(s,f,p),M=1-iw(e,l,f),m=iw(e,l,c),E.push(Wx[u]),E.push(Qx[u])):70===u?(b=1-iw(e,c,p),x=1-iw(s,p,f),C=1-iw(s,l,f),_=1-iw(e,c,l),E.push(Yx[u]),E.push(Xx[u])):100===u?(b=iw(s,p,c),x=iw(e,f,p),C=iw(e,f,l),_=iw(s,l,c),E.push(Yx[u]),E.push(Xx[u])):34===u?(0===g?(w=1-iw(e,c,p),b=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)):(w=iw(s,p,c),b=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)),E.push(Wx[u]),E.push(Yx[u]),E.push(Qx[u]),E.push(Kx[u])):35===u?(4===g?(w=1-iw(e,c,p),b=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)):(w=iw(s,p,c),b=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)),E.push(Wx[u]),E.push(Yx[u]),E.push(Jx[u]),E.push(Kx[u])):136===u?(0===g?(w=iw(s,p,c),b=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)):(w=1-iw(e,c,p),b=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)),E.push(Wx[u]),E.push(Yx[u]),E.push(Qx[u]),E.push(Kx[u])):153===u?(0===g?(w=iw(e,p,c),v=1-iw(e,p,f),M=1-iw(e,l,f),m=iw(e,l,c)):(w=1-iw(s,c,p),v=iw(s,f,p),M=iw(s,f,l),m=1-iw(s,c,l)),E.push(Wx[u]),E.push(Jx[u])):102===u?(0===g?(b=1-iw(e,c,p),x=iw(e,f,p),C=iw(e,f,l),_=1-iw(e,c,l)):(b=iw(s,p,c),x=1-iw(s,p,f),C=1-iw(s,l,f),_=iw(s,l,c)),E.push(Yx[u]),E.push(Kx[u])):155===u?(4===g?(w=iw(e,p,c),v=1-iw(e,p,f),M=1-iw(e,l,f),m=iw(e,l,c)):(w=1-iw(s,c,p),v=iw(s,f,p),M=iw(s,f,l),m=1-iw(s,c,l)),E.push(Wx[u]),E.push(Qx[u])):103===u?(4===g?(b=1-iw(e,c,p),x=iw(e,f,p),C=iw(e,f,l),_=1-iw(e,c,l)):(b=iw(s,p,c),x=1-iw(s,p,f),C=1-iw(s,l,f),_=iw(s,l,c)),E.push(Yx[u]),E.push(Xx[u])):152===u?(0===g?(w=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),m=iw(e,l,c)):(w=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),m=1-iw(s,c,l)),E.push(Wx[u]),E.push(Xx[u]),E.push(Jx[u])):156===u?(4===g?(w=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),m=iw(e,l,c)):(w=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),m=1-iw(s,c,l)),E.push(Wx[u]),E.push(Jx[u]),E.push(Kx[u])):137===u?(0===g?(w=iw(s,p,c),b=iw(e,p,c),v=1-iw(e,p,f),M=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)):(w=1-iw(e,c,p),b=1-iw(s,c,p),v=iw(s,f,p),M=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)),E.push(Wx[u]),E.push(Yx[u]),E.push(Jx[u])):139===u?(4===g?(w=iw(s,p,c),b=iw(e,p,c),v=1-iw(e,p,f),M=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)):(w=1-iw(e,c,p),b=1-iw(s,c,p),v=iw(s,f,p),M=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)),E.push(Wx[u]),E.push(Yx[u]),E.push(Qx[u])):98===u?(0===g?(w=1-iw(e,c,p),b=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),C=iw(e,f,l),_=1-iw(e,c,l)):(w=iw(s,p,c),b=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),C=1-iw(s,l,f),_=iw(s,l,c)),E.push(Wx[u]),E.push(Yx[u]),E.push(Kx[u])):99===u?(4===g?(w=1-iw(e,c,p),b=1-iw(s,c,p),x=iw(s,f,p),v=iw(e,f,p),C=iw(e,f,l),_=1-iw(e,c,l)):(w=iw(s,p,c),b=iw(e,p,c),x=1-iw(e,p,f),v=1-iw(s,p,f),C=1-iw(s,l,f),_=iw(s,l,c)),E.push(Wx[u]),E.push(Yx[u]),E.push(Jx[u])):38===u?(0===g?(b=1-iw(e,c,p),x=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)):(b=iw(s,p,c),x=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)),E.push(Yx[u]),E.push(Qx[u]),E.push(Kx[u])):39===u?(4===g?(b=1-iw(e,c,p),x=iw(e,f,p),M=iw(e,f,l),C=iw(s,f,l),_=1-iw(s,c,l),m=1-iw(e,c,l)):(b=iw(s,p,c),x=1-iw(s,p,f),M=1-iw(s,l,f),C=1-iw(e,l,f),_=iw(e,l,c),m=iw(s,l,c)),E.push(Yx[u]),E.push(Xx[u]),E.push(Kx[u])):85===u&&(w=1,b=0,x=1,v=0,M=0,C=1,_=0,m=1),(_<0||_>1||m<0||m>1||w<0||w>1||x<0||x>1||M<0||M>1||C<0||C>1)&&console.log("MarchingSquaresJS-isoBands: "+u+" "+d+" "+l+","+c+","+p+","+f+" "+g+" "+_+" "+m+" "+w+" "+b+" "+x+" "+v+" "+M+" "+C),o.cells[a][h]={cval:u,cval_real:d,flipped:g,topleft:_,topright:m,righttop:w,rightbottom:b,bottomright:x,bottomleft:v,leftbottom:M,lefttop:C,edges:E}}}}}return o}(t,e,i);return cx.polygons?(cx.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),h=function(t){var e=[],i=0;return t.cells.forEach((function(t,n){t.forEach((function(t,r){if(void 0!==t){var o=ew[t.cval](t);"object"==typeof o&&nw(o)?"object"==typeof o[0]&&nw(o[0])?"object"==typeof o[0][0]&&nw(o[0][0])?o.forEach((function(t){t.forEach((function(t){t[0]+=r,t[1]+=n})),e[i++]=t})):(o.forEach((function(t){t[0]+=r,t[1]+=n})),e[i++]=o):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}}))})),e}(u)):(cx.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),h=function(t){for(var e=[],i=t.rows,n=t.cols,r=[],o=0;o<i;o++)for(var s=0;s<n;s++)if(void 0!==t.cells[o][s]&&t.cells[o][s].edges.length>0){var a=ow(t.cells[o][s]),h=null,u=s,l=o;null!==a&&r.push([a.p[0]+u,a.p[1]+l]);do{if(null===(h=sw(t.cells[l][u],a.x,a.y,a.o)))break;if(r.push([h.p[0]+u,h.p[1]+l]),u+=h.x,a=h,(l+=h.y)<0||l>=i||u<0||u>=n||void 0===t.cells[l][u]){var c=rw(t,u-=h.x,l-=h.y,h.x,h.y,h.o);if(null===c)break;c.path.forEach((function(t){r.push(t)})),u=c.i,l=c.j,a=c}}while(void 0!==t.cells[l][u]&&t.cells[l][u].edges.length>0);e.push(r),r=[],t.cells[o][s].edges.length>0&&s--}return e}(u)),"function"==typeof cx.successCallback&&cx.successCallback(h),h}var fx=64,dx=16,gx=[],yx=[],_x=[],mx=[],vx=[],xx=[],wx=[],bx=[],Cx=[],Mx=[],Ex=[],Sx=[],Px=[],Ix=[],Tx=[],Lx=[],Ox=[],Rx=[],Nx=[],Ax=[],Dx=[],kx=[],Fx=[],jx=[];wx[85]=Mx[85]=-1,bx[85]=Ex[85]=0,Cx[85]=Sx[85]=1,Nx[85]=kx[85]=1,Ax[85]=Fx[85]=0,Dx[85]=jx[85]=1,gx[85]=mx[85]=0,yx[85]=vx[85]=-1,_x[85]=Tx[85]=0,Lx[85]=Px[85]=0,Ox[85]=Ix[85]=1,xx[85]=Rx[85]=1,kx[1]=kx[169]=0,Fx[1]=Fx[169]=-1,jx[1]=jx[169]=0,Px[1]=Px[169]=-1,Ix[1]=Ix[169]=0,Tx[1]=Tx[169]=0,Mx[4]=Mx[166]=0,Ex[4]=Ex[166]=-1,Sx[4]=Sx[166]=1,Lx[4]=Lx[166]=1,Ox[4]=Ox[166]=0,Rx[4]=Rx[166]=0,wx[16]=wx[154]=0,bx[16]=bx[154]=1,Cx[16]=Cx[154]=1,mx[16]=mx[154]=1,vx[16]=vx[154]=0,xx[16]=xx[154]=1,Nx[64]=Nx[106]=0,Ax[64]=Ax[106]=1,Dx[64]=Dx[106]=0,gx[64]=gx[106]=-1,yx[64]=yx[106]=0,_x[64]=_x[106]=1,Nx[2]=Nx[168]=0,Ax[2]=Ax[168]=-1,Dx[2]=Dx[168]=1,kx[2]=kx[168]=0,Fx[2]=Fx[168]=-1,jx[2]=jx[168]=0,Px[2]=Px[168]=-1,Ix[2]=Ix[168]=0,Tx[2]=Tx[168]=0,Lx[2]=Lx[168]=-1,Ox[2]=Ox[168]=0,Rx[2]=Rx[168]=1,wx[8]=wx[162]=0,bx[8]=bx[162]=-1,Cx[8]=Cx[162]=0,Mx[8]=Mx[162]=0,Ex[8]=Ex[162]=-1,Sx[8]=Sx[162]=1,Px[8]=Px[162]=1,Ix[8]=Ix[162]=0,Tx[8]=Tx[162]=1,Lx[8]=Lx[162]=1,Ox[8]=Ox[162]=0,Rx[8]=Rx[162]=0,wx[32]=wx[138]=0,bx[32]=bx[138]=1,Cx[32]=Cx[138]=1,Mx[32]=Mx[138]=0,Ex[32]=Ex[138]=1,Sx[32]=Sx[138]=0,gx[32]=gx[138]=1,yx[32]=yx[138]=0,_x[32]=_x[138]=0,mx[32]=mx[138]=1,vx[32]=vx[138]=0,xx[32]=xx[138]=1,kx[128]=kx[42]=0,Fx[128]=Fx[42]=1,jx[128]=jx[42]=1,Nx[128]=Nx[42]=0,Ax[128]=Ax[42]=1,Dx[128]=Dx[42]=0,gx[128]=gx[42]=-1,yx[128]=yx[42]=0,_x[128]=_x[42]=1,mx[128]=mx[42]=-1,vx[128]=vx[42]=0,xx[128]=xx[42]=0,Mx[5]=Mx[165]=-1,Ex[5]=Ex[165]=0,Sx[5]=Sx[165]=0,kx[5]=kx[165]=1,Fx[5]=Fx[165]=0,jx[5]=jx[165]=0,Lx[20]=Lx[150]=0,Ox[20]=Ox[150]=1,Rx[20]=Rx[150]=1,mx[20]=mx[150]=0,vx[20]=vx[150]=-1,xx[20]=xx[150]=1,wx[80]=wx[90]=-1,bx[80]=bx[90]=0,Cx[80]=Cx[90]=1,Nx[80]=Nx[90]=1,Ax[80]=Ax[90]=0,Dx[80]=Dx[90]=1,Px[65]=Px[105]=0,Ix[65]=Ix[105]=1,Tx[65]=Tx[105]=0,gx[65]=gx[105]=0,yx[65]=yx[105]=-1,_x[65]=_x[105]=0,wx[160]=wx[10]=-1,bx[160]=bx[10]=0,Cx[160]=Cx[10]=1,Mx[160]=Mx[10]=-1,Ex[160]=Ex[10]=0,Sx[160]=Sx[10]=0,kx[160]=kx[10]=1,Fx[160]=Fx[10]=0,jx[160]=jx[10]=0,Nx[160]=Nx[10]=1,Ax[160]=Ax[10]=0,Dx[160]=Dx[10]=1,Lx[130]=Lx[40]=0,Ox[130]=Ox[40]=1,Rx[130]=Rx[40]=1,Px[130]=Px[40]=0,Ix[130]=Ix[40]=1,Tx[130]=Tx[40]=0,gx[130]=gx[40]=0,yx[130]=yx[40]=-1,_x[130]=_x[40]=0,mx[130]=mx[40]=0,vx[130]=vx[40]=-1,xx[130]=xx[40]=1,Mx[37]=Mx[133]=0,Ex[37]=Ex[133]=1,Sx[37]=Sx[133]=1,kx[37]=kx[133]=0,Fx[37]=Fx[133]=1,jx[37]=jx[133]=0,gx[37]=gx[133]=-1,yx[37]=yx[133]=0,_x[37]=_x[133]=0,mx[37]=mx[133]=1,vx[37]=vx[133]=0,xx[37]=xx[133]=0,Lx[148]=Lx[22]=-1,Ox[148]=Ox[22]=0,Rx[148]=Rx[22]=0,kx[148]=kx[22]=0,Fx[148]=Fx[22]=-1,jx[148]=jx[22]=1,Nx[148]=Nx[22]=0,Ax[148]=Ax[22]=1,Dx[148]=Dx[22]=1,mx[148]=mx[22]=-1,vx[148]=vx[22]=0,xx[148]=xx[22]=1,wx[82]=wx[88]=0,bx[82]=bx[88]=-1,Cx[82]=Cx[88]=1,Lx[82]=Lx[88]=1,Ox[82]=Ox[88]=0,Rx[82]=Rx[88]=1,Px[82]=Px[88]=-1,Ix[82]=Ix[88]=0,Tx[82]=Tx[88]=1,Nx[82]=Nx[88]=0,Ax[82]=Ax[88]=-1,Dx[82]=Dx[88]=0,wx[73]=wx[97]=0,bx[73]=bx[97]=1,Cx[73]=Cx[97]=0,Mx[73]=Mx[97]=0,Ex[73]=Ex[97]=-1,Sx[73]=Sx[97]=0,Px[73]=Px[97]=1,Ix[73]=Ix[97]=0,Tx[73]=Tx[97]=0,gx[73]=gx[97]=1,yx[73]=yx[97]=0,_x[73]=_x[97]=1,wx[145]=wx[25]=0,bx[145]=bx[25]=-1,Cx[145]=Cx[25]=0,Px[145]=Px[25]=1,Ix[145]=Ix[25]=0,Tx[145]=Tx[25]=1,kx[145]=kx[25]=0,Fx[145]=Fx[25]=1,jx[145]=jx[25]=1,mx[145]=mx[25]=-1,vx[145]=vx[25]=0,xx[145]=xx[25]=0,Mx[70]=Mx[100]=0,Ex[70]=Ex[100]=1,Sx[70]=Sx[100]=0,Lx[70]=Lx[100]=-1,Ox[70]=Ox[100]=0,Rx[70]=Rx[100]=1,Nx[70]=Nx[100]=0,Ax[70]=Ax[100]=-1,Dx[70]=Dx[100]=1,gx[70]=gx[100]=1,yx[70]=yx[100]=0,_x[70]=_x[100]=0,Mx[101]=Mx[69]=0,Ex[101]=Ex[69]=1,Sx[101]=Sx[69]=0,gx[101]=gx[69]=1,yx[101]=yx[69]=0,_x[101]=_x[69]=0,kx[149]=kx[21]=0,Fx[149]=Fx[21]=1,jx[149]=jx[21]=1,mx[149]=mx[21]=-1,vx[149]=vx[21]=0,xx[149]=xx[21]=0,Lx[86]=Lx[84]=-1,Ox[86]=Ox[84]=0,Rx[86]=Rx[84]=1,Nx[86]=Nx[84]=0,Ax[86]=Ax[84]=-1,Dx[86]=Dx[84]=1,wx[89]=wx[81]=0,bx[89]=bx[81]=-1,Cx[89]=Cx[81]=0,Px[89]=Px[81]=1,Ix[89]=Ix[81]=0,Tx[89]=Tx[81]=1,wx[96]=wx[74]=0,bx[96]=bx[74]=1,Cx[96]=Cx[74]=0,Mx[96]=Mx[74]=-1,Ex[96]=Ex[74]=0,Sx[96]=Sx[74]=1,Nx[96]=Nx[74]=1,Ax[96]=Ax[74]=0,Dx[96]=Dx[74]=0,gx[96]=gx[74]=1,yx[96]=yx[74]=0,_x[96]=_x[74]=1,wx[24]=wx[146]=0,bx[24]=bx[146]=-1,Cx[24]=Cx[146]=1,Lx[24]=Lx[146]=1,Ox[24]=Ox[146]=0,Rx[24]=Rx[146]=1,Px[24]=Px[146]=0,Ix[24]=Ix[146]=1,Tx[24]=Tx[146]=1,mx[24]=mx[146]=0,vx[24]=vx[146]=-1,xx[24]=xx[146]=0,Mx[6]=Mx[164]=-1,Ex[6]=Ex[164]=0,Sx[6]=Sx[164]=1,Lx[6]=Lx[164]=-1,Ox[6]=Ox[164]=0,Rx[6]=Rx[164]=0,kx[6]=kx[164]=0,Fx[6]=Fx[164]=-1,jx[6]=jx[164]=1,Nx[6]=Nx[164]=1,Ax[6]=Ax[164]=0,Dx[6]=Dx[164]=0,Px[129]=Px[41]=0,Ix[129]=Ix[41]=1,Tx[129]=Tx[41]=1,kx[129]=kx[41]=0,Fx[129]=Fx[41]=1,jx[129]=jx[41]=0,gx[129]=gx[41]=-1,yx[129]=yx[41]=0,_x[129]=_x[41]=0,mx[129]=mx[41]=0,vx[129]=vx[41]=-1,xx[129]=xx[41]=0,Lx[66]=Lx[104]=0,Ox[66]=Ox[104]=1,Rx[66]=Rx[104]=0,Px[66]=Px[104]=-1,Ix[66]=Ix[104]=0,Tx[66]=Tx[104]=1,Nx[66]=Nx[104]=0,Ax[66]=Ax[104]=-1,Dx[66]=Dx[104]=0,gx[66]=gx[104]=0,yx[66]=yx[104]=-1,_x[66]=_x[104]=1,wx[144]=wx[26]=-1,bx[144]=bx[26]=0,Cx[144]=Cx[26]=0,kx[144]=kx[26]=1,Fx[144]=Fx[26]=0,jx[144]=jx[26]=1,Nx[144]=Nx[26]=0,Ax[144]=Ax[26]=1,Dx[144]=Dx[26]=1,mx[144]=mx[26]=-1,vx[144]=vx[26]=0,xx[144]=xx[26]=1,Mx[36]=Mx[134]=0,Ex[36]=Ex[134]=1,Sx[36]=Sx[134]=1,Lx[36]=Lx[134]=0,Ox[36]=Ox[134]=1,Rx[36]=Rx[134]=0,gx[36]=gx[134]=0,yx[36]=yx[134]=-1,_x[36]=_x[134]=1,mx[36]=mx[134]=1,vx[36]=vx[134]=0,xx[36]=xx[134]=0,wx[9]=wx[161]=-1,bx[9]=bx[161]=0,Cx[9]=Cx[161]=0,Mx[9]=Mx[161]=0,Ex[9]=Ex[161]=-1,Sx[9]=Sx[161]=0,Px[9]=Px[161]=1,Ix[9]=Ix[161]=0,Tx[9]=Tx[161]=0,kx[9]=kx[161]=1,Fx[9]=Fx[161]=0,jx[9]=jx[161]=1,wx[136]=0,bx[136]=1,Cx[136]=1,Mx[136]=0,Ex[136]=1,Sx[136]=0,Lx[136]=-1,Ox[136]=0,Rx[136]=1,Px[136]=-1,Ix[136]=0,Tx[136]=0,kx[136]=0,Fx[136]=-1,jx[136]=0,Nx[136]=0,Ax[136]=-1,Dx[136]=1,gx[136]=1,yx[136]=0,_x[136]=0,mx[136]=1,vx[136]=0,xx[136]=1,wx[34]=0,bx[34]=-1,Cx[34]=0,Mx[34]=0,Ex[34]=-1,Sx[34]=1,Lx[34]=1,Ox[34]=0,Rx[34]=0,Px[34]=1,Ix[34]=0,Tx[34]=1,kx[34]=0,Fx[34]=1,jx[34]=1,Nx[34]=0,Ax[34]=1,Dx[34]=0,gx[34]=-1,yx[34]=0,_x[34]=1,mx[34]=-1,vx[34]=0,xx[34]=0,wx[35]=0,bx[35]=1,Cx[35]=1,Mx[35]=0,Ex[35]=-1,Sx[35]=1,Lx[35]=1,Ox[35]=0,Rx[35]=0,Px[35]=-1,Ix[35]=0,Tx[35]=0,kx[35]=0,Fx[35]=-1,jx[35]=0,Nx[35]=0,Ax[35]=1,Dx[35]=0,gx[35]=-1,yx[35]=0,_x[35]=1,mx[35]=1,vx[35]=0,xx[35]=1,wx[153]=0,bx[153]=1,Cx[153]=1,Px[153]=-1,Ix[153]=0,Tx[153]=0,kx[153]=0,Fx[153]=-1,jx[153]=0,mx[153]=1,vx[153]=0,xx[153]=1,Mx[102]=0,Ex[102]=-1,Sx[102]=1,Lx[102]=1,Ox[102]=0,Rx[102]=0,Nx[102]=0,Ax[102]=1,Dx[102]=0,gx[102]=-1,yx[102]=0,_x[102]=1,wx[155]=0,bx[155]=-1,Cx[155]=0,Px[155]=1,Ix[155]=0,Tx[155]=1,kx[155]=0,Fx[155]=1,jx[155]=1,mx[155]=-1,vx[155]=0,xx[155]=0,Mx[103]=0,Ex[103]=1,Sx[103]=0,Lx[103]=-1,Ox[103]=0,Rx[103]=1,Nx[103]=0,Ax[103]=-1,Dx[103]=1,gx[103]=1,yx[103]=0,_x[103]=0,wx[152]=0,bx[152]=1,Cx[152]=1,Lx[152]=-1,Ox[152]=0,Rx[152]=1,Px[152]=-1,Ix[152]=0,Tx[152]=0,kx[152]=0,Fx[152]=-1,jx[152]=0,Nx[152]=0,Ax[152]=-1,Dx[152]=1,mx[152]=1,vx[152]=0,xx[152]=1,wx[156]=0,bx[156]=-1,Cx[156]=1,Lx[156]=1,Ox[156]=0,Rx[156]=1,Px[156]=-1,Ix[156]=0,Tx[156]=0,kx[156]=0,Fx[156]=-1,jx[156]=0,Nx[156]=0,Ax[156]=1,Dx[156]=1,mx[156]=-1,vx[156]=0,xx[156]=1,wx[137]=0,bx[137]=1,Cx[137]=1,Mx[137]=0,Ex[137]=1,Sx[137]=0,Px[137]=-1,Ix[137]=0,Tx[137]=0,kx[137]=0,Fx[137]=-1,jx[137]=0,gx[137]=1,yx[137]=0,_x[137]=0,mx[137]=1,vx[137]=0,xx[137]=1,wx[139]=0,bx[139]=1,Cx[139]=1,Mx[139]=0,Ex[139]=-1,Sx[139]=0,Px[139]=1,Ix[139]=0,Tx[139]=0,kx[139]=0,Fx[139]=1,jx[139]=0,gx[139]=-1,yx[139]=0,_x[139]=0,mx[139]=1,vx[139]=0,xx[139]=1,wx[98]=0,bx[98]=-1,Cx[98]=0,Mx[98]=0,Ex[98]=-1,Sx[98]=1,Lx[98]=1,Ox[98]=0,Rx[98]=0,Px[98]=1,Ix[98]=0,Tx[98]=1,Nx[98]=0,Ax[98]=1,Dx[98]=0,gx[98]=-1,yx[98]=0,_x[98]=1,wx[99]=0,bx[99]=1,Cx[99]=0,Mx[99]=0,Ex[99]=-1,Sx[99]=1,Lx[99]=1,Ox[99]=0,Rx[99]=0,Px[99]=-1,Ix[99]=0,Tx[99]=1,Nx[99]=0,Ax[99]=-1,Dx[99]=0,gx[99]=1,yx[99]=0,_x[99]=1,Mx[38]=0,Ex[38]=-1,Sx[38]=1,Lx[38]=1,Ox[38]=0,Rx[38]=0,kx[38]=0,Fx[38]=1,jx[38]=1,Nx[38]=0,Ax[38]=1,Dx[38]=0,gx[38]=-1,yx[38]=0,_x[38]=1,mx[38]=-1,vx[38]=0,xx[38]=0,Mx[39]=0,Ex[39]=1,Sx[39]=1,Lx[39]=-1,Ox[39]=0,Rx[39]=0,kx[39]=0,Fx[39]=-1,jx[39]=1,Nx[39]=0,Ax[39]=1,Dx[39]=0,gx[39]=-1,yx[39]=0,_x[39]=1,mx[39]=1,vx[39]=0,xx[39]=0;var Gx=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},zx=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},Bx=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},Vx=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},Hx=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},qx=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},Zx=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},Ux=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},Wx=[],Yx=[],Xx=[],Jx=[],Qx=[],Kx=[],$x=[],tw=[];Jx[1]=Qx[1]=18,Jx[169]=Qx[169]=18,Xx[4]=Yx[4]=12,Xx[166]=Yx[166]=12,Wx[16]=tw[16]=4,Wx[154]=tw[154]=4,Kx[64]=$x[64]=22,Kx[106]=$x[106]=22,Xx[2]=Kx[2]=17,Jx[2]=Qx[2]=18,Xx[168]=Kx[168]=17,Jx[168]=Qx[168]=18,Wx[8]=Jx[8]=9,Yx[8]=Xx[8]=12,Wx[162]=Jx[162]=9,Yx[162]=Xx[162]=12,Wx[32]=tw[32]=4,Yx[32]=$x[32]=1,Wx[138]=tw[138]=4,Yx[138]=$x[138]=1,Qx[128]=tw[128]=21,Kx[128]=$x[128]=22,Qx[42]=tw[42]=21,Kx[42]=$x[42]=22,Yx[5]=Qx[5]=14,Yx[165]=Qx[165]=14,Xx[20]=tw[20]=6,Xx[150]=tw[150]=6,Wx[80]=Kx[80]=11,Wx[90]=Kx[90]=11,Jx[65]=$x[65]=3,Jx[105]=$x[105]=3,Wx[160]=Kx[160]=11,Yx[160]=Qx[160]=14,Wx[10]=Kx[10]=11,Yx[10]=Qx[10]=14,Xx[130]=tw[130]=6,Jx[130]=$x[130]=3,Xx[40]=tw[40]=6,Jx[40]=$x[40]=3,Yx[101]=$x[101]=1,Yx[69]=$x[69]=1,Qx[149]=tw[149]=21,Qx[21]=tw[21]=21,Xx[86]=Kx[86]=17,Xx[84]=Kx[84]=17,Wx[89]=Jx[89]=9,Wx[81]=Jx[81]=9,Wx[96]=$x[96]=0,Yx[96]=Kx[96]=15,Wx[74]=$x[74]=0,Yx[74]=Kx[74]=15,Wx[24]=Xx[24]=8,Jx[24]=tw[24]=7,Wx[146]=Xx[146]=8,Jx[146]=tw[146]=7,Yx[6]=Kx[6]=15,Xx[6]=Qx[6]=16,Yx[164]=Kx[164]=15,Xx[164]=Qx[164]=16,Jx[129]=tw[129]=7,Qx[129]=$x[129]=20,Jx[41]=tw[41]=7,Qx[41]=$x[41]=20,Xx[66]=$x[66]=2,Jx[66]=Kx[66]=19,Xx[104]=$x[104]=2,Jx[104]=Kx[104]=19,Wx[144]=Qx[144]=10,Kx[144]=tw[144]=23,Wx[26]=Qx[26]=10,Kx[26]=tw[26]=23,Yx[36]=tw[36]=5,Xx[36]=$x[36]=2,Yx[134]=tw[134]=5,Xx[134]=$x[134]=2,Wx[9]=Qx[9]=10,Yx[9]=Jx[9]=13,Wx[161]=Qx[161]=10,Yx[161]=Jx[161]=13,Yx[37]=tw[37]=5,Qx[37]=$x[37]=20,Yx[133]=tw[133]=5,Qx[133]=$x[133]=20,Xx[148]=Qx[148]=16,Kx[148]=tw[148]=23,Xx[22]=Qx[22]=16,Kx[22]=tw[22]=23,Wx[82]=Xx[82]=8,Jx[82]=Kx[82]=19,Wx[88]=Xx[88]=8,Jx[88]=Kx[88]=19,Wx[73]=$x[73]=0,Yx[73]=Jx[73]=13,Wx[97]=$x[97]=0,Yx[97]=Jx[97]=13,Wx[145]=Jx[145]=9,Qx[145]=tw[145]=21,Wx[25]=Jx[25]=9,Qx[25]=tw[25]=21,Yx[70]=$x[70]=1,Xx[70]=Kx[70]=17,Yx[100]=$x[100]=1,Xx[100]=Kx[100]=17,Wx[34]=Jx[34]=9,Yx[34]=Xx[34]=12,Qx[34]=tw[34]=21,Kx[34]=$x[34]=22,Wx[136]=tw[136]=4,Yx[136]=$x[136]=1,Xx[136]=Kx[136]=17,Jx[136]=Qx[136]=18,Wx[35]=tw[35]=4,Yx[35]=Xx[35]=12,Jx[35]=Qx[35]=18,Kx[35]=$x[35]=22,Wx[153]=tw[153]=4,Jx[153]=Qx[153]=18,Yx[102]=Xx[102]=12,Kx[102]=$x[102]=22,Wx[155]=Jx[155]=9,Qx[155]=tw[155]=23,Yx[103]=$x[103]=1,Xx[103]=Kx[103]=17,Wx[152]=tw[152]=4,Xx[152]=Kx[152]=17,Jx[152]=Qx[152]=18,Wx[156]=Xx[156]=8,Jx[156]=Qx[156]=18,Kx[156]=tw[156]=23,Wx[137]=tw[137]=4,Yx[137]=$x[137]=1,Jx[137]=Qx[137]=18,Wx[139]=tw[139]=4,Yx[139]=Jx[139]=13,Qx[139]=$x[139]=20,Wx[98]=Jx[98]=9,Yx[98]=Xx[98]=12,Kx[98]=$x[98]=22,Wx[99]=$x[99]=0,Yx[99]=Xx[99]=12,Jx[99]=Kx[99]=19,Yx[38]=Xx[38]=12,Qx[38]=tw[38]=21,Kx[38]=$x[38]=22,Yx[39]=tw[39]=5,Xx[39]=Qx[39]=16,Kx[39]=$x[39]=22;var ew=[];function iw(t,e,i){return(t-e)/(i-e)}function nw(t){return t.constructor.toString().indexOf("Array")>-1}function rw(t,e,i,n,r,o){for(var s=t.cells[i][e],a=s.cval_real,h=e+n,u=i+r,l=[],c=!1;!c;){if(void 0===t.cells[u]||void 0===t.cells[u][h])if(u-=r,h-=n,a=(s=t.cells[u][h]).cval_real,-1===r)if(0===o)if(1&a)l.push([h,u]),n=-1,r=0,o=0;else{if(!(4&a)){l.push([h+s.bottomright,u]),n=0,r=1,o=1,c=!0;break}l.push([h+1,u]),n=1,r=0,o=0}else{if(!(1&a)){if(4&a){l.push([h+s.bottomright,u]),n=0,r=1,o=1,c=!0;break}l.push([h+s.bottomleft,u]),n=0,r=1,o=0,c=!0;break}l.push([h,u]),n=-1,r=0,o=0}else if(1===r)if(0===o){if(!(a&dx)){if(a&fx){l.push([h+s.topleft,u+1]),n=0,r=-1,o=0,c=!0;break}l.push([h+s.topright,u+1]),n=0,r=-1,o=1,c=!0;break}l.push([h+1,u+1]),n=1,r=0,o=1}else l.push([h+1,u+1]),n=1,r=0,o=1;else if(-1===n)if(0===o){if(!(a&fx)){if(1&a){l.push([h,u+s.leftbottom]),n=1,r=0,o=0,c=!0;break}l.push([h,u+s.lefttop]),n=1,r=0,o=1,c=!0;break}l.push([h,u+1]),n=0,r=1,o=0}else{if(!(a&fx)){console.log("MarchingSquaresJS-isoBands: wtf");break}l.push([h,u+1]),n=0,r=1,o=0}else{if(1!==n){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(4&a)){l.push([h+1,u+s.rightbottom]),n=-1,r=0,o=0,c=!0;break}l.push([h+1,u]),n=0,r=-1,o=1}else{if(!(4&a)){if(a&dx){l.push([h+1,u+s.righttop]),n=-1,r=0,o=1;break}l.push([h+1,u+s.rightbottom]),n=-1,r=0,o=0,c=!0;break}l.push([h+1,u]),n=0,r=-1,o=1}}else if(a=(s=t.cells[u][h]).cval_real,-1===n)if(0===o)if(void 0!==t.cells[u-1]&&void 0!==t.cells[u-1][h])n=0,r=-1,o=1;else{if(!(1&a)){l.push([h+s.bottomright,u]),n=0,r=1,o=1,c=!0;break}l.push([h,u])}else{if(!(a&fx)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+h+","+u);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===n){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[u+1]&&void 0!==t.cells[u+1][h])n=0,r=1,o=0;else{if(!(a&dx)){l.push([h+s.topleft,u+1]),n=0,r=-1,o=0,c=!0;break}l.push([h+1,u+1]),n=1,r=0,o=1}}else if(-1===r){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[u][h+1])n=1,r=0,o=1;else{if(!(4&a)){l.push([h+1,u+s.righttop]),n=-1,r=0,o=1,c=!0;break}l.push([h+1,u]),n=0,r=-1,o=1}}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==t.cells[u][h-1])n=-1,r=0,o=0;else{if(!(a&fx)){l.push([h,u+s.leftbottom]),n=1,r=0,o=0,c=!0;break}l.push([h,u+1]),n=0,r=1,o=0}}if(u+=r,(h+=n)===e&&u===i)break}return{path:l,i:h,j:u,x:n,y:r,o:o}}function ow(t){if(t.edges.length>0){var e=t.edges[t.edges.length-1],i=t.cval_real;switch(e){case 0:return i&dx?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 1:return 4&i?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 2:return 4&i?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topleft,1],x:0,y:-1,o:0};case 3:return 1&i?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 4:return i&dx?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 5:return 4&i?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 6:return 4&i?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};case 7:return 1&i?{p:[t.topright,1],x:0,y:-1,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 8:return 4&i?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.righttop],x:-1,y:0,o:1};case 9:return 1&i?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 10:return 1&i?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.righttop],x:-1,y:0,o:1};case 11:return i&fx?{p:[1,t.righttop],x:-1,y:0,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 12:return 4&i?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 13:return 1&i?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 14:return 1&i?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[1,t.rightbottom],x:-1,y:0,o:0};case 15:return i&fx?{p:[1,t.rightbottom],x:-1,y:0,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 16:return 4&i?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 17:return i&fx?{p:[t.bottomright,0],x:0,y:1,o:1}:{p:[0,t.lefttop],x:1,y:0,o:1};case 18:return 1&i?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.bottomleft,0],x:0,y:1,o:0};case 19:return i&fx?{p:[t.bottomleft,0],x:0,y:1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 20:return i&fx?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.leftbottom],x:1,y:0,o:0};case 21:return i&dx?{p:[0,t.leftbottom],x:1,y:0,o:0}:{p:[t.topright,1],x:0,y:-1,o:1};case 22:return i&fx?{p:[t.topleft,1],x:0,y:-1,o:0}:{p:[0,t.lefttop],x:1,y:0,o:1};case 23:return i&dx?{p:[0,t.lefttop],x:1,y:0,o:1}:{p:[t.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t)}}return null}function sw(t,e,i,n){var r,o,s,a,h,u=t.cval;switch(e){case-1:if(0===n)r=Yx[u],s=Mx[u],a=Ex[u],h=Sx[u];else r=Wx[u],s=wx[u],a=bx[u],h=Cx[u];break;case 1:if(0===n)r=Qx[u],s=kx[u],a=Fx[u],h=jx[u];else r=Kx[u],s=Nx[u],a=Ax[u],h=Dx[u];break;default:switch(i){case-1:if(0===n)r=$x[u],s=gx[u],a=yx[u],h=_x[u];else r=tw[u],s=mx[u],a=vx[u],h=xx[u];break;case 1:if(0===n)r=Jx[u],s=Px[u],a=Ix[u],h=Tx[u];else r=Xx[u],s=Lx[u],a=Ox[u],h=Rx[u]}}if(o=t.edges.indexOf(r),void 0===t.edges[o])return null;switch(function(t,e){delete t.edges[e];for(var i=e+1;i<t.edges.length;i++)t.edges[i-1]=t.edges[i];t.edges.pop()}(t,o),u=t.cval_real,r){case 0:u&dx?(e=t.topleft,i=1):(e=1,i=t.righttop);break;case 1:4&u?(e=1,i=t.rightbottom):(e=t.topleft,i=1);break;case 2:4&u?(e=t.topleft,i=1):(e=t.bottomright,i=0);break;case 3:1&u?(e=t.bottomleft,i=0):(e=t.topleft,i=1);break;case 4:u&dx?(e=t.topright,i=1):(e=1,i=t.righttop);break;case 5:4&u?(e=1,i=t.rightbottom):(e=t.topright,i=1);break;case 6:4&u?(e=t.topright,i=1):(e=t.bottomright,i=0);break;case 7:1&u?(e=t.bottomleft,i=0):(e=t.topright,i=1);break;case 8:4&u?(e=1,i=t.righttop):(e=t.bottomright,i=0);break;case 9:1&u?(e=t.bottomleft,i=0):(e=1,i=t.righttop);break;case 10:1&u?(e=1,i=t.righttop):(e=0,i=t.leftbottom);break;case 11:u&fx?(e=0,i=t.lefttop):(e=1,i=t.righttop);break;case 12:4&u?(e=1,i=t.rightbottom):(e=t.bottomright,i=0);break;case 13:1&u?(e=t.bottomleft,i=0):(e=1,i=t.rightbottom);break;case 14:1&u?(e=1,i=t.rightbottom):(e=0,i=t.leftbottom);break;case 15:u&fx?(e=0,i=t.lefttop):(e=1,i=t.rightbottom);break;case 16:4&u?(e=0,i=t.leftbottom):(e=t.bottomright,i=0);break;case 17:u&fx?(e=0,i=t.lefttop):(e=t.bottomright,i=0);break;case 18:1&u?(e=t.bottomleft,i=0):(e=0,i=t.leftbottom);break;case 19:u&fx?(e=0,i=t.lefttop):(e=t.bottomleft,i=0);break;case 20:u&fx?(e=0,i=t.leftbottom):(e=t.topleft,i=1);break;case 21:u&dx?(e=t.topright,i=1):(e=0,i=t.leftbottom);break;case 22:u&fx?(e=0,i=t.lefttop):(e=t.topleft,i=1);break;case 23:u&dx?(e=t.topright,i=1):(e=0,i=t.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(t),null}return void 0!==e&&void 0!==i&&void 0!==s&&void 0!==a&&void 0!==h||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(t),console.log(e+" "+i+" "+s+" "+a+" "+h)),{p:[e,i],x:s,y:a,o:h}}function aw(t,e,i){if(!xh(i=i||{}))throw new Error("options is invalid");var n=i.zProperty||"elevation",r=i.commonProperties||{},o=i.breaksProperties||[];if(Sh(t,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks is not an Array");if(!xh(r))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var s=ux(t,{zProperty:n,flip:!0}),a=function(t,e,i){for(var n=[],r=1;r<e.length;r++){var o=+e[r-1],s=+e[r],a=uw(hw(px(t,o,s-o))),h={};h.groupedRings=a,h[i]=o+"-"+s,n.push(h)}return n}(s,e,n);a=function(t,e,i){var n=zp(i),r=n[2]-n[0],o=n[3]-n[1],s=n[0],a=n[1],h=e[0].length-1,u=e.length-1,l=r/h,c=o/u,p=function(t){t[0]=t[0]*l+s,t[1]=t[1]*c+a};return t.forEach((function(t){t.groupedRings.forEach((function(t){t.forEach((function(t){t.forEach(p)}))}))})),t}(a,s,t);var h=a.map((function(t,e){if(o[e]&&!xh(o[e]))throw new Error("Each mappedProperty is required to be an Object");var i=hx({},r,o[e]);return i[n]=t[n],gh(t.groupedRings,i)}));return dh(h)}function hw(t){var e=[],i=[];t.forEach((function(t){var n=Kv(ph([t]));i.push(n),e.push({ring:t,area:n})})),i.sort((function(t,e){return e-t}));var n=[];return i.forEach((function(t){for(var i=0;i<e.length;i++)if(e[i].area===t){n.push(e[i].ring),e.splice(i,1);break}})),n}function uw(t){for(var e=t.map((function(t){return{lrCoordinates:t,grouped:!1}})),i=[];!cw(e);)for(var n=0;n<e.length;n++)if(!e[n].grouped){var r=[];r.push(e[n].lrCoordinates),e[n].grouped=!0;for(var o=ph([e[n].lrCoordinates]),s=n+1;s<e.length;s++){if(!e[s].grouped)lw(ph([e[s].lrCoordinates]),o)&&(r.push(e[s].lrCoordinates),e[s].grouped=!0)}i.push(r)}return i}function lw(t,e){for(var i=function(t){var e=[];return"FeatureCollection"===t.type?bh(t,(function(t){wh(t,(function(i){e.push(ch(i,t.properties))}))})):wh(t,(function(i){e.push(ch(i,t.properties))})),dh(e)}(t),n=0;n<i.features.length;n++)if(!ix(i.features[n],e))return!1;return!0}function cw(t){for(var e=0;e<t.length;e++)if(!1===t[e].grouped)return!1;return!0}function pw(t,e,i){void 0===i&&(i={});var n=Ph(t),r=Ph(e),o=Bc.union(n.coordinates,r.coordinates);return 0===o.length?null:1===o.length?ph(o[0],i.properties):gh(o,i.properties)}ew[1]=ew[169]=Gx,ew[4]=ew[166]=zx,ew[16]=ew[154]=Bx,ew[64]=ew[106]=Vx,ew[168]=ew[2]=Hx,ew[162]=ew[8]=qx,ew[138]=ew[32]=Zx,ew[42]=ew[128]=Ux,ew[5]=ew[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},ew[20]=ew[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},ew[80]=ew[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},ew[65]=ew[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},ew[160]=ew[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},ew[130]=ew[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},ew[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},ew[101]=ew[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},ew[149]=ew[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},ew[86]=ew[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},ew[89]=ew[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},ew[96]=ew[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},ew[24]=ew[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},ew[6]=ew[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},ew[129]=ew[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},ew[66]=ew[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ew[144]=ew[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ew[36]=ew[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},ew[9]=ew[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},ew[37]=ew[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},ew[148]=ew[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ew[82]=ew[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},ew[73]=ew[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},ew[145]=ew[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},ew[70]=ew[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ew[34]=function(t){return[Ux(t),qx(t)]},ew[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},ew[136]=function(t){return[Zx(t),Hx(t)]},ew[153]=function(t){return[Bx(t),Gx(t)]},ew[102]=function(t){return[zx(t),Vx(t)]},ew[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},ew[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ew[152]=function(t){return[Bx(t),Hx(t)]},ew[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},ew[137]=function(t){return[Zx(t),Gx(t)]},ew[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},ew[98]=function(t){return[qx(t),Vx(t)]},ew[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},ew[38]=function(t){return[zx(t),Ux(t)]},ew[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]};var fw=function(){function t(t){}var e=function(t,e,i){var n,r,o=!1;for(n=0,r=t.length-1;n<t.length;r=n++)t[n][1]>i!=t[r][1]>i&&e<(t[r][0]-t[n][0])*(i-t[n][1])/(t[r][1]-t[n][1])+t[n][0]&&(o=!o);return o},i=function(t,e){for(var i=[],n=0;n<e;n++)i.push(t);return i},n=function(t,e){for(var n=i(0,e*e),r=0;r<e;r++)n[r*e+r]=t;return n},r=function(t,e,i,n){var r,o,s=Array(i*n);for(r=0;r<i;r++)for(o=0;o<n;o++)s[r*n+o]=t[r*n+o]+e[r*n+o];return s},o=function(t,e,i,n,r){var o,s,a,h=Array(i*r);for(o=0;o<i;o++)for(s=0;s<r;s++)for(h[o*r+s]=0,a=0;a<n;a++)h[o*r+s]+=t[o*n+a]*e[a*r+s];return h},s=function(t,e){var i,n,r,o=Array(e);for(i=0;i<e;i++)o[i]=t[i*e+i];for(i=0;i<e;i++){for(n=0;n<i;n++)o[i]-=t[i*e+n]*t[i*e+n];if(o[i]<=0)return!1;for(o[i]=Math.sqrt(o[i]),n=i+1;n<e;n++){for(r=0;r<i;r++)t[n*e+i]-=t[n*e+r]*t[i*e+r];t[n*e+i]/=o[i]}}for(i=0;i<e;i++)t[i*e+i]=o[i];return!0},a=function(t,e){var i,n,r,o;for(i=0;i<e;i++)for(t[i*e+i]=1/t[i*e+i],n=i+1;n<e;n++){for(o=0,r=i;r<n;r++)o-=t[n*e+r]*t[r*e+i];t[n*e+i]=o/t[n*e+n]}for(i=0;i<e;i++)for(n=i+1;n<e;n++)t[i*e+n]=0;for(i=0;i<e;i++){for(t[i*e+i]*=t[i*e+i],r=i+1;r<e;r++)t[i*e+i]+=t[r*e+i]*t[r*e+i];for(n=i+1;n<e;n++)for(r=n;r<e;r++)t[i*e+n]+=t[r*e+i]*t[r*e+n]}for(i=0;i<e;i++)for(n=0;n<i;n++)t[i*e+n]=t[n*e+i]},h=function(t,e){var i,n,r,o,s,a,h,u,l,c,p,f=e,d=Array(e*e),g=Array(e),y=Array(e),_=Array(e);for(i=0;i<e;i++)for(o=0;o<e;o++)d[i*e+o]=i==o?1:0;for(o=0;o<e;o++)_[o]=0;for(i=0;i<e;i++){for(u=0,o=0;o<e;o++)if(1!=_[o])for(s=0;s<e;s++)0==_[s]&&Math.abs(t[o*e+s])>=u&&(u=Math.abs(t[o*e+s]),r=o,n=s);if(++_[n],r!=n){for(a=0;a<e;a++)p=t[r*e+a],t[r*e+a]=t[n*e+a],t[n*e+a]=p;for(a=0;a<f;a++)p=d[r*e+a],d[r*e+a]=d[n*e+a],d[n*e+a]=p}if(y[i]=r,g[i]=n,0==t[n*e+n])return!1;for(c=1/t[n*e+n],t[n*e+n]=1,a=0;a<e;a++)t[n*e+a]*=c;for(a=0;a<f;a++)d[n*e+a]*=c;for(h=0;h<e;h++)if(h!=n){for(l=t[h*e+n],t[h*e+n]=0,a=0;a<e;a++)t[h*e+a]-=t[n*e+a]*l;for(a=0;a<f;a++)d[h*e+a]-=d[n*e+a]*l}}for(a=e-1;a>=0;a--)if(y[a]!=g[a])for(s=0;s<e;s++)p=t[s*e+y[a]],t[s*e+y[a]]=t[s*e+g[a]],t[s*e+g[a]]=p;return!0},u=function(t,e,i,n,r){return e+(n-e)/i*(1-Math.exp(-1/r*Math.pow(t/i,2)))},l=function(t,e,i,n,r){return e+(n-e)/i*(1-Math.exp(-1/r*(t/i)))},c=function(t,e,i,n,r){return t>i?e+(n-e)/i:e+(n-e)/i*(t/i*1.5-.5*Math.pow(t/i,3))};return t.train=function(t,e,p,f,d,g){var y={t:t,x:e,y:p,nugget:0,range:0,sill:0,A:1/3,n:0};switch(f){case"gaussian":y.model=u;break;case"exponential":y.model=l;break;case"spherical":y.model=c}var _,m,v,x,w=t.length,b=Array((w*w-w)/2);for(_=0,v=0;_<w;_++)for(m=0;m<_;m++,v++)b[v]=Array(2),b[v][0]=Math.pow(Math.pow(e[_]-e[m],2)+Math.pow(p[_]-p[m],2),.5),b[v][1]=Math.abs(t[_]-t[m]);b.sort((function(t,e){return t[0]-e[0]})),y.range=b[(w*w-w)/2-1][0];var C=(w*w-w)/2>30?30:(w*w-w)/2,M=y.range/C,E=i(0,C),S=i(0,C);if(C<30)for(x=0;x<C;x++)E[x]=b[x][0],S[x]=b[x][1];else{for(_=0,m=0,v=0,x=0;_<C&&m<(w*w-w)/2;_++,v=0){for(;b[m][0]<=(_+1)*M&&(E[x]+=b[m][0],S[x]+=b[m][1],v++,!(++m>=(w*w-w)/2)););v>0&&(E[x]/=v,S[x]/=v,x++)}if(x<2)return y}w=x,y.range=E[w-1]-E[0];var P=i(1,2*w),I=Array(w),T=y.A;for(_=0;_<w;_++){switch(f){case"gaussian":P[2*_+1]=1-Math.exp(-1/T*Math.pow(E[_]/y.range,2));break;case"exponential":P[2*_+1]=1-Math.exp(-1/T*E[_]/y.range);break;case"spherical":P[2*_+1]=E[_]/y.range*1.5-.5*Math.pow(E[_]/y.range,3)}I[_]=S[_]}var L=function(t,e,i){var n,r,o=Array(i*e);for(n=0;n<e;n++)for(r=0;r<i;r++)o[r*e+n]=t[n*i+r];return o}(P,w,2),O=o(L,P,2,w,2),R=(O=r(O,n(1/g,2),2,2)).slice(0);s(O,2)?a(O,2):(h(R,2),O=R);var N=o(o(O,L,2,2,w),I,2,w,1);y.nugget=N[0],y.sill=N[1]*y.range+y.nugget,y.n=e.length,w=e.length;var A=Array(w*w);for(_=0;_<w;_++){for(m=0;m<_;m++)A[_*w+m]=y.model(Math.pow(Math.pow(e[_]-e[m],2)+Math.pow(p[_]-p[m],2),.5),y.nugget,y.range,y.sill,y.A),A[m*w+_]=A[_*w+m];A[_*w+_]=y.model(0,y.nugget,y.range,y.sill,y.A)}var D=r(A,n(d,w),w,w),k=D.slice(0);s(D,w)?a(D,w):(h(k,w),D=k);A=D.slice(0);var F=o(D,t,w,w,1);return y.K=A,y.M=F,y},t.predict=function(t,e,i){var n,r=Array(i.n);for(n=0;n<i.n;n++)r[n]=i.model(Math.pow(Math.pow(t-i.x[n],2)+Math.pow(e-i.y[n],2),.5),i.nugget,i.range,i.sill,i.A);return o(r,i.M,1,i.n,1)[0]},t.variance=function(t,e,i){var n,r=Array(i.n);for(n=0;n<i.n;n++)r[n]=i.model(Math.pow(Math.pow(t-i.x[n],2)+Math.pow(e-i.y[n],2),.5),i.nugget,i.range,i.sill,i.A);return i.model(0,i.nugget,i.range,i.sill,i.A)+o(o(r,i.K,1,i.n,i.n),r,1,i.n,1)[0]},t.grid=function(i,n,r){var o,s,a,h=i.length;if(0!=h){var u,l,c=[i[0][0][0],i[0][0][0]],p=[i[0][0][1],i[0][0][1]];for(o=0;o<h;o++)for(s=0;s<i[o].length;s++)i[o][s][0]<c[0]&&(c[0]=i[o][s][0]),i[o][s][0]>c[1]&&(c[1]=i[o][s][0]),i[o][s][1]<p[0]&&(p[0]=i[o][s][1]),i[o][s][1]>p[1]&&(p[1]=i[o][s][1]);var f=Array(2),d=Array(2),g=Array(2),y=Array(2),_=Math.ceil((c[1]-c[0])/r),m=Math.ceil((p[1]-p[0])/r),v=Array(_+1);for(o=0;o<=_;o++)v[o]=Array(m+1);for(o=0;o<h;o++){for(g[0]=i[o][0][0],g[1]=g[0],y[0]=i[o][0][1],y[1]=y[0],s=1;s<i[o].length;s++)i[o][s][0]<g[0]&&(g[0]=i[o][s][0]),i[o][s][0]>g[1]&&(g[1]=i[o][s][0]),i[o][s][1]<y[0]&&(y[0]=i[o][s][1]),i[o][s][1]>y[1]&&(y[1]=i[o][s][1]);for(f[0]=Math.floor((g[0]-(g[0]-c[0])%r-c[0])/r),f[1]=Math.ceil((g[1]-(g[1]-c[1])%r-c[0])/r),d[0]=Math.floor((y[0]-(y[0]-p[0])%r-p[0])/r),d[1]=Math.ceil((y[1]-(y[1]-p[1])%r-p[0])/r),s=f[0];s<=f[1];s++)for(a=d[0];a<=d[1];a++)u=c[0]+s*r,l=p[0]+a*r,e(i[o],u,l)&&(v[s][a]=t.predict(u,l,n))}return v.xlim=c,v.ylim=p,v.zlim=[Math.min(...n.t),Math.max(...n.t)],v.width=r,v}},t.contour=function(t,e,i){},t.plot=function(t,e,i,n,r){var o=t.getContext("2d");o.clearRect(0,0,t.width,t.height);var s,a,h,u,l,c=[i[1]-i[0],n[1]-n[0],e.zlim[1]-e.zlim[0]],p=e.length,f=e[0].length,d=Math.ceil(e.width*t.width/(i[1]-i[0])),g=Math.ceil(e.width*t.height/(n[1]-n[0]));for(s=0;s<p;s++)for(a=0;a<f;a++)null!=e[s][a]&&(h=t.width*(s*e.width+e.xlim[0]-i[0])/c[0],u=t.height*(1-(a*e.width+e.ylim[0]-n[0])/c[1]),(l=(e[s][a]-e.zlim[0])/c[2])<0&&(l=0),l>1&&(l=1),o.fillStyle=r[Math.floor((r.length-1)*l)],o.fillRect(Math.round(h-d/2),Math.round(u-g/2),d,g))},t}();const dw=function(t){var e,i,n,r,o,s=t.zlim[1]-t.zlim[0],a=t.length,h=t[0].length,u=[];for(e=0;e<a;e++)for(i=0;i<h;i++)n=e*t.width+t.xlim[0],r=i*t.width+t.ylim[0],(o=(t[e][i]-t.zlim[0])/s)<0&&(o=0),o>1&&(o=1),u.push(ch([n,r],{value:o}));return u};var gw=484813681109536e-20,yw=Math.PI/2,_w=1e-10,mw=.017453292519943295,vw=57.29577951308232,xw=Math.PI/4,ww=2*Math.PI,bw=3.14159265359,Cw={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Mw={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Ew=/[\s_\-\/\(\)]/g;function Sw(t,e){if(t[e])return t[e];for(var i,n=Object.keys(t),r=e.toLowerCase().replace(Ew,""),o=-1;++o<n.length;)if((i=n[o]).toLowerCase().replace(Ew,"")===r)return t[i]}function Pw(t){var e,i,n,r={},o=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t}),{}),s={proj:"projName",datum:"datumCode",rf:function(t){r.rf=parseFloat(t)},lat_0:function(t){r.lat0=t*mw},lat_1:function(t){r.lat1=t*mw},lat_2:function(t){r.lat2=t*mw},lat_ts:function(t){r.lat_ts=t*mw},lon_0:function(t){r.long0=t*mw},lon_1:function(t){r.long1=t*mw},lon_2:function(t){r.long2=t*mw},alpha:function(t){r.alpha=parseFloat(t)*mw},lonc:function(t){r.longc=t*mw},x_0:function(t){r.x0=parseFloat(t)},y_0:function(t){r.y0=parseFloat(t)},k_0:function(t){r.k0=parseFloat(t)},k:function(t){r.k0=parseFloat(t)},a:function(t){r.a=parseFloat(t)},b:function(t){r.b=parseFloat(t)},r_a:function(){r.R_A=!0},zone:function(t){r.zone=parseInt(t,10)},south:function(){r.utmSouth=!0},towgs84:function(t){r.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){r.to_meter=parseFloat(t)},units:function(t){r.units=t;var e=Sw(Mw,t);e&&(r.to_meter=e.to_meter)},from_greenwich:function(t){r.from_greenwich=t*mw},pm:function(t){var e=Sw(Cw,t);r.from_greenwich=(e||parseFloat(t))*mw},nadgrids:function(t){"@null"===t?r.datumCode="none":r.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(r.axis=t)}};for(e in o)i=o[e],e in s?"function"==typeof(n=s[e])?n(i):r[n]=i:r[e]=i;return"string"==typeof r.datumCode&&"WGS84"!==r.datumCode&&(r.datumCode=r.datumCode.toLowerCase()),r}var Iw=/\s/,Tw=/[A-Za-z]/,Lw=/[A-Za-z84_]/,Ow=/[,\]]/,Rw=/[\d\.E\-\+]/;function Nw(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function Aw(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var n=e?{}:t,r=i.reduce((function(t,e){return Dw(e,t),t}),n);e&&(t[e]=r)}function Dw(t,e){if(Array.isArray(t)){var i=t.shift();if("PARAMETER"===i&&(i=t.shift()),1===t.length)return Array.isArray(t[0])?(e[i]={},void Dw(t[0],e[i])):void(e[i]=t[0]);if(t.length)if("TOWGS84"!==i){if("AXIS"===i)return i in e||(e[i]=[]),void e[i].push(t);var n;switch(Array.isArray(i)||(e[i]={}),i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[i]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&Dw(t[2],e[i]));case"SPHEROID":case"ELLIPSOID":return e[i]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&Dw(t[3],e[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void Aw(e,i,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return Dw(t,e[i]);return Aw(e,i,t)}}else e[i]=t;else e[i]=!0}else e[t]=!0}Nw.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Iw.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},Nw.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(Ow.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},Nw.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Nw.prototype.number=function(t){if(!Rw.test(t)){if(Ow.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},Nw.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},Nw.prototype.keyword=function(t){if(Lw.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=1)}if(!Ow.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},Nw.prototype.neutral=function(t){if(Tw.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Rw.test(t))return this.word=t,void(this.state=3);if(!Ow.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},Nw.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function kw(t){return.017453292519943295*t}function Fw(t){var e=new Nw(t).output(),i=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",i]);var r={};return Dw(e,r),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,n=t.AXIS.length;i<n;++i){var r=[t.AXIS[i][0].toLowerCase(),t.AXIS[i][1].toLowerCase()];-1!==r[0].indexOf("north")||("y"===r[0]||"lat"===r[0])&&"north"===r[1]?e+="n":-1!==r[0].indexOf("south")||("y"===r[0]||"lat"===r[0])&&"south"===r[1]?e+="s":-1!==r[0].indexOf("east")||("x"===r[0]||"lon"===r[0])&&"east"===r[1]?e+="e":-1===r[0].indexOf("west")&&("x"!==r[0]&&"lon"!==r[0]||"west"!==r[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var o=t.GEOGCS;function s(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(o=t),o&&(o.DATUM?t.datumCode=o.DATUM.name.toLowerCase():t.datumCode=o.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(t.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=o.DATUM.SPHEROID.a,t.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(t.datum_params=o.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",kw],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",kw],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",kw],["lat0","latitude_of_origin",kw],["lat0","standard_parallel_1",kw],["lat1","standard_parallel_1",kw],["lat2","standard_parallel_2",kw],["azimuth","Azimuth"],["alpha","azimuth",kw],["srsCode","name"]].forEach((function(e){return i=t,r=(n=e)[0],o=n[1],void(!(r in i)&&o in i&&(i[r]=i[o],3===n.length&&(i[r]=n[2](i[r]))));var i,n,r,o})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=kw(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(r),r}function jw(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?jw[t]=Pw(arguments[1]):jw[t]=Fw(arguments[1]):jw[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?jw.apply(e,t):jw(t)}));if("string"==typeof t){if(t in jw)return jw[t]}else"EPSG"in t?jw["EPSG:"+t.EPSG]=t:"ESRI"in t?jw["ESRI:"+t.ESRI]=t:"IAU2000"in t?jw["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(jw);var Gw=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var zw=["3857","900913","3785","102113"];function Bw(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in jw}(t))return jw[t];if(function(t){return Gw.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=Fw(t);if(function(t){var e=Sw(t,"authority");if(e){var i=Sw(e,"epsg");return i&&zw.indexOf(i)>-1}}(e))return jw["EPSG:3857"];var i=function(t){var e=Sw(t,"extension");if(e)return Sw(e,"proj4")}(e);return i?Pw(i):e}return function(t){return"+"===t[0]}(t)?Pw(t):void 0}function Vw(t,e){var i,n;if(t=t||{},!e)return t;for(n in e)void 0!==(i=e[n])&&(t[n]=i);return t}function Hw(t,e,i){var n=t*e;return i/Math.sqrt(1-n*n)}function qw(t){return t<0?-1:1}function Zw(t){return Math.abs(t)<=bw?t:t-qw(t)*ww}function Uw(t,e,i){var n=t*i,r=.5*t;return n=Math.pow((1-n)/(1+n),r),Math.tan(.5*(yw-e))/n}function Ww(t,e){for(var i,n,r=.5*t,o=yw-2*Math.atan(e),s=0;s<=15;s++)if(i=t*Math.sin(o),o+=n=yw-2*Math.atan(e*Math.pow((1-i)/(1+i),r))-o,Math.abs(n)<=1e-10)return o;return-9999}var Yw={init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Hw(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,n=t.x,r=t.y;if(r*vw>90&&r*vw<-90&&n*vw>180&&n*vw<-180)return null;if(Math.abs(Math.abs(r)-yw)<=_w)return null;if(this.sphere)e=this.x0+this.a*this.k0*Zw(n-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(xw+.5*r));else{var o=Math.sin(r),s=Uw(this.e,r,o);e=this.x0+this.a*this.k0*Zw(n-this.long0),i=this.y0-this.a*this.k0*Math.log(s)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n=t.x-this.x0,r=t.y-this.y0;if(this.sphere)i=yw-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var o=Math.exp(-r/(this.a*this.k0));if(-9999===(i=Ww(this.e,o)))return null}return e=Zw(this.long0+n/(this.a*this.k0)),t.x=e,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]};function Xw(t){return t}var Jw=[Yw,{init:function(){},forward:Xw,inverse:Xw,names:["longlat","identity"]}],Qw={},Kw=[];function $w(t,e){var i=Kw.length;return t.names?(Kw[i]=t,t.names.forEach((function(t){Qw[t.toLowerCase()]=i})),this):(console.log(e),!0)}var tb={start:function(){Jw.forEach($w)},add:$w,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==Qw[e]&&Kw[Qw[e]]?Kw[Qw[e]]:void 0}},eb={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},ib=eb.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};eb.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var nb={};function rb(t,e){if(!(this instanceof rb))return new rb(t);e=e||function(t){if(t)throw t};var i=Bw(t);if("object"==typeof i){var n=rb.projections.get(i.projName);if(n){if(i.datumCode&&"none"!==i.datumCode){var r=Sw(nb,i.datumCode);r&&(i.datum_params=r.towgs84?r.towgs84.split(","):null,i.ellps=r.ellipse,i.datumName=r.datumName?r.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84";var o=function(t,e,i,n,r){if(!t){var o=Sw(eb,n);o||(o=ib),t=o.a,e=o.b,i=o.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<_w)&&(r=!0,e=t),{a:t,b:e,rf:i,sphere:r}}(i.a,i.b,i.rf,i.ellps,i.sphere),s=function(t,e,i,n){var r=t*t,o=e*e,s=(r-o)/r,a=0;return n?(r=(t*=1-s*(.16666666666666666+s*(.04722222222222222+.022156084656084655*s)))*t,s=0):a=Math.sqrt(s),{es:s,e:a,ep2:(r-o)/o}}(o.a,o.b,o.rf,i.R_A),a=i.datum||function(t,e,i,n,r,o){var s={};return s.datum_type=void 0===t||"none"===t?5:4,e&&(s.datum_params=e.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=1),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=2,s.datum_params[3]*=gw,s.datum_params[4]*=gw,s.datum_params[5]*=gw,s.datum_params[6]=s.datum_params[6]/1e6+1))),s.a=i,s.b=n,s.es=r,s.ep2=o,s}(i.datumCode,i.datum_params,o.a,o.b,s.es,s.ep2);Vw(this,i),Vw(this,n),this.a=o.a,this.b=o.b,this.rf=o.rf,this.sphere=o.sphere,this.es=s.es,this.e=s.e,this.ep2=s.ep2,this.datum=a,this.init(),e(null,this)}else e(t)}else e(t)}function ob(t){return 1===t||2===t}function sb(t,e,i){return function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(1===t.datum_type?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:2!==t.datum_type||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e)||5===t.datum_type||5===e.datum_type?i:t.es!==e.es||t.a!==e.a||ob(t.datum_type)||ob(e.datum_type)?(i=function(t,e,i){var n,r,o,s,a=t.x,h=t.y,u=t.z?t.z:0;if(h<-yw&&h>-1.001*yw)h=-yw;else if(h>yw&&h<1.001*yw)h=yw;else{if(h<-yw)return{x:-1/0,y:-1/0,z:t.z};if(h>yw)return{x:1/0,y:1/0,z:t.z}}return a>Math.PI&&(a-=2*Math.PI),r=Math.sin(h),s=Math.cos(h),o=r*r,{x:((n=i/Math.sqrt(1-e*o))+u)*s*Math.cos(a),y:(n+u)*s*Math.sin(a),z:(n*(1-e)+u)*r}}(i,t.es,t.a),ob(t.datum_type)&&(i=function(t,e,i){if(1===e)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(2===e){var n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],h=i[5],u=i[6];return{x:u*(t.x-h*t.y+a*t.z)+n,y:u*(h*t.x+t.y-s*t.z)+r,z:u*(-a*t.x+s*t.y+t.z)+o}}}(i,t.datum_type,t.datum_params)),ob(e.datum_type)&&(i=function(t,e,i){if(1===e)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(2===e){var n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],h=i[5],u=i[6],l=(t.x-n)/u,c=(t.y-r)/u,p=(t.z-o)/u;return{x:l+h*c-a*p,y:-h*l+c+s*p,z:a*l-s*c+p}}}(i,e.datum_type,e.datum_params)),function(t,e,i,n){var r,o,s,a,h,u,l,c,p,f,d,g,y,_,m,v=1e-12,x=t.x,w=t.y,b=t.z?t.z:0;if(r=Math.sqrt(x*x+w*w),o=Math.sqrt(x*x+w*w+b*b),r/i<v){if(_=0,o/i<v)return m=-n,{x:t.x,y:t.y,z:t.z}}else _=Math.atan2(w,x);s=b/o,c=(a=r/o)*(1-e)*(h=1/Math.sqrt(1-e*(2-e)*a*a)),p=s*h,y=0;do{y++,u=e*(l=i/Math.sqrt(1-e*p*p))/(l+(m=r*c+b*p-l*(1-e*p*p))),g=(d=s*(h=1/Math.sqrt(1-u*(2-u)*a*a)))*c-(f=a*(1-u)*h)*p,c=f,p=d}while(g*g>1e-24&&y<30);return{x:_,y:Math.atan(d/Math.abs(f)),z:m}}(i,e.es,e.a,e.b)):i}function ab(t,e,i){var n,r,o,s=i.x,a=i.y,h=i.z||0,u={};for(o=0;o<3;o++)if(!e||2!==o||void 0!==i.z)switch(0===o?(n=s,r="x"):1===o?(n=a,r="y"):(n=h,r="z"),t.axis[o]){case"e":case"n":u[r]=n;break;case"w":case"s":u[r]=-n;break;case"u":void 0!==i[r]&&(u.z=n);break;case"d":void 0!==i[r]&&(u.z=-n);break;default:return null}return u}function hb(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function ub(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function lb(t,e,i){var n;return Array.isArray(i)&&(i=hb(i)),function(t){ub(t.x),ub(t.y)}(i),t.datum&&e.datum&&function(t,e){return(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode||(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode}(t,e)&&(i=lb(t,n=new rb("WGS84"),i),t=n),"enu"!==t.axis&&(i=ab(t,!1,i)),"longlat"===t.projName?i={x:i.x*mw,y:i.y*mw}:(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter}),i=t.inverse(i)),t.from_greenwich&&(i.x+=t.from_greenwich),i=sb(t.datum,e.datum,i),e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y}),"longlat"===e.projName?i={x:i.x*vw,y:i.y*vw}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter})),"enu"!==e.axis?ab(e,!0,i):i}nb.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},nb.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},nb.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nb.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nb.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},nb.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},nb.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},nb.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},nb.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},nb.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nb.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nb.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},nb.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},nb.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},nb.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},nb.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},nb.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},rb.projections=tb,rb.projections.start();var cb=rb("WGS84");function pb(t,e,i){var n,r,o;return Array.isArray(i)?(n=lb(t,e,i),3===i.length?[n.x,n.y,n.z]:[n.x,n.y]):(r=lb(t,e,i),2===(o=Object.keys(i)).length||o.forEach((function(t){"x"!==t&&"y"!==t&&(r[t]=i[t])})),r)}function fb(t){return t instanceof rb?t:t.oProj?t.oProj:rb(t)}function db(t,e,i){t=fb(t);var n,r=!1;return void 0===e?(e=t,t=cb,r=!0):(void 0!==e.x||Array.isArray(e))&&(i=e,e=t,t=cb,r=!0),e=fb(e),i?pb(t,e,i):(n={forward:function(i){return pb(t,e,i)},inverse:function(i){return pb(e,t,i)}},r&&(n.oProj=e),n)}var gb="AJSAJS",yb="AFAFAF",_b=65,mb=73,vb=79,xb=86,wb=90,bb={forward:Cb,inverse:function(t){var e=Pb(Lb(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:Mb};function Cb(t,e){return e=e||5,function(t,e){var i="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(r=t.easting,o=t.northing,s=t.zoneNumber,a=Tb(s),h=Math.floor(r/1e5),u=Math.floor(o/1e5)%20,function(t,e,i){var n=i-1,r=gb.charCodeAt(n),o=yb.charCodeAt(n),s=r+t-1,a=o+e,h=!1;return s>wb&&(s=s-wb+_b-1,h=!0),(s===mb||r<mb&&s>mb||(s>mb||r<mb)&&h)&&s++,(s===vb||r<vb&&s>vb||(s>vb||r<vb)&&h)&&++s===mb&&s++,s>wb&&(s=s-wb+_b-1),a>xb?(a=a-xb+_b-1,h=!0):h=!1,(a===mb||o<mb&&a>mb||(a>mb||o<mb)&&h)&&a++,(a===vb||o<vb&&a>vb||(a>vb||o<vb)&&h)&&++a===mb&&a++,a>xb&&(a=a-xb+_b-1),String.fromCharCode(s)+String.fromCharCode(a)}(h,u,a))+i.substr(i.length-5,e)+n.substr(n.length-5,e);var r,o,s,a,h,u}(function(t){var e,i,n,r,o,s,a,h,u=t.lat,l=t.lon,c=6378137,p=.00669438,f=.9996,d=Eb(u),g=Eb(l);h=Math.floor((l+180)/6)+1,180===l&&(h=60);u>=56&&u<64&&l>=3&&l<12&&(h=32);u>=72&&u<84&&(l>=0&&l<9?h=31:l>=9&&l<21?h=33:l>=21&&l<33?h=35:l>=33&&l<42&&(h=37));a=Eb(6*(h-1)-180+3),e=p/(1-p),i=c/Math.sqrt(1-p*Math.sin(d)*Math.sin(d)),n=Math.tan(d)*Math.tan(d),r=e*Math.cos(d)*Math.cos(d),o=Math.cos(d)*(g-a),s=c*((1-p/4-3*p*p/64-5*p*p*p/256)*d-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*d)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*d)-35*p*p*p/3072*Math.sin(6*d));var y=f*i*(o+(1-n+r)*o*o*o/6+(5-18*n+n*n+72*r-58*e)*o*o*o*o*o/120)+5e5,_=f*(s+i*Math.tan(d)*(o*o/2+(5-n+9*r+4*r*r)*o*o*o*o/24+(61-58*n+n*n+600*r-330*e)*o*o*o*o*o*o/720));u<0&&(_+=1e7);return{northing:Math.round(_),easting:Math.round(y),zoneNumber:h,zoneLetter:Ib(u)}}({lat:t[1],lon:t[0]}),e)}function Mb(t){var e=Pb(Lb(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Eb(t){return t*(Math.PI/180)}function Sb(t){return t/Math.PI*180}function Pb(t){var e=t.northing,i=t.easting,n=t.zoneLetter,r=t.zoneNumber;if(r<0||r>60)return null;var o,s,a,h,u,l,c,p,f,d=.9996,g=6378137,y=.00669438,_=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=i-5e5,v=e;n<"N"&&(v-=1e7),c=6*(r-1)-180+3,o=.006739496752268451,f=(p=v/d/6367449.145945056)+(3*_/2-27*_*_*_/32)*Math.sin(2*p)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*p)+151*_*_*_/96*Math.sin(6*p),s=g/Math.sqrt(1-y*Math.sin(f)*Math.sin(f)),a=Math.tan(f)*Math.tan(f),h=o*Math.cos(f)*Math.cos(f),u=.99330562*g/Math.pow(1-y*Math.sin(f)*Math.sin(f),1.5),l=m/(s*d);var x=f-s*Math.tan(f)/u*(l*l/2-(5+3*a+10*h-4*h*h-9*o)*l*l*l*l/24+(61+90*a+298*h+45*a*a-1.6983531815716497-3*h*h)*l*l*l*l*l*l/720);x=Sb(x);var w,b=(l-(1+2*a+h)*l*l*l/6+(5-2*h+28*a-3*h*h+8*o+24*a*a)*l*l*l*l*l/120)/Math.cos(f);if(b=c+Sb(b),t.accuracy){var C=Pb({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});w={top:C.lat,right:C.lon,bottom:x,left:b}}else w={lat:x,lon:b};return w}function Ib(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function Tb(t){var e=t%6;return 0===e&&(e=6),e}function Lb(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,n=null,r="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,o++}var s=parseInt(r,10);if(0===o||o+3>i)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(o++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+t;n=t.substring(o,o+=2);for(var h=Tb(s),u=function(t,e){var i=gb.charCodeAt(e-1),n=1e5,r=!1;for(;i!==t.charCodeAt(0);){if(++i===mb&&i++,i===vb&&i++,i>wb){if(r)throw"Bad character: "+t;i=_b,r=!0}n+=1e5}return n}(n.charAt(0),h),l=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var i=yb.charCodeAt(e-1),n=0,r=!1;for(;i!==t.charCodeAt(0);){if(++i===mb&&i++,i===vb&&i++,i>xb){if(r)throw"Bad character: "+t;i=_b,r=!0}n+=1e5}return n}(n.charAt(1),h);l<Ob(a);)l+=2e6;var c=i-o;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var p,f,d,g=c/2,y=0,_=0;return g>0&&(p=1e5/Math.pow(10,g),f=t.substring(o,o+g),y=parseFloat(f)*p,d=t.substring(o+g),_=parseFloat(d)*p),{easting:y+u,northing:_+l,zoneLetter:a,zoneNumber:s,accuracy:p}}function Ob(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Rb(t,e,i){if(!(this instanceof Rb))return new Rb(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Rb.fromMGRS=function(t){return new Rb(Mb(t))},Rb.prototype.toMGRS=function(t){return Cb([this.x,this.y],t)};var Nb=.046875,Ab=.01953125,Db=.01068115234375;function kb(t){var e=[];e[0]=1-t*(.25+t*(Nb+t*(Ab+t*Db))),e[1]=t*(.75-t*(Nb+t*(Ab+t*Db)));var i=t*t;return e[2]=i*(.46875-t*(.013020833333333334+.007120768229166667*t)),i*=t,e[3]=i*(.3645833333333333-.005696614583333333*t),e[4]=i*t*.3076171875,e}function Fb(t,e,i,n){return i*=e,e*=e,n[0]*t-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}function jb(t,e,i){for(var n=1/(1-e),r=t,o=20;o;--o){var s=Math.sin(r),a=1-e*s*s;if(r-=a=(Fb(r,s,Math.cos(r),i)-t)*(a*Math.sqrt(a))*n,Math.abs(a)<_w)return r}return r}var Gb={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=kb(this.es),this.ml0=Fb(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,i,n,r=t.x,o=t.y,s=Zw(r-this.long0),a=Math.sin(o),h=Math.cos(o);if(this.es){var u=h*s,l=Math.pow(u,2),c=this.ep2*Math.pow(h,2),p=Math.pow(c,2),f=Math.abs(h)>_w?Math.tan(o):0,d=Math.pow(f,2),g=Math.pow(d,2);e=1-this.es*Math.pow(a,2),u/=Math.sqrt(e);var y=Fb(o,a,h,this.en);i=this.a*(this.k0*u*(1+l/6*(1-d+c+l/20*(5-18*d+g+14*c-58*d*c+l/42*(61+179*g-g*d-479*d)))))+this.x0,n=this.a*(this.k0*(y-this.ml0+a*s*u/2*(1+l/12*(5-d+9*c+4*p+l/30*(61+g-58*d+270*c-330*d*c+l/56*(1385+543*g-g*d-3111*d))))))+this.y0}else{var _=h*Math.sin(s);if(Math.abs(Math.abs(_)-1)<_w)return 93;if(i=.5*this.a*this.k0*Math.log((1+_)/(1-_))+this.x0,n=h*Math.cos(s)/Math.sqrt(1-Math.pow(_,2)),(_=Math.abs(n))>=1){if(_-1>_w)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=i,t.y=n,t},inverse:function(t){var e,i,n,r,o=(t.x-this.x0)*(1/this.a),s=(t.y-this.y0)*(1/this.a);if(this.es)if(i=jb(e=this.ml0+s/this.k0,this.es,this.en),Math.abs(i)<yw){var a=Math.sin(i),h=Math.cos(i),u=Math.abs(h)>_w?Math.tan(i):0,l=this.ep2*Math.pow(h,2),c=Math.pow(l,2),p=Math.pow(u,2),f=Math.pow(p,2);e=1-this.es*Math.pow(a,2);var d=o*Math.sqrt(e)/this.k0,g=Math.pow(d,2);n=i-(e*=u)*g/(1-this.es)*.5*(1-g/12*(5+3*p-9*l*p+l-4*c-g/30*(61+90*p-252*l*p+45*f+46*l-g/56*(1385+3633*p+4095*f+1574*f*p)))),r=Zw(this.long0+d*(1-g/6*(1+2*p+l-g/20*(5+28*p+24*f+8*l*p+6*l-g/42*(61+662*p+1320*f+720*f*p))))/h)}else n=yw*qw(s),r=0;else{var y=Math.exp(o/this.k0),_=.5*(y-1/y),m=this.lat0+s/this.k0,v=Math.cos(m);e=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(_,2))),n=Math.asin(e),s<0&&(n=-n),r=0===_&&0===v?0:Zw(Math.atan2(_,v)+this.long0)}return t.x=r,t.y=n,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]};function zb(t){var e=Math.exp(t);return e=(e-1/e)/2}function Bb(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),n=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))}function Vb(t){var e=Math.abs(t);return e=function(t){var e=1+t,i=e-1;return 0===i?t:t*Math.log(e)/i}(e*(1+e/(Bb(1,e)+1))),t<0?-e:e}function Hb(t,e){for(var i,n=2*Math.cos(2*e),r=t.length-1,o=t[r],s=0;--r>=0;)i=n*o-s+t[r],s=o,o=i;return e+i*Math.sin(2*e)}function qb(t,e,i){for(var n,r,o=Math.sin(e),s=Math.cos(e),a=zb(i),h=function(t){var e=Math.exp(t);return(e+1/e)/2}(i),u=2*s*h,l=-2*o*a,c=t.length-1,p=t[c],f=0,d=0,g=0;--c>=0;)n=d,r=f,p=u*(d=p)-n-l*(f=g)+t[c],g=l*d-r+u*f;return[(u=o*h)*p-(l=s*a)*g,u*g+l*p]}var Zb={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),i*=e,this.cgb[1]=i*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i*=e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),i*=e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(e*(-24832/14175)-2.4)),i*=e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i*=e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),i*=e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i*=e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i*=e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i*=e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=.6650675310896665*i;var n=Hb(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var i,n=2*Math.cos(e),r=t.length-1,o=t[r],s=0;--r>=0;)i=n*o-s+t[r],s=o,o=i;return Math.sin(e)*i}(this.gtu,2*n))},forward:function(t){var e=Zw(t.x-this.long0),i=t.y;i=Hb(this.cbg,i);var n=Math.sin(i),r=Math.cos(i),o=Math.sin(e),s=Math.cos(e);i=Math.atan2(n,s*r),e=Math.atan2(o*r,Bb(n,r*s)),e=Vb(Math.tan(e));var a,h,u=qb(this.gtu,2*i,2*e);return i+=u[0],e+=u[1],Math.abs(e)<=2.623395162778?(a=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*i+this.Zb)+this.y0):(a=1/0,h=1/0),t.x=a,t.y=h,t},inverse:function(t){var e,i,n=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);if(r=(r-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var o=qb(this.utg,2*r,2*n);r+=o[0],n+=o[1],n=Math.atan(zb(n));var s=Math.sin(r),a=Math.cos(r),h=Math.sin(n),u=Math.cos(n);r=Math.atan2(s*u,Bb(h,u*a)),e=Zw((n=Math.atan2(h,u*a))+this.long0),i=Hb(this.cgb,r)}else e=1/0,i=1/0;return t.x=e,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]};var Ub={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(Zw(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*mw,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Zb.init.apply(this),this.forward=Zb.forward,this.inverse=Zb.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Wb(t,e){return Math.pow((1-t)/(1+t),e)}var Yb={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+xw)/(Math.pow(Math.tan(.5*this.lat0+xw),this.C)*Wb(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+xw),this.C)*Wb(this.e*Math.sin(i),this.ratexp))-yw,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,n=Math.pow(Math.tan(.5*i+xw)/this.K,1/this.C),r=20;r>0&&(i=2*Math.atan(n*Wb(this.e*Math.sin(t.y),-.5*this.e))-yw,!(Math.abs(i-t.y)<1e-14));--r)t.y=i;return r?(t.x=e,t.y=i,t):null},names:["gauss"]};var Xb={init:function(){Yb.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,n,r;return t.x=Zw(t.x-this.long0),Yb.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),n=Math.cos(t.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*n),t.x=r*i*Math.sin(t.x),t.y=r*(this.cosc0*e-this.sinc0*i*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,n,r,o;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,o=Math.sqrt(t.x*t.x+t.y*t.y)){var s=2*Math.atan2(o,this.R2);e=Math.sin(s),i=Math.cos(s),r=Math.asin(i*this.sinc0+t.y*e*this.cosc0/o),n=Math.atan2(t.x*e,o*this.cosc0*i-t.y*this.sinc0*e)}else r=this.phic0,n=0;return t.x=n,t.y=r,Yb.inverse.apply(this,[t]),t.x=Zw(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var Jb={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=_w&&(this.k0=.5*(1+qw(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=_w&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=_w&&(this.k0=.5*this.cons*Hw(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Uw(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Hw(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-yw,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,n,r,o,s,a=t.x,h=t.y,u=Math.sin(h),l=Math.cos(h),c=Zw(a-this.long0);return Math.abs(Math.abs(a-this.long0)-Math.PI)<=_w&&Math.abs(h+this.lat0)<=_w?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*u+this.coslat0*l*Math.cos(c)),t.x=this.a*e*l*Math.sin(c)+this.x0,t.y=this.a*e*(this.coslat0*u-this.sinlat0*l*Math.cos(c))+this.y0,t):(i=2*Math.atan(this.ssfn_(h,u,this.e))-yw,r=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=_w?(o=Uw(this.e,h*this.con,this.con*u),s=2*this.a*this.k0*o/this.cons,t.x=this.x0+s*Math.sin(a-this.long0),t.y=this.y0-this.con*s*Math.cos(a-this.long0),t):(Math.abs(this.sinlat0)<_w?(e=2*this.a*this.k0/(1+r*Math.cos(c)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*r*Math.cos(c))),t.y=e*(this.cosX0*n-this.sinX0*r*Math.cos(c))+this.y0),t.x=e*r*Math.sin(c)+this.x0,t))},inverse:function(t){var e,i,n,r,o;t.x-=this.x0,t.y-=this.y0;var s=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var a=2*Math.atan(s/(2*this.a*this.k0));return e=this.long0,i=this.lat0,s<=_w?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(a)*this.sinlat0+t.y*Math.sin(a)*this.coslat0/s),e=Math.abs(this.coslat0)<_w?this.lat0>0?Zw(this.long0+Math.atan2(t.x,-1*t.y)):Zw(this.long0+Math.atan2(t.x,t.y)):Zw(this.long0+Math.atan2(t.x*Math.sin(a),s*this.coslat0*Math.cos(a)-t.y*this.sinlat0*Math.sin(a))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=_w){if(s<=_w)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,n=s*this.cons/(2*this.a*this.k0),i=this.con*Ww(this.e,n),e=this.con*Zw(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else r=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,s<=_w?o=this.X0:(o=Math.asin(Math.cos(r)*this.sinX0+t.y*Math.sin(r)*this.cosX0/s),e=Zw(this.long0+Math.atan2(t.x*Math.sin(r),s*this.cosX0*Math.cos(r)-t.y*this.sinX0*Math.sin(r)))),i=-1*Ww(this.e,Math.tan(.5*(yw+o)));return t.x=e,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(yw+t))*Math.pow((1-e)/(1+e),.5*i)}};var Qb={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,n=1/this.rf,r=2*n-Math.pow(n,2),o=this.e=Math.sqrt(r);this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+o*e)/(1-o*e));this.K=s-this.alpha*a+this.alpha*o/2*h},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+i)+this.K,r=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(o))),a=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*s+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,i=t.y-this.y0,n=e/this.R,r=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(r))),a=this.lambda0+s/this.alpha,h=0,u=o,l=-1e3,c=0;Math.abs(u-l)>1e-7;){if(++c>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),l=u,u=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=a,t.y=u,t},names:["somerc"]};var Kb={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var n,r,o=Uw(this.e,this.lat0,t),s=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));if(s*s<1&&(s=1),isNaN(this.longc)){var a=Uw(this.e,this.lat1,Math.sin(this.lat1)),h=Uw(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(o,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(o,this.bl);var u=Math.pow(a,this.bl),l=Math.pow(h,this.bl);r=.5*((n=this.el/u)-1/n);var c=(this.el*this.el-l*u)/(this.el*this.el+l*u),p=(l-u)/(l+u),f=Zw(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(c*Math.tan(.5*this.bl*f)/p)/this.bl,this.long0=Zw(this.long0);var d=Zw(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*d)/r),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else n=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=n*Math.pow(o,this.bl),r=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(r*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))},forward:function(t){var e,i,n,r=t.x,o=t.y,s=Zw(r-this.long0);if(Math.abs(Math.abs(o)-yw)<=_w)n=o>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(xw+n*this.gamma0*.5)),e=-1*n*yw*this.al/this.bl;else{var a=Uw(this.e,o,Math.sin(o)),h=this.el/Math.pow(a,this.bl),u=.5*(h-1/h),l=.5*(h+1/h),c=Math.sin(this.bl*s),p=(u*Math.sin(this.gamma0)-c*Math.cos(this.gamma0))/l;i=Math.abs(Math.abs(p)-1)<=_w?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-p)/(1+p))/this.bl,e=Math.abs(Math.cos(this.bl*s))<=_w?this.al*this.bl*s:this.al*Math.atan2(u*Math.cos(this.gamma0)+c*Math.sin(this.gamma0),Math.cos(this.bl*s))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},inverse:function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*i/this.al),r=.5*(n-1/n),o=.5*(n+1/n),s=Math.sin(this.bl*e/this.al),a=(s*Math.cos(this.gamma0)+r*Math.sin(this.gamma0))/o,h=Math.pow(this.el/Math.sqrt((1+a)/(1-a)),1/this.bl);return Math.abs(a-1)<_w?(t.x=this.long0,t.y=yw):Math.abs(a+1)<_w?(t.x=this.long0,t.y=-1*yw):(t.y=Ww(this.e,h),t.x=Zw(this.long0-Math.atan2(r*Math.cos(this.gamma0)-s*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var $b={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<_w)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),n=Hw(this.e,e,i),r=Uw(this.e,this.lat1,e),o=Math.sin(this.lat2),s=Math.cos(this.lat2),a=Hw(this.e,o,s),h=Uw(this.e,this.lat2,o),u=Uw(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>_w?this.ns=Math.log(n/a)/Math.log(r/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=_w&&(i=qw(i)*(yw-2e-10));var n,r,o=Math.abs(Math.abs(i)-yw);if(o>_w)n=Uw(this.e,i,Math.sin(i)),r=this.a*this.f0*Math.pow(n,this.ns);else{if((o=i*this.ns)<=0)return null;r=0}var s=this.ns*Zw(e-this.long0);return t.x=this.k0*(r*Math.sin(s))+this.x0,t.y=this.k0*(this.rh-r*Math.cos(s))+this.y0,t},inverse:function(t){var e,i,n,r,o,s=(t.x-this.x0)/this.k0,a=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+a*a),i=1):(e=-Math.sqrt(s*s+a*a),i=-1);var h=0;if(0!==e&&(h=Math.atan2(i*s,i*a)),0!==e||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),-9999===(r=Ww(this.e,n)))return null}else r=-yw;return o=Zw(h/this.ns+this.long0),t.x=o,t.y=r,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var tC={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,i,n,r,o,s,a,h=t.x,u=t.y,l=Zw(h-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),n=-l*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),o=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(r)),s=this.n*o,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),t.y=a*Math.cos(s)/1,t.x=a*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,i,n,r,o,s,a,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),r=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,a=0;var u=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(a=1),s=t.y,u+=1}while(0===a&&u<15);return u>=15?null:t},names:["Krovak","krovak"]};function eC(t,e,i,n,r){return t*r-e*Math.sin(2*r)+i*Math.sin(4*r)-n*Math.sin(6*r)}function iC(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function nC(t){return.375*t*(1+.25*t*(1+.46875*t))}function rC(t){return.05859375*t*t*(1+.75*t)}function oC(t){return t*t*t*(35/3072)}function sC(t,e,i){var n=e*i;return t/Math.sqrt(1-n*n)}function aC(t){return Math.abs(t)<yw?t:t-qw(t)*Math.PI}function hC(t,e,i,n,r){var o,s;o=t/e;for(var a=0;a<15;a++)if(o+=s=(t-(e*o-i*Math.sin(2*o)+n*Math.sin(4*o)-r*Math.sin(6*o)))/(e-2*i*Math.cos(2*o)+4*n*Math.cos(4*o)-6*r*Math.cos(6*o)),Math.abs(s)<=1e-10)return o;return NaN}var uC={init:function(){this.sphere||(this.e0=iC(this.es),this.e1=nC(this.es),this.e2=rC(this.es),this.e3=oC(this.es),this.ml0=this.a*eC(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,n=t.x,r=t.y;if(n=Zw(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(r),Math.cos(n))-this.lat0);else{var o=Math.sin(r),s=Math.cos(r),a=sC(this.a,this.e,o),h=Math.tan(r)*Math.tan(r),u=n*Math.cos(r),l=u*u,c=this.es*s*s/(1-this.es);e=a*u*(1-l*h*(1/6-(8-h+8*c)*l/120)),i=this.a*eC(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+a*o/s*l*(.5+(5-h+6*c)*l/24)}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n=t.x/this.a,r=t.y/this.a;if(this.sphere){var o=r+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(o))}else{var s=hC(this.ml0/this.a+r,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-yw)<=_w)return t.x=this.long0,t.y=yw,r<0&&(t.y*=-1),t;var a=sC(this.a,this.e,Math.sin(s)),h=a*a*a/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(s),2),l=n*this.a/a,c=l*l;e=s-a*Math.tan(s)/h*l*l*(.5-(1+3*u)*l*l/24),i=l*(1-c*(u/3+(1+3*u)*u*c/15))/Math.cos(s)}return t.x=Zw(i+this.long0),t.y=aC(e),t},names:["Cassini","Cassini_Soldner","cass"]};function lC(t,e){var i;return t>1e-7?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e}var cC=.3333333333333333,pC=.17222222222222222,fC=.10257936507936508,dC=.06388888888888888,gC=.0664021164021164,yC=.016415012942191543;var _C={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-yw)<_w?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<_w?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=lC(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,i=[];return i[0]=t*cC,e=t*t,i[0]+=e*pC,i[1]=e*dC,e*=t,i[0]+=e*fC,i[1]+=e*gC,i[2]=e*yC,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=lC(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,n,r,o,s,a,h,u,l,c=t.x,p=t.y;if(c=Zw(c-this.long0),this.sphere){if(o=Math.sin(p),l=Math.cos(p),n=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+l*n:1+this.sinph0*o+this.cosph0*l*n)<=_w)return null;e=(i=Math.sqrt(2/i))*l*Math.sin(c),i*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*l*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(p+this.phi0)<_w)return null;i=xw-.5*p,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(c),i*=n}}else{switch(a=0,h=0,u=0,n=Math.cos(c),r=Math.sin(c),o=Math.sin(p),s=lC(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(a=s/this.qp,h=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:u=1+this.sinb1*a+this.cosb1*h*n;break;case this.EQUIT:u=1+h*n;break;case this.N_POLE:u=yw+p,s=this.qp-s;break;case this.S_POLE:u=p-yw,s=this.qp+s}if(Math.abs(u)<_w)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:u=Math.sqrt(2/u),i=this.mode===this.OBLIQ?this.ymf*u*(this.cosb1*a-this.sinb1*h*n):(u=Math.sqrt(2/(1+h*n)))*a*this.ymf,e=this.xmf*u*h*r;break;case this.N_POLE:case this.S_POLE:s>=0?(e=(u=Math.sqrt(s))*r,i=n*(this.mode===this.S_POLE?u:-u)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,r,o,s,a,h,u,l,c=t.x/this.a,p=t.y/this.a;if(this.sphere){var f,d=0,g=0;if((i=.5*(f=Math.sqrt(c*c+p*p)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(i),d=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(f)<=_w?0:Math.asin(p*g/f),c*=g,p=d*f;break;case this.OBLIQ:i=Math.abs(f)<=_w?this.phi0:Math.asin(d*this.sinph0+p*g*this.cosph0/f),c*=g*this.cosph0,p=(d-Math.sin(i)*this.sinph0)*f;break;case this.N_POLE:p=-p,i=yw-i;break;case this.S_POLE:i-=yw}e=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,p):0}else{if(a=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,p*=this.dd,(s=Math.sqrt(c*c+p*p))<_w)return t.x=0,t.y=this.phi0,t;r=2*Math.asin(.5*s/this.rq),n=Math.cos(r),c*=r=Math.sin(r),this.mode===this.OBLIQ?(a=n*this.sinb1+p*r*this.cosb1/s,o=this.qp*a,p=s*this.cosb1*n-p*this.sinb1*r):(a=p*r/s,o=this.qp*a,p=s*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(o=c*c+p*p))return t.x=0,t.y=this.phi0,t;a=1-o/this.qp,this.mode===this.S_POLE&&(a=-a)}e=Math.atan2(c,p),h=Math.asin(a),u=this.apa,l=h+h,i=h+u[0]*Math.sin(l)+u[1]*Math.sin(l+l)+u[2]*Math.sin(l+l+l)}return t.x=Zw(this.long0+e),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function mC(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var vC={init:function(){Math.abs(this.lat1+this.lat2)<_w||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Hw(this.e3,this.sin_po,this.cos_po),this.qs1=lC(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Hw(this.e3,this.sin_po,this.cos_po),this.qs2=lC(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=lC(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>_w?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=lC(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*Zw(e-this.long0),s=r*Math.sin(o)+this.x0,a=this.rh-r*Math.cos(o)+this.y0;return t.x=s,t.y=a,t},inverse:function(t){var e,i,n,r,o,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),r=0,0!==e&&(r=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,i)),o=Zw(r/this.ns0+this.long0),t.x=o,t.y=s,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,n,r,o,s=mC(.5*e);if(t<_w)return s;for(var a=t*t,h=1;h<=25;h++)if(s+=o=.5*(r=1-(n=t*(i=Math.sin(s)))*n)*r/Math.cos(s)*(e/(1-a)-i/r+.5/t*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return s;return null}};var xC={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i,n,r,o,s,a,h=t.x,u=t.y;return n=Zw(h-this.long0),e=Math.sin(u),i=Math.cos(u),r=Math.cos(n),1,(o=this.sin_p14*e+this.cos_p14*i*r)>0||Math.abs(o)<=_w?(s=this.x0+1*this.a*i*Math.sin(n)/o,a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*r)/o):(s=this.x0+this.infinity_dist*i*Math.sin(n),a=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*r)),t.x=s,t.y=a,t},inverse:function(t){var e,i,n,r,o,s;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(r=Math.atan2(e,this.rc),i=Math.sin(r),s=mC((n=Math.cos(r))*this.sin_p14+t.y*i*this.cos_p14/e),o=Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i),o=Zw(this.long0+o)):(s=this.phic0,o=0),t.x=o,t.y=s,t},names:["gnom"]};var wC={init:function(){this.sphere||(this.k0=Hw(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i,n=t.x,r=t.y,o=Zw(n-this.long0);if(this.sphere)e=this.x0+this.a*o*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var s=lC(this.e,Math.sin(r));e=this.x0+this.a*this.k0*o,i=this.y0+this.a*s*.5/this.k0}return t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=Zw(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*yw:yw;for(var n,r,o,s,a=Math.asin(.5*e),h=0;h<30;h++)if(r=Math.sin(a),o=Math.cos(a),s=t*r,a+=n=Math.pow(1-s*s,2)/(2*o)*(e/(1-t*t)-r/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return a;return NaN}(this.e,2*t.y*this.k0/this.a),e=Zw(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]};var bC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,n=Zw(e-this.long0),r=aC(i-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*r,t},inverse:function(t){var e=t.x,i=t.y;return t.x=Zw(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=aC(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var CC={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=iC(this.es),this.e1=nC(this.es),this.e2=rC(this.es),this.e3=oC(this.es),this.ml0=this.a*eC(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,n,r=t.x,o=t.y,s=Zw(r-this.long0);if(n=s*Math.sin(o),this.sphere)Math.abs(o)<=_w?(e=this.a*s,i=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(o),i=this.a*(aC(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=_w)e=this.a*s,i=-1*this.ml0;else{var a=sC(this.a,this.e,Math.sin(o))/Math.tan(o);e=a*Math.sin(n),i=this.a*eC(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+a*(1-Math.cos(n))}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){var e,i,n,r,o,s,a,h,u;if(n=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=_w)e=Zw(n/this.a+this.long0),i=0;else{var l;for(s=this.lat0+r/this.a,a=n*n/this.a/this.a+s*s,h=s,o=20;o;--o)if(h+=u=-1*(s*(h*(l=Math.tan(h))+1)-h-.5*(h*h+a)*l)/((h-s)/l-1),Math.abs(u)<=_w){i=h;break}e=Zw(this.long0+Math.asin(n*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(r+this.ml0)<=_w)i=0,e=Zw(this.long0+n/this.a);else{var c,p,f,d,g;for(s=(this.ml0+r)/this.a,a=n*n/this.a/this.a+s*s,h=s,o=20;o;--o)if(g=this.e*Math.sin(h),c=Math.sqrt(1-g*g)*Math.tan(h),p=this.a*eC(this.e0,this.e1,this.e2,this.e3,h),f=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),h-=u=(s*(c*(d=p/this.a)+1)-d-.5*c*(d*d+a))/(this.es*Math.sin(2*h)*(d*d+a-2*s*d)/(4*c)+(s-d)*(c*f-2/Math.sin(2*h))-f),Math.abs(u)<=_w){i=h;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=Zw(this.long0+Math.asin(n*c/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]};var MC={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,i=t.x,n=t.y-this.lat0,r=i-this.long0,o=n/gw*1e-5,s=r,a=1,h=0;for(e=1;e<=10;e++)a*=o,h+=this.A[e]*a;var u,l=h,c=s,p=1,f=0,d=0,g=0;for(e=1;e<=6;e++)u=f*l+p*c,p=p*l-f*c,f=u,d=d+this.B_re[e]*p-this.B_im[e]*f,g=g+this.B_im[e]*p+this.B_re[e]*f;return t.x=g*this.a+this.x0,t.y=d*this.a+this.y0,t},inverse:function(t){var e,i,n=t.x,r=t.y,o=n-this.x0,s=(r-this.y0)/this.a,a=o/this.a,h=1,u=0,l=0,c=0;for(e=1;e<=6;e++)i=u*s+h*a,h=h*s-u*a,u=i,l=l+this.C_re[e]*h-this.C_im[e]*u,c=c+this.C_im[e]*h+this.C_re[e]*u;for(var p=0;p<this.iterations;p++){var f,d=l,g=c,y=s,_=a;for(e=2;e<=6;e++)f=g*l+d*c,d=d*l-g*c,g=f,y+=(e-1)*(this.B_re[e]*d-this.B_im[e]*g),_+=(e-1)*(this.B_im[e]*d+this.B_re[e]*g);d=1,g=0;var m=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)f=g*l+d*c,d=d*l-g*c,g=f,m+=e*(this.B_re[e]*d-this.B_im[e]*g),v+=e*(this.B_im[e]*d+this.B_re[e]*g);var x=m*m+v*v;l=(y*m+_*v)/x,c=(_*m-y*v)/x}var w=l,b=c,C=1,M=0;for(e=1;e<=9;e++)C*=w,M+=this.D[e]*C;var E=this.lat0+M*gw*1e5,S=this.long0+b;return t.x=S,t.y=E,t},names:["New_Zealand_Map_Grid","nzmg"]};var EC={init:function(){},forward:function(t){var e=t.x,i=t.y,n=Zw(e-this.long0),r=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=r,t.y=o,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=Zw(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]};var SC={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=kb(this.es)},forward:function(t){var e,i,n=t.x,r=t.y;if(n=Zw(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(r),s=20;s;--s){var a=(this.m*r+Math.sin(r)-o)/(this.m+Math.cos(r));if(r-=a,Math.abs(a)<_w)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;e=this.a*this.C_x*n*(this.m+Math.cos(r)),i=this.a*this.C_y*r}else{var h=Math.sin(r),u=Math.cos(r);i=this.a*Fb(r,h,u,this.en),e=this.a*n*u/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i/=this.C_x*(this.m+Math.cos(e)),this.m?e=mC((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=mC(Math.sin(e)/this.n)),i=Zw(i+this.long0),e=aC(e)):(e=jb(t.y/this.a,this.es,this.en),(n=Math.abs(e))<yw?(n=Math.sin(e),i=Zw(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-_w<yw&&(i=this.long0)),t.x=i,t.y=e,t},names:["Sinusoidal","sinu"]};var PC={init:function(){},forward:function(t){for(var e=t.x,i=t.y,n=Zw(e-this.long0),r=i,o=Math.PI*Math.sin(i);;){var s=-(r+Math.sin(r)-o)/(1+Math.cos(r));if(r+=s,Math.abs(s)<_w)break}r/=2,Math.PI/2-Math.abs(i)<_w&&(n=0);var a=.900316316158*this.a*n*Math.cos(r)+this.x0,h=1.4142135623731*this.a*Math.sin(r)+this.y0;return t.x=a,t.y=h,t},inverse:function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=Zw(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var r=Math.asin(i);return t.x=n,t.y=r,t},names:["Mollweide","moll"]};var IC={init:function(){Math.abs(this.lat1+this.lat2)<_w||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=iC(this.es),this.e1=nC(this.es),this.e2=rC(this.es),this.e3=oC(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Hw(this.e,this.sinphi,this.cosphi),this.ml1=eC(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<_w?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Hw(this.e,this.sinphi,this.cosphi),this.ml2=eC(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=eC(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,i=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var r=eC(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-r)}var o=this.ns*Zw(i-this.long0),s=this.x0+e*Math.sin(o),a=this.y0+this.rh-e*Math.cos(o);return t.x=s,t.y=a,t},inverse:function(t){var e,i,n,r;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;return 0!==i&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere?(r=Zw(this.long0+o/this.ns),n=aC(this.g-i/this.a),t.x=r,t.y=n,t):(n=hC(this.g-i/this.a,this.e0,this.e1,this.e2,this.e3),r=Zw(this.long0+o/this.ns),t.x=r,t.y=n,t)},names:["Equidistant_Conic","eqdc"]};var TC={init:function(){this.R=this.a},forward:function(t){var e,i,n=t.x,r=t.y,o=Zw(n-this.long0);Math.abs(r)<=_w&&(e=this.x0+this.R*o,i=this.y0);var s=mC(2*Math.abs(r/Math.PI));(Math.abs(o)<=_w||Math.abs(Math.abs(r)-yw)<=_w)&&(e=this.x0,i=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*s):this.y0+Math.PI*this.R*-Math.tan(.5*s));var a=.5*Math.abs(Math.PI/o-o/Math.PI),h=a*a,u=Math.sin(s),l=Math.cos(s),c=l/(u+l-1),p=c*c,f=c*(2/u-1),d=f*f,g=Math.PI*this.R*(a*(c-d)+Math.sqrt(h*(c-d)*(c-d)-(d+h)*(p-d)))/(d+h);o<0&&(g=-g),e=this.x0+g;var y=h+c;return g=Math.PI*this.R*(f*y-a*Math.sqrt((d+h)*(h+1)-y*y))/(d+h),i=r>=0?this.y0+g:this.y0-g,t.x=e,t.y=i,t},inverse:function(t){var e,i,n,r,o,s,a,h,u,l,c,p;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,o=(n=t.x/c)*n+(r=t.y/c)*r,c=3*(r*r/(h=-2*(s=-Math.abs(r)*(1+o))+1+2*r*r+o*o)+(2*(a=s-2*r*r+n*n)*a*a/h/h/h-9*s*a/h/h)/27)/(u=(s-a*a/3/h)/h)/(l=2*Math.sqrt(-u/3)),Math.abs(c)>1&&(c=c>=0?1:-1),p=Math.acos(c)/3,i=t.y>=0?(-l*Math.cos(p+Math.PI/3)-a/3/h)*Math.PI:-(-l*Math.cos(p+Math.PI/3)-a/3/h)*Math.PI,e=Math.abs(n)<_w?this.long0:Zw(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-r*r)+o*o))/2/n),t.x=e,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var LC={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,n,r,o,s,a,h,u,l,c,p,f,d,g,y,_,m,v,x,w,b,C=t.x,M=t.y,E=Math.sin(t.y),S=Math.cos(t.y),P=Zw(C-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=_w?(t.x=this.x0+this.a*(yw-M)*Math.sin(P),t.y=this.y0-this.a*(yw-M)*Math.cos(P),t):Math.abs(this.sin_p12+1)<=_w?(t.x=this.x0+this.a*(yw+M)*Math.sin(P),t.y=this.y0+this.a*(yw+M)*Math.cos(P),t):(m=this.sin_p12*E+this.cos_p12*S*Math.cos(P),_=(y=Math.acos(m))/Math.sin(y),t.x=this.x0+this.a*_*S*Math.sin(P),t.y=this.y0+this.a*_*(this.cos_p12*E-this.sin_p12*S*Math.cos(P)),t):(e=iC(this.es),i=nC(this.es),n=rC(this.es),r=oC(this.es),Math.abs(this.sin_p12-1)<=_w?(o=this.a*eC(e,i,n,r,yw),s=this.a*eC(e,i,n,r,M),t.x=this.x0+(o-s)*Math.sin(P),t.y=this.y0-(o-s)*Math.cos(P),t):Math.abs(this.sin_p12+1)<=_w?(o=this.a*eC(e,i,n,r,yw),s=this.a*eC(e,i,n,r,M),t.x=this.x0+(o+s)*Math.sin(P),t.y=this.y0+(o+s)*Math.cos(P),t):(a=E/S,h=sC(this.a,this.e,this.sin_p12),u=sC(this.a,this.e,E),l=Math.atan((1-this.es)*a+this.es*h*this.sin_p12/(u*S)),v=0===(c=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(l)-this.sin_p12*Math.cos(P)))?Math.asin(this.cos_p12*Math.sin(l)-this.sin_p12*Math.cos(l)):Math.abs(Math.abs(c)-Math.PI)<=_w?-Math.asin(this.cos_p12*Math.sin(l)-this.sin_p12*Math.cos(l)):Math.asin(Math.sin(P)*Math.cos(l)/Math.sin(c)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),y=h*v*(1-(x=v*v)*(g=(f=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es))*f)*(1-g)/6+(w=x*v)/8*(d=p*f)*(1-2*g)+(b=w*v)/120*(g*(4-7*g)-3*p*p*(1-7*g))-b*v/48*d),t.x=this.x0+y*Math.sin(c),t.y=this.y0+y*Math.cos(c),t))},inverse:function(t){var e,i,n,r,o,s,a,h,u,l,c,p,f,d,g,y,_,m,v,x,w,b;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*yw*this.a)return;return i=e/this.a,n=Math.sin(i),r=Math.cos(i),o=this.long0,Math.abs(e)<=_w?s=this.lat0:(s=mC(r*this.sin_p12+t.y*n*this.cos_p12/e),a=Math.abs(this.lat0)-yw,o=Math.abs(a)<=_w?this.lat0>=0?Zw(this.long0+Math.atan2(t.x,-t.y)):Zw(this.long0-Math.atan2(-t.x,t.y)):Zw(this.long0+Math.atan2(t.x*n,e*this.cos_p12*r-t.y*this.sin_p12*n))),t.x=o,t.y=s,t}return h=iC(this.es),u=nC(this.es),l=rC(this.es),c=oC(this.es),Math.abs(this.sin_p12-1)<=_w?(s=hC(((p=this.a*eC(h,u,l,c,yw))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,h,u,l,c),o=Zw(this.long0+Math.atan2(t.x,-1*t.y)),t.x=o,t.y=s,t):Math.abs(this.sin_p12+1)<=_w?(p=this.a*eC(h,u,l,c,yw),s=hC(((e=Math.sqrt(t.x*t.x+t.y*t.y))-p)/this.a,h,u,l,c),o=Zw(this.long0+Math.atan2(t.x,t.y)),t.x=o,t.y=s,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),g=Math.atan2(t.x,t.y),f=sC(this.a,this.e,this.sin_p12),y=Math.cos(g),m=-(_=this.e*this.cos_p12*y)*_/(1-this.es),v=3*this.es*(1-m)*this.sin_p12*this.cos_p12*y/(1-this.es),b=1-m*(w=(x=e/f)-m*(1+m)*Math.pow(x,3)/6-v*(1+3*m)*Math.pow(x,4)/24)*w/2-x*w*w*w/6,d=Math.asin(this.sin_p12*Math.cos(w)+this.cos_p12*Math.sin(w)*y),o=Zw(this.long0+Math.asin(Math.sin(g)*Math.sin(w)/Math.cos(d))),s=Math.atan((1-this.es*b*this.sin_p12/Math.sin(d))*Math.tan(d)/(1-this.es)),t.x=o,t.y=s,t)},names:["Azimuthal_Equidistant","aeqd"]};var OC={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,n,r,o,s,a,h=t.x,u=t.y;return n=Zw(h-this.long0),e=Math.sin(u),i=Math.cos(u),r=Math.cos(n),1,((o=this.sin_p14*e+this.cos_p14*i*r)>0||Math.abs(o)<=_w)&&(s=1*this.a*i*Math.sin(n),a=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*r)),t.x=s,t.y=a,t},inverse:function(t){var e,i,n,r,o,s,a;return t.x-=this.x0,t.y-=this.y0,i=mC((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(i),r=Math.cos(i),s=this.long0,Math.abs(e)<=_w?(a=this.lat0,t.x=s,t.y=a,t):(a=mC(r*this.sin_p14+t.y*n*this.cos_p14/e),o=Math.abs(this.lat0)-yw,Math.abs(o)<=_w?(s=this.lat0>=0?Zw(this.long0+Math.atan2(t.x,-t.y)):Zw(this.long0-Math.atan2(-t.x,t.y)),t.x=s,t.y=a,t):(s=Zw(this.long0+Math.atan2(t.x*n,e*this.cos_p14*r-t.y*this.sin_p14*n)),t.x=s,t.y=a,t))},names:["ortho"]},RC=1,NC=2,AC=3,DC=4,kC=5,FC=6,jC=1,GC=2,zC=3,BC=4;function VC(t,e,i,n){var r;return t<_w?(n.value=jC,r=0):(r=Math.atan2(e,i),Math.abs(r)<=xw?n.value=jC:r>xw&&r<=yw+xw?(n.value=GC,r-=yw):r>yw+xw||r<=-(yw+xw)?(n.value=zC,r=r>=0?r-bw:r+bw):(n.value=BC,r+=yw)),r}function HC(t,e){var i=t+e;return i<-bw?i+=ww:i>+bw&&(i-=ww),i}var qC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=yw-xw/2?this.face=kC:this.lat0<=-(yw-xw/2)?this.face=FC:Math.abs(this.long0)<=xw?this.face=RC:Math.abs(this.long0)<=yw+xw?this.face=this.long0>0?NC:DC:this.face=AC,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,n,r,o,s,a={x:0,y:0},h={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===kC)r=yw-e,i>=xw&&i<=yw+xw?(h.value=jC,n=i-yw):i>yw+xw||i<=-(yw+xw)?(h.value=GC,n=i>0?i-bw:i+bw):i>-(yw+xw)&&i<=-xw?(h.value=zC,n=i+yw):(h.value=BC,n=i);else if(this.face===FC)r=yw+e,i>=xw&&i<=yw+xw?(h.value=jC,n=-i+yw):i<xw&&i>=-xw?(h.value=GC,n=-i):i<-xw&&i>=-(yw+xw)?(h.value=zC,n=-i-yw):(h.value=BC,n=i>0?-i+bw:-i-bw);else{var u,l,c,p,f,d;this.face===NC?i=HC(i,+yw):this.face===AC?i=HC(i,+bw):this.face===DC&&(i=HC(i,-yw)),p=Math.sin(e),f=Math.cos(e),d=Math.sin(i),u=f*Math.cos(i),l=f*d,c=p,this.face===RC?n=VC(r=Math.acos(u),c,l,h):this.face===NC?n=VC(r=Math.acos(l),c,-u,h):this.face===AC?n=VC(r=Math.acos(-u),c,-l,h):this.face===DC?n=VC(r=Math.acos(-l),c,u,h):(r=n=0,h.value=jC)}return s=Math.atan(12/bw*(n+Math.acos(Math.sin(n)*Math.cos(xw))-yw)),o=Math.sqrt((1-Math.cos(r))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),h.value===GC?s+=yw:h.value===zC?s+=bw:h.value===BC&&(s+=1.5*bw),a.x=o*Math.cos(s),a.y=o*Math.sin(s),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,t.x=a.x,t.y=a.y,t},inverse:function(t){var e,i,n,r,o,s,a,h,u,l,c,p,f={lam:0,phi:0},d={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?d.value=jC:t.y>=0&&t.y>=Math.abs(t.x)?(d.value=GC,e-=yw):t.x<0&&-t.x>=Math.abs(t.y)?(d.value=zC,e=e<0?e+bw:e-bw):(d.value=BC,e+=yw),u=bw/12*Math.tan(e),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),s=Math.atan(o),(a=1-(n=Math.cos(e))*n*(r=Math.tan(i))*r*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?a=-1:a>1&&(a=1),this.face===kC)h=Math.acos(a),f.phi=yw-h,d.value===jC?f.lam=s+yw:d.value===GC?f.lam=s<0?s+bw:s-bw:d.value===zC?f.lam=s-yw:f.lam=s;else if(this.face===FC)h=Math.acos(a),f.phi=h-yw,d.value===jC?f.lam=-s+yw:d.value===GC?f.lam=-s:d.value===zC?f.lam=-s-yw:f.lam=s<0?-s-bw:-s+bw;else{var g,y,_;u=(g=a)*g,y=(u+=(_=u>=1?0:Math.sqrt(1-u)*Math.sin(s))*_)>=1?0:Math.sqrt(1-u),d.value===GC?(u=y,y=-_,_=u):d.value===zC?(y=-y,_=-_):d.value===BC&&(u=y,y=_,_=-u),this.face===NC?(u=g,g=-y,y=u):this.face===AC?(g=-g,y=-y):this.face===DC&&(u=g,g=y,y=-u),f.phi=Math.acos(-_)-yw,f.lam=Math.atan2(y,g),this.face===NC?f.lam=HC(f.lam,-yw):this.face===AC?f.lam=HC(f.lam,-bw):this.face===DC&&(f.lam=HC(f.lam,+yw))}return 0!==this.es&&(l=f.phi<0?1:0,c=Math.tan(f.phi),p=this.b/Math.sqrt(c*c+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-p*p)/(this.one_minus_f*p)),l&&(f.phi=-f.phi)),f.lam+=this.long0,t.x=f.lam,t.y=f.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},ZC=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],UC=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],WC=.8487,YC=1.3523,XC=vw/5,JC=18,QC=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};var KC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=Zw(t.x-this.long0),i=Math.abs(t.y),n=Math.floor(i*XC);n<0?n=0:n>=JC&&(n=17);var r={x:QC(ZC[n],i=vw*(i-.08726646259971647*n))*e,y:QC(UC[n],i)};return t.y<0&&(r.y=-r.y),r.x=r.x*this.a*WC+this.x0,r.y=r.y*this.a*YC+this.y0,r},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*WC),y:Math.abs(t.y-this.y0)/(this.a*YC)};if(e.y>=1)e.x/=ZC[18][0],e.y=t.y<0?-yw:yw;else{var i=Math.floor(e.y*JC);for(i<0?i=0:i>=JC&&(i=17);;)if(UC[i][0]>e.y)--i;else{if(!(UC[i+1][0]<=e.y))break;++i}var n=UC[i],r=5*(e.y-n[0])/(UC[i+1][0]-n[0]);r=function(t,e,i,n){for(var r=e;n;--n){var o=t(r);if(r-=o,Math.abs(o)<i)break}return r}((function(t){return(QC(n,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(n,t)}),r,_w,100),e.x/=QC(ZC[i],r),e.y=(5*i+r)*mw,t.y<0&&(e.y=-e.y)}return e.x=Zw(e.x+this.long0),e},names:["Robinson","robin"]};db.defaultDatum="WGS84",db.Proj=rb,db.WGS84=new db.Proj("WGS84"),db.Point=Rb,db.toPoint=hb,db.defs=jw,db.transform=lb,db.mgrs=bb,db.version="2.5.0",function(t){t.Proj.projections.add(Gb),t.Proj.projections.add(Zb),t.Proj.projections.add(Ub),t.Proj.projections.add(Xb),t.Proj.projections.add(Jb),t.Proj.projections.add(Qb),t.Proj.projections.add(Kb),t.Proj.projections.add($b),t.Proj.projections.add(tC),t.Proj.projections.add(uC),t.Proj.projections.add(_C),t.Proj.projections.add(vC),t.Proj.projections.add(xC),t.Proj.projections.add(wC),t.Proj.projections.add(bC),t.Proj.projections.add(CC),t.Proj.projections.add(MC),t.Proj.projections.add(EC),t.Proj.projections.add(SC),t.Proj.projections.add(PC),t.Proj.projections.add(IC),t.Proj.projections.add(TC),t.Proj.projections.add(LC),t.Proj.projections.add(OC),t.Proj.projections.add(qC),t.Proj.projections.add(KC)}(db);t.Analysis=class{static getExteriorPoints(t){let e=Gp(t);if(null===e)return null;let i=dh([]);for(let n=1;n<e.geometry.coordinates[0].length;n++){const r=e.geometry.coordinates[0][n];let o=t.features.find((t=>t.geometry.coordinates[0]===r[0]&&t.geometry.coordinates[1]===r[1]));o&&i.features.push(o)}return i}static getExteriorPolygon(t){return Gp(t)}static buffer(t,e){if(0==t.features.length)return null;if(1==t.features.length)return qv(t.features[0],e);{let i=null;i=qv(t.features[0],e);for(let n=1;n<t.features.length;n++)i=pw(i.geometry,qv(t.features[n],e));return i}}static batchBooleanEqual(t){let e=t[0];for(let i=1;i<t.length;i++){if(!Jl(t[i].geometry,e.geometry))return!1;e=t[i]}return!0}static getCenterOfMass(t){switch(Ih(t)){case"Polygon":case"MultiPolygon":return Jv(t,{properties:t.properties});default:return console.error("数据类型仅支持【polygon|multiPolygon】"),null}}static krigingVectorContour(t,e,i,n){if(t.length<=3)throw new Error(rh.INVALID_SAMPlE_DATA_KRIGING);for(var r=[],o=[],s=[],a=0;a<t.length;a++){var h=t[a];r.push(h[2]),o.push(h[0]),s.push(h[1])}const u=fw.train(r,o,s,i.model,i.sigma2,i.alpha),l=n?zp(n):[Math.min(...o),Math.min(...s),Math.max(...o),Math.max(...s)],c=[[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]]];let p=fw.grid(c,u,(l[2]-l[0])/200);const f=aw(dh(dw(p)),e,{zProperty:"value"});if(n){return Vc.GetIntersections(f,n)}return f}},t.ArcConnectorLine=Jr,t.ArcCurve=Gr,t.AreaTool=jo,t.CRS=Ei,t.CanvasLayer=sa,t.CanvasTileLayer=Hs,t.Circle=Ar,t.ClusterLayer=lp,t.Common=oh,t.ConnectorLine=Xr,t.Coordinate=Mi,t.CubicBezierCurve=zr,t.CustomCtl=fp,t.DistanceTool=Fo,t.DrawTool=ro,t.EchartsMarker=class extends dp{constructor(t,e,i,n){let r=document.createElement("div");r.style.cssText=`width:${e[0]}px; height:${e[1]}px;`,n&&(r.id=n),super(t,{content:r,dx:0,dy:0,single:!1}),this._echarts=echarts.init(r),this._echarts.setOption(i)}get echarts(){return this._echarts}},t.Ellipse=Dr,t.Extent=ji,t.GeoJSON=Nr,t.Geometry=Un,t.GeometryCollection=Er,t.GroupTileLayer=Gs,t.HeatLayer=Jc,t.INTERNAL_LAYER_PREFIX=e,t.IdwLayer=ep,t.ImageLayer=ta,t.Label=Ur,t.Layer=Yn,t.LineString=Mr,t.MapTool=io,t.MapX=class extends nr{constructor(t,e){super(t,e=Object.assign({doubleClickZoom:!1,attribution:!1,dragRotate:!1,dragPitch:!1,declutter:!1,declutterLayerIds:[],declutterInMaxZoom:!0,showAttribution:!1,attributionPosition:"bottom-left",attributionContent:"<p style='font-weight:bold;color:black;text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;'>{{x}},{{y}}</p>"},e)),this.initView=this.getView(),this.events=new Map,this._declutter=e.declutter,this._declutterLayerIds=e.declutterLayerIds,this._declutterInMaxZoom=e.declutterInMaxZoom,this._showAttribution=e.showAttribution,this._attributionPosition=e.attributionPosition,this._attributionContent=e.attributionContent,this._attributionControl=new fs.Attribution({content:"",position:this._attributionPosition}).addTo(this),this._tip=new is.UIMarker([0,0],{content:"",animation:!1}).hide().addTo(this),this._interLayers=new Map,this._clickGeos=[];let i=this;const n=new to(ih.highlightLayer.id,null,ih.highlightLayer).addTo(i),r=new to(ih.flashLayer.id,null,ih.flashLayer).addTo(i),o=new to(ih.animateLayer.id,null,ih.animateLayer).addTo(i),s=new to(ih.antsLayer.id,null,ih.antsLayer).addTo(i),a=new to(ih.imgAntsLayer.id,null,ih.imgAntsLayer).addTo(i);i._interLayers.set("highlight",n),i._interLayers.set("flash",r),i._interLayers.set("animate",o),i._interLayers.set("ants",s),i._interLayers.set("imgAnts",a),i.on("mousemove",(t=>{if(this._showAttribution){const e=i._attributionContent.replace("{{x}}",t.coordinate.x.toFixed(3)).replace("{{y}}",t.coordinate.y.toFixed(3));i._attributionControl.config("content",e),i._attributionControl.update()}})),i.on("zoomend",(t=>{e.declutter&&(i._declutterInMaxZoom||t.to!==i.getMaxZoom()?(i._declutter=void 0!==e.declutter&&e.declutter,i._declutter&&i.declutterInZoom(t.to)):i.showAllDeclutterGeos(i._declutterLayerIds))})),i.on("addlayer",(t=>{t.layers.forEach((t=>{const e=t.getId();t instanceof ah&&i._declutter&&i._declutterLayerIds.includes(e)&&(t.on("addgeo",(t=>{i._declutter&&oh.isInZoomInterval(i.getZoom(),t.target)&&i.declutterInZoom(i.getZoom())})),t.on("removegeo",(t=>{i._declutter&&oh.isInZoomInterval(i.getZoom(),t.target)&&i.declutterInZoom(i.getZoom())})),t.on("clear",(t=>{i._declutter&&oh.isInZoomInterval(i.getZoom(),t.target)&&i.declutterInZoom(i.getZoom())}))),t instanceof sh&&t.getCount()>0&&t._fitExtent&&i.fitExtent(t.getExtent(),0)})),i._declutter&&i.declutterInZoom(i.getZoom())})),i.on("click",(t=>{const e=t.target;e.identify({coordinate:t.coordinate,layers:e.getLayers((t=>t instanceof sh&&t.getStyle()&&t.getStyle().clickSymbol))},(t=>{0===t.length&&(e._clickGeos.forEach((t=>{t.setSymbol(oh.delSymbol(t.getSymbol(),"clickSymbol"))})),e._clickGeos.length=0)}));const i=e.getLayers((t=>t instanceof sh&&t._events.click.size>0));e.identify({coordinate:t.coordinate,layers:i},(e=>{i.forEach((i=>{const n=e.filter((t=>t.getLayer().getId()===i.getId()));i._events.click.forEach((e=>{e.on&&e.callback(n,t.coordinate)}))}))}))}))}get declutter(){return this._declutter}set declutter(t){if(t&&0===this._declutterLayerIds.length)throw new Error(rh.NONE_ORDER_LAYERS);t?this.declutterInZoom(this.getZoom()):this.showAllDeclutterGeos(this._declutterLayerIds),this._declutter=t}showAllDeclutterGeos(t){const e=this;t.forEach((t=>{const i=e.getLayer(t);i&&i.forEach((t=>{t.declutterShowHideFlag=!0}))}))}declutterInZoom(t){const e=this;let i=new Ba;e._declutterLayerIds.forEach((n=>{const r=e.getLayer(n);r&&r.isVisible()&&oh.isInZoomInterval(t,r)&&(r.hide(),e.updateMarkerDeclutter(r,t,i),r.show())}))}addDeclutterlayerIds(t){this._declutterLayerIds=Array.from(new Set(this._declutterLayerIds.concat(t))),this._declutter&&this.declutterInZoom(this.getZoom())}removeDeclutterlayerIds(t){this._declutterLayerIds=this._declutterLayerIds.filter((e=>!t.includes(e))),this._declutter&&this.declutterInZoom(this.getZoom())}removeEvent(t){let e=this.events.get(t);null!=e&&this.off(t,e),this.events.delete(t)}addEvent(t,e,i){switch(t){case"click":case"dblclick":break;default:throw new Error(`不支持的事件类型: ${t}`)}let n=this,r=function(t){n.identify({coordinate:t.coordinate,layers:n.getLayers((t=>!i||(Array.isArray(i)?i.includes(t.getId()):i==t.getId())))},(i=>{e(i,t.coordinate)}))};this.on(t,r),this.events.set(t,r)}switchStyle(t){t?this.getBaseLayer().setOptions({cssFilter:""}):this.getBaseLayer().setOptions({cssFilter:"sepia(100%) invert(90%)"})}removeCover(t,e,i){if(e){let n=this._interLayers.get(e);if(n){const r=n.getGeometries((n=>{const r=n.config();return(!t||r.layerId===t)&&((!e||r.coverType===e)&&(!i||i(n)))}));r.map((t=>{t.remove()}))}}}updateMarkerDeclutter(t,e,i){const n=this;i=i||new Ba,t.getId();const r=t.getStyle().symbol,o=r.textSize||0,s={markerWidth:r.markerWidth||0,markerHeight:r.markerHeight||0,markerDy:r.markerDy||0,textHeight:r.textSize||0,textHaloRadius:r.textHaloRadius||0,textDy:r.textDy||0},a=t.getGeometries();for(let t=a.length;t>0;t--){const h=a[t-1],u=n.coordinateToPoint(h.getCoordinates(),e);let l=0,c=r.textName;"string"==typeof c&&(c.startsWith("{")&&c.endsWith("}")&&(c=h.getProperties()[c.slice(1,-1)]||""),l=oh.getTrueLength(c)/2*o*1.12);const p=oh.getBBox(h.getId(),u.x,u.y,{width:s.markerWidth,height:s.markerHeight,dy:s.markerDy},{width:l,height:s.textHeight,haloRadius:s.textHaloRadius,dy:s.textDy});0!==i.search(p).length?h.declutterShowHideFlag=!1:(i.insert(p),h.declutterShowHideFlag=!0)}}},t.Marker=br,t.MultiLineString=Lr,t.MultiPoint=Ir,t.MultiPolygon=Or,t.ParticleLayer=ha,t.Point=de,t.PointExtent=zi,t.Polygon=xr,t.QuadBezierCurve=Br,t.Rectangle=kr,t.RoutePlayer=sp,t.Sector=Fr,t.Size=ge,t.TextBox=Zr,t.TileLayerX=class extends js{constructor(t,e){super(t,e=Object.assign({forceRenderOnMoving:!0,forceRenderOnZooming:!0,forceRenderOnRotating:!0},e))}},t.TileSystem=ds,t.Tool=Vc,t.Transformation=Bi,t.Typhoon=class{constructor(t,e,i,n,r){this._options=n,this._realData=i,this._forcasts=r,this._map=e,this._name=t,this._rCircle={circle7:[],circle10:[],circle12:[]},this._fCircle={circle7:[],circle10:[],circle12:[]},this._focus=n.focus||!1;let o=this;const s={circleLayerZIndex:o._options.baseZIndex+10,forcastCircleLayerZIndex:o._options.baseZIndex+11,pointLayerZIndex:o._options.baseZIndex+31,forcastPointLayerZIndex:o._options.baseZIndex+30,realLineLayerZIndex:o._options.baseZIndex+6,forcastLineLayerZIndex:o._options.baseZIndex+5};this._fPointLayer=new ah(`${t}-typhoonForcastPoint`,void 0,{zIndex:s.forcastPointLayerZIndex,style:{symbol:this._options.pointSymbol}}).addTo(e),this._fLineLayer=new Hc(`${t}-typhoonForcastLine`,void 0,{zIndex:s.forcastLineLayerZIndex,style:{symbol:this._options.forcastLineSymbol}}).addTo(e),this._realPointLayer=new ah(`${this._name}-typhoonPoint`,this._realData,{zIndex:s.pointLayerZIndex,style:{symbol:this._options.pointSymbol}}).addTo(this._map),this._realPointLayer.getCount()<1&&console.log("台风实测点图层无有效数据"),this._realPointLayer.forEach((t=>{t.hide()})),this._rCircleLayer=new to(`${t}-typhoonCircle`,void 0,{zIndex:s.circleLayerZIndex}).addTo(e),this._fCircleLayer=new to(`${t}-typhoonForcastCircle`,void 0,{zIndex:s.forcastCircleLayerZIndex}).addTo(e);let a=this._realPointLayer.getFirstGeometry();if(a.getProperties()&&(this._rCircle.circle7=this.createTyphoonCircle(a.getCoordinates(),a.getProperties().radius7,this._options.circleSymbol,{level:7},1),this._rCircle.circle10=this.createTyphoonCircle(a.getCoordinates(),a.getProperties().radius10,this._options.circleSymbol,{level:10},2),this._rCircle.circle12=this.createTyphoonCircle(a.getCoordinates(),a.getProperties().radius12,this._options.circleSymbol,{level:12},3),o._rCircleLayer.addGeometry(this._rCircle.circle7.concat(this._rCircle.circle10).concat(this._rCircle.circle12))),this._icon=new br(this._realPointLayer.getFirstGeometry().getFirstCoordinate(),{symbol:this._options.iconSymbol}),this._rCircleLayer.addGeometry(o._icon),this._icon.bringToFront(),o._rCircleLayer.hide(),1===this._realPointLayer.getCount())return;let h=[{path:this.dataConvert(this._realData),markerSymbol:[],lineSymbol:this._options.realLineSymbol,trailLineSymbol:this._options.realLineSymbol}];this._player=new sp(h,e,{unitTime:this._options.unitTime,showRoutes:!1,showTrail:!0,maxTrailLine:0}),this._player.lineLayer.setZIndex(s.realLineLayerZIndex);let u=o._realPointLayer.getFirstGeometry().getProperties();if(this._player.on("playing",(function(t){let e=t.target.getCurrentProperties(0),i=t.target.getCurrentCoordinates(0);i&&(o._focus&&o._map.setCenter(i),e&&e.id==u.id||o._realPointLayer.getGeometries((t=>t.getProperties().id==u.id)).forEach((t=>{t.show(),n.playingCallBack&&i&&n.playingCallBack(u,i)})),e=e||u,o.updateTyphoonCircle(o._rCircle,i,e),o._icon.setCoordinates(i),u=e)})),this._player.on("playfinish",(function(){var t,e;const i=o._realPointLayer.getLastGeometry();i.show(),o._realPointLayer.forEach((t=>{t.setZIndex(o._realPointLayer.getGeoMaxZIndex()+1),t.show()})),o.updateTyphoonCircle(o._rCircle,i.getCoordinates(),i.getProperties()),o._icon.setCoordinates(i.getCoordinates()),n.playingCallBack&&n.playingCallBack(i.getProperties(),i.getCoordinates()),o._fLineLayer.show(),o._fPointLayer.show(),null===(t=o._player)||void 0===t||t.showRoute(),null===(e=o._player)||void 0===e||e.hideTrail(),n.finishCallBack&&n.finishCallBack(i.getProperties(),i.getCoordinates())})),!this._forcasts||0===this._forcasts.length)return;o._forcasts&&this.updateForcast(o._forcasts),this._fPointLayer.hide(),this._fLineLayer.hide();const l=this._fPointLayer.getLastGeometry();this._fCircle.circle7=this.createTyphoonCircle(l.getCoordinates(),l.getProperties().radius7,this._options.circleSymbol,{level:7},1),this._fCircle.circle10=this.createTyphoonCircle(l.getCoordinates(),l.getProperties().radius10,this._options.circleSymbol,{level:10},2),this._fCircle.circle12=this.createTyphoonCircle(l.getCoordinates(),l.getProperties().radius12,this._options.circleSymbol,{level:12},3),o._fCircleLayer.addGeometry(this._fCircle.circle7.concat(this._fCircle.circle10).concat(this._fCircle.circle12)),o._fCircleLayer.hide()}get realPointLayer(){return this._realPointLayer}get forcastPointLayer(){return this._fPointLayer}updateForcast(t){this._fPointLayer.clear(),this._fLineLayer.clear(),t.forEach((t=>{let e=t.data;this._fPointLayer.addGeometry(e),this._fLineLayer.addGeometry(Vc.Point2Line(e,{id:t.id}))}))}switchRealPoint(t,e,i={showPoint:!1,showRoute:!1}){var n,r;let o=[];if(o="function"==typeof t?this._realPointLayer.getGeometries(t):Array.isArray(t)?this._realPointLayer.getGeometries((e=>e.getProperties()[t[0]]===t[1])):[t],o.length>0){const t=o[0];this.updateTyphoonCircle(this._rCircle,t.getCoordinates(),o[0].getProperties()),this._icon.setCoordinates(t.getCoordinates()),i.showPoint||this._realPointLayer.forEach((e=>{e.getZIndex()>t.getZIndex()?e.hide():e.show()}));const e=this._realPointLayer.getGeometries();let s=[],a=!0;for(let n=0;n<e.length;n++){const r=e[n];a?(r.show(),s.push(r.getCoordinates()),r.getCoordinates().equals(t.getCoordinates())&&(a=!1)):i.showRoute&&s.push(r.getCoordinates())}let h=new Mr(s);h.setSymbol(this._options.realLineSymbol),null===(n=this._player)||void 0===n||n.lineLayer.clear(),null===(r=this._player)||void 0===r||r.lineLayer.addGeometry(h)}e&&this.updateForcast(e)}showForcastCircle(t){const e=this;if(!e._fPointLayer)return;let i=[];if(i="function"==typeof t?e._fPointLayer.getGeometries(t):Array.isArray(t)?e._fPointLayer.getGeometries((e=>e.getProperties()[t[0]]===t[1])):[t],i.length>0){const t=i[0];this.updateTyphoonCircle(this._fCircle,t.getCoordinates(),t.getProperties()),e._fCircleLayer.show()}}hideForcastCircle(){this._fCircleLayer.hide()}updateTyphoonCircle(t,e,i={radius7:[0,0,0,0],radius10:[0,0,0,0],radius12:[0,0,0,0]}){i=Object.assign({radius7:[0,0,0,0],radius10:[0,0,0,0],radius12:[0,0,0,0]},i);for(let n=0;n<t.circle7.length;n++){let r=t.circle7[n];r.setRadius(1e3*i.radius7[n]),r.setCoordinates(e)}for(let n=0;n<t.circle10.length;n++){let r=t.circle10[n];r.setRadius(1e3*i.radius10[n]),r.setCoordinates(e)}for(let n=0;n<t.circle12.length;n++){let r=t.circle12[n];r.setRadius(1e3*i.radius12[n]),r.setCoordinates(e)}}play(){var t;let e=this;e._rCircleLayer.show(),e._iconInterValIndex=Number(setInterval((()=>{e._icon.setSymbol(e.ratateSymbol(e._icon.getSymbol(),20))}),200)),1==e._realPointLayer.getCount()?e._realPointLayer.getFirstGeometry().show():e._realPointLayer.getCount()>1&&(null===(t=e._player)||void 0===t||t.play())}clear(){var t,e,i;this._rCircleLayer.remove(),this._fCircleLayer.remove(),this._realPointLayer.remove(),null===(t=this._fPointLayer)||void 0===t||t.remove(),null===(e=this._fLineLayer)||void 0===e||e.remove(),null===(i=this._player)||void 0===i||i.remove(),this._iconInterValIndex&&clearInterval(this._iconInterValIndex)}dataConvert(t){let e=[];return t.features.forEach((t=>{t.properties&&t.properties.time?e.push([t.geometry.coordinates[0],t.geometry.coordinates[1],new Date(t.properties.time).getTime(),t.properties]):(console.log("台风点缺少必要属性【time】"),console.log(t.properties))})),e}ratateSymbol(t,e){return t[0].markerRotation+=e,t[0].markerRotation>360&&(t[0].markerRotation-=360),t}getCircleCoords(t,e){let i=[];t=db("EPSG:4326","EPSG:3857",t);for(let n=0;n<e.length;n++){let r=e[n];r*=1e3,r||(r=0);for(let e=180*n;e<=180*(n+1);e++){let n=.5*e,o=db("EPSG:3857","EPSG:4326",[t[0]+r*Math.cos(n*Math.PI/180-90),t[1]+r*Math.sin(n*Math.PI/180-90)]);i.push(o)}}return i.push(i[0]),i}createTyphoonCircle(t,e=[0,0,0,0],i,n,r=0){let o=[];for(let s=0;s<e.length;s++){e[s],Object.assign(n,{directionIndex:s});const a=new Fr(t,1e3*e[s],90*s-90,0+90*s,{symbol:i,properties:n,zIndex:r});o.push(a)}return o}},t.UIMarker=dp,t.Util=Gt,t.VLayer=class{constructor(t,e,i){i=i||{},Object.assign({forceRenderOnMoving:!0,forceRenderOnZooming:!0},i),i.style&&i.style.symbol||Object.assign(i,{style:{symbol:{}}});let n="";if(e&&0!==e.features.length){n=e.features[0].geometry.type;const t=e.features.some((t=>t.type!==n));if(!t)throw new Error("数据错误，要素类别不一致")}else{if(!i||!i.geoType)throw new Error("初始化图层需要数据不为空或指定图层要素类型");n=i.geoType}switch(i.geoType=n,n){case"Point":return new ah(t,e,i);case"LineString":case"MultiLineString":return new Hc(t,e,i);case"Polygon":case"MultiPolygon":return new qc(t,e,i);default:throw new Error("无效或暂不支持的要素类型")}}},t.VectorLayer=to,t.WMSTileLayer=Vs,t.animation=yr,t.renderer=Na,t.ui=is,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log&&console.log("simplegis v0.18.9")}));
